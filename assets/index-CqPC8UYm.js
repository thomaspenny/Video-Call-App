(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();const gh=()=>{};var Ia={};const xc=function(n){const t=[];let e=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},ph=function(n){const t=[];let e=0,r=0;for(;e<n.length;){const s=n[e++];if(s<128)t[r++]=String.fromCharCode(s);else if(s>191&&s<224){const o=n[e++];t[r++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=n[e++],a=n[e++],l=n[e++],h=((s&7)<<18|(o&63)<<12|(a&63)<<6|l&63)-65536;t[r++]=String.fromCharCode(55296+(h>>10)),t[r++]=String.fromCharCode(56320+(h&1023))}else{const o=n[e++],a=n[e++];t[r++]=String.fromCharCode((s&15)<<12|(o&63)<<6|a&63)}}return t.join("")},Lc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const o=n[s],a=s+1<n.length,l=a?n[s+1]:0,h=s+2<n.length,d=h?n[s+2]:0,p=o>>2,E=(o&3)<<4|l>>4;let A=(l&15)<<2|d>>6,b=d&63;h||(b=64,a||(A=64)),r.push(e[p],e[E],e[A],e[b])}return r.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(xc(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):ph(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const o=e[n.charAt(s++)],l=s<n.length?e[n.charAt(s)]:0;++s;const d=s<n.length?e[n.charAt(s)]:64;++s;const E=s<n.length?e[n.charAt(s)]:64;if(++s,o==null||l==null||d==null||E==null)throw new _h;const A=o<<2|l>>4;if(r.push(A),d!==64){const b=l<<4&240|d>>2;if(r.push(b),E!==64){const N=d<<6&192|E;r.push(N)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class _h extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const yh=function(n){const t=xc(n);return Lc.encodeByteArray(t,!0)},Ur=function(n){return yh(n).replace(/\./g,"")},Eh=function(n){try{return Lc.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function Th(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const vh=()=>Th().__FIREBASE_DEFAULTS__,Ih=()=>{if(typeof process>"u"||typeof Ia>"u")return;const n=Ia.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},wh=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=n&&Eh(n[1]);return t&&JSON.parse(t)},Di=()=>{try{return gh()||vh()||Ih()||wh()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Ah=n=>Di()?.emulatorHosts?.[n],Sh=n=>{const t=Ah(n);if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),r]:[t.substring(0,e),r]},Fc=()=>Di()?.config;class Rh{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,r)=>{e?this.reject(e):this.resolve(r),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,r))}}}function ki(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Ch(n){return(await fetch(n,{credentials:"include"})).ok}function bh(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e={alg:"none",type:"JWT"},r=t||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Ur(JSON.stringify(e)),Ur(JSON.stringify(a)),""].join(".")}const Pn={};function Ph(){const n={prod:[],emulator:[]};for(const t of Object.keys(Pn))Pn[t]?n.emulator.push(t):n.prod.push(t);return n}function Vh(n){let t=document.getElementById(n),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",n),e=!0),{created:e,element:t}}let wa=!1;function Dh(n,t){if(typeof window>"u"||typeof document>"u"||!ki(window.location.host)||Pn[n]===t||Pn[n]||wa)return;Pn[n]=t;function e(A){return`__firebase__banner__${A}`}const r="__firebase__banner",o=Ph().prod.length>0;function a(){const A=document.getElementById(r);A&&A.remove()}function l(A){A.style.display="flex",A.style.background="#7faaf0",A.style.position="fixed",A.style.bottom="5px",A.style.left="5px",A.style.padding=".5em",A.style.borderRadius="5px",A.style.alignItems="center"}function h(A,b){A.setAttribute("width","24"),A.setAttribute("id",b),A.setAttribute("height","24"),A.setAttribute("viewBox","0 0 24 24"),A.setAttribute("fill","none"),A.style.marginLeft="-6px"}function d(){const A=document.createElement("span");return A.style.cursor="pointer",A.style.marginLeft="16px",A.style.fontSize="24px",A.innerHTML=" &times;",A.onclick=()=>{wa=!0,a()},A}function p(A,b){A.setAttribute("id",b),A.innerText="Learn more",A.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",A.setAttribute("target","__blank"),A.style.paddingLeft="5px",A.style.textDecoration="underline"}function E(){const A=Vh(r),b=e("text"),N=document.getElementById(b)||document.createElement("span"),x=e("learnmore"),D=document.getElementById(x)||document.createElement("a"),G=e("preprendIcon"),K=document.getElementById(G)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(A.created){const W=A.element;l(W),p(D,x);const Tt=d();h(K,G),W.append(K,N,D,Tt),document.body.appendChild(W)}o?(N.innerText="Preview backend disconnected.",K.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(K.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,N.innerText="Preview backend running in this workspace."),N.setAttribute("id",b)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",E):E()}function kh(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Nh(){const n=Di()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Oh(){return!Nh()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Mh(){try{return typeof indexedDB=="object"}catch{return!1}}function xh(){return new Promise((n,t)=>{try{let e=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{t(s.error?.message||"")}}catch(e){t(e)}})}const Lh="FirebaseError";class rn extends Error{constructor(t,e,r){super(e),this.code=t,this.customData=r,this.name=Lh,Object.setPrototypeOf(this,rn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Bc.prototype.create)}}class Bc{constructor(t,e,r){this.service=t,this.serviceName=e,this.errors=r}create(t,...e){const r=e[0]||{},s=`${this.service}/${t}`,o=this.errors[t],a=o?Fh(o,r):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new rn(s,l,r)}}function Fh(n,t){return n.replace(Bh,(e,r)=>{const s=t[r];return s!=null?String(s):`<${r}?>`})}const Bh=/\{\$([^}]+)}/g;function jr(n,t){if(n===t)return!0;const e=Object.keys(n),r=Object.keys(t);for(const s of e){if(!r.includes(s))return!1;const o=n[s],a=t[s];if(Aa(o)&&Aa(a)){if(!jr(o,a))return!1}else if(o!==a)return!1}for(const s of r)if(!e.includes(s))return!1;return!0}function Aa(n){return n!==null&&typeof n=="object"}function Qe(n){return n&&n._delegate?n._delegate:n}class Ln{constructor(t,e,r){this.name=t,this.instanceFactory=e,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const Ee="[DEFAULT]";class Uh{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const r=new Rh;if(this.instancesDeferred.set(e,r),this.isInitialized(e)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:e});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){const e=this.normalizeInstanceIdentifier(t?.identifier),r=t?.optional??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(qh(t))try{this.getOrInitializeService({instanceIdentifier:Ee})}catch{}for(const[e,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(e);try{const o=this.getOrInitializeService({instanceIdentifier:s});r.resolve(o)}catch{}}}}clearInstance(t=Ee){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=Ee){return this.instances.has(t)}getOptions(t=Ee){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,r=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:e});for(const[o,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(o);r===l&&a.resolve(s)}return s}onInit(t,e){const r=this.normalizeInstanceIdentifier(e),s=this.onInitCallbacks.get(r)??new Set;s.add(t),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&t(o,r),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const r=this.onInitCallbacks.get(e);if(r)for(const s of r)try{s(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:jh(t),options:e}),this.instances.set(t,r),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch{}return r||null}normalizeInstanceIdentifier(t=Ee){return this.component?this.component.multipleInstances?t:Ee:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function jh(n){return n===Ee?void 0:n}function qh(n){return n.instantiationMode==="EAGER"}class $h{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new Uh(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}var H;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(H||(H={}));const zh={debug:H.DEBUG,verbose:H.VERBOSE,info:H.INFO,warn:H.WARN,error:H.ERROR,silent:H.SILENT},Hh=H.INFO,Gh={[H.DEBUG]:"log",[H.VERBOSE]:"log",[H.INFO]:"info",[H.WARN]:"warn",[H.ERROR]:"error"},Kh=(n,t,...e)=>{if(t<n.logLevel)return;const r=new Date().toISOString(),s=Gh[t];if(s)console[s](`[${r}]  ${n.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Uc{constructor(t){this.name=t,this._logLevel=Hh,this._logHandler=Kh,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in H))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?zh[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,H.DEBUG,...t),this._logHandler(this,H.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,H.VERBOSE,...t),this._logHandler(this,H.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,H.INFO,...t),this._logHandler(this,H.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,H.WARN,...t),this._logHandler(this,H.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,H.ERROR,...t),this._logHandler(this,H.ERROR,...t)}}const Wh=(n,t)=>t.some(e=>n instanceof e);let Sa,Ra;function Qh(){return Sa||(Sa=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Xh(){return Ra||(Ra=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const jc=new WeakMap,ti=new WeakMap,qc=new WeakMap,zs=new WeakMap,Ni=new WeakMap;function Jh(n){const t=new Promise((e,r)=>{const s=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{e(ne(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",o),n.addEventListener("error",a)});return t.then(e=>{e instanceof IDBCursor&&jc.set(e,n)}).catch(()=>{}),Ni.set(t,n),t}function Yh(n){if(ti.has(n))return;const t=new Promise((e,r)=>{const s=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{e(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});ti.set(n,t)}let ei={get(n,t,e){if(n instanceof IDBTransaction){if(t==="done")return ti.get(n);if(t==="objectStoreNames")return n.objectStoreNames||qc.get(n);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return ne(n[t])},set(n,t,e){return n[t]=e,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function Zh(n){ei=n(ei)}function td(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const r=n.call(Hs(this),t,...e);return qc.set(r,t.sort?t.sort():[t]),ne(r)}:Xh().includes(n)?function(...t){return n.apply(Hs(this),t),ne(jc.get(this))}:function(...t){return ne(n.apply(Hs(this),t))}}function ed(n){return typeof n=="function"?td(n):(n instanceof IDBTransaction&&Yh(n),Wh(n,Qh())?new Proxy(n,ei):n)}function ne(n){if(n instanceof IDBRequest)return Jh(n);if(zs.has(n))return zs.get(n);const t=ed(n);return t!==n&&(zs.set(n,t),Ni.set(t,n)),t}const Hs=n=>Ni.get(n);function nd(n,t,{blocked:e,upgrade:r,blocking:s,terminated:o}={}){const a=indexedDB.open(n,t),l=ne(a);return r&&a.addEventListener("upgradeneeded",h=>{r(ne(a.result),h.oldVersion,h.newVersion,ne(a.transaction),h)}),e&&a.addEventListener("blocked",h=>e(h.oldVersion,h.newVersion,h)),l.then(h=>{o&&h.addEventListener("close",()=>o()),s&&h.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const rd=["get","getKey","getAll","getAllKeys","count"],sd=["put","add","delete","clear"],Gs=new Map;function Ca(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(Gs.get(t))return Gs.get(t);const e=t.replace(/FromIndex$/,""),r=t!==e,s=sd.includes(e);if(!(e in(r?IDBIndex:IDBObjectStore).prototype)||!(s||rd.includes(e)))return;const o=async function(a,...l){const h=this.transaction(a,s?"readwrite":"readonly");let d=h.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[e](...l),s&&h.done]))[0]};return Gs.set(t,o),o}Zh(n=>({...n,get:(t,e,r)=>Ca(t,e)||n.get(t,e,r),has:(t,e)=>!!Ca(t,e)||n.has(t,e)}));class id{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(od(e)){const r=e.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(e=>e).join(" ")}}function od(n){return n.getComponent()?.type==="VERSION"}const ni="@firebase/app",ba="0.14.6";const Gt=new Uc("@firebase/app"),ad="@firebase/app-compat",cd="@firebase/analytics-compat",ld="@firebase/analytics",ud="@firebase/app-check-compat",hd="@firebase/app-check",dd="@firebase/auth",fd="@firebase/auth-compat",md="@firebase/database",gd="@firebase/data-connect",pd="@firebase/database-compat",_d="@firebase/functions",yd="@firebase/functions-compat",Ed="@firebase/installations",Td="@firebase/installations-compat",vd="@firebase/messaging",Id="@firebase/messaging-compat",wd="@firebase/performance",Ad="@firebase/performance-compat",Sd="@firebase/remote-config",Rd="@firebase/remote-config-compat",Cd="@firebase/storage",bd="@firebase/storage-compat",Pd="@firebase/firestore",Vd="@firebase/ai",Dd="@firebase/firestore-compat",kd="firebase",Nd="12.6.0";const ri="[DEFAULT]",Od={[ni]:"fire-core",[ad]:"fire-core-compat",[ld]:"fire-analytics",[cd]:"fire-analytics-compat",[hd]:"fire-app-check",[ud]:"fire-app-check-compat",[dd]:"fire-auth",[fd]:"fire-auth-compat",[md]:"fire-rtdb",[gd]:"fire-data-connect",[pd]:"fire-rtdb-compat",[_d]:"fire-fn",[yd]:"fire-fn-compat",[Ed]:"fire-iid",[Td]:"fire-iid-compat",[vd]:"fire-fcm",[Id]:"fire-fcm-compat",[wd]:"fire-perf",[Ad]:"fire-perf-compat",[Sd]:"fire-rc",[Rd]:"fire-rc-compat",[Cd]:"fire-gcs",[bd]:"fire-gcs-compat",[Pd]:"fire-fst",[Dd]:"fire-fst-compat",[Vd]:"fire-vertex","fire-js":"fire-js",[kd]:"fire-js-all"};const qr=new Map,Md=new Map,si=new Map;function Pa(n,t){try{n.container.addComponent(t)}catch(e){Gt.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,e)}}function $r(n){const t=n.name;if(si.has(t))return Gt.debug(`There were multiple attempts to register component ${t}.`),!1;si.set(t,n);for(const e of qr.values())Pa(e,n);for(const e of Md.values())Pa(e,n);return!0}function xd(n,t){const e=n.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),n.container.getProvider(t)}function Ld(n){return n==null?!1:n.settings!==void 0}const Fd={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},re=new Bc("app","Firebase",Fd);class Bd{constructor(t,e,r){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ln("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw re.create("app-deleted",{appName:this._name})}}const Ud=Nd;function $c(n,t={}){let e=n;typeof t!="object"&&(t={name:t});const r={name:ri,automaticDataCollectionEnabled:!0,...t},s=r.name;if(typeof s!="string"||!s)throw re.create("bad-app-name",{appName:String(s)});if(e||(e=Fc()),!e)throw re.create("no-options");const o=qr.get(s);if(o){if(jr(e,o.options)&&jr(r,o.config))return o;throw re.create("duplicate-app",{appName:s})}const a=new $h(s);for(const h of si.values())a.addComponent(h);const l=new Bd(e,r,a);return qr.set(s,l),l}function jd(n=ri){const t=qr.get(n);if(!t&&n===ri&&Fc())return $c();if(!t)throw re.create("no-app",{appName:n});return t}function qe(n,t,e){let r=Od[n]??n;e&&(r+=`-${e}`);const s=r.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const a=[`Unable to register library "${r}" with version "${t}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Gt.warn(a.join(" "));return}$r(new Ln(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}const qd="firebase-heartbeat-database",$d=1,Fn="firebase-heartbeat-store";let Ks=null;function zc(){return Ks||(Ks=nd(qd,$d,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(Fn)}catch(e){console.warn(e)}}}}).catch(n=>{throw re.create("idb-open",{originalErrorMessage:n.message})})),Ks}async function zd(n){try{const e=(await zc()).transaction(Fn),r=await e.objectStore(Fn).get(Hc(n));return await e.done,r}catch(t){if(t instanceof rn)Gt.warn(t.message);else{const e=re.create("idb-get",{originalErrorMessage:t?.message});Gt.warn(e.message)}}}async function Va(n,t){try{const r=(await zc()).transaction(Fn,"readwrite");await r.objectStore(Fn).put(t,Hc(n)),await r.done}catch(e){if(e instanceof rn)Gt.warn(e.message);else{const r=re.create("idb-set",{originalErrorMessage:e?.message});Gt.warn(r.message)}}}function Hc(n){return`${n.name}!${n.options.appId}`}const Hd=1024,Gd=30;class Kd{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Qd(e),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Da();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:e}),this._heartbeatsCache.heartbeats.length>Gd){const s=Xd(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){Gt.warn(t)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Da(),{heartbeatsToSend:e,unsentEntries:r}=Wd(this._heartbeatsCache.heartbeats),s=Ur(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return Gt.warn(t),""}}}function Da(){return new Date().toISOString().substring(0,10)}function Wd(n,t=Hd){const e=[];let r=n.slice();for(const s of n){const o=e.find(a=>a.agent===s.agent);if(o){if(o.dates.push(s.date),ka(e)>t){o.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),ka(e)>t){e.pop();break}r=r.slice(1)}return{heartbeatsToSend:e,unsentEntries:r}}class Qd{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Mh()?xh().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await zd(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const r=await this.read();return Va(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const r=await this.read();return Va(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...t.heartbeats]})}else return}}function ka(n){return Ur(JSON.stringify({version:2,heartbeats:n})).length}function Xd(n){if(n.length===0)return-1;let t=0,e=n[0].date;for(let r=1;r<n.length;r++)n[r].date<e&&(e=n[r].date,t=r);return t}function Jd(n){$r(new Ln("platform-logger",t=>new id(t),"PRIVATE")),$r(new Ln("heartbeat",t=>new Kd(t),"PRIVATE")),qe(ni,ba,n),qe(ni,ba,"esm2020"),qe("fire-js","")}Jd("");var Yd="firebase",Zd="12.6.0";qe(Yd,Zd,"app");var Na=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var se,Gc;(function(){var n;function t(T,m){function _(){}_.prototype=m.prototype,T.F=m.prototype,T.prototype=new _,T.prototype.constructor=T,T.D=function(v,y,w){for(var g=Array(arguments.length-2),St=2;St<arguments.length;St++)g[St-2]=arguments[St];return m.prototype[y].apply(v,g)}}function e(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}t(r,e),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(T,m,_){_||(_=0);const v=Array(16);if(typeof m=="string")for(var y=0;y<16;++y)v[y]=m.charCodeAt(_++)|m.charCodeAt(_++)<<8|m.charCodeAt(_++)<<16|m.charCodeAt(_++)<<24;else for(y=0;y<16;++y)v[y]=m[_++]|m[_++]<<8|m[_++]<<16|m[_++]<<24;m=T.g[0],_=T.g[1],y=T.g[2];let w=T.g[3],g;g=m+(w^_&(y^w))+v[0]+3614090360&4294967295,m=_+(g<<7&4294967295|g>>>25),g=w+(y^m&(_^y))+v[1]+3905402710&4294967295,w=m+(g<<12&4294967295|g>>>20),g=y+(_^w&(m^_))+v[2]+606105819&4294967295,y=w+(g<<17&4294967295|g>>>15),g=_+(m^y&(w^m))+v[3]+3250441966&4294967295,_=y+(g<<22&4294967295|g>>>10),g=m+(w^_&(y^w))+v[4]+4118548399&4294967295,m=_+(g<<7&4294967295|g>>>25),g=w+(y^m&(_^y))+v[5]+1200080426&4294967295,w=m+(g<<12&4294967295|g>>>20),g=y+(_^w&(m^_))+v[6]+2821735955&4294967295,y=w+(g<<17&4294967295|g>>>15),g=_+(m^y&(w^m))+v[7]+4249261313&4294967295,_=y+(g<<22&4294967295|g>>>10),g=m+(w^_&(y^w))+v[8]+1770035416&4294967295,m=_+(g<<7&4294967295|g>>>25),g=w+(y^m&(_^y))+v[9]+2336552879&4294967295,w=m+(g<<12&4294967295|g>>>20),g=y+(_^w&(m^_))+v[10]+4294925233&4294967295,y=w+(g<<17&4294967295|g>>>15),g=_+(m^y&(w^m))+v[11]+2304563134&4294967295,_=y+(g<<22&4294967295|g>>>10),g=m+(w^_&(y^w))+v[12]+1804603682&4294967295,m=_+(g<<7&4294967295|g>>>25),g=w+(y^m&(_^y))+v[13]+4254626195&4294967295,w=m+(g<<12&4294967295|g>>>20),g=y+(_^w&(m^_))+v[14]+2792965006&4294967295,y=w+(g<<17&4294967295|g>>>15),g=_+(m^y&(w^m))+v[15]+1236535329&4294967295,_=y+(g<<22&4294967295|g>>>10),g=m+(y^w&(_^y))+v[1]+4129170786&4294967295,m=_+(g<<5&4294967295|g>>>27),g=w+(_^y&(m^_))+v[6]+3225465664&4294967295,w=m+(g<<9&4294967295|g>>>23),g=y+(m^_&(w^m))+v[11]+643717713&4294967295,y=w+(g<<14&4294967295|g>>>18),g=_+(w^m&(y^w))+v[0]+3921069994&4294967295,_=y+(g<<20&4294967295|g>>>12),g=m+(y^w&(_^y))+v[5]+3593408605&4294967295,m=_+(g<<5&4294967295|g>>>27),g=w+(_^y&(m^_))+v[10]+38016083&4294967295,w=m+(g<<9&4294967295|g>>>23),g=y+(m^_&(w^m))+v[15]+3634488961&4294967295,y=w+(g<<14&4294967295|g>>>18),g=_+(w^m&(y^w))+v[4]+3889429448&4294967295,_=y+(g<<20&4294967295|g>>>12),g=m+(y^w&(_^y))+v[9]+568446438&4294967295,m=_+(g<<5&4294967295|g>>>27),g=w+(_^y&(m^_))+v[14]+3275163606&4294967295,w=m+(g<<9&4294967295|g>>>23),g=y+(m^_&(w^m))+v[3]+4107603335&4294967295,y=w+(g<<14&4294967295|g>>>18),g=_+(w^m&(y^w))+v[8]+1163531501&4294967295,_=y+(g<<20&4294967295|g>>>12),g=m+(y^w&(_^y))+v[13]+2850285829&4294967295,m=_+(g<<5&4294967295|g>>>27),g=w+(_^y&(m^_))+v[2]+4243563512&4294967295,w=m+(g<<9&4294967295|g>>>23),g=y+(m^_&(w^m))+v[7]+1735328473&4294967295,y=w+(g<<14&4294967295|g>>>18),g=_+(w^m&(y^w))+v[12]+2368359562&4294967295,_=y+(g<<20&4294967295|g>>>12),g=m+(_^y^w)+v[5]+4294588738&4294967295,m=_+(g<<4&4294967295|g>>>28),g=w+(m^_^y)+v[8]+2272392833&4294967295,w=m+(g<<11&4294967295|g>>>21),g=y+(w^m^_)+v[11]+1839030562&4294967295,y=w+(g<<16&4294967295|g>>>16),g=_+(y^w^m)+v[14]+4259657740&4294967295,_=y+(g<<23&4294967295|g>>>9),g=m+(_^y^w)+v[1]+2763975236&4294967295,m=_+(g<<4&4294967295|g>>>28),g=w+(m^_^y)+v[4]+1272893353&4294967295,w=m+(g<<11&4294967295|g>>>21),g=y+(w^m^_)+v[7]+4139469664&4294967295,y=w+(g<<16&4294967295|g>>>16),g=_+(y^w^m)+v[10]+3200236656&4294967295,_=y+(g<<23&4294967295|g>>>9),g=m+(_^y^w)+v[13]+681279174&4294967295,m=_+(g<<4&4294967295|g>>>28),g=w+(m^_^y)+v[0]+3936430074&4294967295,w=m+(g<<11&4294967295|g>>>21),g=y+(w^m^_)+v[3]+3572445317&4294967295,y=w+(g<<16&4294967295|g>>>16),g=_+(y^w^m)+v[6]+76029189&4294967295,_=y+(g<<23&4294967295|g>>>9),g=m+(_^y^w)+v[9]+3654602809&4294967295,m=_+(g<<4&4294967295|g>>>28),g=w+(m^_^y)+v[12]+3873151461&4294967295,w=m+(g<<11&4294967295|g>>>21),g=y+(w^m^_)+v[15]+530742520&4294967295,y=w+(g<<16&4294967295|g>>>16),g=_+(y^w^m)+v[2]+3299628645&4294967295,_=y+(g<<23&4294967295|g>>>9),g=m+(y^(_|~w))+v[0]+4096336452&4294967295,m=_+(g<<6&4294967295|g>>>26),g=w+(_^(m|~y))+v[7]+1126891415&4294967295,w=m+(g<<10&4294967295|g>>>22),g=y+(m^(w|~_))+v[14]+2878612391&4294967295,y=w+(g<<15&4294967295|g>>>17),g=_+(w^(y|~m))+v[5]+4237533241&4294967295,_=y+(g<<21&4294967295|g>>>11),g=m+(y^(_|~w))+v[12]+1700485571&4294967295,m=_+(g<<6&4294967295|g>>>26),g=w+(_^(m|~y))+v[3]+2399980690&4294967295,w=m+(g<<10&4294967295|g>>>22),g=y+(m^(w|~_))+v[10]+4293915773&4294967295,y=w+(g<<15&4294967295|g>>>17),g=_+(w^(y|~m))+v[1]+2240044497&4294967295,_=y+(g<<21&4294967295|g>>>11),g=m+(y^(_|~w))+v[8]+1873313359&4294967295,m=_+(g<<6&4294967295|g>>>26),g=w+(_^(m|~y))+v[15]+4264355552&4294967295,w=m+(g<<10&4294967295|g>>>22),g=y+(m^(w|~_))+v[6]+2734768916&4294967295,y=w+(g<<15&4294967295|g>>>17),g=_+(w^(y|~m))+v[13]+1309151649&4294967295,_=y+(g<<21&4294967295|g>>>11),g=m+(y^(_|~w))+v[4]+4149444226&4294967295,m=_+(g<<6&4294967295|g>>>26),g=w+(_^(m|~y))+v[11]+3174756917&4294967295,w=m+(g<<10&4294967295|g>>>22),g=y+(m^(w|~_))+v[2]+718787259&4294967295,y=w+(g<<15&4294967295|g>>>17),g=_+(w^(y|~m))+v[9]+3951481745&4294967295,T.g[0]=T.g[0]+m&4294967295,T.g[1]=T.g[1]+(y+(g<<21&4294967295|g>>>11))&4294967295,T.g[2]=T.g[2]+y&4294967295,T.g[3]=T.g[3]+w&4294967295}r.prototype.v=function(T,m){m===void 0&&(m=T.length);const _=m-this.blockSize,v=this.C;let y=this.h,w=0;for(;w<m;){if(y==0)for(;w<=_;)s(this,T,w),w+=this.blockSize;if(typeof T=="string"){for(;w<m;)if(v[y++]=T.charCodeAt(w++),y==this.blockSize){s(this,v),y=0;break}}else for(;w<m;)if(v[y++]=T[w++],y==this.blockSize){s(this,v),y=0;break}}this.h=y,this.o+=m},r.prototype.A=function(){var T=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);T[0]=128;for(var m=1;m<T.length-8;++m)T[m]=0;m=this.o*8;for(var _=T.length-8;_<T.length;++_)T[_]=m&255,m/=256;for(this.v(T),T=Array(16),m=0,_=0;_<4;++_)for(let v=0;v<32;v+=8)T[m++]=this.g[_]>>>v&255;return T};function o(T,m){var _=l;return Object.prototype.hasOwnProperty.call(_,T)?_[T]:_[T]=m(T)}function a(T,m){this.h=m;const _=[];let v=!0;for(let y=T.length-1;y>=0;y--){const w=T[y]|0;v&&w==m||(_[y]=w,v=!1)}this.g=_}var l={};function h(T){return-128<=T&&T<128?o(T,function(m){return new a([m|0],m<0?-1:0)}):new a([T|0],T<0?-1:0)}function d(T){if(isNaN(T)||!isFinite(T))return E;if(T<0)return D(d(-T));const m=[];let _=1;for(let v=0;T>=_;v++)m[v]=T/_|0,_*=4294967296;return new a(m,0)}function p(T,m){if(T.length==0)throw Error("number format error: empty string");if(m=m||10,m<2||36<m)throw Error("radix out of range: "+m);if(T.charAt(0)=="-")return D(p(T.substring(1),m));if(T.indexOf("-")>=0)throw Error('number format error: interior "-" character');const _=d(Math.pow(m,8));let v=E;for(let w=0;w<T.length;w+=8){var y=Math.min(8,T.length-w);const g=parseInt(T.substring(w,w+y),m);y<8?(y=d(Math.pow(m,y)),v=v.j(y).add(d(g))):(v=v.j(_),v=v.add(d(g)))}return v}var E=h(0),A=h(1),b=h(16777216);n=a.prototype,n.m=function(){if(x(this))return-D(this).m();let T=0,m=1;for(let _=0;_<this.g.length;_++){const v=this.i(_);T+=(v>=0?v:4294967296+v)*m,m*=4294967296}return T},n.toString=function(T){if(T=T||10,T<2||36<T)throw Error("radix out of range: "+T);if(N(this))return"0";if(x(this))return"-"+D(this).toString(T);const m=d(Math.pow(T,6));var _=this;let v="";for(;;){const y=Tt(_,m).g;_=G(_,y.j(m));let w=((_.g.length>0?_.g[0]:_.h)>>>0).toString(T);if(_=y,N(_))return w+v;for(;w.length<6;)w="0"+w;v=w+v}},n.i=function(T){return T<0?0:T<this.g.length?this.g[T]:this.h};function N(T){if(T.h!=0)return!1;for(let m=0;m<T.g.length;m++)if(T.g[m]!=0)return!1;return!0}function x(T){return T.h==-1}n.l=function(T){return T=G(this,T),x(T)?-1:N(T)?0:1};function D(T){const m=T.g.length,_=[];for(let v=0;v<m;v++)_[v]=~T.g[v];return new a(_,~T.h).add(A)}n.abs=function(){return x(this)?D(this):this},n.add=function(T){const m=Math.max(this.g.length,T.g.length),_=[];let v=0;for(let y=0;y<=m;y++){let w=v+(this.i(y)&65535)+(T.i(y)&65535),g=(w>>>16)+(this.i(y)>>>16)+(T.i(y)>>>16);v=g>>>16,w&=65535,g&=65535,_[y]=g<<16|w}return new a(_,_[_.length-1]&-2147483648?-1:0)};function G(T,m){return T.add(D(m))}n.j=function(T){if(N(this)||N(T))return E;if(x(this))return x(T)?D(this).j(D(T)):D(D(this).j(T));if(x(T))return D(this.j(D(T)));if(this.l(b)<0&&T.l(b)<0)return d(this.m()*T.m());const m=this.g.length+T.g.length,_=[];for(var v=0;v<2*m;v++)_[v]=0;for(v=0;v<this.g.length;v++)for(let y=0;y<T.g.length;y++){const w=this.i(v)>>>16,g=this.i(v)&65535,St=T.i(y)>>>16,fe=T.i(y)&65535;_[2*v+2*y]+=g*fe,K(_,2*v+2*y),_[2*v+2*y+1]+=w*fe,K(_,2*v+2*y+1),_[2*v+2*y+1]+=g*St,K(_,2*v+2*y+1),_[2*v+2*y+2]+=w*St,K(_,2*v+2*y+2)}for(T=0;T<m;T++)_[T]=_[2*T+1]<<16|_[2*T];for(T=m;T<2*m;T++)_[T]=0;return new a(_,0)};function K(T,m){for(;(T[m]&65535)!=T[m];)T[m+1]+=T[m]>>>16,T[m]&=65535,m++}function W(T,m){this.g=T,this.h=m}function Tt(T,m){if(N(m))throw Error("division by zero");if(N(T))return new W(E,E);if(x(T))return m=Tt(D(T),m),new W(D(m.g),D(m.h));if(x(m))return m=Tt(T,D(m)),new W(D(m.g),m.h);if(T.g.length>30){if(x(T)||x(m))throw Error("slowDivide_ only works with positive integers.");for(var _=A,v=m;v.l(T)<=0;)_=At(_),v=At(v);var y=ut(_,1),w=ut(v,1);for(v=ut(v,2),_=ut(_,2);!N(v);){var g=w.add(v);g.l(T)<=0&&(y=y.add(_),w=g),v=ut(v,1),_=ut(_,1)}return m=G(T,y.j(m)),new W(y,m)}for(y=E;T.l(m)>=0;){for(_=Math.max(1,Math.floor(T.m()/m.m())),v=Math.ceil(Math.log(_)/Math.LN2),v=v<=48?1:Math.pow(2,v-48),w=d(_),g=w.j(m);x(g)||g.l(T)>0;)_-=v,w=d(_),g=w.j(m);N(w)&&(w=A),y=y.add(w),T=G(T,g)}return new W(y,T)}n.B=function(T){return Tt(this,T).h},n.and=function(T){const m=Math.max(this.g.length,T.g.length),_=[];for(let v=0;v<m;v++)_[v]=this.i(v)&T.i(v);return new a(_,this.h&T.h)},n.or=function(T){const m=Math.max(this.g.length,T.g.length),_=[];for(let v=0;v<m;v++)_[v]=this.i(v)|T.i(v);return new a(_,this.h|T.h)},n.xor=function(T){const m=Math.max(this.g.length,T.g.length),_=[];for(let v=0;v<m;v++)_[v]=this.i(v)^T.i(v);return new a(_,this.h^T.h)};function At(T){const m=T.g.length+1,_=[];for(let v=0;v<m;v++)_[v]=T.i(v)<<1|T.i(v-1)>>>31;return new a(_,T.h)}function ut(T,m){const _=m>>5;m%=32;const v=T.g.length-_,y=[];for(let w=0;w<v;w++)y[w]=m>0?T.i(w+_)>>>m|T.i(w+_+1)<<32-m:T.i(w+_);return new a(y,T.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,Gc=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=p,se=a}).apply(typeof Na<"u"?Na:typeof self<"u"?self:typeof window<"u"?window:{});var Ir=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Kc,Sn,Wc,Vr,ii,Qc,Xc,Jc;(function(){var n,t=Object.defineProperty;function e(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ir=="object"&&Ir];for(var c=0;c<i.length;++c){var u=i[c];if(u&&u.Math==Math)return u}throw Error("Cannot find global object")}var r=e(this);function s(i,c){if(c)t:{var u=r;i=i.split(".");for(var f=0;f<i.length-1;f++){var I=i[f];if(!(I in u))break t;u=u[I]}i=i[i.length-1],f=u[i],c=c(f),c!=f&&c!=null&&t(u,i,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(i){return i||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(i){return i||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(i){return i||function(c){var u=[],f;for(f in c)Object.prototype.hasOwnProperty.call(c,f)&&u.push([f,c[f]]);return u}});var o=o||{},a=this||self;function l(i){var c=typeof i;return c=="object"&&i!=null||c=="function"}function h(i,c,u){return i.call.apply(i.bind,arguments)}function d(i,c,u){return d=h,d.apply(null,arguments)}function p(i,c){var u=Array.prototype.slice.call(arguments,1);return function(){var f=u.slice();return f.push.apply(f,arguments),i.apply(this,f)}}function E(i,c){function u(){}u.prototype=c.prototype,i.Z=c.prototype,i.prototype=new u,i.prototype.constructor=i,i.Ob=function(f,I,S){for(var V=Array(arguments.length-2),j=2;j<arguments.length;j++)V[j-2]=arguments[j];return c.prototype[I].apply(f,V)}}var A=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?i=>i&&AsyncContext.Snapshot.wrap(i):i=>i;function b(i){const c=i.length;if(c>0){const u=Array(c);for(let f=0;f<c;f++)u[f]=i[f];return u}return[]}function N(i,c){for(let f=1;f<arguments.length;f++){const I=arguments[f];var u=typeof I;if(u=u!="object"?u:I?Array.isArray(I)?"array":u:"null",u=="array"||u=="object"&&typeof I.length=="number"){u=i.length||0;const S=I.length||0;i.length=u+S;for(let V=0;V<S;V++)i[u+V]=I[V]}else i.push(I)}}class x{constructor(c,u){this.i=c,this.j=u,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function D(i){a.setTimeout(()=>{throw i},0)}function G(){var i=T;let c=null;return i.g&&(c=i.g,i.g=i.g.next,i.g||(i.h=null),c.next=null),c}class K{constructor(){this.h=this.g=null}add(c,u){const f=W.get();f.set(c,u),this.h?this.h.next=f:this.g=f,this.h=f}}var W=new x(()=>new Tt,i=>i.reset());class Tt{constructor(){this.next=this.g=this.h=null}set(c,u){this.h=c,this.g=u,this.next=null}reset(){this.next=this.g=this.h=null}}let At,ut=!1,T=new K,m=()=>{const i=Promise.resolve(void 0);At=()=>{i.then(_)}};function _(){for(var i;i=G();){try{i.h.call(i.g)}catch(u){D(u)}var c=W;c.j(i),c.h<100&&(c.h++,i.next=c.g,c.g=i)}ut=!1}function v(){this.u=this.u,this.C=this.C}v.prototype.u=!1,v.prototype.dispose=function(){this.u||(this.u=!0,this.N())},v.prototype[Symbol.dispose]=function(){this.dispose()},v.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function y(i,c){this.type=i,this.g=this.target=c,this.defaultPrevented=!1}y.prototype.h=function(){this.defaultPrevented=!0};var w=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var i=!1,c=Object.defineProperty({},"passive",{get:function(){i=!0}});try{const u=()=>{};a.addEventListener("test",u,c),a.removeEventListener("test",u,c)}catch{}return i})();function g(i){return/^[\s\xa0]*$/.test(i)}function St(i,c){y.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i&&this.init(i,c)}E(St,y),St.prototype.init=function(i,c){const u=this.type=i.type,f=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;this.target=i.target||i.srcElement,this.g=c,c=i.relatedTarget,c||(u=="mouseover"?c=i.fromElement:u=="mouseout"&&(c=i.toElement)),this.relatedTarget=c,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=i.pointerType,this.state=i.state,this.i=i,i.defaultPrevented&&St.Z.h.call(this)},St.prototype.h=function(){St.Z.h.call(this);const i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var fe="closure_listenable_"+(Math.random()*1e6|0),Lu=0;function Fu(i,c,u,f,I){this.listener=i,this.proxy=null,this.src=c,this.type=u,this.capture=!!f,this.ha=I,this.key=++Lu,this.da=this.fa=!1}function ar(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function cr(i,c,u){for(const f in i)c.call(u,i[f],f,i)}function Bu(i,c){for(const u in i)c.call(void 0,i[u],u,i)}function vo(i){const c={};for(const u in i)c[u]=i[u];return c}const Io="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function wo(i,c){let u,f;for(let I=1;I<arguments.length;I++){f=arguments[I];for(u in f)i[u]=f[u];for(let S=0;S<Io.length;S++)u=Io[S],Object.prototype.hasOwnProperty.call(f,u)&&(i[u]=f[u])}}function lr(i){this.src=i,this.g={},this.h=0}lr.prototype.add=function(i,c,u,f,I){const S=i.toString();i=this.g[S],i||(i=this.g[S]=[],this.h++);const V=vs(i,c,f,I);return V>-1?(c=i[V],u||(c.fa=!1)):(c=new Fu(c,this.src,S,!!f,I),c.fa=u,i.push(c)),c};function Ts(i,c){const u=c.type;if(u in i.g){var f=i.g[u],I=Array.prototype.indexOf.call(f,c,void 0),S;(S=I>=0)&&Array.prototype.splice.call(f,I,1),S&&(ar(c),i.g[u].length==0&&(delete i.g[u],i.h--))}}function vs(i,c,u,f){for(let I=0;I<i.length;++I){const S=i[I];if(!S.da&&S.listener==c&&S.capture==!!u&&S.ha==f)return I}return-1}var Is="closure_lm_"+(Math.random()*1e6|0),ws={};function Ao(i,c,u,f,I){if(Array.isArray(c)){for(let S=0;S<c.length;S++)Ao(i,c[S],u,f,I);return null}return u=Co(u),i&&i[fe]?i.J(c,u,l(f)?!!f.capture:!1,I):Uu(i,c,u,!1,f,I)}function Uu(i,c,u,f,I,S){if(!c)throw Error("Invalid event type");const V=l(I)?!!I.capture:!!I;let j=Ss(i);if(j||(i[Is]=j=new lr(i)),u=j.add(c,u,f,V,S),u.proxy)return u;if(f=ju(),u.proxy=f,f.src=i,f.listener=u,i.addEventListener)w||(I=V),I===void 0&&(I=!1),i.addEventListener(c.toString(),f,I);else if(i.attachEvent)i.attachEvent(Ro(c.toString()),f);else if(i.addListener&&i.removeListener)i.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return u}function ju(){function i(u){return c.call(i.src,i.listener,u)}const c=qu;return i}function So(i,c,u,f,I){if(Array.isArray(c))for(var S=0;S<c.length;S++)So(i,c[S],u,f,I);else f=l(f)?!!f.capture:!!f,u=Co(u),i&&i[fe]?(i=i.i,S=String(c).toString(),S in i.g&&(c=i.g[S],u=vs(c,u,f,I),u>-1&&(ar(c[u]),Array.prototype.splice.call(c,u,1),c.length==0&&(delete i.g[S],i.h--)))):i&&(i=Ss(i))&&(c=i.g[c.toString()],i=-1,c&&(i=vs(c,u,f,I)),(u=i>-1?c[i]:null)&&As(u))}function As(i){if(typeof i!="number"&&i&&!i.da){var c=i.src;if(c&&c[fe])Ts(c.i,i);else{var u=i.type,f=i.proxy;c.removeEventListener?c.removeEventListener(u,f,i.capture):c.detachEvent?c.detachEvent(Ro(u),f):c.addListener&&c.removeListener&&c.removeListener(f),(u=Ss(c))?(Ts(u,i),u.h==0&&(u.src=null,c[Is]=null)):ar(i)}}}function Ro(i){return i in ws?ws[i]:ws[i]="on"+i}function qu(i,c){if(i.da)i=!0;else{c=new St(c,this);const u=i.listener,f=i.ha||i.src;i.fa&&As(i),i=u.call(f,c)}return i}function Ss(i){return i=i[Is],i instanceof lr?i:null}var Rs="__closure_events_fn_"+(Math.random()*1e9>>>0);function Co(i){return typeof i=="function"?i:(i[Rs]||(i[Rs]=function(c){return i.handleEvent(c)}),i[Rs])}function pt(){v.call(this),this.i=new lr(this),this.M=this,this.G=null}E(pt,v),pt.prototype[fe]=!0,pt.prototype.removeEventListener=function(i,c,u,f){So(this,i,c,u,f)};function vt(i,c){var u,f=i.G;if(f)for(u=[];f;f=f.G)u.push(f);if(i=i.M,f=c.type||c,typeof c=="string")c=new y(c,i);else if(c instanceof y)c.target=c.target||i;else{var I=c;c=new y(f,i),wo(c,I)}I=!0;let S,V;if(u)for(V=u.length-1;V>=0;V--)S=c.g=u[V],I=ur(S,f,!0,c)&&I;if(S=c.g=i,I=ur(S,f,!0,c)&&I,I=ur(S,f,!1,c)&&I,u)for(V=0;V<u.length;V++)S=c.g=u[V],I=ur(S,f,!1,c)&&I}pt.prototype.N=function(){if(pt.Z.N.call(this),this.i){var i=this.i;for(const c in i.g){const u=i.g[c];for(let f=0;f<u.length;f++)ar(u[f]);delete i.g[c],i.h--}}this.G=null},pt.prototype.J=function(i,c,u,f){return this.i.add(String(i),c,!1,u,f)},pt.prototype.K=function(i,c,u,f){return this.i.add(String(i),c,!0,u,f)};function ur(i,c,u,f){if(c=i.i.g[String(c)],!c)return!0;c=c.concat();let I=!0;for(let S=0;S<c.length;++S){const V=c[S];if(V&&!V.da&&V.capture==u){const j=V.listener,ot=V.ha||V.src;V.fa&&Ts(i.i,V),I=j.call(ot,f)!==!1&&I}}return I&&!f.defaultPrevented}function $u(i,c){if(typeof i!="function")if(i&&typeof i.handleEvent=="function")i=d(i.handleEvent,i);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(i,c||0)}function bo(i){i.g=$u(()=>{i.g=null,i.i&&(i.i=!1,bo(i))},i.l);const c=i.h;i.h=null,i.m.apply(null,c)}class zu extends v{constructor(c,u){super(),this.m=c,this.l=u,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:bo(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ln(i){v.call(this),this.h=i,this.g={}}E(ln,v);var Po=[];function Vo(i){cr(i.g,function(c,u){this.g.hasOwnProperty(u)&&As(c)},i),i.g={}}ln.prototype.N=function(){ln.Z.N.call(this),Vo(this)},ln.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Cs=a.JSON.stringify,Hu=a.JSON.parse,Gu=class{stringify(i){return a.JSON.stringify(i,void 0)}parse(i){return a.JSON.parse(i,void 0)}};function Do(){}function ko(){}var un={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function bs(){y.call(this,"d")}E(bs,y);function Ps(){y.call(this,"c")}E(Ps,y);var me={},No=null;function hr(){return No=No||new pt}me.Ia="serverreachability";function Oo(i){y.call(this,me.Ia,i)}E(Oo,y);function hn(i){const c=hr();vt(c,new Oo(c))}me.STAT_EVENT="statevent";function Mo(i,c){y.call(this,me.STAT_EVENT,i),this.stat=c}E(Mo,y);function It(i){const c=hr();vt(c,new Mo(c,i))}me.Ja="timingevent";function xo(i,c){y.call(this,me.Ja,i),this.size=c}E(xo,y);function dn(i,c){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){i()},c)}function fn(){this.g=!0}fn.prototype.ua=function(){this.g=!1};function Ku(i,c,u,f,I,S){i.info(function(){if(i.g)if(S){var V="",j=S.split("&");for(let X=0;X<j.length;X++){var ot=j[X].split("=");if(ot.length>1){const ht=ot[0];ot=ot[1];const xt=ht.split("_");V=xt.length>=2&&xt[1]=="type"?V+(ht+"="+ot+"&"):V+(ht+"=redacted&")}}}else V=null;else V=S;return"XMLHTTP REQ ("+f+") [attempt "+I+"]: "+c+`
`+u+`
`+V})}function Wu(i,c,u,f,I,S,V){i.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+I+"]: "+c+`
`+u+`
`+S+" "+V})}function ke(i,c,u,f){i.info(function(){return"XMLHTTP TEXT ("+c+"): "+Xu(i,u)+(f?" "+f:"")})}function Qu(i,c){i.info(function(){return"TIMEOUT: "+c})}fn.prototype.info=function(){};function Xu(i,c){if(!i.g)return c;if(!c)return null;try{const S=JSON.parse(c);if(S){for(i=0;i<S.length;i++)if(Array.isArray(S[i])){var u=S[i];if(!(u.length<2)){var f=u[1];if(Array.isArray(f)&&!(f.length<1)){var I=f[0];if(I!="noop"&&I!="stop"&&I!="close")for(let V=1;V<f.length;V++)f[V]=""}}}}return Cs(S)}catch{return c}}var dr={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Lo={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Fo;function Vs(){}E(Vs,Do),Vs.prototype.g=function(){return new XMLHttpRequest},Fo=new Vs;function mn(i){return encodeURIComponent(String(i))}function Ju(i){var c=1;i=i.split(":");const u=[];for(;c>0&&i.length;)u.push(i.shift()),c--;return i.length&&u.push(i.join(":")),u}function Qt(i,c,u,f){this.j=i,this.i=c,this.l=u,this.S=f||1,this.V=new ln(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Bo}function Bo(){this.i=null,this.g="",this.h=!1}var Uo={},Ds={};function ks(i,c,u){i.M=1,i.A=mr(Mt(c)),i.u=u,i.R=!0,jo(i,null)}function jo(i,c){i.F=Date.now(),fr(i),i.B=Mt(i.A);var u=i.B,f=i.S;Array.isArray(f)||(f=[String(f)]),ta(u.i,"t",f),i.C=0,u=i.j.L,i.h=new Bo,i.g=ya(i.j,u?c:null,!i.u),i.P>0&&(i.O=new zu(d(i.Y,i,i.g),i.P)),c=i.V,u=i.g,f=i.ba;var I="readystatechange";Array.isArray(I)||(I&&(Po[0]=I.toString()),I=Po);for(let S=0;S<I.length;S++){const V=Ao(u,I[S],f||c.handleEvent,!1,c.h||c);if(!V)break;c.g[V.key]=V}c=i.J?vo(i.J):{},i.u?(i.v||(i.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.B,i.v,i.u,c)):(i.v="GET",i.g.ea(i.B,i.v,null,c)),hn(),Ku(i.i,i.v,i.B,i.l,i.S,i.u)}Qt.prototype.ba=function(i){i=i.target;const c=this.O;c&&Yt(i)==3?c.j():this.Y(i)},Qt.prototype.Y=function(i){try{if(i==this.g)t:{const j=Yt(this.g),ot=this.g.ya(),X=this.g.ca();if(!(j<3)&&(j!=3||this.g&&(this.h.h||this.g.la()||aa(this.g)))){this.K||j!=4||ot==7||(ot==8||X<=0?hn(3):hn(2)),Ns(this);var c=this.g.ca();this.X=c;var u=Yu(this);if(this.o=c==200,Wu(this.i,this.v,this.B,this.l,this.S,j,c),this.o){if(this.U&&!this.L){e:{if(this.g){var f,I=this.g;if((f=I.g?I.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!g(f)){var S=f;break e}}S=null}if(i=S)ke(this.i,this.l,i,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Os(this,i);else{this.o=!1,this.m=3,It(12),ge(this),gn(this);break t}}if(this.R){i=!0;let ht;for(;!this.K&&this.C<u.length;)if(ht=Zu(this,u),ht==Ds){j==4&&(this.m=4,It(14),i=!1),ke(this.i,this.l,null,"[Incomplete Response]");break}else if(ht==Uo){this.m=4,It(15),ke(this.i,this.l,u,"[Invalid Chunk]"),i=!1;break}else ke(this.i,this.l,ht,null),Os(this,ht);if(qo(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),j!=4||u.length!=0||this.h.h||(this.m=1,It(16),i=!1),this.o=this.o&&i,!i)ke(this.i,this.l,u,"[Invalid Chunked Response]"),ge(this),gn(this);else if(u.length>0&&!this.W){this.W=!0;var V=this.j;V.g==this&&V.aa&&!V.P&&(V.j.info("Great, no buffering proxy detected. Bytes received: "+u.length),qs(V),V.P=!0,It(11))}}else ke(this.i,this.l,u,null),Os(this,u);j==4&&ge(this),this.o&&!this.K&&(j==4?ma(this.j,this):(this.o=!1,fr(this)))}else fh(this.g),c==400&&u.indexOf("Unknown SID")>0?(this.m=3,It(12)):(this.m=0,It(13)),ge(this),gn(this)}}}catch{}finally{}};function Yu(i){if(!qo(i))return i.g.la();const c=aa(i.g);if(c==="")return"";let u="";const f=c.length,I=Yt(i.g)==4;if(!i.h.i){if(typeof TextDecoder>"u")return ge(i),gn(i),"";i.h.i=new a.TextDecoder}for(let S=0;S<f;S++)i.h.h=!0,u+=i.h.i.decode(c[S],{stream:!(I&&S==f-1)});return c.length=0,i.h.g+=u,i.C=0,i.h.g}function qo(i){return i.g?i.v=="GET"&&i.M!=2&&i.j.Aa:!1}function Zu(i,c){var u=i.C,f=c.indexOf(`
`,u);return f==-1?Ds:(u=Number(c.substring(u,f)),isNaN(u)?Uo:(f+=1,f+u>c.length?Ds:(c=c.slice(f,f+u),i.C=f+u,c)))}Qt.prototype.cancel=function(){this.K=!0,ge(this)};function fr(i){i.T=Date.now()+i.H,$o(i,i.H)}function $o(i,c){if(i.D!=null)throw Error("WatchDog timer not null");i.D=dn(d(i.aa,i),c)}function Ns(i){i.D&&(a.clearTimeout(i.D),i.D=null)}Qt.prototype.aa=function(){this.D=null;const i=Date.now();i-this.T>=0?(Qu(this.i,this.B),this.M!=2&&(hn(),It(17)),ge(this),this.m=2,gn(this)):$o(this,this.T-i)};function gn(i){i.j.I==0||i.K||ma(i.j,i)}function ge(i){Ns(i);var c=i.O;c&&typeof c.dispose=="function"&&c.dispose(),i.O=null,Vo(i.V),i.g&&(c=i.g,i.g=null,c.abort(),c.dispose())}function Os(i,c){try{var u=i.j;if(u.I!=0&&(u.g==i||Ms(u.h,i))){if(!i.L&&Ms(u.h,i)&&u.I==3){try{var f=u.Ba.g.parse(c)}catch{f=null}if(Array.isArray(f)&&f.length==3){var I=f;if(I[0]==0){t:if(!u.v){if(u.g)if(u.g.F+3e3<i.F)Er(u),_r(u);else break t;js(u),It(18)}}else u.xa=I[1],0<u.xa-u.K&&I[2]<37500&&u.F&&u.A==0&&!u.C&&(u.C=dn(d(u.Va,u),6e3));Go(u.h)<=1&&u.ta&&(u.ta=void 0)}else _e(u,11)}else if((i.L||u.g==i)&&Er(u),!g(c))for(I=u.Ba.g.parse(c),c=0;c<I.length;c++){let X=I[c];const ht=X[0];if(!(ht<=u.K))if(u.K=ht,X=X[1],u.I==2)if(X[0]=="c"){u.M=X[1],u.ba=X[2];const xt=X[3];xt!=null&&(u.ka=xt,u.j.info("VER="+u.ka));const ye=X[4];ye!=null&&(u.za=ye,u.j.info("SVER="+u.za));const Zt=X[5];Zt!=null&&typeof Zt=="number"&&Zt>0&&(f=1.5*Zt,u.O=f,u.j.info("backChannelRequestTimeoutMs_="+f)),f=u;const te=i.g;if(te){const vr=te.g?te.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(vr){var S=f.h;S.g||vr.indexOf("spdy")==-1&&vr.indexOf("quic")==-1&&vr.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(xs(S,S.h),S.h=null))}if(f.G){const $s=te.g?te.g.getResponseHeader("X-HTTP-Session-Id"):null;$s&&(f.wa=$s,J(f.J,f.G,$s))}}u.I=3,u.l&&u.l.ra(),u.aa&&(u.T=Date.now()-i.F,u.j.info("Handshake RTT: "+u.T+"ms")),f=u;var V=i;if(f.na=_a(f,f.L?f.ba:null,f.W),V.L){Ko(f.h,V);var j=V,ot=f.O;ot&&(j.H=ot),j.D&&(Ns(j),fr(j)),f.g=V}else da(f);u.i.length>0&&yr(u)}else X[0]!="stop"&&X[0]!="close"||_e(u,7);else u.I==3&&(X[0]=="stop"||X[0]=="close"?X[0]=="stop"?_e(u,7):Us(u):X[0]!="noop"&&u.l&&u.l.qa(X),u.A=0)}}hn(4)}catch{}}var th=class{constructor(i,c){this.g=i,this.map=c}};function zo(i){this.l=i||10,a.PerformanceNavigationTiming?(i=a.performance.getEntriesByType("navigation"),i=i.length>0&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Ho(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function Go(i){return i.h?1:i.g?i.g.size:0}function Ms(i,c){return i.h?i.h==c:i.g?i.g.has(c):!1}function xs(i,c){i.g?i.g.add(c):i.h=c}function Ko(i,c){i.h&&i.h==c?i.h=null:i.g&&i.g.has(c)&&i.g.delete(c)}zo.prototype.cancel=function(){if(this.i=Wo(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function Wo(i){if(i.h!=null)return i.i.concat(i.h.G);if(i.g!=null&&i.g.size!==0){let c=i.i;for(const u of i.g.values())c=c.concat(u.G);return c}return b(i.i)}var Qo=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function eh(i,c){if(i){i=i.split("&");for(let u=0;u<i.length;u++){const f=i[u].indexOf("=");let I,S=null;f>=0?(I=i[u].substring(0,f),S=i[u].substring(f+1)):I=i[u],c(I,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}function Xt(i){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;i instanceof Xt?(this.l=i.l,pn(this,i.j),this.o=i.o,this.g=i.g,_n(this,i.u),this.h=i.h,Ls(this,ea(i.i)),this.m=i.m):i&&(c=String(i).match(Qo))?(this.l=!1,pn(this,c[1]||"",!0),this.o=yn(c[2]||""),this.g=yn(c[3]||"",!0),_n(this,c[4]),this.h=yn(c[5]||"",!0),Ls(this,c[6]||"",!0),this.m=yn(c[7]||"")):(this.l=!1,this.i=new Tn(null,this.l))}Xt.prototype.toString=function(){const i=[];var c=this.j;c&&i.push(En(c,Xo,!0),":");var u=this.g;return(u||c=="file")&&(i.push("//"),(c=this.o)&&i.push(En(c,Xo,!0),"@"),i.push(mn(u).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u=this.u,u!=null&&i.push(":",String(u))),(u=this.h)&&(this.g&&u.charAt(0)!="/"&&i.push("/"),i.push(En(u,u.charAt(0)=="/"?sh:rh,!0))),(u=this.i.toString())&&i.push("?",u),(u=this.m)&&i.push("#",En(u,oh)),i.join("")},Xt.prototype.resolve=function(i){const c=Mt(this);let u=!!i.j;u?pn(c,i.j):u=!!i.o,u?c.o=i.o:u=!!i.g,u?c.g=i.g:u=i.u!=null;var f=i.h;if(u)_n(c,i.u);else if(u=!!i.h){if(f.charAt(0)!="/")if(this.g&&!this.h)f="/"+f;else{var I=c.h.lastIndexOf("/");I!=-1&&(f=c.h.slice(0,I+1)+f)}if(I=f,I==".."||I==".")f="";else if(I.indexOf("./")!=-1||I.indexOf("/.")!=-1){f=I.lastIndexOf("/",0)==0,I=I.split("/");const S=[];for(let V=0;V<I.length;){const j=I[V++];j=="."?f&&V==I.length&&S.push(""):j==".."?((S.length>1||S.length==1&&S[0]!="")&&S.pop(),f&&V==I.length&&S.push("")):(S.push(j),f=!0)}f=S.join("/")}else f=I}return u?c.h=f:u=i.i.toString()!=="",u?Ls(c,ea(i.i)):u=!!i.m,u&&(c.m=i.m),c};function Mt(i){return new Xt(i)}function pn(i,c,u){i.j=u?yn(c,!0):c,i.j&&(i.j=i.j.replace(/:$/,""))}function _n(i,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);i.u=c}else i.u=null}function Ls(i,c,u){c instanceof Tn?(i.i=c,ah(i.i,i.l)):(u||(c=En(c,ih)),i.i=new Tn(c,i.l))}function J(i,c,u){i.i.set(c,u)}function mr(i){return J(i,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),i}function yn(i,c){return i?c?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function En(i,c,u){return typeof i=="string"?(i=encodeURI(i).replace(c,nh),u&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function nh(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var Xo=/[#\/\?@]/g,rh=/[#\?:]/g,sh=/[#\?]/g,ih=/[#\?@]/g,oh=/#/g;function Tn(i,c){this.h=this.g=null,this.i=i||null,this.j=!!c}function pe(i){i.g||(i.g=new Map,i.h=0,i.i&&eh(i.i,function(c,u){i.add(decodeURIComponent(c.replace(/\+/g," ")),u)}))}n=Tn.prototype,n.add=function(i,c){pe(this),this.i=null,i=Ne(this,i);let u=this.g.get(i);return u||this.g.set(i,u=[]),u.push(c),this.h+=1,this};function Jo(i,c){pe(i),c=Ne(i,c),i.g.has(c)&&(i.i=null,i.h-=i.g.get(c).length,i.g.delete(c))}function Yo(i,c){return pe(i),c=Ne(i,c),i.g.has(c)}n.forEach=function(i,c){pe(this),this.g.forEach(function(u,f){u.forEach(function(I){i.call(c,I,f,this)},this)},this)};function Zo(i,c){pe(i);let u=[];if(typeof c=="string")Yo(i,c)&&(u=u.concat(i.g.get(Ne(i,c))));else for(i=Array.from(i.g.values()),c=0;c<i.length;c++)u=u.concat(i[c]);return u}n.set=function(i,c){return pe(this),this.i=null,i=Ne(this,i),Yo(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[c]),this.h+=1,this},n.get=function(i,c){return i?(i=Zo(this,i),i.length>0?String(i[0]):c):c};function ta(i,c,u){Jo(i,c),u.length>0&&(i.i=null,i.g.set(Ne(i,c),b(u)),i.h+=u.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],c=Array.from(this.g.keys());for(let f=0;f<c.length;f++){var u=c[f];const I=mn(u);u=Zo(this,u);for(let S=0;S<u.length;S++){let V=I;u[S]!==""&&(V+="="+mn(u[S])),i.push(V)}}return this.i=i.join("&")};function ea(i){const c=new Tn;return c.i=i.i,i.g&&(c.g=new Map(i.g),c.h=i.h),c}function Ne(i,c){return c=String(c),i.j&&(c=c.toLowerCase()),c}function ah(i,c){c&&!i.j&&(pe(i),i.i=null,i.g.forEach(function(u,f){const I=f.toLowerCase();f!=I&&(Jo(this,f),ta(this,I,u))},i)),i.j=c}function ch(i,c){const u=new fn;if(a.Image){const f=new Image;f.onload=p(Jt,u,"TestLoadImage: loaded",!0,c,f),f.onerror=p(Jt,u,"TestLoadImage: error",!1,c,f),f.onabort=p(Jt,u,"TestLoadImage: abort",!1,c,f),f.ontimeout=p(Jt,u,"TestLoadImage: timeout",!1,c,f),a.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=i}else c(!1)}function lh(i,c){const u=new fn,f=new AbortController,I=setTimeout(()=>{f.abort(),Jt(u,"TestPingServer: timeout",!1,c)},1e4);fetch(i,{signal:f.signal}).then(S=>{clearTimeout(I),S.ok?Jt(u,"TestPingServer: ok",!0,c):Jt(u,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(I),Jt(u,"TestPingServer: error",!1,c)})}function Jt(i,c,u,f,I){try{I&&(I.onload=null,I.onerror=null,I.onabort=null,I.ontimeout=null),f(u)}catch{}}function uh(){this.g=new Gu}function Fs(i){this.i=i.Sb||null,this.h=i.ab||!1}E(Fs,Do),Fs.prototype.g=function(){return new gr(this.i,this.h)};function gr(i,c){pt.call(this),this.H=i,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}E(gr,pt),n=gr.prototype,n.open=function(i,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=i,this.D=c,this.readyState=1,In(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};i&&(c.body=i),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,vn(this)),this.readyState=0},n.Pa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,In(this)),this.g&&(this.readyState=3,In(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;na(this)}else i.text().then(this.Oa.bind(this),this.ga.bind(this))};function na(i){i.j.read().then(i.Ma.bind(i)).catch(i.ga.bind(i))}n.Ma=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var c=i.value?i.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!i.done}))&&(this.response=this.responseText+=c)}i.done?vn(this):In(this),this.readyState==3&&na(this)}},n.Oa=function(i){this.g&&(this.response=this.responseText=i,vn(this))},n.Na=function(i){this.g&&(this.response=i,vn(this))},n.ga=function(){this.g&&vn(this)};function vn(i){i.readyState=4,i.l=null,i.j=null,i.B=null,In(i)}n.setRequestHeader=function(i,c){this.A.append(i,c)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],c=this.h.entries();for(var u=c.next();!u.done;)u=u.value,i.push(u[0]+": "+u[1]),u=c.next();return i.join(`\r
`)};function In(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(gr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function ra(i){let c="";return cr(i,function(u,f){c+=f,c+=":",c+=u,c+=`\r
`}),c}function Bs(i,c,u){t:{for(f in u){var f=!1;break t}f=!0}f||(u=ra(u),typeof i=="string"?u!=null&&mn(u):J(i,c,u))}function nt(i){pt.call(this),this.headers=new Map,this.L=i||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}E(nt,pt);var hh=/^https?$/i,dh=["POST","PUT"];n=nt.prototype,n.Fa=function(i){this.H=i},n.ea=function(i,c,u,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);c=c?c.toUpperCase():"GET",this.D=i,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Fo.g(),this.g.onreadystatechange=A(d(this.Ca,this));try{this.B=!0,this.g.open(c,String(i),!0),this.B=!1}catch(S){sa(this,S);return}if(i=u||"",u=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var I in f)u.set(I,f[I]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(const S of f.keys())u.set(S,f.get(S));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(u.keys()).find(S=>S.toLowerCase()=="content-type"),I=a.FormData&&i instanceof a.FormData,!(Array.prototype.indexOf.call(dh,c,void 0)>=0)||f||I||u.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[S,V]of u)this.g.setRequestHeader(S,V);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(i),this.v=!1}catch(S){sa(this,S)}};function sa(i,c){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=c,i.o=5,ia(i),pr(i)}function ia(i){i.A||(i.A=!0,vt(i,"complete"),vt(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=i||7,vt(this,"complete"),vt(this,"abort"),pr(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),pr(this,!0)),nt.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?oa(this):this.Xa())},n.Xa=function(){oa(this)};function oa(i){if(i.h&&typeof o<"u"){if(i.v&&Yt(i)==4)setTimeout(i.Ca.bind(i),0);else if(vt(i,"readystatechange"),Yt(i)==4){i.h=!1;try{const S=i.ca();t:switch(S){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break t;default:c=!1}var u;if(!(u=c)){var f;if(f=S===0){let V=String(i.D).match(Qo)[1]||null;!V&&a.self&&a.self.location&&(V=a.self.location.protocol.slice(0,-1)),f=!hh.test(V?V.toLowerCase():"")}u=f}if(u)vt(i,"complete"),vt(i,"success");else{i.o=6;try{var I=Yt(i)>2?i.g.statusText:""}catch{I=""}i.l=I+" ["+i.ca()+"]",ia(i)}}finally{pr(i)}}}}function pr(i,c){if(i.g){i.m&&(clearTimeout(i.m),i.m=null);const u=i.g;i.g=null,c||vt(i,"ready");try{u.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Yt(i){return i.g?i.g.readyState:0}n.ca=function(){try{return Yt(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(i){if(this.g){var c=this.g.responseText;return i&&c.indexOf(i)==0&&(c=c.substring(i.length)),Hu(c)}};function aa(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.F){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function fh(i){const c={};i=(i.g&&Yt(i)>=2&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<i.length;f++){if(g(i[f]))continue;var u=Ju(i[f]);const I=u[0];if(u=u[1],typeof u!="string")continue;u=u.trim();const S=c[I]||[];c[I]=S,S.push(u)}Bu(c,function(f){return f.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function wn(i,c,u){return u&&u.internalChannelParams&&u.internalChannelParams[i]||c}function ca(i){this.za=0,this.i=[],this.j=new fn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=wn("failFast",!1,i),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=wn("baseRetryDelayMs",5e3,i),this.Za=wn("retryDelaySeedMs",1e4,i),this.Ta=wn("forwardChannelMaxRetries",2,i),this.va=wn("forwardChannelRequestTimeoutMs",2e4,i),this.ma=i&&i.xmlHttpFactory||void 0,this.Ua=i&&i.Rb||void 0,this.Aa=i&&i.useFetchStreams||!1,this.O=void 0,this.L=i&&i.supportsCrossDomainXhr||!1,this.M="",this.h=new zo(i&&i.concurrentRequestLimit),this.Ba=new uh,this.S=i&&i.fastHandshake||!1,this.R=i&&i.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=i&&i.Pb||!1,i&&i.ua&&this.j.ua(),i&&i.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&i&&i.detectBufferingProxy||!1,this.ia=void 0,i&&i.longPollingTimeout&&i.longPollingTimeout>0&&(this.ia=i.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=ca.prototype,n.ka=8,n.I=1,n.connect=function(i,c,u,f){It(0),this.W=i,this.H=c||{},u&&f!==void 0&&(this.H.OSID=u,this.H.OAID=f),this.F=this.X,this.J=_a(this,null,this.W),yr(this)};function Us(i){if(la(i),i.I==3){var c=i.V++,u=Mt(i.J);if(J(u,"SID",i.M),J(u,"RID",c),J(u,"TYPE","terminate"),An(i,u),c=new Qt(i,i.j,c),c.M=2,c.A=mr(Mt(u)),u=!1,a.navigator&&a.navigator.sendBeacon)try{u=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!u&&a.Image&&(new Image().src=c.A,u=!0),u||(c.g=ya(c.j,null),c.g.ea(c.A)),c.F=Date.now(),fr(c)}pa(i)}function _r(i){i.g&&(qs(i),i.g.cancel(),i.g=null)}function la(i){_r(i),i.v&&(a.clearTimeout(i.v),i.v=null),Er(i),i.h.cancel(),i.m&&(typeof i.m=="number"&&a.clearTimeout(i.m),i.m=null)}function yr(i){if(!Ho(i.h)&&!i.m){i.m=!0;var c=i.Ea;At||m(),ut||(At(),ut=!0),T.add(c,i),i.D=0}}function mh(i,c){return Go(i.h)>=i.h.j-(i.m?1:0)?!1:i.m?(i.i=c.G.concat(i.i),!0):i.I==1||i.I==2||i.D>=(i.Sa?0:i.Ta)?!1:(i.m=dn(d(i.Ea,i,c),ga(i,i.D)),i.D++,!0)}n.Ea=function(i){if(this.m)if(this.m=null,this.I==1){if(!i){this.V=Math.floor(Math.random()*1e5),i=this.V++;const I=new Qt(this,this.j,i);let S=this.o;if(this.U&&(S?(S=vo(S),wo(S,this.U)):S=this.U),this.u!==null||this.R||(I.J=S,S=null),this.S)t:{for(var c=0,u=0;u<this.i.length;u++){e:{var f=this.i[u];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break e}f=void 0}if(f===void 0)break;if(c+=f,c>4096){c=u;break t}if(c===4096||u===this.i.length-1){c=u+1;break t}}c=1e3}else c=1e3;c=ha(this,I,c),u=Mt(this.J),J(u,"RID",i),J(u,"CVER",22),this.G&&J(u,"X-HTTP-Session-Id",this.G),An(this,u),S&&(this.R?c="headers="+mn(ra(S))+"&"+c:this.u&&Bs(u,this.u,S)),xs(this.h,I),this.Ra&&J(u,"TYPE","init"),this.S?(J(u,"$req",c),J(u,"SID","null"),I.U=!0,ks(I,u,null)):ks(I,u,c),this.I=2}}else this.I==3&&(i?ua(this,i):this.i.length==0||Ho(this.h)||ua(this))};function ua(i,c){var u;c?u=c.l:u=i.V++;const f=Mt(i.J);J(f,"SID",i.M),J(f,"RID",u),J(f,"AID",i.K),An(i,f),i.u&&i.o&&Bs(f,i.u,i.o),u=new Qt(i,i.j,u,i.D+1),i.u===null&&(u.J=i.o),c&&(i.i=c.G.concat(i.i)),c=ha(i,u,1e3),u.H=Math.round(i.va*.5)+Math.round(i.va*.5*Math.random()),xs(i.h,u),ks(u,f,c)}function An(i,c){i.H&&cr(i.H,function(u,f){J(c,f,u)}),i.l&&cr({},function(u,f){J(c,f,u)})}function ha(i,c,u){u=Math.min(i.i.length,u);const f=i.l?d(i.l.Ka,i.l,i):null;t:{var I=i.i;let j=-1;for(;;){const ot=["count="+u];j==-1?u>0?(j=I[0].g,ot.push("ofs="+j)):j=0:ot.push("ofs="+j);let X=!0;for(let ht=0;ht<u;ht++){var S=I[ht].g;const xt=I[ht].map;if(S-=j,S<0)j=Math.max(0,I[ht].g-100),X=!1;else try{S="req"+S+"_"||"";try{var V=xt instanceof Map?xt:Object.entries(xt);for(const[ye,Zt]of V){let te=Zt;l(Zt)&&(te=Cs(Zt)),ot.push(S+ye+"="+encodeURIComponent(te))}}catch(ye){throw ot.push(S+"type="+encodeURIComponent("_badmap")),ye}}catch{f&&f(xt)}}if(X){V=ot.join("&");break t}}V=void 0}return i=i.i.splice(0,u),c.G=i,V}function da(i){if(!i.g&&!i.v){i.Y=1;var c=i.Da;At||m(),ut||(At(),ut=!0),T.add(c,i),i.A=0}}function js(i){return i.g||i.v||i.A>=3?!1:(i.Y++,i.v=dn(d(i.Da,i),ga(i,i.A)),i.A++,!0)}n.Da=function(){if(this.v=null,fa(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var i=4*this.T;this.j.info("BP detection timer enabled: "+i),this.B=dn(d(this.Wa,this),i)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,It(10),_r(this),fa(this))};function qs(i){i.B!=null&&(a.clearTimeout(i.B),i.B=null)}function fa(i){i.g=new Qt(i,i.j,"rpc",i.Y),i.u===null&&(i.g.J=i.o),i.g.P=0;var c=Mt(i.na);J(c,"RID","rpc"),J(c,"SID",i.M),J(c,"AID",i.K),J(c,"CI",i.F?"0":"1"),!i.F&&i.ia&&J(c,"TO",i.ia),J(c,"TYPE","xmlhttp"),An(i,c),i.u&&i.o&&Bs(c,i.u,i.o),i.O&&(i.g.H=i.O);var u=i.g;i=i.ba,u.M=1,u.A=mr(Mt(c)),u.u=null,u.R=!0,jo(u,i)}n.Va=function(){this.C!=null&&(this.C=null,_r(this),js(this),It(19))};function Er(i){i.C!=null&&(a.clearTimeout(i.C),i.C=null)}function ma(i,c){var u=null;if(i.g==c){Er(i),qs(i),i.g=null;var f=2}else if(Ms(i.h,c))u=c.G,Ko(i.h,c),f=1;else return;if(i.I!=0){if(c.o)if(f==1){u=c.u?c.u.length:0,c=Date.now()-c.F;var I=i.D;f=hr(),vt(f,new xo(f,u)),yr(i)}else da(i);else if(I=c.m,I==3||I==0&&c.X>0||!(f==1&&mh(i,c)||f==2&&js(i)))switch(u&&u.length>0&&(c=i.h,c.i=c.i.concat(u)),I){case 1:_e(i,5);break;case 4:_e(i,10);break;case 3:_e(i,6);break;default:_e(i,2)}}}function ga(i,c){let u=i.Qa+Math.floor(Math.random()*i.Za);return i.isActive()||(u*=2),u*c}function _e(i,c){if(i.j.info("Error code "+c),c==2){var u=d(i.bb,i),f=i.Ua;const I=!f;f=new Xt(f||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||pn(f,"https"),mr(f),I?ch(f.toString(),u):lh(f.toString(),u)}else It(2);i.I=0,i.l&&i.l.pa(c),pa(i),la(i)}n.bb=function(i){i?(this.j.info("Successfully pinged google.com"),It(2)):(this.j.info("Failed to ping google.com"),It(1))};function pa(i){if(i.I=0,i.ja=[],i.l){const c=Wo(i.h);(c.length!=0||i.i.length!=0)&&(N(i.ja,c),N(i.ja,i.i),i.h.i.length=0,b(i.i),i.i.length=0),i.l.oa()}}function _a(i,c,u){var f=u instanceof Xt?Mt(u):new Xt(u);if(f.g!="")c&&(f.g=c+"."+f.g),_n(f,f.u);else{var I=a.location;f=I.protocol,c=c?c+"."+I.hostname:I.hostname,I=+I.port;const S=new Xt(null);f&&pn(S,f),c&&(S.g=c),I&&_n(S,I),u&&(S.h=u),f=S}return u=i.G,c=i.wa,u&&c&&J(f,u,c),J(f,"VER",i.ka),An(i,f),f}function ya(i,c,u){if(c&&!i.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=i.Aa&&!i.ma?new nt(new Fs({ab:u})):new nt(i.ma),c.Fa(i.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function Ea(){}n=Ea.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Tr(){}Tr.prototype.g=function(i,c){return new bt(i,c)};function bt(i,c){pt.call(this),this.g=new ca(c),this.l=i,this.h=c&&c.messageUrlParams||null,i=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(i?i["X-WebChannel-Content-Type"]=c.messageContentType:i={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(i?i["X-WebChannel-Client-Profile"]=c.sa:i={"X-WebChannel-Client-Profile":c.sa}),this.g.U=i,(i=c&&c.Qb)&&!g(i)&&(this.g.u=i),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!g(c)&&(this.g.G=c,i=this.h,i!==null&&c in i&&(i=this.h,c in i&&delete i[c])),this.j=new Oe(this)}E(bt,pt),bt.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},bt.prototype.close=function(){Us(this.g)},bt.prototype.o=function(i){var c=this.g;if(typeof i=="string"){var u={};u.__data__=i,i=u}else this.v&&(u={},u.__data__=Cs(i),i=u);c.i.push(new th(c.Ya++,i)),c.I==3&&yr(c)},bt.prototype.N=function(){this.g.l=null,delete this.j,Us(this.g),delete this.g,bt.Z.N.call(this)};function Ta(i){bs.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var c=i.__sm__;if(c){t:{for(const u in c){i=u;break t}i=void 0}(this.i=i)&&(i=this.i,c=c!==null&&i in c?c[i]:void 0),this.data=c}else this.data=i}E(Ta,bs);function va(){Ps.call(this),this.status=1}E(va,Ps);function Oe(i){this.g=i}E(Oe,Ea),Oe.prototype.ra=function(){vt(this.g,"a")},Oe.prototype.qa=function(i){vt(this.g,new Ta(i))},Oe.prototype.pa=function(i){vt(this.g,new va)},Oe.prototype.oa=function(){vt(this.g,"b")},Tr.prototype.createWebChannel=Tr.prototype.g,bt.prototype.send=bt.prototype.o,bt.prototype.open=bt.prototype.m,bt.prototype.close=bt.prototype.close,Jc=function(){return new Tr},Xc=function(){return hr()},Qc=me,ii={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},dr.NO_ERROR=0,dr.TIMEOUT=8,dr.HTTP_ERROR=6,Vr=dr,Lo.COMPLETE="complete",Wc=Lo,ko.EventType=un,un.OPEN="a",un.CLOSE="b",un.ERROR="c",un.MESSAGE="d",pt.prototype.listen=pt.prototype.J,Sn=ko,nt.prototype.listenOnce=nt.prototype.K,nt.prototype.getLastError=nt.prototype.Ha,nt.prototype.getLastErrorCode=nt.prototype.ya,nt.prototype.getStatus=nt.prototype.ca,nt.prototype.getResponseJson=nt.prototype.La,nt.prototype.getResponseText=nt.prototype.la,nt.prototype.send=nt.prototype.ea,nt.prototype.setWithCredentials=nt.prototype.Fa,Kc=nt}).apply(typeof Ir<"u"?Ir:typeof self<"u"?self:typeof window<"u"?window:{});const Oa="@firebase/firestore",Ma="4.9.2";class yt{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}yt.UNAUTHENTICATED=new yt(null),yt.GOOGLE_CREDENTIALS=new yt("google-credentials-uid"),yt.FIRST_PARTY=new yt("first-party-uid"),yt.MOCK_USER=new yt("mock-user");let sn="12.3.0";const Se=new Uc("@firebase/firestore");function Me(){return Se.logLevel}function k(n,...t){if(Se.logLevel<=H.DEBUG){const e=t.map(Oi);Se.debug(`Firestore (${sn}): ${n}`,...e)}}function Kt(n,...t){if(Se.logLevel<=H.ERROR){const e=t.map(Oi);Se.error(`Firestore (${sn}): ${n}`,...e)}}function Xe(n,...t){if(Se.logLevel<=H.WARN){const e=t.map(Oi);Se.warn(`Firestore (${sn}): ${n}`,...e)}}function Oi(n){if(typeof n=="string")return n;try{return(function(e){return JSON.stringify(e)})(n)}catch{return n}}function L(n,t,e){let r="Unexpected state";typeof t=="string"?r=t:e=t,Yc(n,r,e)}function Yc(n,t,e){let r=`FIRESTORE (${sn}) INTERNAL ASSERTION FAILED: ${t} (ID: ${n.toString(16)})`;if(e!==void 0)try{r+=" CONTEXT: "+JSON.stringify(e)}catch{r+=" CONTEXT: "+e}throw Kt(r),new Error(r)}function Q(n,t,e,r){let s="Unexpected state";typeof e=="string"?s=e:r=e,n||Yc(t,s,r)}function B(n,t){return n}const C={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class O extends rn{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ie{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Zc{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class tf{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(yt.UNAUTHENTICATED)))}shutdown(){}}class ef{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class nf{constructor(t){this.t=t,this.currentUser=yt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){Q(this.o===void 0,42304);let r=this.i;const s=h=>this.i!==r?(r=this.i,e(h)):Promise.resolve();let o=new ie;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new ie,t.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const h=o;t.enqueueRetryable((async()=>{await h.promise,await s(this.currentUser)}))},l=h=>{k("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((h=>l(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?l(h):(k("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new ie)}}),0),a()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((r=>this.i!==t?(k("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Q(typeof r.accessToken=="string",31837,{l:r}),new Zc(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return Q(t===null||typeof t=="string",2055,{h:t}),new yt(t)}}class rf{constructor(t,e,r){this.P=t,this.T=e,this.I=r,this.type="FirstParty",this.user=yt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class sf{constructor(t,e,r){this.P=t,this.T=e,this.I=r}getToken(){return Promise.resolve(new rf(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable((()=>e(yt.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class xa{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class of{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ld(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){Q(this.o===void 0,3512);const r=o=>{o.error!=null&&k("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,k("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(o.token):Promise.resolve()};this.o=o=>{t.enqueueRetryable((()=>r(o)))};const s=o=>{k("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>s(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):k("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new xa(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((e=>e?(Q(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new xa(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function af(n){const t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let r=0;r<n;r++)e[r]=Math.floor(256*Math.random());return e}class Mi{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=af(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<e&&(r+=t.charAt(s[o]%62))}return r}}function q(n,t){return n<t?-1:n>t?1:0}function oi(n,t){const e=Math.min(n.length,t.length);for(let r=0;r<e;r++){const s=n.charAt(r),o=t.charAt(r);if(s!==o)return Ws(s)===Ws(o)?q(s,o):Ws(s)?1:-1}return q(n.length,t.length)}const cf=55296,lf=57343;function Ws(n){const t=n.charCodeAt(0);return t>=cf&&t<=lf}function Je(n,t,e){return n.length===t.length&&n.every(((r,s)=>e(r,t[s])))}const La="__name__";class Lt{constructor(t,e,r){e===void 0?e=0:e>t.length&&L(637,{offset:e,range:t.length}),r===void 0?r=t.length-e:r>t.length-e&&L(1746,{length:r,range:t.length-e}),this.segments=t,this.offset=e,this.len=r}get length(){return this.len}isEqual(t){return Lt.comparator(this,t)===0}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Lt?t.forEach((r=>{e.push(r)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,r=this.limit();e<r;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const r=Math.min(t.length,e.length);for(let s=0;s<r;s++){const o=Lt.compareSegments(t.get(s),e.get(s));if(o!==0)return o}return q(t.length,e.length)}static compareSegments(t,e){const r=Lt.isNumericId(t),s=Lt.isNumericId(e);return r&&!s?-1:!r&&s?1:r&&s?Lt.extractNumericId(t).compare(Lt.extractNumericId(e)):oi(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return se.fromString(t.substring(4,t.length-2))}}class Y extends Lt{construct(t,e,r){return new Y(t,e,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const r of t){if(r.indexOf("//")>=0)throw new O(C.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter((s=>s.length>0)))}return new Y(e)}static emptyPath(){return new Y([])}}const uf=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class mt extends Lt{construct(t,e,r){return new mt(t,e,r)}static isValidIdentifier(t){return uf.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),mt.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===La}static keyField(){return new mt([La])}static fromServerFormat(t){const e=[];let r="",s=0;const o=()=>{if(r.length===0)throw new O(C.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""};let a=!1;for(;s<t.length;){const l=t[s];if(l==="\\"){if(s+1===t.length)throw new O(C.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const h=t[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new O(C.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=h,s+=2}else l==="`"?(a=!a,s++):l!=="."||a?(r+=l,s++):(o(),s++)}if(o(),a)throw new O(C.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new mt(e)}static emptyPath(){return new mt([])}}class M{constructor(t){this.path=t}static fromPath(t){return new M(Y.fromString(t))}static fromName(t){return new M(Y.fromString(t).popFirst(5))}static empty(){return new M(Y.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Y.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return Y.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new M(new Y(t.slice()))}}function tl(n,t,e){if(!e)throw new O(C.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function hf(n,t,e,r){if(t===!0&&r===!0)throw new O(C.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function Fa(n){if(!M.isDocumentKey(n))throw new O(C.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Ba(n){if(M.isDocumentKey(n))throw new O(C.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function el(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function xi(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const t=(function(r){return r.constructor?r.constructor.name:null})(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":L(12329,{type:typeof n})}function Ft(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new O(C.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=xi(n);throw new O(C.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}function it(n,t){const e={typeString:n};return t&&(e.value=t),e}function Zn(n,t){if(!el(n))throw new O(C.INVALID_ARGUMENT,"JSON must be an object");let e;for(const r in t)if(t[r]){const s=t[r].typeString,o="value"in t[r]?{value:t[r].value}:void 0;if(!(r in n)){e=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){e=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&a!==o.value){e=`Expected '${r}' field to equal '${o.value}'`;break}}if(e)throw new O(C.INVALID_ARGUMENT,e);return!0}const Ua=-62135596800,ja=1e6;class Z{static now(){return Z.fromMillis(Date.now())}static fromDate(t){return Z.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),r=Math.floor((t-1e3*e)*ja);return new Z(e,r)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new O(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new O(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<Ua)throw new O(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new O(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/ja}_compareTo(t){return this.seconds===t.seconds?q(this.nanoseconds,t.nanoseconds):q(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Z._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(Zn(t,Z._jsonSchema))return new Z(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-Ua;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Z._jsonSchemaVersion="firestore/timestamp/1.0",Z._jsonSchema={type:it("string",Z._jsonSchemaVersion),seconds:it("number"),nanoseconds:it("number")};class F{static fromTimestamp(t){return new F(t)}static min(){return new F(new Z(0,0))}static max(){return new F(new Z(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Bn=-1;function df(n,t){const e=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=F.fromTimestamp(r===1e9?new Z(e+1,0):new Z(e,r));return new ae(s,M.empty(),t)}function ff(n){return new ae(n.readTime,n.key,Bn)}class ae{constructor(t,e,r){this.readTime=t,this.documentKey=e,this.largestBatchId=r}static min(){return new ae(F.min(),M.empty(),Bn)}static max(){return new ae(F.max(),M.empty(),Bn)}}function mf(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=M.comparator(n.documentKey,t.documentKey),e!==0?e:q(n.largestBatchId,t.largestBatchId))}const gf="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class pf{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function on(n){if(n.code!==C.FAILED_PRECONDITION||n.message!==gf)throw n;k("LocalStore","Unexpectedly lost primary lease")}class R{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&L(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new R(((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(t,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(e,o).next(r,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof R?e:R.resolve(e)}catch(e){return R.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):R.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):R.reject(e)}static resolve(t){return new R(((e,r)=>{e(t)}))}static reject(t){return new R(((e,r)=>{r(t)}))}static waitFor(t){return new R(((e,r)=>{let s=0,o=0,a=!1;t.forEach((l=>{++s,l.next((()=>{++o,a&&o===s&&e()}),(h=>r(h)))})),a=!0,o===s&&e()}))}static or(t){let e=R.resolve(!1);for(const r of t)e=e.next((s=>s?R.resolve(s):r()));return e}static forEach(t,e){const r=[];return t.forEach(((s,o)=>{r.push(e.call(this,s,o))})),this.waitFor(r)}static mapArray(t,e){return new R(((r,s)=>{const o=t.length,a=new Array(o);let l=0;for(let h=0;h<o;h++){const d=h;e(t[d]).next((p=>{a[d]=p,++l,l===o&&r(a)}),(p=>s(p)))}}))}static doWhile(t,e){return new R(((r,s)=>{const o=()=>{t()===!0?e().next((()=>{o()}),s):r()};o()}))}}function _f(n){const t=n.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function an(n){return n.name==="IndexedDbTransactionError"}class as{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>e.writeSequenceNumber(r))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}as.ce=-1;const Li=-1;function cs(n){return n==null}function zr(n){return n===0&&1/n==-1/0}function yf(n){return typeof n=="number"&&Number.isInteger(n)&&!zr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const nl="";function Ef(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=qa(t)),t=Tf(n.get(e),t);return qa(t)}function Tf(n,t){let e=t;const r=n.length;for(let s=0;s<r;s++){const o=n.charAt(s);switch(o){case"\0":e+="";break;case nl:e+="";break;default:e+=o}}return e}function qa(n){return n+nl+""}function $a(n){let t=0;for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function be(n,t){for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function rl(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}class et{constructor(t,e){this.comparator=t,this.root=e||ft.EMPTY}insert(t,e){return new et(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,ft.BLACK,null,null))}remove(t){return new et(this.comparator,this.root.remove(t,this.comparator).copy(null,null,ft.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const r=this.comparator(t,e.key);if(r===0)return e.value;r<0?e=e.left:r>0&&(e=e.right)}return null}indexOf(t){let e=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(t,r.key);if(s===0)return e+r.left.size;s<0?r=r.left:(e+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,r)=>(t(e,r),!1)))}toString(){const t=[];return this.inorderTraversal(((e,r)=>(t.push(`${e}:${r}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new wr(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new wr(this.root,t,this.comparator,!1)}getReverseIterator(){return new wr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new wr(this.root,t,this.comparator,!0)}}class wr{constructor(t,e,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!t.isEmpty();)if(o=e?r(t.key,e):1,e&&s&&(o*=-1),o<0)t=this.isReverse?t.left:t.right;else{if(o===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class ft{constructor(t,e,r,s,o){this.key=t,this.value=e,this.color=r??ft.RED,this.left=s??ft.EMPTY,this.right=o??ft.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,r,s,o){return new ft(t??this.key,e??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,r){let s=this;const o=r(t,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(t,e,r),null):o===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return ft.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let r,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return ft.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,ft.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,ft.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw L(43730,{key:this.key,value:this.value});if(this.right.isRed())throw L(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw L(27949);return t+(this.isRed()?0:1)}}ft.EMPTY=null,ft.RED=!0,ft.BLACK=!1;ft.EMPTY=new class{constructor(){this.size=0}get key(){throw L(57766)}get value(){throw L(16141)}get color(){throw L(16727)}get left(){throw L(29726)}get right(){throw L(36894)}copy(t,e,r,s,o){return this}insert(t,e,r){return new ft(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class lt{constructor(t){this.comparator=t,this.data=new et(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,r)=>(t(e),!1)))}forEachInRange(t,e){const r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let r;for(r=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new za(this.data.getIterator())}getIteratorFrom(t){return new za(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((r=>{e=e.add(r)})),e}isEqual(t){if(!(t instanceof lt)||this.size!==t.size)return!1;const e=this.data.getIterator(),r=t.data.getIterator();for(;e.hasNext();){const s=e.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new lt(this.comparator);return e.data=t,e}}class za{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Nt{constructor(t){this.fields=t,t.sort(mt.comparator)}static empty(){return new Nt([])}unionWith(t){let e=new lt(mt.comparator);for(const r of this.fields)e=e.add(r);for(const r of t)e=e.add(r);return new Nt(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Je(this.fields,t.fields,((e,r)=>e.isEqual(r)))}}class sl extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class gt{constructor(t){this.binaryString=t}static fromBase64String(t){const e=(function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new sl("Invalid base64 string: "+o):o}})(t);return new gt(e)}static fromUint8Array(t){const e=(function(s){let o="";for(let a=0;a<s.length;++a)o+=String.fromCharCode(s[a]);return o})(t);return new gt(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(e){return btoa(e)})(this.binaryString)}toUint8Array(){return(function(e){const r=new Uint8Array(e.length);for(let s=0;s<e.length;s++)r[s]=e.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return q(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}gt.EMPTY_BYTE_STRING=new gt("");const vf=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ce(n){if(Q(!!n,39018),typeof n=="string"){let t=0;const e=vf.exec(n);if(Q(!!e,46558,{timestamp:n}),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:rt(n.seconds),nanos:rt(n.nanos)}}function rt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function le(n){return typeof n=="string"?gt.fromBase64String(n):gt.fromUint8Array(n)}const il="server_timestamp",ol="__type__",al="__previous_value__",cl="__local_write_time__";function Fi(n){return(n?.mapValue?.fields||{})[ol]?.stringValue===il}function ls(n){const t=n.mapValue.fields[al];return Fi(t)?ls(t):t}function Un(n){const t=ce(n.mapValue.fields[cl].timestampValue);return new Z(t.seconds,t.nanos)}class If{constructor(t,e,r,s,o,a,l,h,d,p){this.databaseId=t,this.appId=e,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=h,this.useFetchStreams=d,this.isUsingEmulator=p}}const Hr="(default)";class jn{constructor(t,e){this.projectId=t,this.database=e||Hr}static empty(){return new jn("","")}get isDefaultDatabase(){return this.database===Hr}isEqual(t){return t instanceof jn&&t.projectId===this.projectId&&t.database===this.database}}const ll="__type__",wf="__max__",Ar={mapValue:{}},ul="__vector__",Gr="value";function ue(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Fi(n)?4:Sf(n)?9007199254740991:Af(n)?10:11:L(28295,{value:n})}function $t(n,t){if(n===t)return!0;const e=ue(n);if(e!==ue(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return Un(n).isEqual(Un(t));case 3:return(function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const a=ce(s.timestampValue),l=ce(o.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos})(n,t);case 5:return n.stringValue===t.stringValue;case 6:return(function(s,o){return le(s.bytesValue).isEqual(le(o.bytesValue))})(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return(function(s,o){return rt(s.geoPointValue.latitude)===rt(o.geoPointValue.latitude)&&rt(s.geoPointValue.longitude)===rt(o.geoPointValue.longitude)})(n,t);case 2:return(function(s,o){if("integerValue"in s&&"integerValue"in o)return rt(s.integerValue)===rt(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const a=rt(s.doubleValue),l=rt(o.doubleValue);return a===l?zr(a)===zr(l):isNaN(a)&&isNaN(l)}return!1})(n,t);case 9:return Je(n.arrayValue.values||[],t.arrayValue.values||[],$t);case 10:case 11:return(function(s,o){const a=s.mapValue.fields||{},l=o.mapValue.fields||{};if($a(a)!==$a(l))return!1;for(const h in a)if(a.hasOwnProperty(h)&&(l[h]===void 0||!$t(a[h],l[h])))return!1;return!0})(n,t);default:return L(52216,{left:n})}}function qn(n,t){return(n.values||[]).find((e=>$t(e,t)))!==void 0}function Ye(n,t){if(n===t)return 0;const e=ue(n),r=ue(t);if(e!==r)return q(e,r);switch(e){case 0:case 9007199254740991:return 0;case 1:return q(n.booleanValue,t.booleanValue);case 2:return(function(o,a){const l=rt(o.integerValue||o.doubleValue),h=rt(a.integerValue||a.doubleValue);return l<h?-1:l>h?1:l===h?0:isNaN(l)?isNaN(h)?0:-1:1})(n,t);case 3:return Ha(n.timestampValue,t.timestampValue);case 4:return Ha(Un(n),Un(t));case 5:return oi(n.stringValue,t.stringValue);case 6:return(function(o,a){const l=le(o),h=le(a);return l.compareTo(h)})(n.bytesValue,t.bytesValue);case 7:return(function(o,a){const l=o.split("/"),h=a.split("/");for(let d=0;d<l.length&&d<h.length;d++){const p=q(l[d],h[d]);if(p!==0)return p}return q(l.length,h.length)})(n.referenceValue,t.referenceValue);case 8:return(function(o,a){const l=q(rt(o.latitude),rt(a.latitude));return l!==0?l:q(rt(o.longitude),rt(a.longitude))})(n.geoPointValue,t.geoPointValue);case 9:return Ga(n.arrayValue,t.arrayValue);case 10:return(function(o,a){const l=o.fields||{},h=a.fields||{},d=l[Gr]?.arrayValue,p=h[Gr]?.arrayValue,E=q(d?.values?.length||0,p?.values?.length||0);return E!==0?E:Ga(d,p)})(n.mapValue,t.mapValue);case 11:return(function(o,a){if(o===Ar.mapValue&&a===Ar.mapValue)return 0;if(o===Ar.mapValue)return 1;if(a===Ar.mapValue)return-1;const l=o.fields||{},h=Object.keys(l),d=a.fields||{},p=Object.keys(d);h.sort(),p.sort();for(let E=0;E<h.length&&E<p.length;++E){const A=oi(h[E],p[E]);if(A!==0)return A;const b=Ye(l[h[E]],d[p[E]]);if(b!==0)return b}return q(h.length,p.length)})(n.mapValue,t.mapValue);default:throw L(23264,{he:e})}}function Ha(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return q(n,t);const e=ce(n),r=ce(t),s=q(e.seconds,r.seconds);return s!==0?s:q(e.nanos,r.nanos)}function Ga(n,t){const e=n.values||[],r=t.values||[];for(let s=0;s<e.length&&s<r.length;++s){const o=Ye(e[s],r[s]);if(o)return o}return q(e.length,r.length)}function Ze(n){return ai(n)}function ai(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(e){const r=ce(e);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(e){return le(e).toBase64()})(n.bytesValue):"referenceValue"in n?(function(e){return M.fromName(e).toString()})(n.referenceValue):"geoPointValue"in n?(function(e){return`geo(${e.latitude},${e.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(e){let r="[",s=!0;for(const o of e.values||[])s?s=!1:r+=",",r+=ai(o);return r+"]"})(n.arrayValue):"mapValue"in n?(function(e){const r=Object.keys(e.fields||{}).sort();let s="{",o=!0;for(const a of r)o?o=!1:s+=",",s+=`${a}:${ai(e.fields[a])}`;return s+"}"})(n.mapValue):L(61005,{value:n})}function Dr(n){switch(ue(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=ls(n);return t?16+Dr(t):16;case 5:return 2*n.stringValue.length;case 6:return le(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,o)=>s+Dr(o)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return be(r.fields,((o,a)=>{s+=o.length+Dr(a)})),s})(n.mapValue);default:throw L(13486,{value:n})}}function ci(n){return!!n&&"integerValue"in n}function Bi(n){return!!n&&"arrayValue"in n}function Ka(n){return!!n&&"nullValue"in n}function Wa(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function kr(n){return!!n&&"mapValue"in n}function Af(n){return(n?.mapValue?.fields||{})[ll]?.stringValue===ul}function Vn(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const t={mapValue:{fields:{}}};return be(n.mapValue.fields,((e,r)=>t.mapValue.fields[e]=Vn(r))),t}if(n.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=Vn(n.arrayValue.values[e]);return t}return{...n}}function Sf(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===wf}class Vt{constructor(t){this.value=t}static empty(){return new Vt({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let r=0;r<t.length-1;++r)if(e=(e.mapValue.fields||{})[t.get(r)],!kr(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Vn(e)}setAll(t){let e=mt.emptyPath(),r={},s=[];t.forEach(((a,l)=>{if(!e.isImmediateParentOf(l)){const h=this.getFieldsMap(e);this.applyChanges(h,r,s),r={},s=[],e=l.popLast()}a?r[l.lastSegment()]=Vn(a):s.push(l.lastSegment())}));const o=this.getFieldsMap(e);this.applyChanges(o,r,s)}delete(t){const e=this.field(t.popLast());kr(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return $t(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let r=0;r<t.length;++r){let s=e.mapValue.fields[t.get(r)];kr(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(r)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,r){be(e,((s,o)=>t[s]=o));for(const s of r)delete t[s]}clone(){return new Vt(Vn(this.value))}}function hl(n){const t=[];return be(n.fields,((e,r)=>{const s=new mt([e]);if(kr(r)){const o=hl(r.mapValue).fields;if(o.length===0)t.push(s);else for(const a of o)t.push(s.child(a))}else t.push(s)})),new Nt(t)}class Et{constructor(t,e,r,s,o,a,l){this.key=t,this.documentType=e,this.version=r,this.readTime=s,this.createTime=o,this.data=a,this.documentState=l}static newInvalidDocument(t){return new Et(t,0,F.min(),F.min(),F.min(),Vt.empty(),0)}static newFoundDocument(t,e,r,s){return new Et(t,1,e,F.min(),r,s,0)}static newNoDocument(t,e){return new Et(t,2,e,F.min(),F.min(),Vt.empty(),0)}static newUnknownDocument(t,e){return new Et(t,3,e,F.min(),F.min(),Vt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(F.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Vt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Vt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=F.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof Et&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Et(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Kr{constructor(t,e){this.position=t,this.inclusive=e}}function Qa(n,t,e){let r=0;for(let s=0;s<n.position.length;s++){const o=t[s],a=n.position[s];if(o.field.isKeyField()?r=M.comparator(M.fromName(a.referenceValue),e.key):r=Ye(a,e.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Xa(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!$t(n.position[e],t.position[e]))return!1;return!0}class Wr{constructor(t,e="asc"){this.field=t,this.dir=e}}function Rf(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}class dl{}class at extends dl{constructor(t,e,r){super(),this.field=t,this.op=e,this.value=r}static create(t,e,r){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,r):new bf(t,e,r):e==="array-contains"?new Df(t,r):e==="in"?new kf(t,r):e==="not-in"?new Nf(t,r):e==="array-contains-any"?new Of(t,r):new at(t,e,r)}static createKeyFieldInFilter(t,e,r){return e==="in"?new Pf(t,r):new Vf(t,r)}matches(t){const e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(Ye(e,this.value)):e!==null&&ue(this.value)===ue(e)&&this.matchesComparison(Ye(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return L(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class zt extends dl{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new zt(t,e)}matches(t){return fl(this)?this.filters.find((e=>!e.matches(t)))===void 0:this.filters.find((e=>e.matches(t)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function fl(n){return n.op==="and"}function ml(n){return Cf(n)&&fl(n)}function Cf(n){for(const t of n.filters)if(t instanceof zt)return!1;return!0}function li(n){if(n instanceof at)return n.field.canonicalString()+n.op.toString()+Ze(n.value);if(ml(n))return n.filters.map((t=>li(t))).join(",");{const t=n.filters.map((e=>li(e))).join(",");return`${n.op}(${t})`}}function gl(n,t){return n instanceof at?(function(r,s){return s instanceof at&&r.op===s.op&&r.field.isEqual(s.field)&&$t(r.value,s.value)})(n,t):n instanceof zt?(function(r,s){return s instanceof zt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((o,a,l)=>o&&gl(a,s.filters[l])),!0):!1})(n,t):void L(19439)}function pl(n){return n instanceof at?(function(e){return`${e.field.canonicalString()} ${e.op} ${Ze(e.value)}`})(n):n instanceof zt?(function(e){return e.op.toString()+" {"+e.getFilters().map(pl).join(" ,")+"}"})(n):"Filter"}class bf extends at{constructor(t,e,r){super(t,e,r),this.key=M.fromName(r.referenceValue)}matches(t){const e=M.comparator(t.key,this.key);return this.matchesComparison(e)}}class Pf extends at{constructor(t,e){super(t,"in",e),this.keys=_l("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Vf extends at{constructor(t,e){super(t,"not-in",e),this.keys=_l("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function _l(n,t){return(t.arrayValue?.values||[]).map((e=>M.fromName(e.referenceValue)))}class Df extends at{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Bi(e)&&qn(e.arrayValue,this.value)}}class kf extends at{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return e!==null&&qn(this.value.arrayValue,e)}}class Nf extends at{constructor(t,e){super(t,"not-in",e)}matches(t){if(qn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!qn(this.value.arrayValue,e)}}class Of extends at{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Bi(e)||!e.arrayValue.values)&&e.arrayValue.values.some((r=>qn(this.value.arrayValue,r)))}}class Mf{constructor(t,e=null,r=[],s=[],o=null,a=null,l=null){this.path=t,this.collectionGroup=e,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=a,this.endAt=l,this.Te=null}}function Ja(n,t=null,e=[],r=[],s=null,o=null,a=null){return new Mf(n,t,e,r,s,o,a)}function Ui(n){const t=B(n);if(t.Te===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((r=>li(r))).join(","),e+="|ob:",e+=t.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),cs(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((r=>Ze(r))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((r=>Ze(r))).join(",")),t.Te=e}return t.Te}function ji(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!Rf(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!gl(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!Xa(n.startAt,t.startAt)&&Xa(n.endAt,t.endAt)}function ui(n){return M.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class us{constructor(t,e=null,r=[],s=[],o=null,a="F",l=null,h=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=a,this.startAt=l,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function xf(n,t,e,r,s,o,a,l){return new us(n,t,e,r,s,o,a,l)}function qi(n){return new us(n)}function Ya(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Lf(n){return n.collectionGroup!==null}function Dn(n){const t=B(n);if(t.Ie===null){t.Ie=[];const e=new Set;for(const o of t.explicitOrderBy)t.Ie.push(o),e.add(o.field.canonicalString());const r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new lt(mt.comparator);return a.filters.forEach((h=>{h.getFlattenedFilters().forEach((d=>{d.isInequality()&&(l=l.add(d.field))}))})),l})(t).forEach((o=>{e.has(o.canonicalString())||o.isKeyField()||t.Ie.push(new Wr(o,r))})),e.has(mt.keyField().canonicalString())||t.Ie.push(new Wr(mt.keyField(),r))}return t.Ie}function Bt(n){const t=B(n);return t.Ee||(t.Ee=Ff(t,Dn(n))),t.Ee}function Ff(n,t){if(n.limitType==="F")return Ja(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map((s=>{const o=s.dir==="desc"?"asc":"desc";return new Wr(s.field,o)}));const e=n.endAt?new Kr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Kr(n.startAt.position,n.startAt.inclusive):null;return Ja(n.path,n.collectionGroup,t,n.filters,n.limit,e,r)}}function hi(n,t,e){return new us(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function hs(n,t){return ji(Bt(n),Bt(t))&&n.limitType===t.limitType}function yl(n){return`${Ui(Bt(n))}|lt:${n.limitType}`}function xe(n){return`Query(target=${(function(e){let r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map((s=>pl(s))).join(", ")}]`),cs(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map((s=>Ze(s))).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map((s=>Ze(s))).join(",")),`Target(${r})`})(Bt(n))}; limitType=${n.limitType})`}function ds(n,t){return t.isFoundDocument()&&(function(r,s){const o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):M.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(n,t)&&(function(r,s){for(const o of Dn(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0})(n,t)&&(function(r,s){for(const o of r.filters)if(!o.matches(s))return!1;return!0})(n,t)&&(function(r,s){return!(r.startAt&&!(function(a,l,h){const d=Qa(a,l,h);return a.inclusive?d<=0:d<0})(r.startAt,Dn(r),s)||r.endAt&&!(function(a,l,h){const d=Qa(a,l,h);return a.inclusive?d>=0:d>0})(r.endAt,Dn(r),s))})(n,t)}function Bf(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function El(n){return(t,e)=>{let r=!1;for(const s of Dn(n)){const o=Uf(s,t,e);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function Uf(n,t,e){const r=n.field.isKeyField()?M.comparator(t.key,e.key):(function(o,a,l){const h=a.data.field(o),d=l.data.field(o);return h!==null&&d!==null?Ye(h,d):L(42886)})(n.field,t,e);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return L(19790,{direction:n.dir})}}class Pe{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),r=this.inner[e];if(r!==void 0){for(const[s,o]of r)if(this.equalsFn(s,t))return o}}has(t){return this.get(t)!==void 0}set(t,e){const r=this.mapKeyFn(t),s=this.inner[r];if(s===void 0)return this.inner[r]=[[t,e]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],t))return void(s[o]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),r=this.inner[e];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],t))return r.length===1?delete this.inner[e]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(t){be(this.inner,((e,r)=>{for(const[s,o]of r)t(s,o)}))}isEmpty(){return rl(this.inner)}size(){return this.innerSize}}const jf=new et(M.comparator);function Wt(){return jf}const Tl=new et(M.comparator);function Rn(...n){let t=Tl;for(const e of n)t=t.insert(e.key,e);return t}function vl(n){let t=Tl;return n.forEach(((e,r)=>t=t.insert(e,r.overlayedDocument))),t}function Te(){return kn()}function Il(){return kn()}function kn(){return new Pe((n=>n.toString()),((n,t)=>n.isEqual(t)))}const qf=new et(M.comparator),$f=new lt(M.comparator);function $(...n){let t=$f;for(const e of n)t=t.add(e);return t}const zf=new lt(q);function Hf(){return zf}function $i(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:zr(t)?"-0":t}}function wl(n){return{integerValue:""+n}}function Gf(n,t){return yf(t)?wl(t):$i(n,t)}class fs{constructor(){this._=void 0}}function Kf(n,t,e){return n instanceof $n?(function(s,o){const a={fields:{[ol]:{stringValue:il},[cl]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&Fi(o)&&(o=ls(o)),o&&(a.fields[al]=o),{mapValue:a}})(e,t):n instanceof zn?Sl(n,t):n instanceof Hn?Rl(n,t):(function(s,o){const a=Al(s,o),l=Za(a)+Za(s.Ae);return ci(a)&&ci(s.Ae)?wl(l):$i(s.serializer,l)})(n,t)}function Wf(n,t,e){return n instanceof zn?Sl(n,t):n instanceof Hn?Rl(n,t):e}function Al(n,t){return n instanceof Qr?(function(r){return ci(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(t)?t:{integerValue:0}:null}class $n extends fs{}class zn extends fs{constructor(t){super(),this.elements=t}}function Sl(n,t){const e=Cl(t);for(const r of n.elements)e.some((s=>$t(s,r)))||e.push(r);return{arrayValue:{values:e}}}class Hn extends fs{constructor(t){super(),this.elements=t}}function Rl(n,t){let e=Cl(t);for(const r of n.elements)e=e.filter((s=>!$t(s,r)));return{arrayValue:{values:e}}}class Qr extends fs{constructor(t,e){super(),this.serializer=t,this.Ae=e}}function Za(n){return rt(n.integerValue||n.doubleValue)}function Cl(n){return Bi(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Qf{constructor(t,e){this.field=t,this.transform=e}}function Xf(n,t){return n.field.isEqual(t.field)&&(function(r,s){return r instanceof zn&&s instanceof zn||r instanceof Hn&&s instanceof Hn?Je(r.elements,s.elements,$t):r instanceof Qr&&s instanceof Qr?$t(r.Ae,s.Ae):r instanceof $n&&s instanceof $n})(n.transform,t.transform)}class Jf{constructor(t,e){this.version=t,this.transformResults=e}}class Ot{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Ot}static exists(t){return new Ot(void 0,t)}static updateTime(t){return new Ot(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Nr(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}class ms{}function bl(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new zi(n.key,Ot.none()):new tr(n.key,n.data,Ot.none());{const e=n.data,r=Vt.empty();let s=new lt(mt.comparator);for(let o of t.fields)if(!s.has(o)){let a=e.field(o);a===null&&o.length>1&&(o=o.popLast(),a=e.field(o)),a===null?r.delete(o):r.set(o,a),s=s.add(o)}return new Ve(n.key,r,new Nt(s.toArray()),Ot.none())}}function Yf(n,t,e){n instanceof tr?(function(s,o,a){const l=s.value.clone(),h=ec(s.fieldTransforms,o,a.transformResults);l.setAll(h),o.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(n,t,e):n instanceof Ve?(function(s,o,a){if(!Nr(s.precondition,o))return void o.convertToUnknownDocument(a.version);const l=ec(s.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(Pl(s)),h.setAll(l),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()})(n,t,e):(function(s,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()})(0,t,e)}function Nn(n,t,e,r){return n instanceof tr?(function(o,a,l,h){if(!Nr(o.precondition,a))return l;const d=o.value.clone(),p=nc(o.fieldTransforms,h,a);return d.setAll(p),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,t,e,r):n instanceof Ve?(function(o,a,l,h){if(!Nr(o.precondition,a))return l;const d=nc(o.fieldTransforms,h,a),p=a.data;return p.setAll(Pl(o)),p.setAll(d),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),l===null?null:l.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((E=>E.field)))})(n,t,e,r):(function(o,a,l){return Nr(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l})(n,t,e)}function Zf(n,t){let e=null;for(const r of n.fieldTransforms){const s=t.data.field(r.field),o=Al(r.transform,s||null);o!=null&&(e===null&&(e=Vt.empty()),e.set(r.field,o))}return e||null}function tc(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Je(r,s,((o,a)=>Xf(o,a)))})(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}class tr extends ms{constructor(t,e,r,s=[]){super(),this.key=t,this.value=e,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Ve extends ms{constructor(t,e,r,s,o=[]){super(),this.key=t,this.data=e,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function Pl(n){const t=new Map;return n.fieldMask.fields.forEach((e=>{if(!e.isEmpty()){const r=n.data.field(e);t.set(e,r)}})),t}function ec(n,t,e){const r=new Map;Q(n.length===e.length,32656,{Re:e.length,Ve:n.length});for(let s=0;s<e.length;s++){const o=n[s],a=o.transform,l=t.data.field(o.field);r.set(o.field,Wf(a,l,e[s]))}return r}function nc(n,t,e){const r=new Map;for(const s of n){const o=s.transform,a=e.data.field(s.field);r.set(s.field,Kf(o,a,t))}return r}class zi extends ms{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class tm extends ms{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class em{constructor(t,e,r,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(t,e){const r=e.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(t.key)&&Yf(o,t,r[s])}}applyToLocalView(t,e){for(const r of this.baseMutations)r.key.isEqual(t.key)&&(e=Nn(r,t,e,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(t.key)&&(e=Nn(r,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const r=Il();return this.mutations.forEach((s=>{const o=t.get(s.key),a=o.overlayedDocument;let l=this.applyToLocalView(a,o.mutatedFields);l=e.has(s.key)?null:l;const h=bl(a,l);h!==null&&r.set(s.key,h),a.isValidDocument()||a.convertToNoDocument(F.min())})),r}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),$())}isEqual(t){return this.batchId===t.batchId&&Je(this.mutations,t.mutations,((e,r)=>tc(e,r)))&&Je(this.baseMutations,t.baseMutations,((e,r)=>tc(e,r)))}}class Hi{constructor(t,e,r,s){this.batch=t,this.commitVersion=e,this.mutationResults=r,this.docVersions=s}static from(t,e,r){Q(t.mutations.length===r.length,58842,{me:t.mutations.length,fe:r.length});let s=(function(){return qf})();const o=t.mutations;for(let a=0;a<o.length;a++)s=s.insert(o[a].key,r[a].version);return new Hi(t,e,r,s)}}class nm{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class rm{constructor(t,e){this.count=t,this.unchangedNames=e}}var st,z;function sm(n){switch(n){case C.OK:return L(64938);case C.CANCELLED:case C.UNKNOWN:case C.DEADLINE_EXCEEDED:case C.RESOURCE_EXHAUSTED:case C.INTERNAL:case C.UNAVAILABLE:case C.UNAUTHENTICATED:return!1;case C.INVALID_ARGUMENT:case C.NOT_FOUND:case C.ALREADY_EXISTS:case C.PERMISSION_DENIED:case C.FAILED_PRECONDITION:case C.ABORTED:case C.OUT_OF_RANGE:case C.UNIMPLEMENTED:case C.DATA_LOSS:return!0;default:return L(15467,{code:n})}}function Vl(n){if(n===void 0)return Kt("GRPC error has no .code"),C.UNKNOWN;switch(n){case st.OK:return C.OK;case st.CANCELLED:return C.CANCELLED;case st.UNKNOWN:return C.UNKNOWN;case st.DEADLINE_EXCEEDED:return C.DEADLINE_EXCEEDED;case st.RESOURCE_EXHAUSTED:return C.RESOURCE_EXHAUSTED;case st.INTERNAL:return C.INTERNAL;case st.UNAVAILABLE:return C.UNAVAILABLE;case st.UNAUTHENTICATED:return C.UNAUTHENTICATED;case st.INVALID_ARGUMENT:return C.INVALID_ARGUMENT;case st.NOT_FOUND:return C.NOT_FOUND;case st.ALREADY_EXISTS:return C.ALREADY_EXISTS;case st.PERMISSION_DENIED:return C.PERMISSION_DENIED;case st.FAILED_PRECONDITION:return C.FAILED_PRECONDITION;case st.ABORTED:return C.ABORTED;case st.OUT_OF_RANGE:return C.OUT_OF_RANGE;case st.UNIMPLEMENTED:return C.UNIMPLEMENTED;case st.DATA_LOSS:return C.DATA_LOSS;default:return L(39323,{code:n})}}(z=st||(st={}))[z.OK=0]="OK",z[z.CANCELLED=1]="CANCELLED",z[z.UNKNOWN=2]="UNKNOWN",z[z.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",z[z.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",z[z.NOT_FOUND=5]="NOT_FOUND",z[z.ALREADY_EXISTS=6]="ALREADY_EXISTS",z[z.PERMISSION_DENIED=7]="PERMISSION_DENIED",z[z.UNAUTHENTICATED=16]="UNAUTHENTICATED",z[z.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",z[z.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",z[z.ABORTED=10]="ABORTED",z[z.OUT_OF_RANGE=11]="OUT_OF_RANGE",z[z.UNIMPLEMENTED=12]="UNIMPLEMENTED",z[z.INTERNAL=13]="INTERNAL",z[z.UNAVAILABLE=14]="UNAVAILABLE",z[z.DATA_LOSS=15]="DATA_LOSS";function im(){return new TextEncoder}const om=new se([4294967295,4294967295],0);function rc(n){const t=im().encode(n),e=new Gc;return e.update(t),new Uint8Array(e.digest())}function sc(n){const t=new DataView(n.buffer),e=t.getUint32(0,!0),r=t.getUint32(4,!0),s=t.getUint32(8,!0),o=t.getUint32(12,!0);return[new se([e,r],0),new se([s,o],0)]}class Gi{constructor(t,e,r){if(this.bitmap=t,this.padding=e,this.hashCount=r,e<0||e>=8)throw new Cn(`Invalid padding: ${e}`);if(r<0)throw new Cn(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new Cn(`Invalid hash count: ${r}`);if(t.length===0&&e!==0)throw new Cn(`Invalid padding when bitmap length is 0: ${e}`);this.ge=8*t.length-e,this.pe=se.fromNumber(this.ge)}ye(t,e,r){let s=t.add(e.multiply(se.fromNumber(r)));return s.compare(om)===1&&(s=new se([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.ge===0)return!1;const e=rc(t),[r,s]=sc(e);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);if(!this.we(a))return!1}return!0}static create(t,e,r){const s=t%8==0?0:8-t%8,o=new Uint8Array(Math.ceil(t/8)),a=new Gi(o,s,e);return r.forEach((l=>a.insert(l))),a}insert(t){if(this.ge===0)return;const e=rc(t),[r,s]=sc(e);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);this.Se(a)}}Se(t){const e=Math.floor(t/8),r=t%8;this.bitmap[e]|=1<<r}}class Cn extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class gs{constructor(t,e,r,s,o){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(t,e,r){const s=new Map;return s.set(t,er.createSynthesizedTargetChangeForCurrentChange(t,e,r)),new gs(F.min(),s,new et(q),Wt(),$())}}class er{constructor(t,e,r,s,o){this.resumeToken=t,this.current=e,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(t,e,r){return new er(r,e,$(),$(),$())}}class Or{constructor(t,e,r,s){this.be=t,this.removedTargetIds=e,this.key=r,this.De=s}}class Dl{constructor(t,e){this.targetId=t,this.Ce=e}}class kl{constructor(t,e,r=gt.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=r,this.cause=s}}class ic{constructor(){this.ve=0,this.Fe=oc(),this.Me=gt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=$(),e=$(),r=$();return this.Fe.forEach(((s,o)=>{switch(o){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:r=r.add(s);break;default:L(38017,{changeType:o})}})),new er(this.Me,this.xe,t,e,r)}qe(){this.Oe=!1,this.Fe=oc()}Qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,Q(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class am{constructor(t){this.Ge=t,this.ze=new Map,this.je=Wt(),this.Je=Sr(),this.He=Sr(),this.Ye=new et(q)}Ze(t){for(const e of t.be)t.De&&t.De.isFoundDocument()?this.Xe(e,t.De):this.et(e,t.key,t.De);for(const e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,(e=>{const r=this.nt(e);switch(t.state){case 0:this.rt(e)&&r.Le(t.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(t.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(r.We(),r.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),r.Le(t.resumeToken));break;default:L(56790,{state:t.state})}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach(((r,s)=>{this.rt(s)&&e(s)}))}st(t){const e=t.targetId,r=t.Ce.count,s=this.ot(e);if(s){const o=s.target;if(ui(o))if(r===0){const a=new M(o.path);this.et(e,a,Et.newNoDocument(a,F.min()))}else Q(r===1,20013,{expectedCount:r});else{const a=this._t(e);if(a!==r){const l=this.ut(t),h=l?this.ct(l,t,a):1;if(h!==0){this.it(e);const d=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(e,d)}}}}}ut(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=e;let a,l;try{a=le(r).toUint8Array()}catch(h){if(h instanceof sl)return Xe("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{l=new Gi(a,s,o)}catch(h){return Xe(h instanceof Cn?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return l.ge===0?null:l}ct(t,e,r){return e.Ce.count===r-this.Pt(t,e.targetId)?0:2}Pt(t,e){const r=this.Ge.getRemoteKeysForTarget(e);let s=0;return r.forEach((o=>{const a=this.Ge.ht(),l=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;t.mightContain(l)||(this.et(e,o,null),s++)})),s}Tt(t){const e=new Map;this.ze.forEach(((o,a)=>{const l=this.ot(a);if(l){if(o.current&&ui(l.target)){const h=new M(l.target.path);this.It(h).has(a)||this.Et(a,h)||this.et(a,h,Et.newNoDocument(h,t))}o.Be&&(e.set(a,o.ke()),o.qe())}}));let r=$();this.He.forEach(((o,a)=>{let l=!0;a.forEachWhile((h=>{const d=this.ot(h);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)})),l&&(r=r.add(o))})),this.je.forEach(((o,a)=>a.setReadTime(t)));const s=new gs(t,e,this.Ye,this.je,r);return this.je=Wt(),this.Je=Sr(),this.He=Sr(),this.Ye=new et(q),s}Xe(t,e){if(!this.rt(t))return;const r=this.Et(t,e.key)?2:0;this.nt(t).Qe(e.key,r),this.je=this.je.insert(e.key,e),this.Je=this.Je.insert(e.key,this.It(e.key).add(t)),this.He=this.He.insert(e.key,this.dt(e.key).add(t))}et(t,e,r){if(!this.rt(t))return;const s=this.nt(t);this.Et(t,e)?s.Qe(e,1):s.$e(e),this.He=this.He.insert(e,this.dt(e).delete(t)),this.He=this.He.insert(e,this.dt(e).add(t)),r&&(this.je=this.je.insert(e,r))}removeTarget(t){this.ze.delete(t)}_t(t){const e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let e=this.ze.get(t);return e||(e=new ic,this.ze.set(t,e)),e}dt(t){let e=this.He.get(t);return e||(e=new lt(q),this.He=this.He.insert(t,e)),e}It(t){let e=this.Je.get(t);return e||(e=new lt(q),this.Je=this.Je.insert(t,e)),e}rt(t){const e=this.ot(t)!==null;return e||k("WatchChangeAggregator","Detected inactive target",t),e}ot(t){const e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new ic),this.Ge.getRemoteKeysForTarget(t).forEach((e=>{this.et(t,e,null)}))}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}}function Sr(){return new et(M.comparator)}function oc(){return new et(M.comparator)}const cm={asc:"ASCENDING",desc:"DESCENDING"},lm={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},um={and:"AND",or:"OR"};class hm{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function di(n,t){return n.useProto3Json||cs(t)?t:{value:t}}function Xr(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Nl(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function dm(n,t){return Xr(n,t.toTimestamp())}function Ut(n){return Q(!!n,49232),F.fromTimestamp((function(e){const r=ce(e);return new Z(r.seconds,r.nanos)})(n))}function Ki(n,t){return fi(n,t).canonicalString()}function fi(n,t){const e=(function(s){return new Y(["projects",s.projectId,"databases",s.database])})(n).child("documents");return t===void 0?e:e.child(t)}function Ol(n){const t=Y.fromString(n);return Q(Bl(t),10190,{key:t.toString()}),t}function mi(n,t){return Ki(n.databaseId,t.path)}function Qs(n,t){const e=Ol(t);if(e.get(1)!==n.databaseId.projectId)throw new O(C.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new O(C.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new M(xl(e))}function Ml(n,t){return Ki(n.databaseId,t)}function fm(n){const t=Ol(n);return t.length===4?Y.emptyPath():xl(t)}function gi(n){return new Y(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function xl(n){return Q(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function ac(n,t,e){return{name:mi(n,t),fields:e.value.mapValue.fields}}function mm(n,t){let e;if("targetChange"in t){t.targetChange;const r=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:L(39313,{state:d})})(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],o=(function(d,p){return d.useProto3Json?(Q(p===void 0||typeof p=="string",58123),gt.fromBase64String(p||"")):(Q(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),gt.fromUint8Array(p||new Uint8Array))})(n,t.targetChange.resumeToken),a=t.targetChange.cause,l=a&&(function(d){const p=d.code===void 0?C.UNKNOWN:Vl(d.code);return new O(p,d.message||"")})(a);e=new kl(r,s,o,l||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const s=Qs(n,r.document.name),o=Ut(r.document.updateTime),a=r.document.createTime?Ut(r.document.createTime):F.min(),l=new Vt({mapValue:{fields:r.document.fields}}),h=Et.newFoundDocument(s,o,a,l),d=r.targetIds||[],p=r.removedTargetIds||[];e=new Or(d,p,h.key,h)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const s=Qs(n,r.document),o=r.readTime?Ut(r.readTime):F.min(),a=Et.newNoDocument(s,o),l=r.removedTargetIds||[];e=new Or([],l,a.key,a)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const s=Qs(n,r.document),o=r.removedTargetIds||[];e=new Or([],o,s,null)}else{if(!("filter"in t))return L(11601,{Rt:t});{t.filter;const r=t.filter;r.targetId;const{count:s=0,unchangedNames:o}=r,a=new rm(s,o),l=r.targetId;e=new Dl(l,a)}}return e}function gm(n,t){let e;if(t instanceof tr)e={update:ac(n,t.key,t.value)};else if(t instanceof zi)e={delete:mi(n,t.key)};else if(t instanceof Ve)e={update:ac(n,t.key,t.data),updateMask:Am(t.fieldMask)};else{if(!(t instanceof tm))return L(16599,{Vt:t.type});e={verify:mi(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map((r=>(function(o,a){const l=a.transform;if(l instanceof $n)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof zn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Hn)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof Qr)return{fieldPath:a.field.canonicalString(),increment:l.Ae};throw L(20930,{transform:a.transform})})(0,r)))),t.precondition.isNone||(e.currentDocument=(function(s,o){return o.updateTime!==void 0?{updateTime:dm(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:L(27497)})(n,t.precondition)),e}function pm(n,t){return n&&n.length>0?(Q(t!==void 0,14353),n.map((e=>(function(s,o){let a=s.updateTime?Ut(s.updateTime):Ut(o);return a.isEqual(F.min())&&(a=Ut(o)),new Jf(a,s.transformResults||[])})(e,t)))):[]}function _m(n,t){return{documents:[Ml(n,t.path)]}}function ym(n,t){const e={structuredQuery:{}},r=t.path;let s;t.collectionGroup!==null?(s=r,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=r.popLast(),e.structuredQuery.from=[{collectionId:r.lastSegment()}]),e.parent=Ml(n,s);const o=(function(d){if(d.length!==0)return Fl(zt.create(d,"and"))})(t.filters);o&&(e.structuredQuery.where=o);const a=(function(d){if(d.length!==0)return d.map((p=>(function(A){return{field:Le(A.field),direction:vm(A.dir)}})(p)))})(t.orderBy);a&&(e.structuredQuery.orderBy=a);const l=di(n,t.limit);return l!==null&&(e.structuredQuery.limit=l),t.startAt&&(e.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(t.startAt)),t.endAt&&(e.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(t.endAt)),{ft:e,parent:s}}function Em(n){let t=fm(n.parent);const e=n.structuredQuery,r=e.from?e.from.length:0;let s=null;if(r>0){Q(r===1,65062);const p=e.from[0];p.allDescendants?s=p.collectionId:t=t.child(p.collectionId)}let o=[];e.where&&(o=(function(E){const A=Ll(E);return A instanceof zt&&ml(A)?A.getFilters():[A]})(e.where));let a=[];e.orderBy&&(a=(function(E){return E.map((A=>(function(N){return new Wr(Fe(N.field),(function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(N.direction))})(A)))})(e.orderBy));let l=null;e.limit&&(l=(function(E){let A;return A=typeof E=="object"?E.value:E,cs(A)?null:A})(e.limit));let h=null;e.startAt&&(h=(function(E){const A=!!E.before,b=E.values||[];return new Kr(b,A)})(e.startAt));let d=null;return e.endAt&&(d=(function(E){const A=!E.before,b=E.values||[];return new Kr(b,A)})(e.endAt)),xf(t,s,a,o,l,"F",h,d)}function Tm(n,t){const e=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L(28987,{purpose:s})}})(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Ll(n){return n.unaryFilter!==void 0?(function(e){switch(e.unaryFilter.op){case"IS_NAN":const r=Fe(e.unaryFilter.field);return at.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Fe(e.unaryFilter.field);return at.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Fe(e.unaryFilter.field);return at.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Fe(e.unaryFilter.field);return at.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return L(61313);default:return L(60726)}})(n):n.fieldFilter!==void 0?(function(e){return at.create(Fe(e.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return L(58110);default:return L(50506)}})(e.fieldFilter.op),e.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(e){return zt.create(e.compositeFilter.filters.map((r=>Ll(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return L(1026)}})(e.compositeFilter.op))})(n):L(30097,{filter:n})}function vm(n){return cm[n]}function Im(n){return lm[n]}function wm(n){return um[n]}function Le(n){return{fieldPath:n.canonicalString()}}function Fe(n){return mt.fromServerFormat(n.fieldPath)}function Fl(n){return n instanceof at?(function(e){if(e.op==="=="){if(Wa(e.value))return{unaryFilter:{field:Le(e.field),op:"IS_NAN"}};if(Ka(e.value))return{unaryFilter:{field:Le(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(Wa(e.value))return{unaryFilter:{field:Le(e.field),op:"IS_NOT_NAN"}};if(Ka(e.value))return{unaryFilter:{field:Le(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Le(e.field),op:Im(e.op),value:e.value}}})(n):n instanceof zt?(function(e){const r=e.getFilters().map((s=>Fl(s)));return r.length===1?r[0]:{compositeFilter:{op:wm(e.op),filters:r}}})(n):L(54877,{filter:n})}function Am(n){const t=[];return n.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Bl(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class ee{constructor(t,e,r,s,o=F.min(),a=F.min(),l=gt.EMPTY_BYTE_STRING,h=null){this.target=t,this.targetId=e,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=h}withSequenceNumber(t){return new ee(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new ee(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new ee(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new ee(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Sm{constructor(t){this.yt=t}}function Rm(n){const t=Em({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?hi(t,t.limit,"L"):t}class Cm{constructor(){this.Cn=new bm}addToCollectionParentIndex(t,e){return this.Cn.add(e),R.resolve()}getCollectionParents(t,e){return R.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return R.resolve()}deleteFieldIndex(t,e){return R.resolve()}deleteAllFieldIndexes(t){return R.resolve()}createTargetIndexes(t,e){return R.resolve()}getDocumentsMatchingTarget(t,e){return R.resolve(null)}getIndexType(t,e){return R.resolve(0)}getFieldIndexes(t,e){return R.resolve([])}getNextCollectionGroupToUpdate(t){return R.resolve(null)}getMinOffset(t,e){return R.resolve(ae.min())}getMinOffsetFromCollectionGroup(t,e){return R.resolve(ae.min())}updateCollectionGroup(t,e,r){return R.resolve()}updateIndexEntries(t,e){return R.resolve()}}class bm{constructor(){this.index={}}add(t){const e=t.lastSegment(),r=t.popLast(),s=this.index[e]||new lt(Y.comparator),o=!s.has(r);return this.index[e]=s.add(r),o}has(t){const e=t.lastSegment(),r=t.popLast(),s=this.index[e];return s&&s.has(r)}getEntries(t){return(this.index[t]||new lt(Y.comparator)).toArray()}}const cc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ul=41943040;class Rt{static withCacheSize(t){return new Rt(t,Rt.DEFAULT_COLLECTION_PERCENTILE,Rt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=r}}Rt.DEFAULT_COLLECTION_PERCENTILE=10,Rt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Rt.DEFAULT=new Rt(Ul,Rt.DEFAULT_COLLECTION_PERCENTILE,Rt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Rt.DISABLED=new Rt(-1,0,0);class tn{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new tn(0)}static cr(){return new tn(-1)}}const lc="LruGarbageCollector",Pm=1048576;function uc([n,t],[e,r]){const s=q(n,e);return s===0?q(t,r):s}class Vm{constructor(t){this.Ir=t,this.buffer=new lt(uc),this.Er=0}dr(){return++this.Er}Ar(t){const e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{const r=this.buffer.last();uc(e,r)<0&&(this.buffer=this.buffer.delete(r).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Dm{constructor(t,e,r){this.garbageCollector=t,this.asyncQueue=e,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(t){k(lc,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){an(e)?k(lc,"Ignoring IndexedDB error during garbage collection: ",e):await on(e)}await this.Vr(3e5)}))}}class km{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next((r=>Math.floor(e/100*r)))}nthSequenceNumber(t,e){if(e===0)return R.resolve(as.ce);const r=new Vm(e);return this.mr.forEachTarget(t,(s=>r.Ar(s.sequenceNumber))).next((()=>this.mr.pr(t,(s=>r.Ar(s))))).next((()=>r.maxValue))}removeTargets(t,e,r){return this.mr.removeTargets(t,e,r)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(k("LruGarbageCollector","Garbage collection skipped; disabled"),R.resolve(cc)):this.getCacheSize(t).next((r=>r<this.params.cacheSizeCollectionThreshold?(k("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),cc):this.yr(t,e)))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let r,s,o,a,l,h,d;const p=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((E=>(E>this.params.maximumSequenceNumbersToCollect?(k("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${E}`),s=this.params.maximumSequenceNumbersToCollect):s=E,a=Date.now(),this.nthSequenceNumber(t,s)))).next((E=>(r=E,l=Date.now(),this.removeTargets(t,r,e)))).next((E=>(o=E,h=Date.now(),this.removeOrphanedDocuments(t,r)))).next((E=>(d=Date.now(),Me()<=H.DEBUG&&k("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-p}ms
	Determined least recently used ${s} in `+(l-a)+`ms
	Removed ${o} targets in `+(h-l)+`ms
	Removed ${E} documents in `+(d-h)+`ms
Total Duration: ${d-p}ms`),R.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:E}))))}}function Nm(n,t){return new km(n,t)}class Om{constructor(){this.changes=new Pe((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Et.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const r=this.changes.get(e);return r!==void 0?R.resolve(r):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Mm{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class xm{constructor(t,e,r,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=r,this.indexManager=s}getDocument(t,e){let r=null;return this.documentOverlayCache.getOverlay(t,e).next((s=>(r=s,this.remoteDocumentCache.getEntry(t,e)))).next((s=>(r!==null&&Nn(r.mutation,s,Nt.empty(),Z.now()),s)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((r=>this.getLocalViewOfDocuments(t,r,$()).next((()=>r))))}getLocalViewOfDocuments(t,e,r=$()){const s=Te();return this.populateOverlays(t,s,e).next((()=>this.computeViews(t,e,s,r).next((o=>{let a=Rn();return o.forEach(((l,h)=>{a=a.insert(l,h.overlayedDocument)})),a}))))}getOverlayedDocuments(t,e){const r=Te();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,$())))}populateOverlays(t,e,r){const s=[];return r.forEach((o=>{e.has(o)||s.push(o)})),this.documentOverlayCache.getOverlays(t,s).next((o=>{o.forEach(((a,l)=>{e.set(a,l)}))}))}computeViews(t,e,r,s){let o=Wt();const a=kn(),l=(function(){return kn()})();return e.forEach(((h,d)=>{const p=r.get(d.key);s.has(d.key)&&(p===void 0||p.mutation instanceof Ve)?o=o.insert(d.key,d):p!==void 0?(a.set(d.key,p.mutation.getFieldMask()),Nn(p.mutation,d,p.mutation.getFieldMask(),Z.now())):a.set(d.key,Nt.empty())})),this.recalculateAndSaveOverlays(t,o).next((h=>(h.forEach(((d,p)=>a.set(d,p))),e.forEach(((d,p)=>l.set(d,new Mm(p,a.get(d)??null)))),l)))}recalculateAndSaveOverlays(t,e){const r=kn();let s=new et(((a,l)=>a-l)),o=$();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((a=>{for(const l of a)l.keys().forEach((h=>{const d=e.get(h);if(d===null)return;let p=r.get(h)||Nt.empty();p=l.applyToLocalView(d,p),r.set(h,p);const E=(s.get(l.batchId)||$()).add(h);s=s.insert(l.batchId,E)}))})).next((()=>{const a=[],l=s.getReverseIterator();for(;l.hasNext();){const h=l.getNext(),d=h.key,p=h.value,E=Il();p.forEach((A=>{if(!o.has(A)){const b=bl(e.get(A),r.get(A));b!==null&&E.set(A,b),o=o.add(A)}})),a.push(this.documentOverlayCache.saveOverlays(t,d,E))}return R.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((r=>this.recalculateAndSaveOverlays(t,r)))}getDocumentsMatchingQuery(t,e,r,s){return(function(a){return M.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Lf(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,s):this.getDocumentsMatchingCollectionQuery(t,e,r,s)}getNextDocuments(t,e,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,s).next((o=>{const a=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,s-o.size):R.resolve(Te());let l=Bn,h=o;return a.next((d=>R.forEach(d,((p,E)=>(l<E.largestBatchId&&(l=E.largestBatchId),o.get(p)?R.resolve():this.remoteDocumentCache.getEntry(t,p).next((A=>{h=h.insert(p,A)}))))).next((()=>this.populateOverlays(t,d,o))).next((()=>this.computeViews(t,h,d,$()))).next((p=>({batchId:l,changes:vl(p)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new M(e)).next((r=>{let s=Rn();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(t,e,r,s){const o=e.collectionGroup;let a=Rn();return this.indexManager.getCollectionParents(t,o).next((l=>R.forEach(l,(h=>{const d=(function(E,A){return new us(A,null,E.explicitOrderBy.slice(),E.filters.slice(),E.limit,E.limitType,E.startAt,E.endAt)})(e,h.child(o));return this.getDocumentsMatchingCollectionQuery(t,d,r,s).next((p=>{p.forEach(((E,A)=>{a=a.insert(E,A)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(t,e,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next((a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,o,s)))).next((a=>{o.forEach(((h,d)=>{const p=d.getKey();a.get(p)===null&&(a=a.insert(p,Et.newInvalidDocument(p)))}));let l=Rn();return a.forEach(((h,d)=>{const p=o.get(h);p!==void 0&&Nn(p.mutation,d,Nt.empty(),Z.now()),ds(e,d)&&(l=l.insert(h,d))})),l}))}}class Lm{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return R.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,(function(s){return{id:s.id,version:s.version,createTime:Ut(s.createTime)}})(e)),R.resolve()}getNamedQuery(t,e){return R.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,(function(s){return{name:s.name,query:Rm(s.bundledQuery),readTime:Ut(s.readTime)}})(e)),R.resolve()}}class Fm{constructor(){this.overlays=new et(M.comparator),this.qr=new Map}getOverlay(t,e){return R.resolve(this.overlays.get(e))}getOverlays(t,e){const r=Te();return R.forEach(e,(s=>this.getOverlay(t,s).next((o=>{o!==null&&r.set(s,o)})))).next((()=>r))}saveOverlays(t,e,r){return r.forEach(((s,o)=>{this.St(t,e,o)})),R.resolve()}removeOverlaysForBatchId(t,e,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),R.resolve()}getOverlaysForCollection(t,e,r){const s=Te(),o=e.length+1,a=new M(e.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const h=l.getNext().value,d=h.getKey();if(!e.isPrefixOf(d.path))break;d.path.length===o&&h.largestBatchId>r&&s.set(h.getKey(),h)}return R.resolve(s)}getOverlaysForCollectionGroup(t,e,r,s){let o=new et(((d,p)=>d-p));const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===e&&d.largestBatchId>r){let p=o.get(d.largestBatchId);p===null&&(p=Te(),o=o.insert(d.largestBatchId,p)),p.set(d.getKey(),d)}}const l=Te(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((d,p)=>l.set(d,p))),!(l.size()>=s)););return R.resolve(l)}St(t,e,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new nm(e,r));let o=this.qr.get(e);o===void 0&&(o=$(),this.qr.set(e,o)),this.qr.set(e,o.add(r.key))}}class Bm{constructor(){this.sessionToken=gt.EMPTY_BYTE_STRING}getSessionToken(t){return R.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,R.resolve()}}class Wi{constructor(){this.Qr=new lt(dt.$r),this.Ur=new lt(dt.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){const r=new dt(t,e);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(t,e){t.forEach((r=>this.addReference(r,e)))}removeReference(t,e){this.Gr(new dt(t,e))}zr(t,e){t.forEach((r=>this.removeReference(r,e)))}jr(t){const e=new M(new Y([])),r=new dt(e,t),s=new dt(e,t+1),o=[];return this.Ur.forEachInRange([r,s],(a=>{this.Gr(a),o.push(a.key)})),o}Jr(){this.Qr.forEach((t=>this.Gr(t)))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){const e=new M(new Y([])),r=new dt(e,t),s=new dt(e,t+1);let o=$();return this.Ur.forEachInRange([r,s],(a=>{o=o.add(a.key)})),o}containsKey(t){const e=new dt(t,0),r=this.Qr.firstAfterOrEqual(e);return r!==null&&t.isEqual(r.key)}}class dt{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return M.comparator(t.key,e.key)||q(t.Yr,e.Yr)}static Kr(t,e){return q(t.Yr,e.Yr)||M.comparator(t.key,e.key)}}class Um{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new lt(dt.$r)}checkEmpty(t){return R.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,r,s){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new em(o,e,r,s);this.mutationQueue.push(a);for(const l of s)this.Zr=this.Zr.add(new dt(l.key,o)),this.indexManager.addToCollectionParentIndex(t,l.key.path.popLast());return R.resolve(a)}lookupMutationBatch(t,e){return R.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){const r=e+1,s=this.ei(r),o=s<0?0:s;return R.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return R.resolve(this.mutationQueue.length===0?Li:this.tr-1)}getAllMutationBatches(t){return R.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const r=new dt(e,0),s=new dt(e,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,s],(a=>{const l=this.Xr(a.Yr);o.push(l)})),R.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new lt(q);return e.forEach((s=>{const o=new dt(s,0),a=new dt(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,a],(l=>{r=r.add(l.Yr)}))})),R.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(t,e){const r=e.path,s=r.length+1;let o=r;M.isDocumentKey(o)||(o=o.child(""));const a=new dt(new M(o),0);let l=new lt(q);return this.Zr.forEachWhile((h=>{const d=h.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(l=l.add(h.Yr)),!0)}),a),R.resolve(this.ti(l))}ti(t){const e=[];return t.forEach((r=>{const s=this.Xr(r);s!==null&&e.push(s)})),e}removeMutationBatch(t,e){Q(this.ni(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return R.forEach(e.mutations,(s=>{const o=new dt(s.key,e.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.Zr=r}))}ir(t){}containsKey(t,e){const r=new dt(e,0),s=this.Zr.firstAfterOrEqual(r);return R.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,R.resolve()}ni(t,e){return this.ei(t)}ei(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Xr(t){const e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class jm{constructor(t){this.ri=t,this.docs=(function(){return new et(M.comparator)})(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const r=e.key,s=this.docs.get(r),o=s?s.size:0,a=this.ri(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const r=this.docs.get(e);return R.resolve(r?r.document.mutableCopy():Et.newInvalidDocument(e))}getEntries(t,e){let r=Wt();return e.forEach((s=>{const o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():Et.newInvalidDocument(s))})),R.resolve(r)}getDocumentsMatchingQuery(t,e,r,s){let o=Wt();const a=e.path,l=new M(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(l);for(;h.hasNext();){const{key:d,value:{document:p}}=h.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||mf(ff(p),r)<=0||(s.has(p.key)||ds(e,p))&&(o=o.insert(p.key,p.mutableCopy()))}return R.resolve(o)}getAllFromCollectionGroup(t,e,r,s){L(9500)}ii(t,e){return R.forEach(this.docs,(r=>e(r)))}newChangeBuffer(t){return new qm(this)}getSize(t){return R.resolve(this.size)}}class qm extends Om{constructor(t){super(),this.Nr=t}applyChanges(t){const e=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?e.push(this.Nr.addEntry(t,s)):this.Nr.removeEntry(r)})),R.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}}class $m{constructor(t){this.persistence=t,this.si=new Pe((e=>Ui(e)),ji),this.lastRemoteSnapshotVersion=F.min(),this.highestTargetId=0,this.oi=0,this._i=new Wi,this.targetCount=0,this.ai=tn.ur()}forEachTarget(t,e){return this.si.forEach(((r,s)=>e(s))),R.resolve()}getLastRemoteSnapshotVersion(t){return R.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return R.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),R.resolve(this.highestTargetId)}setTargetsMetadata(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this.oi&&(this.oi=e),R.resolve()}Pr(t){this.si.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.ai=new tn(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,R.resolve()}updateTargetData(t,e){return this.Pr(e),R.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,R.resolve()}removeTargets(t,e,r){let s=0;const o=[];return this.si.forEach(((a,l)=>{l.sequenceNumber<=e&&r.get(l.targetId)===null&&(this.si.delete(a),o.push(this.removeMatchingKeysForTargetId(t,l.targetId)),s++)})),R.waitFor(o).next((()=>s))}getTargetCount(t){return R.resolve(this.targetCount)}getTargetData(t,e){const r=this.si.get(e)||null;return R.resolve(r)}addMatchingKeys(t,e,r){return this._i.Wr(e,r),R.resolve()}removeMatchingKeys(t,e,r){this._i.zr(e,r);const s=this.persistence.referenceDelegate,o=[];return s&&e.forEach((a=>{o.push(s.markPotentiallyOrphaned(t,a))})),R.waitFor(o)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),R.resolve()}getMatchingKeysForTargetId(t,e){const r=this._i.Hr(e);return R.resolve(r)}containsKey(t,e){return R.resolve(this._i.containsKey(e))}}class jl{constructor(t,e){this.ui={},this.overlays={},this.ci=new as(0),this.li=!1,this.li=!0,this.hi=new Bm,this.referenceDelegate=t(this),this.Pi=new $m(this),this.indexManager=new Cm,this.remoteDocumentCache=(function(s){return new jm(s)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new Sm(e),this.Ii=new Lm(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Fm,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let r=this.ui[t.toKey()];return r||(r=new Um(e,this.referenceDelegate),this.ui[t.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,r){k("MemoryPersistence","Starting transaction:",t);const s=new zm(this.ci.next());return this.referenceDelegate.Ei(),r(s).next((o=>this.referenceDelegate.di(s).next((()=>o)))).toPromise().then((o=>(s.raiseOnCommittedEvent(),o)))}Ai(t,e){return R.or(Object.values(this.ui).map((r=>()=>r.containsKey(t,e))))}}class zm extends pf{constructor(t){super(),this.currentSequenceNumber=t}}class Qi{constructor(t){this.persistence=t,this.Ri=new Wi,this.Vi=null}static mi(t){return new Qi(t)}get fi(){if(this.Vi)return this.Vi;throw L(60996)}addReference(t,e,r){return this.Ri.addReference(r,e),this.fi.delete(r.toString()),R.resolve()}removeReference(t,e,r){return this.Ri.removeReference(r,e),this.fi.add(r.toString()),R.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),R.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach((s=>this.fi.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((s=>{s.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(t,e)))}Ei(){this.Vi=new Set}di(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return R.forEach(this.fi,(r=>{const s=M.fromPath(r);return this.gi(t,s).next((o=>{o||e.removeEntry(s,F.min())}))})).next((()=>(this.Vi=null,e.apply(t))))}updateLimboDocument(t,e){return this.gi(t,e).next((r=>{r?this.fi.delete(e.toString()):this.fi.add(e.toString())}))}Ti(t){return 0}gi(t,e){return R.or([()=>R.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}}class Jr{constructor(t,e){this.persistence=t,this.pi=new Pe((r=>Ef(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=Nm(this,e)}static mi(t,e){return new Jr(t,e)}Ei(){}di(t){return R.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){const e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next((r=>e.next((s=>r+s))))}wr(t){let e=0;return this.pr(t,(r=>{e++})).next((()=>e))}pr(t,e){return R.forEach(this.pi,((r,s)=>this.br(t,r,s).next((o=>o?R.resolve():e(s)))))}removeTargets(t,e,r){return this.persistence.getTargetCache().removeTargets(t,e,r)}removeOrphanedDocuments(t,e){let r=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ii(t,(a=>this.br(t,a,e).next((l=>{l||(r++,o.removeEntry(a,F.min()))})))).next((()=>o.apply(t))).next((()=>r))}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),R.resolve()}removeTarget(t,e){const r=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,r)}addReference(t,e,r){return this.pi.set(r,t.currentSequenceNumber),R.resolve()}removeReference(t,e,r){return this.pi.set(r,t.currentSequenceNumber),R.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),R.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Dr(t.data.value)),e}br(t,e,r){return R.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const s=this.pi.get(e);return R.resolve(s!==void 0&&s>r)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class Xi{constructor(t,e,r,s){this.targetId=t,this.fromCache=e,this.Es=r,this.ds=s}static As(t,e){let r=$(),s=$();for(const o of e.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new Xi(t,e.fromCache,r,s)}}class Hm{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class Gm{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return Oh()?8:_f(kh())>0?6:4})()}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,r,s){const o={result:null};return this.ys(t,e).next((a=>{o.result=a})).next((()=>{if(!o.result)return this.ws(t,e,s,r).next((a=>{o.result=a}))})).next((()=>{if(o.result)return;const a=new Hm;return this.Ss(t,e,a).next((l=>{if(o.result=l,this.Vs)return this.bs(t,e,a,l.size)}))})).next((()=>o.result))}bs(t,e,r,s){return r.documentReadCount<this.fs?(Me()<=H.DEBUG&&k("QueryEngine","SDK will not create cache indexes for query:",xe(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),R.resolve()):(Me()<=H.DEBUG&&k("QueryEngine","Query:",xe(e),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(Me()<=H.DEBUG&&k("QueryEngine","The SDK decides to create cache indexes for query:",xe(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Bt(e))):R.resolve())}ys(t,e){if(Ya(e))return R.resolve(null);let r=Bt(e);return this.indexManager.getIndexType(t,r).next((s=>s===0?null:(e.limit!==null&&s===1&&(e=hi(e,null,"F"),r=Bt(e)),this.indexManager.getDocumentsMatchingTarget(t,r).next((o=>{const a=$(...o);return this.ps.getDocuments(t,a).next((l=>this.indexManager.getMinOffset(t,r).next((h=>{const d=this.Ds(e,l);return this.Cs(e,d,a,h.readTime)?this.ys(t,hi(e,null,"F")):this.vs(t,d,e,h)}))))})))))}ws(t,e,r,s){return Ya(e)||s.isEqual(F.min())?R.resolve(null):this.ps.getDocuments(t,r).next((o=>{const a=this.Ds(e,o);return this.Cs(e,a,r,s)?R.resolve(null):(Me()<=H.DEBUG&&k("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),xe(e)),this.vs(t,a,e,df(s,Bn)).next((l=>l)))}))}Ds(t,e){let r=new lt(El(t));return e.forEach(((s,o)=>{ds(t,o)&&(r=r.add(o))})),r}Cs(t,e,r,s){if(t.limit===null)return!1;if(r.size!==e.size)return!0;const o=t.limitType==="F"?e.last():e.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}Ss(t,e,r){return Me()<=H.DEBUG&&k("QueryEngine","Using full collection scan to execute query:",xe(e)),this.ps.getDocumentsMatchingQuery(t,e,ae.min(),r)}vs(t,e,r,s){return this.ps.getDocumentsMatchingQuery(t,r,s).next((o=>(e.forEach((a=>{o=o.insert(a.key,a)})),o)))}}const Ji="LocalStore",Km=3e8;class Wm{constructor(t,e,r,s){this.persistence=t,this.Fs=e,this.serializer=s,this.Ms=new et(q),this.xs=new Pe((o=>Ui(o)),ji),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(r)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new xm(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ms)))}}function Qm(n,t,e,r){return new Wm(n,t,e,r)}async function ql(n,t){const e=B(n);return await e.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return e.mutationQueue.getAllMutationBatches(r).next((o=>(s=o,e.Bs(t),e.mutationQueue.getAllMutationBatches(r)))).next((o=>{const a=[],l=[];let h=$();for(const d of s){a.push(d.batchId);for(const p of d.mutations)h=h.add(p.key)}for(const d of o){l.push(d.batchId);for(const p of d.mutations)h=h.add(p.key)}return e.localDocuments.getDocuments(r,h).next((d=>({Ls:d,removedBatchIds:a,addedBatchIds:l})))}))}))}function Xm(n,t){const e=B(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=t.batch.keys(),o=e.Ns.newChangeBuffer({trackRemovals:!0});return(function(l,h,d,p){const E=d.batch,A=E.keys();let b=R.resolve();return A.forEach((N=>{b=b.next((()=>p.getEntry(h,N))).next((x=>{const D=d.docVersions.get(N);Q(D!==null,48541),x.version.compareTo(D)<0&&(E.applyToRemoteDocument(x,d),x.isValidDocument()&&(x.setReadTime(d.commitVersion),p.addEntry(x)))}))})),b.next((()=>l.mutationQueue.removeMutationBatch(h,E)))})(e,r,t,o).next((()=>o.apply(r))).next((()=>e.mutationQueue.performConsistencyCheck(r))).next((()=>e.documentOverlayCache.removeOverlaysForBatchId(r,s,t.batch.batchId))).next((()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(l){let h=$();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(h=h.add(l.batch.mutations[d].key));return h})(t)))).next((()=>e.localDocuments.getDocuments(r,s)))}))}function $l(n){const t=B(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Pi.getLastRemoteSnapshotVersion(e)))}function Jm(n,t){const e=B(n),r=t.snapshotVersion;let s=e.Ms;return e.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const a=e.Ns.newChangeBuffer({trackRemovals:!0});s=e.Ms;const l=[];t.targetChanges.forEach(((p,E)=>{const A=s.get(E);if(!A)return;l.push(e.Pi.removeMatchingKeys(o,p.removedDocuments,E).next((()=>e.Pi.addMatchingKeys(o,p.addedDocuments,E))));let b=A.withSequenceNumber(o.currentSequenceNumber);t.targetMismatches.get(E)!==null?b=b.withResumeToken(gt.EMPTY_BYTE_STRING,F.min()).withLastLimboFreeSnapshotVersion(F.min()):p.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(p.resumeToken,r)),s=s.insert(E,b),(function(x,D,G){return x.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=Km?!0:G.addedDocuments.size+G.modifiedDocuments.size+G.removedDocuments.size>0})(A,b,p)&&l.push(e.Pi.updateTargetData(o,b))}));let h=Wt(),d=$();if(t.documentUpdates.forEach((p=>{t.resolvedLimboDocuments.has(p)&&l.push(e.persistence.referenceDelegate.updateLimboDocument(o,p))})),l.push(Ym(o,a,t.documentUpdates).next((p=>{h=p.ks,d=p.qs}))),!r.isEqual(F.min())){const p=e.Pi.getLastRemoteSnapshotVersion(o).next((E=>e.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));l.push(p)}return R.waitFor(l).next((()=>a.apply(o))).next((()=>e.localDocuments.getLocalViewOfDocuments(o,h,d))).next((()=>h))})).then((o=>(e.Ms=s,o)))}function Ym(n,t,e){let r=$(),s=$();return e.forEach((o=>r=r.add(o))),t.getEntries(n,r).next((o=>{let a=Wt();return e.forEach(((l,h)=>{const d=o.get(l);h.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(l)),h.isNoDocument()&&h.version.isEqual(F.min())?(t.removeEntry(l,h.readTime),a=a.insert(l,h)):!d.isValidDocument()||h.version.compareTo(d.version)>0||h.version.compareTo(d.version)===0&&d.hasPendingWrites?(t.addEntry(h),a=a.insert(l,h)):k(Ji,"Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",h.version)})),{ks:a,qs:s}}))}function Zm(n,t){const e=B(n);return e.persistence.runTransaction("Get next mutation batch","readonly",(r=>(t===void 0&&(t=Li),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t))))}function tg(n,t){const e=B(n);return e.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return e.Pi.getTargetData(r,t).next((o=>o?(s=o,R.resolve(s)):e.Pi.allocateTargetId(r).next((a=>(s=new ee(t,a,"TargetPurposeListen",r.currentSequenceNumber),e.Pi.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=e.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.Ms=e.Ms.insert(r.targetId,r),e.xs.set(t,r.targetId)),r}))}async function pi(n,t,e){const r=B(n),s=r.Ms.get(t),o=e?"readwrite":"readwrite-primary";try{e||await r.persistence.runTransaction("Release target",o,(a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!an(a))throw a;k(Ji,`Failed to update sequence numbers for target ${t}: ${a}`)}r.Ms=r.Ms.remove(t),r.xs.delete(s.target)}function hc(n,t,e){const r=B(n);let s=F.min(),o=$();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(h,d,p){const E=B(h),A=E.xs.get(p);return A!==void 0?R.resolve(E.Ms.get(A)):E.Pi.getTargetData(d,p)})(r,a,Bt(t)).next((l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,l.targetId).next((h=>{o=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(a,t,e?s:F.min(),e?o:$()))).next((l=>(eg(r,Bf(t),l),{documents:l,Qs:o})))))}function eg(n,t,e){let r=n.Os.get(t)||F.min();e.forEach(((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),n.Os.set(t,r)}class dc{constructor(){this.activeTargetIds=Hf()}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class ng{constructor(){this.Mo=new dc,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,r){}addLocalQueryTarget(t,e=!0){return e&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,r){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new dc,Promise.resolve()}handleUserChange(t,e,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class rg{Oo(t){}shutdown(){}}const fc="ConnectivityMonitor";class mc{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){k(fc,"Network connectivity changed: AVAILABLE");for(const t of this.qo)t(0)}ko(){k(fc,"Network connectivity changed: UNAVAILABLE");for(const t of this.qo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Rr=null;function _i(){return Rr===null?Rr=(function(){return 268435456+Math.round(2147483648*Math.random())})():Rr++,"0x"+Rr.toString(16)}const Xs="RestConnection",sg={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class ig{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===Hr?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(t,e,r,s,o){const a=_i(),l=this.zo(t,e.toUriEncodedString());k(Xs,`Sending RPC '${t}' ${a}:`,l,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,s,o);const{host:d}=new URL(l),p=ki(d);return this.Jo(t,l,h,r,p).then((E=>(k(Xs,`Received RPC '${t}' ${a}: `,E),E)),(E=>{throw Xe(Xs,`RPC '${t}' ${a} failed with error: `,E,"url: ",l,"request:",r),E}))}Ho(t,e,r,s,o,a){return this.Go(t,e,r,s,o)}jo(t,e,r){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+sn})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((s,o)=>t[o]=s)),r&&r.headers.forEach(((s,o)=>t[o]=s))}zo(t,e){const r=sg[t];return`${this.Uo}/v1/${e}:${r}`}terminate(){}}class og{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}}const _t="WebChannelConnection";class ag extends ig{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,r,s,o){const a=_i();return new Promise(((l,h)=>{const d=new Kc;d.setWithCredentials(!0),d.listenOnce(Wc.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case Vr.NO_ERROR:const E=d.getResponseJson();k(_t,`XHR for RPC '${t}' ${a} received:`,JSON.stringify(E)),l(E);break;case Vr.TIMEOUT:k(_t,`RPC '${t}' ${a} timed out`),h(new O(C.DEADLINE_EXCEEDED,"Request time out"));break;case Vr.HTTP_ERROR:const A=d.getStatus();if(k(_t,`RPC '${t}' ${a} failed with status:`,A,"response text:",d.getResponseText()),A>0){let b=d.getResponseJson();Array.isArray(b)&&(b=b[0]);const N=b?.error;if(N&&N.status&&N.message){const x=(function(G){const K=G.toLowerCase().replace(/_/g,"-");return Object.values(C).indexOf(K)>=0?K:C.UNKNOWN})(N.status);h(new O(x,N.message))}else h(new O(C.UNKNOWN,"Server responded with status "+d.getStatus()))}else h(new O(C.UNAVAILABLE,"Connection failed."));break;default:L(9055,{l_:t,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{k(_t,`RPC '${t}' ${a} completed.`)}}));const p=JSON.stringify(s);k(_t,`RPC '${t}' ${a} sending request:`,s),d.send(e,"POST",p,r,15)}))}T_(t,e,r){const s=_i(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=Jc(),l=Xc(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(h.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,e,r),h.encodeInitMessageHeaders=!0;const p=o.join("");k(_t,`Creating RPC '${t}' stream ${s}: ${p}`,h);const E=a.createWebChannel(p,h);this.I_(E);let A=!1,b=!1;const N=new og({Yo:D=>{b?k(_t,`Not sending because RPC '${t}' stream ${s} is closed:`,D):(A||(k(_t,`Opening RPC '${t}' stream ${s} transport.`),E.open(),A=!0),k(_t,`RPC '${t}' stream ${s} sending:`,D),E.send(D))},Zo:()=>E.close()}),x=(D,G,K)=>{D.listen(G,(W=>{try{K(W)}catch(Tt){setTimeout((()=>{throw Tt}),0)}}))};return x(E,Sn.EventType.OPEN,(()=>{b||(k(_t,`RPC '${t}' stream ${s} transport opened.`),N.o_())})),x(E,Sn.EventType.CLOSE,(()=>{b||(b=!0,k(_t,`RPC '${t}' stream ${s} transport closed`),N.a_(),this.E_(E))})),x(E,Sn.EventType.ERROR,(D=>{b||(b=!0,Xe(_t,`RPC '${t}' stream ${s} transport errored. Name:`,D.name,"Message:",D.message),N.a_(new O(C.UNAVAILABLE,"The operation could not be completed")))})),x(E,Sn.EventType.MESSAGE,(D=>{if(!b){const G=D.data[0];Q(!!G,16349);const K=G,W=K?.error||K[0]?.error;if(W){k(_t,`RPC '${t}' stream ${s} received error:`,W);const Tt=W.status;let At=(function(m){const _=st[m];if(_!==void 0)return Vl(_)})(Tt),ut=W.message;At===void 0&&(At=C.INTERNAL,ut="Unknown error status: "+Tt+" with message "+W.message),b=!0,N.a_(new O(At,ut)),E.close()}else k(_t,`RPC '${t}' stream ${s} received:`,G),N.u_(G)}})),x(l,Qc.STAT_EVENT,(D=>{D.stat===ii.PROXY?k(_t,`RPC '${t}' stream ${s} detected buffering proxy`):D.stat===ii.NOPROXY&&k(_t,`RPC '${t}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{N.__()}),0),N}terminate(){this.c_.forEach((t=>t.close())),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter((e=>e===t))}}function Js(){return typeof document<"u"?document:null}function ps(n){return new hm(n,!0)}class zl{constructor(t,e,r=1e3,s=1.5,o=6e4){this.Mi=t,this.timerId=e,this.d_=r,this.A_=s,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();const e=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,e-r);s>0&&k("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${e} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),t()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const gc="PersistentStream";class Hl{constructor(t,e,r,s,o,a,l,h){this.Mi=t,this.S_=r,this.b_=s,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new zl(t,e)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(t){this.Q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():e&&e.code===C.RESOURCE_EXHAUSTED?(Kt(e.toString()),Kt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===C.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.r_(e)}K_(){}auth(){this.state=1;const t=this.W_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===e&&this.G_(r,s)}),(r=>{t((()=>{const s=new O(C.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(t,e){const r=this.W_(this.D_);this.stream=this.j_(t,e),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(t){return k(gc,`close with error: ${t}`),this.stream=null,this.close(4,t)}W_(t){return e=>{this.Mi.enqueueAndForget((()=>this.D_===t?e():(k(gc,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class cg extends Hl{constructor(t,e,r,s,o,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,r,s,a),this.serializer=o}j_(t,e){return this.connection.T_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();const e=mm(this.serializer,t),r=(function(o){if(!("targetChange"in o))return F.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?F.min():a.readTime?Ut(a.readTime):F.min()})(t);return this.listener.H_(e,r)}Y_(t){const e={};e.database=gi(this.serializer),e.addTarget=(function(o,a){let l;const h=a.target;if(l=ui(h)?{documents:_m(o,h)}:{query:ym(o,h).ft},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=Nl(o,a.resumeToken);const d=di(o,a.expectedCount);d!==null&&(l.expectedCount=d)}else if(a.snapshotVersion.compareTo(F.min())>0){l.readTime=Xr(o,a.snapshotVersion.toTimestamp());const d=di(o,a.expectedCount);d!==null&&(l.expectedCount=d)}return l})(this.serializer,t);const r=Tm(this.serializer,t);r&&(e.labels=r),this.q_(e)}Z_(t){const e={};e.database=gi(this.serializer),e.removeTarget=t,this.q_(e)}}class lg extends Hl{constructor(t,e,r,s,o,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,r,s,a),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}J_(t){return Q(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,Q(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){Q(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const e=pm(t.writeResults,t.commitTime),r=Ut(t.commitTime);return this.listener.na(r,e)}ra(){const t={};t.database=gi(this.serializer),this.q_(t)}ea(t){const e={streamToken:this.lastStreamToken,writes:t.map((r=>gm(this.serializer,r)))};this.q_(e)}}class ug{}class hg extends ug{constructor(t,e,r,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new O(C.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Go(t,fi(e,r),s,o,a))).catch((o=>{throw o.name==="FirebaseError"?(o.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new O(C.UNKNOWN,o.toString())}))}Ho(t,e,r,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,l])=>this.connection.Ho(t,fi(e,r),s,a,l,o))).catch((a=>{throw a.name==="FirebaseError"?(a.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new O(C.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class dg{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Kt(e),this.aa=!1):k("OnlineStateTracker",e)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Re="RemoteStore";class fg{constructor(t,e,r,s,o){this.localStore=t,this.datastore=e,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((a=>{r.enqueueAndForget((async()=>{De(this)&&(k(Re,"Restarting streams for network reachability change."),await(async function(h){const d=B(h);d.Ea.add(4),await nr(d),d.Ra.set("Unknown"),d.Ea.delete(4),await _s(d)})(this))}))})),this.Ra=new dg(r,s)}}async function _s(n){if(De(n))for(const t of n.da)await t(!0)}async function nr(n){for(const t of n.da)await t(!1)}function Gl(n,t){const e=B(n);e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),eo(e)?to(e):cn(e).O_()&&Zi(e,t))}function Yi(n,t){const e=B(n),r=cn(e);e.Ia.delete(t),r.O_()&&Kl(e,t),e.Ia.size===0&&(r.O_()?r.L_():De(e)&&e.Ra.set("Unknown"))}function Zi(n,t){if(n.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(F.min())>0){const e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}cn(n).Y_(t)}function Kl(n,t){n.Va.Ue(t),cn(n).Z_(t)}function to(n){n.Va=new am({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),At:t=>n.Ia.get(t)||null,ht:()=>n.datastore.serializer.databaseId}),cn(n).start(),n.Ra.ua()}function eo(n){return De(n)&&!cn(n).x_()&&n.Ia.size>0}function De(n){return B(n).Ea.size===0}function Wl(n){n.Va=void 0}async function mg(n){n.Ra.set("Online")}async function gg(n){n.Ia.forEach(((t,e)=>{Zi(n,t)}))}async function pg(n,t){Wl(n),eo(n)?(n.Ra.ha(t),to(n)):n.Ra.set("Unknown")}async function _g(n,t,e){if(n.Ra.set("Online"),t instanceof kl&&t.state===2&&t.cause)try{await(async function(s,o){const a=o.cause;for(const l of o.targetIds)s.Ia.has(l)&&(await s.remoteSyncer.rejectListen(l,a),s.Ia.delete(l),s.Va.removeTarget(l))})(n,t)}catch(r){k(Re,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await Yr(n,r)}else if(t instanceof Or?n.Va.Ze(t):t instanceof Dl?n.Va.st(t):n.Va.tt(t),!e.isEqual(F.min()))try{const r=await $l(n.localStore);e.compareTo(r)>=0&&await(function(o,a){const l=o.Va.Tt(a);return l.targetChanges.forEach(((h,d)=>{if(h.resumeToken.approximateByteSize()>0){const p=o.Ia.get(d);p&&o.Ia.set(d,p.withResumeToken(h.resumeToken,a))}})),l.targetMismatches.forEach(((h,d)=>{const p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken(gt.EMPTY_BYTE_STRING,p.snapshotVersion)),Kl(o,h);const E=new ee(p.target,h,d,p.sequenceNumber);Zi(o,E)})),o.remoteSyncer.applyRemoteEvent(l)})(n,e)}catch(r){k(Re,"Failed to raise snapshot:",r),await Yr(n,r)}}async function Yr(n,t,e){if(!an(t))throw t;n.Ea.add(1),await nr(n),n.Ra.set("Offline"),e||(e=()=>$l(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{k(Re,"Retrying IndexedDB access"),await e(),n.Ea.delete(1),await _s(n)}))}function Ql(n,t){return t().catch((e=>Yr(n,e,t)))}async function ys(n){const t=B(n),e=he(t);let r=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:Li;for(;yg(t);)try{const s=await Zm(t.localStore,r);if(s===null){t.Ta.length===0&&e.L_();break}r=s.batchId,Eg(t,s)}catch(s){await Yr(t,s)}Xl(t)&&Jl(t)}function yg(n){return De(n)&&n.Ta.length<10}function Eg(n,t){n.Ta.push(t);const e=he(n);e.O_()&&e.X_&&e.ea(t.mutations)}function Xl(n){return De(n)&&!he(n).x_()&&n.Ta.length>0}function Jl(n){he(n).start()}async function Tg(n){he(n).ra()}async function vg(n){const t=he(n);for(const e of n.Ta)t.ea(e.mutations)}async function Ig(n,t,e){const r=n.Ta.shift(),s=Hi.from(r,t,e);await Ql(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await ys(n)}async function wg(n,t){t&&he(n).X_&&await(async function(r,s){if((function(a){return sm(a)&&a!==C.ABORTED})(s.code)){const o=r.Ta.shift();he(r).B_(),await Ql(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s))),await ys(r)}})(n,t),Xl(n)&&Jl(n)}async function pc(n,t){const e=B(n);e.asyncQueue.verifyOperationInProgress(),k(Re,"RemoteStore received new credentials");const r=De(e);e.Ea.add(3),await nr(e),r&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await _s(e)}async function Ag(n,t){const e=B(n);t?(e.Ea.delete(2),await _s(e)):t||(e.Ea.add(2),await nr(e),e.Ra.set("Unknown"))}function cn(n){return n.ma||(n.ma=(function(e,r,s){const o=B(e);return o.sa(),new cg(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:mg.bind(null,n),t_:gg.bind(null,n),r_:pg.bind(null,n),H_:_g.bind(null,n)}),n.da.push((async t=>{t?(n.ma.B_(),eo(n)?to(n):n.Ra.set("Unknown")):(await n.ma.stop(),Wl(n))}))),n.ma}function he(n){return n.fa||(n.fa=(function(e,r,s){const o=B(e);return o.sa(),new lg(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:Tg.bind(null,n),r_:wg.bind(null,n),ta:vg.bind(null,n),na:Ig.bind(null,n)}),n.da.push((async t=>{t?(n.fa.B_(),await ys(n)):(await n.fa.stop(),n.Ta.length>0&&(k(Re,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class no{constructor(t,e,r,s,o){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new ie,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,r,s,o){const a=Date.now()+r,l=new no(t,e,a,s,o);return l.start(r),l}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new O(C.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ro(n,t){if(Kt("AsyncQueue",`${t}: ${n}`),an(n))return new O(C.UNAVAILABLE,`${t}: ${n}`);throw n}class $e{static emptySet(t){return new $e(t.comparator)}constructor(t){this.comparator=t?(e,r)=>t(e,r)||M.comparator(e.key,r.key):(e,r)=>M.comparator(e.key,r.key),this.keyedMap=Rn(),this.sortedSet=new et(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,r)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof $e)||this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;e.hasNext();){const s=e.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){const r=new $e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=e,r}}class _c{constructor(){this.ga=new et(M.comparator)}track(t){const e=t.doc.key,r=this.ga.get(e);r?t.type!==0&&r.type===3?this.ga=this.ga.insert(e,t):t.type===3&&r.type!==1?this.ga=this.ga.insert(e,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.ga=this.ga.remove(e):t.type===1&&r.type===2?this.ga=this.ga.insert(e,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):L(63341,{Rt:t,pa:r}):this.ga=this.ga.insert(e,t)}ya(){const t=[];return this.ga.inorderTraversal(((e,r)=>{t.push(r)})),t}}class en{constructor(t,e,r,s,o,a,l,h,d){this.query=t,this.docs=e,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=h,this.hasCachedResults=d}static fromInitialDocuments(t,e,r,s,o){const a=[];return e.forEach((l=>{a.push({type:0,doc:l})})),new en(t,e,$e.emptySet(e),a,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&hs(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,r=t.docChanges;if(e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==r[s].type||!e[s].doc.isEqual(r[s].doc))return!1;return!0}}class Sg{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((t=>t.Da()))}}class Rg{constructor(){this.queries=yc(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(e,r){const s=B(e),o=s.queries;s.queries=yc(),o.forEach(((a,l)=>{for(const h of l.Sa)h.onError(r)}))})(this,new O(C.ABORTED,"Firestore shutting down"))}}function yc(){return new Pe((n=>yl(n)),hs)}async function Yl(n,t){const e=B(n);let r=3;const s=t.query;let o=e.queries.get(s);o?!o.ba()&&t.Da()&&(r=2):(o=new Sg,r=t.Da()?0:1);try{switch(r){case 0:o.wa=await e.onListen(s,!0);break;case 1:o.wa=await e.onListen(s,!1);break;case 2:await e.onFirstRemoteStoreListen(s)}}catch(a){const l=ro(a,`Initialization of query '${xe(t.query)}' failed`);return void t.onError(l)}e.queries.set(s,o),o.Sa.push(t),t.va(e.onlineState),o.wa&&t.Fa(o.wa)&&so(e)}async function Zl(n,t){const e=B(n),r=t.query;let s=3;const o=e.queries.get(r);if(o){const a=o.Sa.indexOf(t);a>=0&&(o.Sa.splice(a,1),o.Sa.length===0?s=t.Da()?0:1:!o.ba()&&t.Da()&&(s=2))}switch(s){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function Cg(n,t){const e=B(n);let r=!1;for(const s of t){const o=s.query,a=e.queries.get(o);if(a){for(const l of a.Sa)l.Fa(s)&&(r=!0);a.wa=s}}r&&so(e)}function bg(n,t,e){const r=B(n),s=r.queries.get(t);if(s)for(const o of s.Sa)o.onError(e);r.queries.delete(t)}function so(n){n.Ca.forEach((t=>{t.next()}))}var yi,Ec;(Ec=yi||(yi={})).Ma="default",Ec.Cache="cache";class tu{constructor(t,e,r){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(t){if(!this.options.includeMetadataChanges){const r=[];for(const s of t.docChanges)s.type!==3&&r.push(s);t=new en(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache||!this.Da())return!0;const r=e!=="Offline";return(!this.options.qa||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Ba(t){if(t.docChanges.length>0)return!0;const e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}ka(t){t=en.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==yi.Cache}}class eu{constructor(t){this.key=t}}class nu{constructor(t){this.key=t}}class Pg{constructor(t,e){this.query=t,this.Ya=e,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=$(),this.mutatedKeys=$(),this.eu=El(t),this.tu=new $e(this.eu)}get nu(){return this.Ya}ru(t,e){const r=e?e.iu:new _c,s=e?e.tu:this.tu;let o=e?e.mutatedKeys:this.mutatedKeys,a=s,l=!1;const h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((p,E)=>{const A=s.get(p),b=ds(this.query,E)?E:null,N=!!A&&this.mutatedKeys.has(A.key),x=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations);let D=!1;A&&b?A.data.isEqual(b.data)?N!==x&&(r.track({type:3,doc:b}),D=!0):this.su(A,b)||(r.track({type:2,doc:b}),D=!0,(h&&this.eu(b,h)>0||d&&this.eu(b,d)<0)&&(l=!0)):!A&&b?(r.track({type:0,doc:b}),D=!0):A&&!b&&(r.track({type:1,doc:A}),D=!0,(h||d)&&(l=!0)),D&&(b?(a=a.add(b),o=x?o.add(p):o.delete(p)):(a=a.delete(p),o=o.delete(p)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:a,iu:r,Cs:l,mutatedKeys:o}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,r,s){const o=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const a=t.iu.ya();a.sort(((p,E)=>(function(b,N){const x=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L(20277,{Rt:D})}};return x(b)-x(N)})(p.type,E.type)||this.eu(p.doc,E.doc))),this.ou(r),s=s??!1;const l=e&&!s?this._u():[],h=this.Xa.size===0&&this.current&&!s?1:0,d=h!==this.Za;return this.Za=h,a.length!==0||d?{snapshot:new en(this.query,t.tu,o,a,t.mutatedKeys,h===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new _c,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach((e=>this.Ya=this.Ya.add(e))),t.modifiedDocuments.forEach((e=>{})),t.removedDocuments.forEach((e=>this.Ya=this.Ya.delete(e))),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Xa;this.Xa=$(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const e=[];return t.forEach((r=>{this.Xa.has(r)||e.push(new nu(r))})),this.Xa.forEach((r=>{t.has(r)||e.push(new eu(r))})),e}cu(t){this.Ya=t.Qs,this.Xa=$();const e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return en.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const io="SyncEngine";class Vg{constructor(t,e,r){this.query=t,this.targetId=e,this.view=r}}class Dg{constructor(t){this.key=t,this.hu=!1}}class kg{constructor(t,e,r,s,o,a){this.localStore=t,this.remoteStore=e,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Pe((l=>yl(l)),hs),this.Iu=new Map,this.Eu=new Set,this.du=new et(M.comparator),this.Au=new Map,this.Ru=new Wi,this.Vu={},this.mu=new Map,this.fu=tn.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function Ng(n,t,e=!0){const r=cu(n);let s;const o=r.Tu.get(t);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.lu()):s=await ru(r,t,e,!0),s}async function Og(n,t){const e=cu(n);await ru(e,t,!0,!1)}async function ru(n,t,e,r){const s=await tg(n.localStore,Bt(t)),o=s.targetId,a=n.sharedClientState.addLocalQueryTarget(o,e);let l;return r&&(l=await Mg(n,t,o,a==="current",s.resumeToken)),n.isPrimaryClient&&e&&Gl(n.remoteStore,s),l}async function Mg(n,t,e,r,s){n.pu=(E,A,b)=>(async function(x,D,G,K){let W=D.view.ru(G);W.Cs&&(W=await hc(x.localStore,D.query,!1).then((({documents:T})=>D.view.ru(T,W))));const Tt=K&&K.targetChanges.get(D.targetId),At=K&&K.targetMismatches.get(D.targetId)!=null,ut=D.view.applyChanges(W,x.isPrimaryClient,Tt,At);return vc(x,D.targetId,ut.au),ut.snapshot})(n,E,A,b);const o=await hc(n.localStore,t,!0),a=new Pg(t,o.Qs),l=a.ru(o.documents),h=er.createSynthesizedTargetChangeForCurrentChange(e,r&&n.onlineState!=="Offline",s),d=a.applyChanges(l,n.isPrimaryClient,h);vc(n,e,d.au);const p=new Vg(t,e,a);return n.Tu.set(t,p),n.Iu.has(e)?n.Iu.get(e).push(t):n.Iu.set(e,[t]),d.snapshot}async function xg(n,t,e){const r=B(n),s=r.Tu.get(t),o=r.Iu.get(s.targetId);if(o.length>1)return r.Iu.set(s.targetId,o.filter((a=>!hs(a,t)))),void r.Tu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await pi(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),e&&Yi(r.remoteStore,s.targetId),Ei(r,s.targetId)})).catch(on)):(Ei(r,s.targetId),await pi(r.localStore,s.targetId,!0))}async function Lg(n,t){const e=B(n),r=e.Tu.get(t),s=e.Iu.get(r.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),Yi(e.remoteStore,r.targetId))}async function Fg(n,t,e){const r=Hg(n);try{const s=await(function(a,l){const h=B(a),d=Z.now(),p=l.reduce(((b,N)=>b.add(N.key)),$());let E,A;return h.persistence.runTransaction("Locally write mutations","readwrite",(b=>{let N=Wt(),x=$();return h.Ns.getEntries(b,p).next((D=>{N=D,N.forEach(((G,K)=>{K.isValidDocument()||(x=x.add(G))}))})).next((()=>h.localDocuments.getOverlayedDocuments(b,N))).next((D=>{E=D;const G=[];for(const K of l){const W=Zf(K,E.get(K.key).overlayedDocument);W!=null&&G.push(new Ve(K.key,W,hl(W.value.mapValue),Ot.exists(!0)))}return h.mutationQueue.addMutationBatch(b,d,G,l)})).next((D=>{A=D;const G=D.applyToLocalDocumentSet(E,x);return h.documentOverlayCache.saveOverlays(b,D.batchId,G)}))})).then((()=>({batchId:A.batchId,changes:vl(E)})))})(r.localStore,t);r.sharedClientState.addPendingMutation(s.batchId),(function(a,l,h){let d=a.Vu[a.currentUser.toKey()];d||(d=new et(q)),d=d.insert(l,h),a.Vu[a.currentUser.toKey()]=d})(r,s.batchId,e),await rr(r,s.changes),await ys(r.remoteStore)}catch(s){const o=ro(s,"Failed to persist write");e.reject(o)}}async function su(n,t){const e=B(n);try{const r=await Jm(e.localStore,t);t.targetChanges.forEach(((s,o)=>{const a=e.Au.get(o);a&&(Q(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?Q(a.hu,14607):s.removedDocuments.size>0&&(Q(a.hu,42227),a.hu=!1))})),await rr(e,r,t)}catch(r){await on(r)}}function Tc(n,t,e){const r=B(n);if(r.isPrimaryClient&&e===0||!r.isPrimaryClient&&e===1){const s=[];r.Tu.forEach(((o,a)=>{const l=a.view.va(t);l.snapshot&&s.push(l.snapshot)})),(function(a,l){const h=B(a);h.onlineState=l;let d=!1;h.queries.forEach(((p,E)=>{for(const A of E.Sa)A.va(l)&&(d=!0)})),d&&so(h)})(r.eventManager,t),s.length&&r.Pu.H_(s),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Bg(n,t,e){const r=B(n);r.sharedClientState.updateQueryState(t,"rejected",e);const s=r.Au.get(t),o=s&&s.key;if(o){let a=new et(M.comparator);a=a.insert(o,Et.newNoDocument(o,F.min()));const l=$().add(o),h=new gs(F.min(),new Map,new et(q),a,l);await su(r,h),r.du=r.du.remove(o),r.Au.delete(t),oo(r)}else await pi(r.localStore,t,!1).then((()=>Ei(r,t,e))).catch(on)}async function Ug(n,t){const e=B(n),r=t.batch.batchId;try{const s=await Xm(e.localStore,t);ou(e,r,null),iu(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await rr(e,s)}catch(s){await on(s)}}async function jg(n,t,e){const r=B(n);try{const s=await(function(a,l){const h=B(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let p;return h.mutationQueue.lookupMutationBatch(d,l).next((E=>(Q(E!==null,37113),p=E.keys(),h.mutationQueue.removeMutationBatch(d,E)))).next((()=>h.mutationQueue.performConsistencyCheck(d))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(d,p,l))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p))).next((()=>h.localDocuments.getDocuments(d,p)))}))})(r.localStore,t);ou(r,t,e),iu(r,t),r.sharedClientState.updateMutationState(t,"rejected",e),await rr(r,s)}catch(s){await on(s)}}function iu(n,t){(n.mu.get(t)||[]).forEach((e=>{e.resolve()})),n.mu.delete(t)}function ou(n,t,e){const r=B(n);let s=r.Vu[r.currentUser.toKey()];if(s){const o=s.get(t);o&&(e?o.reject(e):o.resolve(),s=s.remove(t)),r.Vu[r.currentUser.toKey()]=s}}function Ei(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(const r of n.Iu.get(t))n.Tu.delete(r),e&&n.Pu.yu(r,e);n.Iu.delete(t),n.isPrimaryClient&&n.Ru.jr(t).forEach((r=>{n.Ru.containsKey(r)||au(n,r)}))}function au(n,t){n.Eu.delete(t.path.canonicalString());const e=n.du.get(t);e!==null&&(Yi(n.remoteStore,e),n.du=n.du.remove(t),n.Au.delete(e),oo(n))}function vc(n,t,e){for(const r of e)r instanceof eu?(n.Ru.addReference(r.key,t),qg(n,r)):r instanceof nu?(k(io,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,t),n.Ru.containsKey(r.key)||au(n,r.key)):L(19791,{wu:r})}function qg(n,t){const e=t.key,r=e.path.canonicalString();n.du.get(e)||n.Eu.has(r)||(k(io,"New document in limbo: "+e),n.Eu.add(r),oo(n))}function oo(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const t=n.Eu.values().next().value;n.Eu.delete(t);const e=new M(Y.fromString(t)),r=n.fu.next();n.Au.set(r,new Dg(e)),n.du=n.du.insert(e,r),Gl(n.remoteStore,new ee(Bt(qi(e.path)),r,"TargetPurposeLimboResolution",as.ce))}}async function rr(n,t,e){const r=B(n),s=[],o=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((l,h)=>{a.push(r.pu(h,t,e).then((d=>{if((d||e)&&r.isPrimaryClient){const p=d?!d.fromCache:e?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(d){s.push(d);const p=Xi.As(h.targetId,d);o.push(p)}})))})),await Promise.all(a),r.Pu.H_(s),await(async function(h,d){const p=B(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",(E=>R.forEach(d,(A=>R.forEach(A.Es,(b=>p.persistence.referenceDelegate.addReference(E,A.targetId,b))).next((()=>R.forEach(A.ds,(b=>p.persistence.referenceDelegate.removeReference(E,A.targetId,b)))))))))}catch(E){if(!an(E))throw E;k(Ji,"Failed to update sequence numbers: "+E)}for(const E of d){const A=E.targetId;if(!E.fromCache){const b=p.Ms.get(A),N=b.snapshotVersion,x=b.withLastLimboFreeSnapshotVersion(N);p.Ms=p.Ms.insert(A,x)}}})(r.localStore,o))}async function $g(n,t){const e=B(n);if(!e.currentUser.isEqual(t)){k(io,"User change. New user:",t.toKey());const r=await ql(e.localStore,t);e.currentUser=t,(function(o,a){o.mu.forEach((l=>{l.forEach((h=>{h.reject(new O(C.CANCELLED,a))}))})),o.mu.clear()})(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await rr(e,r.Ls)}}function zg(n,t){const e=B(n),r=e.Au.get(t);if(r&&r.hu)return $().add(r.key);{let s=$();const o=e.Iu.get(t);if(!o)return s;for(const a of o){const l=e.Tu.get(a);s=s.unionWith(l.view.nu)}return s}}function cu(n){const t=B(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=su.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=zg.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Bg.bind(null,t),t.Pu.H_=Cg.bind(null,t.eventManager),t.Pu.yu=bg.bind(null,t.eventManager),t}function Hg(n){const t=B(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Ug.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=jg.bind(null,t),t}class Zr{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=ps(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,e){return null}Mu(t,e){return null}vu(t){return Qm(this.persistence,new Gm,t.initialUser,this.serializer)}Cu(t){return new jl(Qi.mi,this.serializer)}Du(t){return new ng}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Zr.provider={build:()=>new Zr};class Gg extends Zr{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){Q(this.persistence.referenceDelegate instanceof Jr,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new Dm(r,t.asyncQueue,e)}Cu(t){const e=this.cacheSizeBytes!==void 0?Rt.withCacheSize(this.cacheSizeBytes):Rt.DEFAULT;return new jl((r=>Jr.mi(r,e)),this.serializer)}}class Ti{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Tc(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=$g.bind(null,this.syncEngine),await Ag(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return(function(){return new Rg})()}createDatastore(t){const e=ps(t.databaseInfo.databaseId),r=(function(o){return new ag(o)})(t.databaseInfo);return(function(o,a,l,h){return new hg(o,a,l,h)})(t.authCredentials,t.appCheckCredentials,r,e)}createRemoteStore(t){return(function(r,s,o,a,l){return new fg(r,s,o,a,l)})(this.localStore,this.datastore,t.asyncQueue,(e=>Tc(this.syncEngine,e,0)),(function(){return mc.v()?new mc:new rg})())}createSyncEngine(t,e){return(function(s,o,a,l,h,d,p){const E=new kg(s,o,a,l,h,d);return p&&(E.gu=!0),E})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){await(async function(e){const r=B(e);k(Re,"RemoteStore shutting down."),r.Ea.add(5),await nr(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Ti.provider={build:()=>new Ti};class lu{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):Kt("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout((()=>{this.muted||t(e)}),0)}}const de="FirestoreClient";class Kg{constructor(t,e,r,s,o){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=r,this.databaseInfo=s,this.user=yt.UNAUTHENTICATED,this.clientId=Mi.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async a=>{k(de,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(k(de,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new ie;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const r=ro(e,"Failed to shutdown persistence");t.reject(r)}})),t.promise}}async function Ys(n,t){n.asyncQueue.verifyOperationInProgress(),k(de,"Initializing OfflineComponentProvider");const e=n.configuration;await t.initialize(e);let r=e.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await ql(t.localStore,s),r=s)})),t.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=t}async function Ic(n,t){n.asyncQueue.verifyOperationInProgress();const e=await Wg(n);k(de,"Initializing OnlineComponentProvider"),await t.initialize(e,n.configuration),n.setCredentialChangeListener((r=>pc(t.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>pc(t.remoteStore,s))),n._onlineComponents=t}async function Wg(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){k(de,"Using user provided OfflineComponentProvider");try{await Ys(n,n._uninitializedComponentsProvider._offline)}catch(t){const e=t;if(!(function(s){return s.name==="FirebaseError"?s.code===C.FAILED_PRECONDITION||s.code===C.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(e))throw e;Xe("Error using user provided cache. Falling back to memory cache: "+e),await Ys(n,new Zr)}}else k(de,"Using default OfflineComponentProvider"),await Ys(n,new Gg(void 0));return n._offlineComponents}async function uu(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(k(de,"Using user provided OnlineComponentProvider"),await Ic(n,n._uninitializedComponentsProvider._online)):(k(de,"Using default OnlineComponentProvider"),await Ic(n,new Ti))),n._onlineComponents}function Qg(n){return uu(n).then((t=>t.syncEngine))}async function vi(n){const t=await uu(n),e=t.eventManager;return e.onListen=Ng.bind(null,t.syncEngine),e.onUnlisten=xg.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=Og.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=Lg.bind(null,t.syncEngine),e}function Xg(n,t,e={}){const r=new ie;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,l,h,d){const p=new lu({next:A=>{p.Nu(),a.enqueueAndForget((()=>Zl(o,E))),A.fromCache&&h.source==="server"?d.reject(new O(C.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(A)},error:A=>d.reject(A)}),E=new tu(l,p,{includeMetadataChanges:!0,qa:!0});return Yl(o,E)})(await vi(n),n.asyncQueue,t,e,r))),r.promise}function hu(n){const t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}const wc=new Map;const du="firestore.googleapis.com",Ac=!0;class Sc{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new O(C.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=du,this.ssl=Ac}else this.host=t.host,this.ssl=t.ssl??Ac;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=Ul;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<Pm)throw new O(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}hf("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=hu(t.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new O(C.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new O(C.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new O(C.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Es{constructor(t,e,r,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Sc({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new O(C.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new O(C.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Sc(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new tf;switch(r.type){case"firstParty":return new sf(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new O(C.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(e){const r=wc.get(e);r&&(k("ComponentProvider","Removing Datastore"),wc.delete(e),r.terminate())})(this),Promise.resolve()}}function Jg(n,t,e,r={}){n=Ft(n,Es);const s=ki(t),o=n._getSettings(),a={...o,emulatorOptions:n._getEmulatorOptions()},l=`${t}:${e}`;s&&(Ch(`https://${l}`),Dh("Firestore",!0)),o.host!==du&&o.host!==l&&Xe("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:l,ssl:s,emulatorOptions:r};if(!jr(h,a)&&(n._setSettings(h),r.mockUserToken)){let d,p;if(typeof r.mockUserToken=="string")d=r.mockUserToken,p=yt.MOCK_USER;else{d=bh(r.mockUserToken,n._app?.options.projectId);const E=r.mockUserToken.sub||r.mockUserToken.user_id;if(!E)throw new O(C.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new yt(E)}n._authCredentials=new ef(new Zc(d,p))}}class sr{constructor(t,e,r){this.converter=e,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new sr(this.firestore,t,this._query)}}class ct{constructor(t,e,r){this.converter=e,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new oe(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new ct(this.firestore,t,this._key)}toJSON(){return{type:ct._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,r){if(Zn(e,ct._jsonSchema))return new ct(t,r||null,new M(Y.fromString(e.referencePath)))}}ct._jsonSchemaVersion="firestore/documentReference/1.0",ct._jsonSchema={type:it("string",ct._jsonSchemaVersion),referencePath:it("string")};class oe extends sr{constructor(t,e,r){super(t,e,qi(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new ct(this.firestore,null,new M(t))}withConverter(t){return new oe(this.firestore,t,this._path)}}function On(n,t,...e){if(n=Qe(n),tl("collection","path",t),n instanceof Es){const r=Y.fromString(t,...e);return Ba(r),new oe(n,null,r)}{if(!(n instanceof ct||n instanceof oe))throw new O(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Y.fromString(t,...e));return Ba(r),new oe(n.firestore,null,r)}}function nn(n,t,...e){if(n=Qe(n),arguments.length===1&&(t=Mi.newId()),tl("doc","path",t),n instanceof Es){const r=Y.fromString(t,...e);return Fa(r),new ct(n,null,new M(r))}{if(!(n instanceof ct||n instanceof oe))throw new O(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Y.fromString(t,...e));return Fa(r),new ct(n.firestore,n instanceof oe?n.converter:null,new M(r))}}const Rc="AsyncQueue";class Cc{constructor(t=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new zl(this,"async_queue_retry"),this._c=()=>{const r=Js();r&&k(Rc,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=t;const e=Js();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const e=Js();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise((()=>{}));const e=new ie;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Xu.push(t),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!an(t))throw t;k(Rc,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(t){const e=this.ac.then((()=>(this.rc=!0,t().catch((r=>{throw this.nc=r,this.rc=!1,Kt("INTERNAL UNHANDLED ERROR: ",bc(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=e,e}enqueueAfterDelay(t,e,r){this.uc(),this.oc.indexOf(t)>-1&&(e=0);const s=no.createAndSchedule(this,t,e,r,(o=>this.hc(o)));return this.tc.push(s),s}uc(){this.nc&&L(47125,{Pc:bc(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do t=this.ac,await t;while(t!==this.ac)}Ic(t){for(const e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then((()=>{this.tc.sort(((e,r)=>e.targetTimeMs-r.targetTimeMs));for(const e of this.tc)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Tc()}))}dc(t){this.oc.push(t)}hc(t){const e=this.tc.indexOf(t);this.tc.splice(e,1)}}function bc(n){let t=n.message||"";return n.stack&&(t=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),t}function Pc(n){return(function(e,r){if(typeof e!="object"||e===null)return!1;const s=e;for(const o of r)if(o in s&&typeof s[o]=="function")return!0;return!1})(n,["next","error","complete"])}class Ce extends Es{constructor(t,e,r,s){super(t,e,r,s),this.type="firestore",this._queue=new Cc,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new Cc(t),this._firestoreClient=void 0,await t}}}function Yg(n,t){const e=typeof n=="object"?n:jd(),r=typeof n=="string"?n:Hr,s=xd(e,"firestore").getImmediate({identifier:r});if(!s._initialized){const o=Sh("firestore");o&&Jg(s,...o)}return s}function ao(n){if(n._terminated)throw new O(C.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Zg(n),n._firestoreClient}function Zg(n){const t=n._freezeSettings(),e=(function(s,o,a,l){return new If(s,o,a,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,hu(l.experimentalLongPollingOptions),l.useFetchStreams,l.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,t);n._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),n._firestoreClient=new Kg(n._authCredentials,n._appCheckCredentials,n._queue,e,n._componentsProvider&&(function(s){const o=s?._online.build();return{_offline:s?._offline.build(o),_online:o}})(n._componentsProvider))}class Dt{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Dt(gt.fromBase64String(t))}catch(e){throw new O(C.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new Dt(gt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:Dt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(Zn(t,Dt._jsonSchema))return Dt.fromBase64String(t.bytes)}}Dt._jsonSchemaVersion="firestore/bytes/1.0",Dt._jsonSchema={type:it("string",Dt._jsonSchemaVersion),bytes:it("string")};class co{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new O(C.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new mt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class lo{constructor(t){this._methodName=t}}class jt{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new O(C.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new O(C.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return q(this._lat,t._lat)||q(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:jt._jsonSchemaVersion}}static fromJSON(t){if(Zn(t,jt._jsonSchema))return new jt(t.latitude,t.longitude)}}jt._jsonSchemaVersion="firestore/geoPoint/1.0",jt._jsonSchema={type:it("string",jt._jsonSchemaVersion),latitude:it("number"),longitude:it("number")};class qt{constructor(t){this._values=(t||[]).map((e=>e))}toArray(){return this._values.map((t=>t))}isEqual(t){return(function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0})(this._values,t._values)}toJSON(){return{type:qt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(Zn(t,qt._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every((e=>typeof e=="number")))return new qt(t.vectorValues);throw new O(C.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}qt._jsonSchemaVersion="firestore/vectorValue/1.0",qt._jsonSchema={type:it("string",qt._jsonSchemaVersion),vectorValues:it("object")};const tp=/^__.*__$/;class ep{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return this.fieldMask!==null?new Ve(t,this.data,this.fieldMask,e,this.fieldTransforms):new tr(t,this.data,e,this.fieldTransforms)}}function fu(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L(40011,{Ac:n})}}class uo{constructor(t,e,r,s,o,a){this.settings=t,this.databaseId=e,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new uo({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(t){const e=this.path?.child(t),r=this.Vc({path:e,fc:!1});return r.gc(t),r}yc(t){const e=this.path?.child(t),r=this.Vc({path:e,fc:!1});return r.Rc(),r}wc(t){return this.Vc({path:void 0,fc:!0})}Sc(t){return ts(t,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return this.fieldMask.find((e=>t.isPrefixOf(e)))!==void 0||this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))!==void 0}Rc(){if(this.path)for(let t=0;t<this.path.length;t++)this.gc(this.path.get(t))}gc(t){if(t.length===0)throw this.Sc("Document fields must not be empty");if(fu(this.Ac)&&tp.test(t))throw this.Sc('Document fields cannot begin and end with "__"')}}class np{constructor(t,e,r){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=r||ps(t)}Cc(t,e,r,s=!1){return new uo({Ac:t,methodName:e,Dc:r,path:mt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function mu(n){const t=n._freezeSettings(),e=ps(n._databaseId);return new np(n._databaseId,!!t.ignoreUndefinedProperties,e)}function gu(n,t,e,r,s,o={}){const a=n.Cc(o.merge||o.mergeFields?2:0,t,e,s);Eu("Data must be an object, but it was:",a,r);const l=_u(r,a);let h,d;if(o.merge)h=new Nt(a.fieldMask),d=a.fieldTransforms;else if(o.mergeFields){const p=[];for(const E of o.mergeFields){const A=rp(t,E,e);if(!a.contains(A))throw new O(C.INVALID_ARGUMENT,`Field '${A}' is specified in your field mask but missing from your input data.`);ip(p,A)||p.push(A)}h=new Nt(p),d=a.fieldTransforms.filter((E=>h.covers(E.field)))}else h=null,d=a.fieldTransforms;return new ep(new Vt(l),h,d)}class ho extends lo{_toFieldTransform(t){return new Qf(t.path,new $n)}isEqual(t){return t instanceof ho}}function pu(n,t){if(yu(n=Qe(n)))return Eu("Unsupported field value:",t,n),_u(n,t);if(n instanceof lo)return(function(r,s){if(!fu(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)})(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.fc&&t.Ac!==4)throw t.Sc("Nested arrays are not supported");return(function(r,s){const o=[];let a=0;for(const l of r){let h=pu(l,s.wc(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}})(n,t)}return(function(r,s){if((r=Qe(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Gf(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=Z.fromDate(r);return{timestampValue:Xr(s.serializer,o)}}if(r instanceof Z){const o=new Z(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Xr(s.serializer,o)}}if(r instanceof jt)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Dt)return{bytesValue:Nl(s.serializer,r._byteString)};if(r instanceof ct){const o=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Ki(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof qt)return(function(a,l){return{mapValue:{fields:{[ll]:{stringValue:ul},[Gr]:{arrayValue:{values:a.toArray().map((d=>{if(typeof d!="number")throw l.Sc("VectorValues must only contain numeric values.");return $i(l.serializer,d)}))}}}}}})(r,s);throw s.Sc(`Unsupported field value: ${xi(r)}`)})(n,t)}function _u(n,t){const e={};return rl(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):be(n,((r,s)=>{const o=pu(s,t.mc(r));o!=null&&(e[r]=o)})),{mapValue:{fields:e}}}function yu(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Z||n instanceof jt||n instanceof Dt||n instanceof ct||n instanceof lo||n instanceof qt)}function Eu(n,t,e){if(!yu(e)||!el(e)){const r=xi(e);throw r==="an object"?t.Sc(n+" a custom object"):t.Sc(n+" "+r)}}function rp(n,t,e){if((t=Qe(t))instanceof co)return t._internalPath;if(typeof t=="string")return Tu(n,t);throw ts("Field path arguments must be of type string or ",n,!1,void 0,e)}const sp=new RegExp("[~\\*/\\[\\]]");function Tu(n,t,e){if(t.search(sp)>=0)throw ts(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new co(...t.split("."))._internalPath}catch{throw ts(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function ts(n,t,e,r,s){const o=r&&!r.isEmpty(),a=s!==void 0;let l=`Function ${t}() called with invalid data`;e&&(l+=" (via `toFirestore()`)"),l+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${s}`),h+=")"),new O(C.INVALID_ARGUMENT,l+n+h)}function ip(n,t){return n.some((e=>e.isEqual(t)))}class vu{constructor(t,e,r,s,o){this._firestore=t,this._userDataWriter=e,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new ct(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new op(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Iu("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}}class op extends vu{data(){return super.data()}}function Iu(n,t){return typeof t=="string"?Tu(n,t):t instanceof co?t._internalPath:t._delegate._internalPath}function wu(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new O(C.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ap{convertValue(t,e="none"){switch(ue(t)){case 0:return null;case 1:return t.booleanValue;case 2:return rt(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(le(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw L(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const r={};return be(t,((s,o)=>{r[s]=this.convertValue(o,e)})),r}convertVectorValue(t){const e=t.fields?.[Gr].arrayValue?.values?.map((r=>rt(r.doubleValue)));return new qt(e)}convertGeoPoint(t){return new jt(rt(t.latitude),rt(t.longitude))}convertArray(t,e){return(t.values||[]).map((r=>this.convertValue(r,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const r=ls(t);return r==null?null:this.convertValue(r,e);case"estimate":return this.convertTimestamp(Un(t));default:return null}}convertTimestamp(t){const e=ce(t);return new Z(e.seconds,e.nanos)}convertDocumentKey(t,e){const r=Y.fromString(t);Q(Bl(r),9688,{name:t});const s=new jn(r.get(1),r.get(3)),o=new M(r.popFirst(5));return s.isEqual(e)||Kt(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),o}}function Au(n,t,e){let r;return r=n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t,r}class bn{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Ie extends vu{constructor(t,e,r,s,o,a){super(t,e,r,s,a),this._firestore=t,this._firestoreImpl=t,this.metadata=o}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Mr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const r=this._document.data.field(Iu("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new O(C.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,e={};return e.type=Ie._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}}Ie._jsonSchemaVersion="firestore/documentSnapshot/1.0",Ie._jsonSchema={type:it("string",Ie._jsonSchemaVersion),bundleSource:it("string","DocumentSnapshot"),bundleName:it("string"),bundle:it("string")};class Mr extends Ie{data(t={}){return super.data(t)}}class we{constructor(t,e,r,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new bn(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach((r=>{t.call(e,new Mr(this._firestore,this._userDataWriter,r.key,r,new bn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new O(C.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=(function(s,o){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((l=>{const h=new Mr(s._firestore,s._userDataWriter,l.doc.key,l.doc,new bn(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((l=>o||l.type!==3)).map((l=>{const h=new Mr(s._firestore,s._userDataWriter,l.doc.key,l.doc,new bn(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,p=-1;return l.type!==0&&(d=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),p=a.indexOf(l.doc.key)),{type:cp(l.type),doc:h,oldIndex:d,newIndex:p}}))}})(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new O(C.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=we._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=Mi.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const e=[],r=[],s=[];return this.docs.forEach((o=>{o._document!==null&&(e.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))})),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function cp(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L(61501,{type:n})}}we._jsonSchemaVersion="firestore/querySnapshot/1.0",we._jsonSchema={type:it("string",we._jsonSchemaVersion),bundleSource:it("string","QuerySnapshot"),bundleName:it("string"),bundle:it("string")};class fo extends ap{constructor(t){super(),this.firestore=t}convertBytes(t){return new Dt(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new ct(this.firestore,null,e)}}function lp(n){n=Ft(n,sr);const t=Ft(n.firestore,Ce),e=ao(t),r=new fo(t);return wu(n._query),Xg(e,n._query).then((s=>new we(t,r,n,s)))}function es(n,t,e){n=Ft(n,ct);const r=Ft(n.firestore,Ce),s=Au(n.converter,t,e);return mo(r,[gu(mu(r),"setDoc",n._key,s,n.converter!==null,e).toMutation(n._key,Ot.none())])}function up(n){return mo(Ft(n.firestore,Ce),[new zi(n._key,Ot.none())])}function Su(n,t){const e=Ft(n.firestore,Ce),r=nn(n),s=Au(n.converter,t);return mo(e,[gu(mu(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Ot.exists(!1))]).then((()=>r))}function Vc(n,...t){n=Qe(n);let e={includeMetadataChanges:!1,source:"default"},r=0;typeof t[r]!="object"||Pc(t[r])||(e=t[r++]);const s={includeMetadataChanges:e.includeMetadataChanges,source:e.source};if(Pc(t[r])){const h=t[r];t[r]=h.next?.bind(h),t[r+1]=h.error?.bind(h),t[r+2]=h.complete?.bind(h)}let o,a,l;if(n instanceof ct)a=Ft(n.firestore,Ce),l=qi(n._key.path),o={next:h=>{t[r]&&t[r](hp(a,n,h))},error:t[r+1],complete:t[r+2]};else{const h=Ft(n,sr);a=Ft(h.firestore,Ce),l=h._query;const d=new fo(a);o={next:p=>{t[r]&&t[r](new we(a,d,h,p))},error:t[r+1],complete:t[r+2]},wu(n._query)}return(function(d,p,E,A){const b=new lu(A),N=new tu(p,b,E);return d.asyncQueue.enqueueAndForget((async()=>Yl(await vi(d),N))),()=>{b.Nu(),d.asyncQueue.enqueueAndForget((async()=>Zl(await vi(d),N)))}})(ao(a),l,s,o)}function mo(n,t){return(function(r,s){const o=new ie;return r.asyncQueue.enqueueAndForget((async()=>Fg(await Qg(r),s,o))),o.promise})(ao(n),t)}function hp(n,t,e){const r=e.docs.get(t._key),s=new fo(n);return new Ie(n,s,t._key,r,new bn(e.hasPendingWrites,e.fromCache),t.converter)}function Gn(){return new ho("serverTimestamp")}(function(t,e=!0){(function(s){sn=s})(Ud),$r(new Ln("firestore",((r,{instanceIdentifier:s,options:o})=>{const a=r.getProvider("app").getImmediate(),l=new Ce(new nf(r.getProvider("auth-internal")),new of(a,r.getProvider("app-check-internal")),(function(d,p){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new O(C.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new jn(d.options.projectId,p)})(a,s),a);return o={useFetchStreams:e,...o},l._setSettings(o),l}),"PUBLIC").setMultipleInstances(!0)),qe(Oa,Ma,t),qe(Oa,Ma,"esm2020")})();const dp={apiKey:"AIzaSyC5fjkXd_lirXDEY5wyH-upF9yU_nzLAJw",authDomain:"web-rtc-server-50d56.firebaseapp.com",projectId:"web-rtc-server-50d56",storageBucket:"web-rtc-server-50d56.firebasestorage.app",messagingSenderId:"1017642181996",appId:"1:1017642181996:web:e325acd4ee82baa9087f49",measurementId:"G-KVDMZRQKBP"},fp=$c(dp),Ru=Yg(fp),mp={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10};let U=null;const Dc=document.getElementById("webcamButton"),Cu=document.getElementById("webcamVideo"),go=document.getElementById("callButton"),bu=document.getElementById("answerButton"),Ct=document.getElementById("remoteVideo"),Kn=document.getElementById("hangupButton"),Pu=document.getElementById("settingsButton"),Mn=document.getElementById("settingsModal"),gp=document.getElementById("closeSettings"),ze=document.getElementById("videoSelect"),Wn=document.getElementById("audioSelect"),ns=document.getElementById("audioOutputSelect"),He=document.getElementById("createCallModal"),pp=document.getElementById("closeCreateCall"),ir=document.getElementById("callIdDisplay"),Cr=document.getElementById("copyCallId"),_p=document.getElementById("shareGmail"),yp=document.getElementById("shareOutlook"),Ae=document.getElementById("joinCallModal"),Ii=document.getElementById("joinCallInput"),Ep=document.getElementById("confirmJoinCall"),Tp=document.getElementById("closeJoinCall"),xr=document.getElementById("toggleMute"),Lr=document.getElementById("toggleCamera"),Vu=document.getElementById("toggleFullscreen"),Du=document.getElementById("callTimer"),vp=document.getElementById("videoContainer"),Ip=document.getElementById("slot-0-camera-off"),rs=document.getElementById("remoteCameraOff"),wp=document.getElementById("slot-0-muted"),po=document.getElementById("remoteMuted"),Ht=document.getElementById("connectionIndicator"),ss=document.getElementById("networkStats"),Ap=document.getElementById("videoStat"),Sp=document.getElementById("audioStat"),Rp=document.getElementById("latencyStat"),Cp=document.getElementById("packetLossStat"),_o=document.getElementById("chatPanel"),br=document.getElementById("chatMessages"),kc=document.getElementById("chatInput"),bp=document.getElementById("sendMessage"),Qn=document.getElementById("openChat"),Pp=document.getElementById("toggleChat"),Nc=document.getElementById("showStatsToggle"),wi=document.getElementById("usernameInput"),yo=document.getElementById("localNameTag"),Ge=document.getElementById("remoteNameTag");let Be=!1,Pr=!1,Ai=null,Fr=null,xn=null,Si=!1,kt="Guest",Xn=null,Jn=null;const Pt=localStorage.getItem("clientId")||Math.random().toString(36).substring(2,10);localStorage.setItem("clientId",Pt);const P={},Ri=10;let tt=null;function or(n){Object.values(P).forEach(t=>{const e=t.dataChannel;if(e&&e.readyState==="open")try{e.send(JSON.stringify(n))}catch{}})}let ve=null,Ue=null,je=0,Ke=null,We=null,Ci=0,Oc=0;const Vp=1e3,is=.03,Dp=.06;function ku(){if(U&&U.getAudioTracks().length)try{ve||(ve=new(window.AudioContext||window.webkitAudioContext));const n=ve.createMediaStreamSource(U);Ue=ve.createAnalyser(),Ue.fftSize=2048,n.connect(Ue);const t=new Uint8Array(Ue.fftSize);Ke&&clearInterval(Ke),Ke=setInterval(()=>{Ue.getByteTimeDomainData(t);let e=0;for(let s=0;s<t.length;s++){const o=(t[s]-128)/128;e+=o*o}const r=Math.sqrt(e/t.length);je=Math.min(1,r),or({type:"audio-level",level:je});try{const s=document.getElementById("slot-0");if(s){const o=s.querySelector(".audio-meter"),a=o&&o.querySelector(".level");o&&a&&(o.style.display="block",a.style.width=Math.min(100,Math.round(je*100))+"%"),s.classList.toggle("speaking",je>is+.03)}}catch{}},200)}catch(n){console.warn("Failed to start local audio meter",n)}}function kp(){if(Ke&&(clearInterval(Ke),Ke=null),ve){try{ve.close()}catch{}ve=null,Ue=null,je=0}}function Np(){We&&clearInterval(We),We=setInterval(()=>{if(Date.now()<Ci)return;let n=null,t=-1;const e=Date.now();for(const[s,o]of Object.entries(P)){if(!o)continue;const a=typeof o.lastAudioLevel=="number"?o.lastAudioLevel:0,l=o&&o.levelTs?o.levelTs:0;e-l>2e3||a>t&&(t=a,n=s)}if(!n||t<is||tt===n||Date.now()<Ci||e-Oc<Vp)return;let r=0;if(tt&&P[tt]){const s=P[tt];r=typeof s.lastAudioLevel=="number"?s.lastAudioLevel:0}if(t>Math.max(r+Dp,is)){tt=n;const s=P[n];s&&s.remoteStream&&(Ct.srcObject=s.remoteStream),Ge.textContent=s&&s.username||"Guest",Eo(),Oc=Date.now()}},250)}function Op(){We&&(clearInterval(We),We=null)}function Eo(){if(document.querySelectorAll(".thumb-slot").forEach(n=>n.classList.remove("active")),tt){const n=P[tt];if(n&&n.slotIndex){const t=document.getElementById(`slot-${n.slotIndex}`);t&&t.classList.add("active")}}else{const n=document.getElementById("slot-0");n&&n.classList.add("active")}}function Mp(n){for(const[t,e]of Object.entries(P))if(t===n&&e.slotIndex)return e.slotIndex;for(let t=1;t<Ri;t++){if(!document.getElementById(`slot-${t}`))continue;if(!Object.values(P).some(s=>s.slotIndex===t))return t}return null}function Yn(n){const t=P[n];return!t||!t.slotIndex?null:document.getElementById(`slot-${t.slotIndex}`)}function Nu(n){const t=P[n].slotIndex||Mp(n);if(!t)return null;P[n].slotIndex=t;const e=document.getElementById(`slot-${t}`);e.classList.remove("empty");let r=e.querySelector("video");r||(r=document.createElement("video"),r.className="thumb-video",r.autoplay=!0,r.playsInline=!0,r.id=`slot-${t}-video`,e.appendChild(r));let s=e.querySelector(".slot-name");if(s||(s=document.createElement("div"),s.className="video-name-tag slot-name",s.id=`slot-${t}-name`,s.textContent=P[n].username||"Guest",e.appendChild(s)),!e.querySelector(".camera-off-overlay")){const l=document.createElement("div");l.className="camera-off-overlay small",l.id=`slot-${t}-camera-off`,l.innerHTML='<div class="camera-off-icon"></div>',e.appendChild(l)}if(!e.querySelector(".muted-indicator")){const l=document.createElement("div");l.className="muted-indicator small",l.id=`slot-${t}-muted`,l.textContent="",e.appendChild(l)}if(!e.querySelector(".audio-meter")){const l=document.createElement("div");l.className="audio-meter",l.innerHTML='<div class="level"></div>',e.appendChild(l)}if(!e.querySelector(".peer-debug")){const l=document.createElement("div");l.className="peer-debug",l.id=`slot-${t}-debug`,l.textContent="...",e.appendChild(l)}e.classList.add("debug-mode");const o=e.querySelector(".camera-off-overlay"),a=e.querySelector(".muted-indicator");return o&&o.classList.remove("active"),a&&a.classList.remove("active"),r}let wt=null,bi=null,Pi=null;async function Br(n){if(!wt)return;const t=On(wt,"signals"),e=document.getElementById("signalWarning"),r=async(s=1)=>{try{return await Su(t,{...n,createdAt:Gn()}),e&&(e.style.display="none"),!0}catch(o){return console.error("sendSignal failed (attempt",s,"):",o),e&&(e.style.display="block",e.innerHTML=`Signaling error: ${o.message||o}. Check adblocker/firewall and allowlist this site.<small>Retrying...</small>`),s<3?(await new Promise(a=>setTimeout(a,1e3*s)),await r(s+1)):!1}};return await r(1)}async function Ou(){if(!wt)return;const n=nn(wt,"participants",Pt);try{await es(n,{username:kt},{merge:!0})}catch(t){console.error("Failed to update participant record:",t)}}async function To(n,t=!1){if(wt=nn(Ru,"calls",n),t)try{await es(wt,{createdAt:Gn()})}catch(s){console.error("Error creating call doc:",s)}try{const s=On(wt,"participants"),o=await lp(s);if(!t&&o.size>=Ri){alert("Call is full (maximum "+Ri+" participants)");return}await es(nn(wt,"participants",Pt),{username:kt,joinedAt:Gn()},{merge:!0})}catch(s){console.error("Failed to join call participants collection:",s)}const e=On(wt,"participants");bi=Vc(e,s=>{s.docChanges().forEach(async o=>{const a=o.doc.id,l=o.doc.data();if(o.type==="added"){if(a===Pt)return;P[a]=P[a]||{},P[a].username=l.username||"Guest",P[a].cameraEnabled=void 0,P[a].muted=void 0,P[a].lastAudioLevel=0,P[a].levelTs=0,P[a].makingOffer=!1,P[a].ignoreOffer=!1,P[a].polite=Pt>a,Nu(a),os(a),Pt<a?await Zs(a,!0):await Zs(a,!1),tt||(tt=a,Ct.srcObject=P[a].remoteStream,Ge.textContent=P[a].username||"Guest",Eo())}else if(o.type==="removed")Vi(a);else if(o.type==="modified"&&P[a]){P[a].username=l.username||"Guest";const h=Yn(a);if(h){const d=h.querySelector(".slot-name");d&&(d.textContent=P[a].username)}}})});const r=On(wt,"signals");Pi=Vc(r,s=>{s.docChanges().forEach(async o=>{if(o.type!=="added")return;const a=o.doc.data();if(!a||a.to!==Pt)return;const l=a.from;if(a.type==="offer"){P[l]=P[l]||{},P[l].username=P[l].username||"Guest",P[l]=P[l]||{},P[l].username=P[l].username||"Guest";const h=await Zs(l,!1),d=!!P[l].polite,p={type:"offer",sdp:a.sdp},E=P[l].makingOffer||h&&h.signalingState!=="stable";if(P[l].ignoreOffer=!d&&E,P[l].ignoreOffer){console.log("Ignoring incoming offer from",l,"due to collision and not polite");return}try{if(E&&d)try{await h.setLocalDescription({type:"rollback"})}catch{}if(await h.setRemoteDescription(new RTCSessionDescription(p)),P[l]&&P[l].pendingCandidates&&P[l].pendingCandidates.length){for(const b of P[l].pendingCandidates)try{await h.addIceCandidate(new RTCIceCandidate(b))}catch(N){console.warn("Failed applying queued candidate",N)}P[l].pendingCandidates=[]}const A=await h.createAnswer();await h.setLocalDescription(A),await Br({type:"answer",from:Pt,to:l,sdp:A.sdp})}catch(A){console.error("Failed to handle incoming offer from",l,A)}}else if(a.type==="answer"){const h=P[l]&&P[l].pc;if(P[l]&&P[l].ignoreOffer){console.log("Ignoring answer from",l,"because earlier offer was ignored");return}if(h)try{const d={type:"answer",sdp:a.sdp};if(await h.setRemoteDescription(new RTCSessionDescription(d)),P[l]&&P[l].pendingCandidates&&P[l].pendingCandidates.length){for(const p of P[l].pendingCandidates)try{await h.addIceCandidate(new RTCIceCandidate(p))}catch(E){console.warn("Failed applying queued candidate",E)}P[l].pendingCandidates=[]}}catch(d){console.error("Failed to set remote answer for",l,d)}}else if(a.type==="ice"){const h=P[l]&&P[l].pc;if(h&&a.candidate)try{!h.remoteDescription||!h.remoteDescription.type?(P[l]=P[l]||{},P[l].pendingCandidates=P[l].pendingCandidates||[],P[l].pendingCandidates.push(a.candidate)):await h.addIceCandidate(new RTCIceCandidate(a.candidate))}catch(d){console.warn("Failed to add remote ICE candidate",d)}else a.type==="left"&&(console.log("Peer left:",l),Vi(l))}})}),await Ou(),Up(),qp(),Qn.classList.add("active"),Np(),document.querySelectorAll(".thumb-slot").forEach(s=>s.classList.add("debug-mode"));try{po.classList.remove("active"),rs.classList.remove("active"),document.querySelectorAll(".thumb-slot .camera-off-overlay, .thumb-slot .muted-indicator").forEach(s=>s.classList.remove("active"))}catch{}}async function xp(){if(wt){try{await Su(On(wt,"signals"),{type:"left",from:Pt,createdAt:Gn()}),await up(nn(wt,"participants",Pt))}catch{}bi&&bi(),Pi&&Pi()}Object.keys(P).forEach(n=>Vi(n)),Op(),kp(),wt=null,jp(),$p(),Qn.classList.remove("active")}async function Zs(n,t=!1){if(!wt)throw new Error("Not in a call");if(P[n]&&P[n].pc)return P[n].pc;const e=new RTCPeerConnection(mp),r=new MediaStream;P[n]=P[n]||{},P[n].pc=e,P[n].remoteStream=r;const s=Nu(n);s&&(s.srcObject=r,Eo());try{const o=e.addTransceiver("audio",{direction:"sendrecv"}),a=e.addTransceiver("video",{direction:"sendrecv"});if(P[n].transceivers={audio:o,video:a},U){const l=U.getAudioTracks()[0],h=U.getVideoTracks()[0];try{l&&o.sender.replaceTrack(l)}catch{}try{h&&a.sender.replaceTrack(h)}catch{}}}catch{if(U){const a=U.getAudioTracks()[0],l=U.getVideoTracks()[0];if(a)try{e.addTrack(a,U)}catch{}if(l)try{e.addTrack(l,U)}catch{}}}if(t){const o=e.createDataChannel("data");P[n].dataChannel=o,Mc(o,n)}else e.ondatachannel=o=>{P[n].dataChannel=o.channel,Mc(o.channel,n)};if(e.ontrack=o=>{try{console.log("pc.ontrack",n,o.streams),o.streams&&o.streams.length?o.streams[0].getTracks().forEach(l=>r.addTrack(l)):o.track?r.addTrack(o.track):console.warn("ontrack: no streams or track present for",n,o);const a=Yn(n);if(a){const l=a.querySelector(".camera-off-overlay");l&&l.classList.remove("active"),P[n]&&(P[n].cameraEnabled=!0);const h=a.querySelector(".audio-meter");h&&(h.style.display="block")}os(n)}catch(a){console.error("ontrack handler error for",n,a)}},e.onicecandidate=({candidate:o})=>{if(o){const a=o&&typeof o.toJSON=="function"?o.toJSON():o;console.log("pc.onicecandidate -> sending ICE to",n,a),Br({type:"ice",from:Pt,to:n,candidate:a})}},e.onnegotiationneeded=async()=>{try{if(e.signalingState!=="stable"||P[n].makingOffer)return;P[n].makingOffer=!0;const o=await e.createOffer();await e.setLocalDescription(o),await Br({type:"offer",from:Pt,to:n,sdp:o.sdp})}catch(o){console.warn("Negotiation failure for",n,o),setTimeout(()=>{P[n]&&(P[n].makingOffer=!1)},500)}finally{P[n]&&(P[n].makingOffer=!1)}},e.onconnectionstatechange=()=>{console.log("pc.onconnectionstatechange",n,e.connectionState)},e.oniceconnectionstatechange=()=>{console.log("pc.oniceconnectionstatechange",n,e.iceConnectionState)},t)try{P[n].makingOffer=!0;const o=await e.createOffer();await e.setLocalDescription(o),await Br({type:"offer",from:Pt,to:n,sdp:o.sdp})}finally{P[n].makingOffer=!1}return e}function Vi(n){const t=P[n];if(t){if(t.pc)try{t.pc.close()}catch{}if(t.dataChannel)try{t.dataChannel.close()}catch{}if(t.slotIndex){const e=document.getElementById(`slot-${t.slotIndex}`);e&&(e.innerHTML="",e.classList.add("empty"))}delete P[n]}}function os(n){const t=P[n],e=Yn(n),r=tt===n;if(e){const s=e.querySelector(".camera-off-overlay"),o=e.querySelector(".muted-indicator"),a=e.querySelector(".audio-meter");let l=!1;const h=e.querySelector("video");if(h&&h.srcObject){try{const E=h.srcObject.getVideoTracks?h.srcObject.getVideoTracks():[];E.length>0&&(l=E.some(A=>A&&A.enabled!==!1))}catch{}!l&&typeof h.readyState=="number"&&(l=h.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA)}const d=!!(l||t&&t.remoteStream&&t.remoteStream.getVideoTracks().length>0);d?s&&s.classList.remove("active"):s&&s.classList.toggle("active",t&&t.cameraEnabled===!1),o&&o.classList.toggle("active",t&&t.muted===!0),a&&(a.style.display=d||t&&t.levelTs&&Date.now()-t.levelTs<3e3?"block":"none");const p=e.querySelector(".peer-debug");if(p){const E=t&&t.pc,A=t&&t.pendingCandidates?t.pendingCandidates.length:0,b=t&&t.remoteStream?t.remoteStream.getTracks().length:0,N=[];N.push(`cam:${String(t?.cameraEnabled)}`),N.push(`muted:${String(t?.muted)}`),N.push(`rTracks:${b}`),N.push(`pending:${A}`),E&&(N.push(E.signalingState||"no-signal"),N.push(E.iceConnectionState||"no-ice")),p.textContent=N.join(" | ")}}if(r){if(typeof t?.cameraEnabled=="boolean"){let s=!1;try{if(Ct&&Ct.srcObject){const o=Ct.srcObject.getVideoTracks?Ct.srcObject.getVideoTracks():[];o.length&&(s=o.some(a=>a&&a.enabled!==!1)),!s&&typeof Ct.readyState=="number"&&(s=Ct.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA)}}catch{}s?rs.classList.remove("active"):rs.classList.toggle("active",t.cameraEnabled===!1)}typeof t?.muted=="boolean"&&po.classList.toggle("active",t.muted===!0)}}async function Lp(){const n=await navigator.mediaDevices.enumerateDevices();ze.innerHTML="",Wn.innerHTML="",ns.innerHTML="",n.forEach(t=>{const e=document.createElement("option");e.value=t.deviceId,e.text=t.label||`${t.kind} ${ze.length+1}`,t.kind==="videoinput"?ze.appendChild(e):t.kind==="audioinput"?Wn.appendChild(e):t.kind==="audiooutput"&&ns.appendChild(e)})}ze.onchange=async()=>{Xn=ze.value,U&&await Mu()};Wn.onchange=async()=>{Jn=Wn.value,U&&await Mu()};ns.onchange=async()=>{if(typeof Ct.setSinkId<"u")try{await Ct.setSinkId(ns.value)}catch(n){console.error("Error setting audio output:",n)}};async function Mu(){const n={video:Xn?{deviceId:{exact:Xn}}:!0,audio:Jn?{deviceId:{exact:Jn}}:!0},t=U;U=await navigator.mediaDevices.getUserMedia(n),Cu.srcObject=U,ku(),Object.values(P).forEach(e=>{if(!e.pc)return;const r=e.pc.getSenders?e.pc.getSenders():[],s=U.getVideoTracks()[0],o=U.getAudioTracks()[0];if(e.transceivers){try{e.transceivers.audio&&o&&e.transceivers.audio.sender.replaceTrack(o)}catch{}try{e.transceivers.video&&s&&e.transceivers.video.sender.replaceTrack(s)}catch{}}if(r.forEach(a=>{a.track&&(a.track.kind==="video"&&s?a.replaceTrack(s):a.track.kind==="audio"&&o&&a.replaceTrack(o))}),r.length===0&&!e.transceivers&&U.getTracks().length>0)try{const a=U.getAudioTracks()[0],l=U.getVideoTracks()[0];a&&e.pc.addTrack(a,U),l&&e.pc.addTrack(l,U)}catch(a){console.warn("Error adding initial tracks after updateStream",a)}}),t&&t.getTracks().forEach(e=>e.stop())}Pu.onclick=()=>{Mn.classList.add("active")};gp.onclick=()=>{Mn.classList.remove("active")};Mn.onclick=n=>{n.target===Mn&&Mn.classList.remove("active")};Nc.onchange=()=>{Si=Nc.checked,Si&&xn?(Ht.classList.add("active"),ss.classList.add("active")):(Ht.classList.remove("active"),ss.classList.remove("active"))};localStorage.getItem("username")&&(kt=localStorage.getItem("username"),wi.value=kt,yo.textContent=kt);wi.oninput=()=>{kt=wi.value.trim()||"Guest",localStorage.setItem("username",kt),yo.textContent=kt,Ou(),or({type:"username",username:kt})};pp.onclick=()=>{He.classList.remove("active")};He.onclick=n=>{n.target===He&&He.classList.remove("active")};Cr.onclick=async()=>{try{const n=`${window.location.origin}${window.location.pathname}${window.location.pathname.endsWith("/"),""}?join=${ir.value}`;await navigator.clipboard.writeText(n);const t=Cr.textContent;Cr.textContent="Copied!",setTimeout(()=>{Cr.textContent=t},2e3)}catch(n){console.error("Failed to copy:",n)}};_p.onclick=()=>{const n=ir.value,t=`${window.location.origin}${window.location.pathname}${window.location.pathname.endsWith("/"),""}?join=${n}`,e=encodeURIComponent("Join my video call"),r=encodeURIComponent(`Hi,

Join my video call using this link: ${t}

Click the link and the join dialog will be pre-filled for you  no copy/paste needed.

See you soon!`);window.open(`https://mail.google.com/mail/?view=cm&fs=1&su=${e}&body=${r}`,"_blank")};yp.onclick=()=>{const n=ir.value,t=`${window.location.origin}${window.location.pathname}${window.location.pathname.endsWith("/"),""}?join=${n}`,e=encodeURIComponent("Join my video call"),r=encodeURIComponent(`Hi,

Join my video call using this link: ${t}

Click the link and the join dialog will be pre-filled for you  no copy/paste needed.

See you soon!`);window.open(`https://outlook.office.com/mail/deeplink/compose?subject=${e}&body=${r}`,"_blank")};bu.onclick=()=>{Ae.classList.add("active")};Tp.onclick=()=>{Ae.classList.remove("active")};Ae.onclick=n=>{n.target===Ae&&Ae.classList.remove("active")};function Fp(){try{const n=new URL(window.location.href).searchParams;let t=n.get("join")||n.get("call");if(!t&&window.location.hash){const e=window.location.hash.substring(1),r=new URLSearchParams(e);t=r.get("join")||r.get("call")}if(t){Ii.value=t,Ae.classList.add("active"),Ii.focus();try{window.history.replaceState({},document.title,window.location.pathname)}catch{}}}catch(n){console.warn("Failed to parse incoming join param",n)}}Fp();Qn.onclick=()=>{_o.classList.add("open"),Qn.classList.remove("has-new")};Pp.onclick=()=>{_o.classList.remove("open")};bp.onclick=()=>{Bp()};function Bp(){const n=kc.value.trim();n&&(xu(n,"sent",kt),or({type:"chat",message:n,username:kt,timestamp:Date.now()}),kc.value="")}function xu(n,t="received",e="Guest"){if(!br)return;const r=document.createElement("div");r.className=`chat-message ${t}`;const s=document.createElement("div");s.className="chat-meta",s.textContent=`${e}  ${new Date().toLocaleTimeString()}`;const o=document.createElement("div");o.className="chat-body",o.textContent=n,r.appendChild(s),r.appendChild(o),br.appendChild(r),br.scrollTop=br.scrollHeight}go.onclick=async()=>{const n=Math.random().toString(36).substring(2,12);ir.value=n,He.classList.add("active");const t=nn(Ru,"calls",n);await es(t,{createdAt:Gn()}),await To(n,!0),Kn.disabled=!1};xr.onclick=()=>{if(U){const n=U.getAudioTracks()[0];n&&(n.enabled=!n.enabled,Be=!n.enabled,xr.classList.toggle("muted",Be),xr.textContent=Be?"":"",wp.classList.toggle("active",Be),or({type:"mute",muted:Be}))}};Lr.onclick=()=>{if(U){const n=U.getVideoTracks()[0];n&&(n.enabled=!n.enabled,Pr=!n.enabled,Lr.classList.toggle("camera-off",Pr),Lr.textContent=Pr?"":"",Ip.classList.toggle("active",Pr),or({type:"camera",enabled:n.enabled}))}};Vu.onclick=()=>{document.fullscreenElement?document.exitFullscreen():vp.requestFullscreen().catch(n=>{console.error("Error attempting to enable fullscreen:",n)})};function Up(){Ai=Date.now(),Fr=setInterval(()=>{const n=Math.floor((Date.now()-Ai)/1e3),t=Math.floor(n/60),e=n%60;Du.textContent=`${String(t).padStart(2,"0")}:${String(e).padStart(2,"0")}`},1e3)}function jp(){Fr&&(clearInterval(Fr),Fr=null),Du.textContent="00:00",Ai=null}async function qp(){Si&&(Ht.classList.add("active"),ss.classList.add("active")),xn=setInterval(async()=>{if(!tt)return;const n=P[tt];if(!n||!n.pc)return;const t=await n.pc.getStats();let e=0,r=0,s=0,o=0,a=0,l=0;t.forEach(d=>{d.type==="inbound-rtp"&&(d.kind==="video"&&d.bytesReceived?e=Math.round(d.bytesReceived*8/1e3):d.kind==="audio"&&d.bytesReceived&&(r=Math.round(d.bytesReceived*8/1e3)),d.packetsLost!==void 0&&(a+=d.packetsLost),d.packetsReceived!==void 0&&(l+=d.packetsReceived)),d.type==="candidate-pair"&&d.state==="succeeded"&&d.currentRoundTripTime!==void 0&&(s=Math.round(d.currentRoundTripTime*1e3))}),l>0&&(o=Math.round(a/(a+l)*100)),Ap.textContent=`${e} kbps`,Sp.textContent=`${r} kbps`,Rp.textContent=`${s} ms`,Cp.textContent=`${o}%`;const h=Ht.querySelector(".connection-text");Ht.classList.remove("good","fair","poor"),s<150&&o<2?(Ht.classList.add("good"),h.textContent="Good"):s<300&&o<5?(Ht.classList.add("fair"),h.textContent="Fair"):(Ht.classList.add("poor"),h.textContent="Poor")},1e3)}function $p(){xn&&(clearInterval(xn),xn=null),Ht.classList.remove("active"),ss.classList.remove("active")}function Mc(n,t){n.onopen=()=>{console.log("Data channel opened for",t);try{n.send(JSON.stringify({type:"username",username:kt})),(U&&U.getVideoTracks().length?U.getVideoTracks()[0].enabled:!1)&&n.send(JSON.stringify({type:"camera",enabled:!0})),Be&&n.send(JSON.stringify({type:"mute",muted:!0})),n.send(JSON.stringify({type:"audio-level",level:je||0}))}catch{}},n.onmessage=e=>{const r=JSON.parse(e.data),s=P[t];if(r.type==="audio-level"){const a=typeof r.level=="number"?r.level:0;s&&(s.lastAudioLevel=a,s.levelTs=Date.now());const l=Yn(t);if(l){const h=l.querySelector(".audio-meter"),d=h&&h.querySelector(".level");h&&d&&(h.style.display="block",d.style.width=Math.min(100,Math.round(a*100))+"%");const p=a>is+.02;l.classList.toggle("speaking",p)}return}const o=Yn(t);if(r.type==="camera"){if(typeof r.enabled=="boolean"){if(o){const a=o.querySelector(".camera-off-overlay");a&&a.classList.toggle("active",!r.enabled)}s&&(s.cameraEnabled=!!r.enabled),os(t),t===tt&&rs.classList.toggle("active",!r.enabled)}}else if(r.type==="mute"){if(typeof r.muted=="boolean"){if(o){const a=o.querySelector(".muted-indicator");a&&a.classList.toggle("active",r.muted)}s&&(s.muted=!!r.muted),os(t),t===tt&&po.classList.toggle("active",r.muted)}}else if(r.type==="chat")xu(r.message,"received",r.username||s&&s.username||"Guest"),_o.classList.contains("open")||Qn.classList.add("has-new");else if(r.type==="username"){if(s&&(s.username=r.username||"Guest"),o){const a=o.querySelector(".slot-name");a&&(a.textContent=r.username||"Guest")}t===tt&&(Ge.textContent=r.username||"Guest")}},n.onerror=e=>{console.error("Data channel error:",e)}}const zp=document.getElementById("topThumbnails");zp?.addEventListener("click",n=>{const t=n.target.closest(".thumb-slot");if(!t)return;const e=t.querySelector("video");if(e&&e.srcObject){const r=parseInt(t.dataset.index);if(r===0)Object.keys(P).length>0?(tt=Object.keys(P)[0]||null,tt&&P[tt]&&P[tt].remoteStream&&(Ct.srcObject=P[tt].remoteStream,Ge.textContent=P[tt].username||"Guest")):(tt=null,Ct.srcObject=U,Ge.textContent=yo.textContent||"Guest");else{const s=Object.entries(P).find(([o,a])=>a.slotIndex===r);tt=s?s[0]:null}if(!(r===0&&Object.keys(P).length>0)){Ct.srcObject=e.srcObject;const s=t.querySelector(".slot-name");Ge.textContent=s?s.textContent:"Guest"}}Ci=Date.now()+3e3});Dc.onclick=async()=>{console.log("Webcam button clicked");try{console.log("Requesting media devices..."),U=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),console.log("Media devices granted:",U)}catch(e){console.error("Error accessing media devices:",e),alert("Error accessing webcam: "+e.message);return}Object.keys(P).forEach(e=>{const r=P[e];if(!r.pc)return;const s=r.pc.getSenders?r.pc.getSenders():[],o=s.some(d=>d.track&&d.track.kind==="audio"),a=s.some(d=>d.track&&d.track.kind==="video"),l=U.getAudioTracks()[0],h=U.getVideoTracks()[0];if(r.transceivers){try{r.transceivers.audio&&l&&r.transceivers.audio.sender.replaceTrack(l)}catch{}try{r.transceivers.video&&h&&r.transceivers.video.sender.replaceTrack(h)}catch{}if(!r.transceivers.audio&&!o&&l)try{r.pc.addTrack(l,U)}catch{}if(!r.transceivers.video&&!a&&h)try{r.pc.addTrack(h,U)}catch{}}else{if(!o&&l)try{r.pc.addTrack(l,U)}catch{}if(!a&&h)try{r.pc.addTrack(h,U)}catch{}}}),Cu.srcObject=U,Object.keys(P).length===0&&(Ct.srcObject=U),ku(),await Lp();const n=U.getVideoTracks()[0],t=U.getAudioTracks()[0];n&&(Xn=n.getSettings().deviceId,ze.value=Xn),t&&(Jn=t.getSettings().deviceId,Wn.value=Jn),go.disabled=!1,bu.disabled=!1,Dc.disabled=!0,Kn.disabled=!1,Pu.disabled=!1,xr.disabled=!1,Lr.disabled=!1,Vu.disabled=!1};go.onclick=async()=>{const n=Math.random().toString(36).substring(2,12);ir.value=n,He.classList.add("active"),await To(n,!0),Kn.disabled=!1};Ep.onclick=async()=>{const n=Ii.value.trim();if(!n){alert("Please enter a call ID");return}Ae.classList.remove("active"),await To(n,!1)};Kn.onclick=async()=>{await xp(),Kn.disabled=!0};
