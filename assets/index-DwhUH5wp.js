(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();const dh=()=>{};var Ea={};const Nc=function(n){const t=[];let e=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},fh=function(n){const t=[];let e=0,r=0;for(;e<n.length;){const s=n[e++];if(s<128)t[r++]=String.fromCharCode(s);else if(s>191&&s<224){const o=n[e++];t[r++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=n[e++],a=n[e++],u=n[e++],h=((s&7)<<18|(o&63)<<12|(a&63)<<6|u&63)-65536;t[r++]=String.fromCharCode(55296+(h>>10)),t[r++]=String.fromCharCode(56320+(h&1023))}else{const o=n[e++],a=n[e++];t[r++]=String.fromCharCode((s&15)<<12|(o&63)<<6|a&63)}}return t.join("")},Mc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const o=n[s],a=s+1<n.length,u=a?n[s+1]:0,h=s+2<n.length,d=h?n[s+2]:0,_=o>>2,v=(o&3)<<4|u>>4;let S=(u&15)<<2|d>>6,b=d&63;h||(b=64,a||(S=64)),r.push(e[_],e[v],e[S],e[b])}return r.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(Nc(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):fh(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const o=e[n.charAt(s++)],u=s<n.length?e[n.charAt(s)]:0;++s;const d=s<n.length?e[n.charAt(s)]:64;++s;const v=s<n.length?e[n.charAt(s)]:64;if(++s,o==null||u==null||d==null||v==null)throw new mh;const S=o<<2|u>>4;if(r.push(S),d!==64){const b=u<<4&240|d>>2;if(r.push(b),v!==64){const N=d<<6&192|v;r.push(N)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class mh extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const gh=function(n){const t=Nc(n);return Mc.encodeByteArray(t,!0)},Br=function(n){return gh(n).replace(/\./g,"")},ph=function(n){try{return Mc.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function _h(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const yh=()=>_h().__FIREBASE_DEFAULTS__,Eh=()=>{if(typeof process>"u"||typeof Ea>"u")return;const n=Ea.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Th=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=n&&ph(n[1]);return t&&JSON.parse(t)},Pi=()=>{try{return dh()||yh()||Eh()||Th()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},vh=n=>Pi()?.emulatorHosts?.[n],Ih=n=>{const t=vh(n);if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),r]:[t.substring(0,e),r]},Oc=()=>Pi()?.config;class wh{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,r)=>{e?this.reject(e):this.resolve(r),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,r))}}}function Vi(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Ah(n){return(await fetch(n,{credentials:"include"})).ok}function Sh(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e={alg:"none",type:"JWT"},r=t||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Br(JSON.stringify(e)),Br(JSON.stringify(a)),""].join(".")}const Pn={};function Rh(){const n={prod:[],emulator:[]};for(const t of Object.keys(Pn))Pn[t]?n.emulator.push(t):n.prod.push(t);return n}function Ch(n){let t=document.getElementById(n),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",n),e=!0),{created:e,element:t}}let Ta=!1;function bh(n,t){if(typeof window>"u"||typeof document>"u"||!Vi(window.location.host)||Pn[n]===t||Pn[n]||Ta)return;Pn[n]=t;function e(S){return`__firebase__banner__${S}`}const r="__firebase__banner",o=Rh().prod.length>0;function a(){const S=document.getElementById(r);S&&S.remove()}function u(S){S.style.display="flex",S.style.background="#7faaf0",S.style.position="fixed",S.style.bottom="5px",S.style.left="5px",S.style.padding=".5em",S.style.borderRadius="5px",S.style.alignItems="center"}function h(S,b){S.setAttribute("width","24"),S.setAttribute("id",b),S.setAttribute("height","24"),S.setAttribute("viewBox","0 0 24 24"),S.setAttribute("fill","none"),S.style.marginLeft="-6px"}function d(){const S=document.createElement("span");return S.style.cursor="pointer",S.style.marginLeft="16px",S.style.fontSize="24px",S.innerHTML=" &times;",S.onclick=()=>{Ta=!0,a()},S}function _(S,b){S.setAttribute("id",b),S.innerText="Learn more",S.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",S.setAttribute("target","__blank"),S.style.paddingLeft="5px",S.style.textDecoration="underline"}function v(){const S=Ch(r),b=e("text"),N=document.getElementById(b)||document.createElement("span"),x=e("learnmore"),V=document.getElementById(x)||document.createElement("a"),H=e("preprendIcon"),K=document.getElementById(H)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(S.created){const W=S.element;u(W),_(V,x);const Tt=d();h(K,H),W.append(K,N,V,Tt),document.body.appendChild(W)}o?(N.innerText="Preview backend disconnected.",K.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(K.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,N.innerText="Preview backend running in this workspace."),N.setAttribute("id",b)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",v):v()}function Ph(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Vh(){const n=Pi()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Dh(){return!Vh()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function kh(){try{return typeof indexedDB=="object"}catch{return!1}}function Nh(){return new Promise((n,t)=>{try{let e=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{t(s.error?.message||"")}}catch(e){t(e)}})}const Mh="FirebaseError";class rn extends Error{constructor(t,e,r){super(e),this.code=t,this.customData=r,this.name=Mh,Object.setPrototypeOf(this,rn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,xc.prototype.create)}}class xc{constructor(t,e,r){this.service=t,this.serviceName=e,this.errors=r}create(t,...e){const r=e[0]||{},s=`${this.service}/${t}`,o=this.errors[t],a=o?Oh(o,r):"Error",u=`${this.serviceName}: ${a} (${s}).`;return new rn(s,u,r)}}function Oh(n,t){return n.replace(xh,(e,r)=>{const s=t[r];return s!=null?String(s):`<${r}?>`})}const xh=/\{\$([^}]+)}/g;function Ur(n,t){if(n===t)return!0;const e=Object.keys(n),r=Object.keys(t);for(const s of e){if(!r.includes(s))return!1;const o=n[s],a=t[s];if(va(o)&&va(a)){if(!Ur(o,a))return!1}else if(o!==a)return!1}for(const s of r)if(!e.includes(s))return!1;return!0}function va(n){return n!==null&&typeof n=="object"}function Qe(n){return n&&n._delegate?n._delegate:n}class Ln{constructor(t,e,r){this.name=t,this.instanceFactory=e,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const Ee="[DEFAULT]";class Lh{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const r=new wh;if(this.instancesDeferred.set(e,r),this.isInitialized(e)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:e});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){const e=this.normalizeInstanceIdentifier(t?.identifier),r=t?.optional??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Bh(t))try{this.getOrInitializeService({instanceIdentifier:Ee})}catch{}for(const[e,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(e);try{const o=this.getOrInitializeService({instanceIdentifier:s});r.resolve(o)}catch{}}}}clearInstance(t=Ee){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=Ee){return this.instances.has(t)}getOptions(t=Ee){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,r=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:e});for(const[o,a]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(o);r===u&&a.resolve(s)}return s}onInit(t,e){const r=this.normalizeInstanceIdentifier(e),s=this.onInitCallbacks.get(r)??new Set;s.add(t),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&t(o,r),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const r=this.onInitCallbacks.get(e);if(r)for(const s of r)try{s(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Fh(t),options:e}),this.instances.set(t,r),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch{}return r||null}normalizeInstanceIdentifier(t=Ee){return this.component?this.component.multipleInstances?t:Ee:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Fh(n){return n===Ee?void 0:n}function Bh(n){return n.instantiationMode==="EAGER"}class Uh{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new Lh(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}var G;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(G||(G={}));const jh={debug:G.DEBUG,verbose:G.VERBOSE,info:G.INFO,warn:G.WARN,error:G.ERROR,silent:G.SILENT},qh=G.INFO,$h={[G.DEBUG]:"log",[G.VERBOSE]:"log",[G.INFO]:"info",[G.WARN]:"warn",[G.ERROR]:"error"},zh=(n,t,...e)=>{if(t<n.logLevel)return;const r=new Date().toISOString(),s=$h[t];if(s)console[s](`[${r}]  ${n.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Lc{constructor(t){this.name=t,this._logLevel=qh,this._logHandler=zh,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in G))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?jh[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,G.DEBUG,...t),this._logHandler(this,G.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,G.VERBOSE,...t),this._logHandler(this,G.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,G.INFO,...t),this._logHandler(this,G.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,G.WARN,...t),this._logHandler(this,G.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,G.ERROR,...t),this._logHandler(this,G.ERROR,...t)}}const Gh=(n,t)=>t.some(e=>n instanceof e);let Ia,wa;function Hh(){return Ia||(Ia=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Kh(){return wa||(wa=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Fc=new WeakMap,Ys=new WeakMap,Bc=new WeakMap,qs=new WeakMap,Di=new WeakMap;function Wh(n){const t=new Promise((e,r)=>{const s=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{e(ee(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",o),n.addEventListener("error",a)});return t.then(e=>{e instanceof IDBCursor&&Fc.set(e,n)}).catch(()=>{}),Di.set(t,n),t}function Qh(n){if(Ys.has(n))return;const t=new Promise((e,r)=>{const s=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{e(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});Ys.set(n,t)}let Zs={get(n,t,e){if(n instanceof IDBTransaction){if(t==="done")return Ys.get(n);if(t==="objectStoreNames")return n.objectStoreNames||Bc.get(n);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return ee(n[t])},set(n,t,e){return n[t]=e,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function Xh(n){Zs=n(Zs)}function Jh(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const r=n.call($s(this),t,...e);return Bc.set(r,t.sort?t.sort():[t]),ee(r)}:Kh().includes(n)?function(...t){return n.apply($s(this),t),ee(Fc.get(this))}:function(...t){return ee(n.apply($s(this),t))}}function Yh(n){return typeof n=="function"?Jh(n):(n instanceof IDBTransaction&&Qh(n),Gh(n,Hh())?new Proxy(n,Zs):n)}function ee(n){if(n instanceof IDBRequest)return Wh(n);if(qs.has(n))return qs.get(n);const t=Yh(n);return t!==n&&(qs.set(n,t),Di.set(t,n)),t}const $s=n=>Di.get(n);function Zh(n,t,{blocked:e,upgrade:r,blocking:s,terminated:o}={}){const a=indexedDB.open(n,t),u=ee(a);return r&&a.addEventListener("upgradeneeded",h=>{r(ee(a.result),h.oldVersion,h.newVersion,ee(a.transaction),h)}),e&&a.addEventListener("blocked",h=>e(h.oldVersion,h.newVersion,h)),u.then(h=>{o&&h.addEventListener("close",()=>o()),s&&h.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),u}const td=["get","getKey","getAll","getAllKeys","count"],ed=["put","add","delete","clear"],zs=new Map;function Aa(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(zs.get(t))return zs.get(t);const e=t.replace(/FromIndex$/,""),r=t!==e,s=ed.includes(e);if(!(e in(r?IDBIndex:IDBObjectStore).prototype)||!(s||td.includes(e)))return;const o=async function(a,...u){const h=this.transaction(a,s?"readwrite":"readonly");let d=h.store;return r&&(d=d.index(u.shift())),(await Promise.all([d[e](...u),s&&h.done]))[0]};return zs.set(t,o),o}Xh(n=>({...n,get:(t,e,r)=>Aa(t,e)||n.get(t,e,r),has:(t,e)=>!!Aa(t,e)||n.has(t,e)}));class nd{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(rd(e)){const r=e.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(e=>e).join(" ")}}function rd(n){return n.getComponent()?.type==="VERSION"}const ti="@firebase/app",Sa="0.14.6";const Gt=new Lc("@firebase/app"),sd="@firebase/app-compat",id="@firebase/analytics-compat",od="@firebase/analytics",ad="@firebase/app-check-compat",cd="@firebase/app-check",ld="@firebase/auth",ud="@firebase/auth-compat",hd="@firebase/database",dd="@firebase/data-connect",fd="@firebase/database-compat",md="@firebase/functions",gd="@firebase/functions-compat",pd="@firebase/installations",_d="@firebase/installations-compat",yd="@firebase/messaging",Ed="@firebase/messaging-compat",Td="@firebase/performance",vd="@firebase/performance-compat",Id="@firebase/remote-config",wd="@firebase/remote-config-compat",Ad="@firebase/storage",Sd="@firebase/storage-compat",Rd="@firebase/firestore",Cd="@firebase/ai",bd="@firebase/firestore-compat",Pd="firebase",Vd="12.6.0";const ei="[DEFAULT]",Dd={[ti]:"fire-core",[sd]:"fire-core-compat",[od]:"fire-analytics",[id]:"fire-analytics-compat",[cd]:"fire-app-check",[ad]:"fire-app-check-compat",[ld]:"fire-auth",[ud]:"fire-auth-compat",[hd]:"fire-rtdb",[dd]:"fire-data-connect",[fd]:"fire-rtdb-compat",[md]:"fire-fn",[gd]:"fire-fn-compat",[pd]:"fire-iid",[_d]:"fire-iid-compat",[yd]:"fire-fcm",[Ed]:"fire-fcm-compat",[Td]:"fire-perf",[vd]:"fire-perf-compat",[Id]:"fire-rc",[wd]:"fire-rc-compat",[Ad]:"fire-gcs",[Sd]:"fire-gcs-compat",[Rd]:"fire-fst",[bd]:"fire-fst-compat",[Cd]:"fire-vertex","fire-js":"fire-js",[Pd]:"fire-js-all"};const jr=new Map,kd=new Map,ni=new Map;function Ra(n,t){try{n.container.addComponent(t)}catch(e){Gt.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,e)}}function qr(n){const t=n.name;if(ni.has(t))return Gt.debug(`There were multiple attempts to register component ${t}.`),!1;ni.set(t,n);for(const e of jr.values())Ra(e,n);for(const e of kd.values())Ra(e,n);return!0}function Nd(n,t){const e=n.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),n.container.getProvider(t)}function Md(n){return n==null?!1:n.settings!==void 0}const Od={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ne=new xc("app","Firebase",Od);class xd{constructor(t,e,r){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Ln("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ne.create("app-deleted",{appName:this._name})}}const Ld=Vd;function Uc(n,t={}){let e=n;typeof t!="object"&&(t={name:t});const r={name:ei,automaticDataCollectionEnabled:!0,...t},s=r.name;if(typeof s!="string"||!s)throw ne.create("bad-app-name",{appName:String(s)});if(e||(e=Oc()),!e)throw ne.create("no-options");const o=jr.get(s);if(o){if(Ur(e,o.options)&&Ur(r,o.config))return o;throw ne.create("duplicate-app",{appName:s})}const a=new Uh(s);for(const h of ni.values())a.addComponent(h);const u=new xd(e,r,a);return jr.set(s,u),u}function Fd(n=ei){const t=jr.get(n);if(!t&&n===ei&&Oc())return Uc();if(!t)throw ne.create("no-app",{appName:n});return t}function qe(n,t,e){let r=Dd[n]??n;e&&(r+=`-${e}`);const s=r.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const a=[`Unable to register library "${r}" with version "${t}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Gt.warn(a.join(" "));return}qr(new Ln(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}const Bd="firebase-heartbeat-database",Ud=1,Fn="firebase-heartbeat-store";let Gs=null;function jc(){return Gs||(Gs=Zh(Bd,Ud,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(Fn)}catch(e){console.warn(e)}}}}).catch(n=>{throw ne.create("idb-open",{originalErrorMessage:n.message})})),Gs}async function jd(n){try{const e=(await jc()).transaction(Fn),r=await e.objectStore(Fn).get(qc(n));return await e.done,r}catch(t){if(t instanceof rn)Gt.warn(t.message);else{const e=ne.create("idb-get",{originalErrorMessage:t?.message});Gt.warn(e.message)}}}async function Ca(n,t){try{const r=(await jc()).transaction(Fn,"readwrite");await r.objectStore(Fn).put(t,qc(n)),await r.done}catch(e){if(e instanceof rn)Gt.warn(e.message);else{const r=ne.create("idb-set",{originalErrorMessage:e?.message});Gt.warn(r.message)}}}function qc(n){return`${n.name}!${n.options.appId}`}const qd=1024,$d=30;class zd{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Hd(e),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=ba();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:e}),this._heartbeatsCache.heartbeats.length>$d){const s=Kd(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){Gt.warn(t)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=ba(),{heartbeatsToSend:e,unsentEntries:r}=Gd(this._heartbeatsCache.heartbeats),s=Br(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return Gt.warn(t),""}}}function ba(){return new Date().toISOString().substring(0,10)}function Gd(n,t=qd){const e=[];let r=n.slice();for(const s of n){const o=e.find(a=>a.agent===s.agent);if(o){if(o.dates.push(s.date),Pa(e)>t){o.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),Pa(e)>t){e.pop();break}r=r.slice(1)}return{heartbeatsToSend:e,unsentEntries:r}}class Hd{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return kh()?Nh().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await jd(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const r=await this.read();return Ca(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const r=await this.read();return Ca(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...t.heartbeats]})}else return}}function Pa(n){return Br(JSON.stringify({version:2,heartbeats:n})).length}function Kd(n){if(n.length===0)return-1;let t=0,e=n[0].date;for(let r=1;r<n.length;r++)n[r].date<e&&(e=n[r].date,t=r);return t}function Wd(n){qr(new Ln("platform-logger",t=>new nd(t),"PRIVATE")),qr(new Ln("heartbeat",t=>new zd(t),"PRIVATE")),qe(ti,Sa,n),qe(ti,Sa,"esm2020"),qe("fire-js","")}Wd("");var Qd="firebase",Xd="12.6.0";qe(Qd,Xd,"app");var Va=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var re,$c;(function(){var n;function t(E,m){function p(){}p.prototype=m.prototype,E.F=m.prototype,E.prototype=new p,E.prototype.constructor=E,E.D=function(T,y,w){for(var g=Array(arguments.length-2),St=2;St<arguments.length;St++)g[St-2]=arguments[St];return m.prototype[y].apply(T,g)}}function e(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}t(r,e),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(E,m,p){p||(p=0);const T=Array(16);if(typeof m=="string")for(var y=0;y<16;++y)T[y]=m.charCodeAt(p++)|m.charCodeAt(p++)<<8|m.charCodeAt(p++)<<16|m.charCodeAt(p++)<<24;else for(y=0;y<16;++y)T[y]=m[p++]|m[p++]<<8|m[p++]<<16|m[p++]<<24;m=E.g[0],p=E.g[1],y=E.g[2];let w=E.g[3],g;g=m+(w^p&(y^w))+T[0]+3614090360&4294967295,m=p+(g<<7&4294967295|g>>>25),g=w+(y^m&(p^y))+T[1]+3905402710&4294967295,w=m+(g<<12&4294967295|g>>>20),g=y+(p^w&(m^p))+T[2]+606105819&4294967295,y=w+(g<<17&4294967295|g>>>15),g=p+(m^y&(w^m))+T[3]+3250441966&4294967295,p=y+(g<<22&4294967295|g>>>10),g=m+(w^p&(y^w))+T[4]+4118548399&4294967295,m=p+(g<<7&4294967295|g>>>25),g=w+(y^m&(p^y))+T[5]+1200080426&4294967295,w=m+(g<<12&4294967295|g>>>20),g=y+(p^w&(m^p))+T[6]+2821735955&4294967295,y=w+(g<<17&4294967295|g>>>15),g=p+(m^y&(w^m))+T[7]+4249261313&4294967295,p=y+(g<<22&4294967295|g>>>10),g=m+(w^p&(y^w))+T[8]+1770035416&4294967295,m=p+(g<<7&4294967295|g>>>25),g=w+(y^m&(p^y))+T[9]+2336552879&4294967295,w=m+(g<<12&4294967295|g>>>20),g=y+(p^w&(m^p))+T[10]+4294925233&4294967295,y=w+(g<<17&4294967295|g>>>15),g=p+(m^y&(w^m))+T[11]+2304563134&4294967295,p=y+(g<<22&4294967295|g>>>10),g=m+(w^p&(y^w))+T[12]+1804603682&4294967295,m=p+(g<<7&4294967295|g>>>25),g=w+(y^m&(p^y))+T[13]+4254626195&4294967295,w=m+(g<<12&4294967295|g>>>20),g=y+(p^w&(m^p))+T[14]+2792965006&4294967295,y=w+(g<<17&4294967295|g>>>15),g=p+(m^y&(w^m))+T[15]+1236535329&4294967295,p=y+(g<<22&4294967295|g>>>10),g=m+(y^w&(p^y))+T[1]+4129170786&4294967295,m=p+(g<<5&4294967295|g>>>27),g=w+(p^y&(m^p))+T[6]+3225465664&4294967295,w=m+(g<<9&4294967295|g>>>23),g=y+(m^p&(w^m))+T[11]+643717713&4294967295,y=w+(g<<14&4294967295|g>>>18),g=p+(w^m&(y^w))+T[0]+3921069994&4294967295,p=y+(g<<20&4294967295|g>>>12),g=m+(y^w&(p^y))+T[5]+3593408605&4294967295,m=p+(g<<5&4294967295|g>>>27),g=w+(p^y&(m^p))+T[10]+38016083&4294967295,w=m+(g<<9&4294967295|g>>>23),g=y+(m^p&(w^m))+T[15]+3634488961&4294967295,y=w+(g<<14&4294967295|g>>>18),g=p+(w^m&(y^w))+T[4]+3889429448&4294967295,p=y+(g<<20&4294967295|g>>>12),g=m+(y^w&(p^y))+T[9]+568446438&4294967295,m=p+(g<<5&4294967295|g>>>27),g=w+(p^y&(m^p))+T[14]+3275163606&4294967295,w=m+(g<<9&4294967295|g>>>23),g=y+(m^p&(w^m))+T[3]+4107603335&4294967295,y=w+(g<<14&4294967295|g>>>18),g=p+(w^m&(y^w))+T[8]+1163531501&4294967295,p=y+(g<<20&4294967295|g>>>12),g=m+(y^w&(p^y))+T[13]+2850285829&4294967295,m=p+(g<<5&4294967295|g>>>27),g=w+(p^y&(m^p))+T[2]+4243563512&4294967295,w=m+(g<<9&4294967295|g>>>23),g=y+(m^p&(w^m))+T[7]+1735328473&4294967295,y=w+(g<<14&4294967295|g>>>18),g=p+(w^m&(y^w))+T[12]+2368359562&4294967295,p=y+(g<<20&4294967295|g>>>12),g=m+(p^y^w)+T[5]+4294588738&4294967295,m=p+(g<<4&4294967295|g>>>28),g=w+(m^p^y)+T[8]+2272392833&4294967295,w=m+(g<<11&4294967295|g>>>21),g=y+(w^m^p)+T[11]+1839030562&4294967295,y=w+(g<<16&4294967295|g>>>16),g=p+(y^w^m)+T[14]+4259657740&4294967295,p=y+(g<<23&4294967295|g>>>9),g=m+(p^y^w)+T[1]+2763975236&4294967295,m=p+(g<<4&4294967295|g>>>28),g=w+(m^p^y)+T[4]+1272893353&4294967295,w=m+(g<<11&4294967295|g>>>21),g=y+(w^m^p)+T[7]+4139469664&4294967295,y=w+(g<<16&4294967295|g>>>16),g=p+(y^w^m)+T[10]+3200236656&4294967295,p=y+(g<<23&4294967295|g>>>9),g=m+(p^y^w)+T[13]+681279174&4294967295,m=p+(g<<4&4294967295|g>>>28),g=w+(m^p^y)+T[0]+3936430074&4294967295,w=m+(g<<11&4294967295|g>>>21),g=y+(w^m^p)+T[3]+3572445317&4294967295,y=w+(g<<16&4294967295|g>>>16),g=p+(y^w^m)+T[6]+76029189&4294967295,p=y+(g<<23&4294967295|g>>>9),g=m+(p^y^w)+T[9]+3654602809&4294967295,m=p+(g<<4&4294967295|g>>>28),g=w+(m^p^y)+T[12]+3873151461&4294967295,w=m+(g<<11&4294967295|g>>>21),g=y+(w^m^p)+T[15]+530742520&4294967295,y=w+(g<<16&4294967295|g>>>16),g=p+(y^w^m)+T[2]+3299628645&4294967295,p=y+(g<<23&4294967295|g>>>9),g=m+(y^(p|~w))+T[0]+4096336452&4294967295,m=p+(g<<6&4294967295|g>>>26),g=w+(p^(m|~y))+T[7]+1126891415&4294967295,w=m+(g<<10&4294967295|g>>>22),g=y+(m^(w|~p))+T[14]+2878612391&4294967295,y=w+(g<<15&4294967295|g>>>17),g=p+(w^(y|~m))+T[5]+4237533241&4294967295,p=y+(g<<21&4294967295|g>>>11),g=m+(y^(p|~w))+T[12]+1700485571&4294967295,m=p+(g<<6&4294967295|g>>>26),g=w+(p^(m|~y))+T[3]+2399980690&4294967295,w=m+(g<<10&4294967295|g>>>22),g=y+(m^(w|~p))+T[10]+4293915773&4294967295,y=w+(g<<15&4294967295|g>>>17),g=p+(w^(y|~m))+T[1]+2240044497&4294967295,p=y+(g<<21&4294967295|g>>>11),g=m+(y^(p|~w))+T[8]+1873313359&4294967295,m=p+(g<<6&4294967295|g>>>26),g=w+(p^(m|~y))+T[15]+4264355552&4294967295,w=m+(g<<10&4294967295|g>>>22),g=y+(m^(w|~p))+T[6]+2734768916&4294967295,y=w+(g<<15&4294967295|g>>>17),g=p+(w^(y|~m))+T[13]+1309151649&4294967295,p=y+(g<<21&4294967295|g>>>11),g=m+(y^(p|~w))+T[4]+4149444226&4294967295,m=p+(g<<6&4294967295|g>>>26),g=w+(p^(m|~y))+T[11]+3174756917&4294967295,w=m+(g<<10&4294967295|g>>>22),g=y+(m^(w|~p))+T[2]+718787259&4294967295,y=w+(g<<15&4294967295|g>>>17),g=p+(w^(y|~m))+T[9]+3951481745&4294967295,E.g[0]=E.g[0]+m&4294967295,E.g[1]=E.g[1]+(y+(g<<21&4294967295|g>>>11))&4294967295,E.g[2]=E.g[2]+y&4294967295,E.g[3]=E.g[3]+w&4294967295}r.prototype.v=function(E,m){m===void 0&&(m=E.length);const p=m-this.blockSize,T=this.C;let y=this.h,w=0;for(;w<m;){if(y==0)for(;w<=p;)s(this,E,w),w+=this.blockSize;if(typeof E=="string"){for(;w<m;)if(T[y++]=E.charCodeAt(w++),y==this.blockSize){s(this,T),y=0;break}}else for(;w<m;)if(T[y++]=E[w++],y==this.blockSize){s(this,T),y=0;break}}this.h=y,this.o+=m},r.prototype.A=function(){var E=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);E[0]=128;for(var m=1;m<E.length-8;++m)E[m]=0;m=this.o*8;for(var p=E.length-8;p<E.length;++p)E[p]=m&255,m/=256;for(this.v(E),E=Array(16),m=0,p=0;p<4;++p)for(let T=0;T<32;T+=8)E[m++]=this.g[p]>>>T&255;return E};function o(E,m){var p=u;return Object.prototype.hasOwnProperty.call(p,E)?p[E]:p[E]=m(E)}function a(E,m){this.h=m;const p=[];let T=!0;for(let y=E.length-1;y>=0;y--){const w=E[y]|0;T&&w==m||(p[y]=w,T=!1)}this.g=p}var u={};function h(E){return-128<=E&&E<128?o(E,function(m){return new a([m|0],m<0?-1:0)}):new a([E|0],E<0?-1:0)}function d(E){if(isNaN(E)||!isFinite(E))return v;if(E<0)return V(d(-E));const m=[];let p=1;for(let T=0;E>=p;T++)m[T]=E/p|0,p*=4294967296;return new a(m,0)}function _(E,m){if(E.length==0)throw Error("number format error: empty string");if(m=m||10,m<2||36<m)throw Error("radix out of range: "+m);if(E.charAt(0)=="-")return V(_(E.substring(1),m));if(E.indexOf("-")>=0)throw Error('number format error: interior "-" character');const p=d(Math.pow(m,8));let T=v;for(let w=0;w<E.length;w+=8){var y=Math.min(8,E.length-w);const g=parseInt(E.substring(w,w+y),m);y<8?(y=d(Math.pow(m,y)),T=T.j(y).add(d(g))):(T=T.j(p),T=T.add(d(g)))}return T}var v=h(0),S=h(1),b=h(16777216);n=a.prototype,n.m=function(){if(x(this))return-V(this).m();let E=0,m=1;for(let p=0;p<this.g.length;p++){const T=this.i(p);E+=(T>=0?T:4294967296+T)*m,m*=4294967296}return E},n.toString=function(E){if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(N(this))return"0";if(x(this))return"-"+V(this).toString(E);const m=d(Math.pow(E,6));var p=this;let T="";for(;;){const y=Tt(p,m).g;p=H(p,y.j(m));let w=((p.g.length>0?p.g[0]:p.h)>>>0).toString(E);if(p=y,N(p))return w+T;for(;w.length<6;)w="0"+w;T=w+T}},n.i=function(E){return E<0?0:E<this.g.length?this.g[E]:this.h};function N(E){if(E.h!=0)return!1;for(let m=0;m<E.g.length;m++)if(E.g[m]!=0)return!1;return!0}function x(E){return E.h==-1}n.l=function(E){return E=H(this,E),x(E)?-1:N(E)?0:1};function V(E){const m=E.g.length,p=[];for(let T=0;T<m;T++)p[T]=~E.g[T];return new a(p,~E.h).add(S)}n.abs=function(){return x(this)?V(this):this},n.add=function(E){const m=Math.max(this.g.length,E.g.length),p=[];let T=0;for(let y=0;y<=m;y++){let w=T+(this.i(y)&65535)+(E.i(y)&65535),g=(w>>>16)+(this.i(y)>>>16)+(E.i(y)>>>16);T=g>>>16,w&=65535,g&=65535,p[y]=g<<16|w}return new a(p,p[p.length-1]&-2147483648?-1:0)};function H(E,m){return E.add(V(m))}n.j=function(E){if(N(this)||N(E))return v;if(x(this))return x(E)?V(this).j(V(E)):V(V(this).j(E));if(x(E))return V(this.j(V(E)));if(this.l(b)<0&&E.l(b)<0)return d(this.m()*E.m());const m=this.g.length+E.g.length,p=[];for(var T=0;T<2*m;T++)p[T]=0;for(T=0;T<this.g.length;T++)for(let y=0;y<E.g.length;y++){const w=this.i(T)>>>16,g=this.i(T)&65535,St=E.i(y)>>>16,fe=E.i(y)&65535;p[2*T+2*y]+=g*fe,K(p,2*T+2*y),p[2*T+2*y+1]+=w*fe,K(p,2*T+2*y+1),p[2*T+2*y+1]+=g*St,K(p,2*T+2*y+1),p[2*T+2*y+2]+=w*St,K(p,2*T+2*y+2)}for(E=0;E<m;E++)p[E]=p[2*E+1]<<16|p[2*E];for(E=m;E<2*m;E++)p[E]=0;return new a(p,0)};function K(E,m){for(;(E[m]&65535)!=E[m];)E[m+1]+=E[m]>>>16,E[m]&=65535,m++}function W(E,m){this.g=E,this.h=m}function Tt(E,m){if(N(m))throw Error("division by zero");if(N(E))return new W(v,v);if(x(E))return m=Tt(V(E),m),new W(V(m.g),V(m.h));if(x(m))return m=Tt(E,V(m)),new W(V(m.g),m.h);if(E.g.length>30){if(x(E)||x(m))throw Error("slowDivide_ only works with positive integers.");for(var p=S,T=m;T.l(E)<=0;)p=At(p),T=At(T);var y=ut(p,1),w=ut(T,1);for(T=ut(T,2),p=ut(p,2);!N(T);){var g=w.add(T);g.l(E)<=0&&(y=y.add(p),w=g),T=ut(T,1),p=ut(p,1)}return m=H(E,y.j(m)),new W(y,m)}for(y=v;E.l(m)>=0;){for(p=Math.max(1,Math.floor(E.m()/m.m())),T=Math.ceil(Math.log(p)/Math.LN2),T=T<=48?1:Math.pow(2,T-48),w=d(p),g=w.j(m);x(g)||g.l(E)>0;)p-=T,w=d(p),g=w.j(m);N(w)&&(w=S),y=y.add(w),E=H(E,g)}return new W(y,E)}n.B=function(E){return Tt(this,E).h},n.and=function(E){const m=Math.max(this.g.length,E.g.length),p=[];for(let T=0;T<m;T++)p[T]=this.i(T)&E.i(T);return new a(p,this.h&E.h)},n.or=function(E){const m=Math.max(this.g.length,E.g.length),p=[];for(let T=0;T<m;T++)p[T]=this.i(T)|E.i(T);return new a(p,this.h|E.h)},n.xor=function(E){const m=Math.max(this.g.length,E.g.length),p=[];for(let T=0;T<m;T++)p[T]=this.i(T)^E.i(T);return new a(p,this.h^E.h)};function At(E){const m=E.g.length+1,p=[];for(let T=0;T<m;T++)p[T]=E.i(T)<<1|E.i(T-1)>>>31;return new a(p,E.h)}function ut(E,m){const p=m>>5;m%=32;const T=E.g.length-p,y=[];for(let w=0;w<T;w++)y[w]=m>0?E.i(w+p)>>>m|E.i(w+p+1)<<32-m:E.i(w+p);return new a(y,E.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,$c=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=_,re=a}).apply(typeof Va<"u"?Va:typeof self<"u"?self:typeof window<"u"?window:{});var vr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var zc,Sn,Gc,Pr,ri,Hc,Kc,Wc;(function(){var n,t=Object.defineProperty;function e(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof vr=="object"&&vr];for(var c=0;c<i.length;++c){var l=i[c];if(l&&l.Math==Math)return l}throw Error("Cannot find global object")}var r=e(this);function s(i,c){if(c)t:{var l=r;i=i.split(".");for(var f=0;f<i.length-1;f++){var I=i[f];if(!(I in l))break t;l=l[I]}i=i[i.length-1],f=l[i],c=c(f),c!=f&&c!=null&&t(l,i,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(i){return i||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(i){return i||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(i){return i||function(c){var l=[],f;for(f in c)Object.prototype.hasOwnProperty.call(c,f)&&l.push([f,c[f]]);return l}});var o=o||{},a=this||self;function u(i){var c=typeof i;return c=="object"&&i!=null||c=="function"}function h(i,c,l){return i.call.apply(i.bind,arguments)}function d(i,c,l){return d=h,d.apply(null,arguments)}function _(i,c){var l=Array.prototype.slice.call(arguments,1);return function(){var f=l.slice();return f.push.apply(f,arguments),i.apply(this,f)}}function v(i,c){function l(){}l.prototype=c.prototype,i.Z=c.prototype,i.prototype=new l,i.prototype.constructor=i,i.Ob=function(f,I,A){for(var P=Array(arguments.length-2),j=2;j<arguments.length;j++)P[j-2]=arguments[j];return c.prototype[I].apply(f,P)}}var S=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?i=>i&&AsyncContext.Snapshot.wrap(i):i=>i;function b(i){const c=i.length;if(c>0){const l=Array(c);for(let f=0;f<c;f++)l[f]=i[f];return l}return[]}function N(i,c){for(let f=1;f<arguments.length;f++){const I=arguments[f];var l=typeof I;if(l=l!="object"?l:I?Array.isArray(I)?"array":l:"null",l=="array"||l=="object"&&typeof I.length=="number"){l=i.length||0;const A=I.length||0;i.length=l+A;for(let P=0;P<A;P++)i[l+P]=I[P]}else i.push(I)}}class x{constructor(c,l){this.i=c,this.j=l,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function V(i){a.setTimeout(()=>{throw i},0)}function H(){var i=E;let c=null;return i.g&&(c=i.g,i.g=i.g.next,i.g||(i.h=null),c.next=null),c}class K{constructor(){this.h=this.g=null}add(c,l){const f=W.get();f.set(c,l),this.h?this.h.next=f:this.g=f,this.h=f}}var W=new x(()=>new Tt,i=>i.reset());class Tt{constructor(){this.next=this.g=this.h=null}set(c,l){this.h=c,this.g=l,this.next=null}reset(){this.next=this.g=this.h=null}}let At,ut=!1,E=new K,m=()=>{const i=Promise.resolve(void 0);At=()=>{i.then(p)}};function p(){for(var i;i=H();){try{i.h.call(i.g)}catch(l){V(l)}var c=W;c.j(i),c.h<100&&(c.h++,i.next=c.g,c.g=i)}ut=!1}function T(){this.u=this.u,this.C=this.C}T.prototype.u=!1,T.prototype.dispose=function(){this.u||(this.u=!0,this.N())},T.prototype[Symbol.dispose]=function(){this.dispose()},T.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function y(i,c){this.type=i,this.g=this.target=c,this.defaultPrevented=!1}y.prototype.h=function(){this.defaultPrevented=!0};var w=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var i=!1,c=Object.defineProperty({},"passive",{get:function(){i=!0}});try{const l=()=>{};a.addEventListener("test",l,c),a.removeEventListener("test",l,c)}catch{}return i})();function g(i){return/^[\s\xa0]*$/.test(i)}function St(i,c){y.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i&&this.init(i,c)}v(St,y),St.prototype.init=function(i,c){const l=this.type=i.type,f=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;this.target=i.target||i.srcElement,this.g=c,c=i.relatedTarget,c||(l=="mouseover"?c=i.fromElement:l=="mouseout"&&(c=i.toElement)),this.relatedTarget=c,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=i.pointerType,this.state=i.state,this.i=i,i.defaultPrevented&&St.Z.h.call(this)},St.prototype.h=function(){St.Z.h.call(this);const i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var fe="closure_listenable_"+(Math.random()*1e6|0),Mu=0;function Ou(i,c,l,f,I){this.listener=i,this.proxy=null,this.src=c,this.type=l,this.capture=!!f,this.ha=I,this.key=++Mu,this.da=this.fa=!1}function or(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function ar(i,c,l){for(const f in i)c.call(l,i[f],f,i)}function xu(i,c){for(const l in i)c.call(void 0,i[l],l,i)}function yo(i){const c={};for(const l in i)c[l]=i[l];return c}const Eo="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function To(i,c){let l,f;for(let I=1;I<arguments.length;I++){f=arguments[I];for(l in f)i[l]=f[l];for(let A=0;A<Eo.length;A++)l=Eo[A],Object.prototype.hasOwnProperty.call(f,l)&&(i[l]=f[l])}}function cr(i){this.src=i,this.g={},this.h=0}cr.prototype.add=function(i,c,l,f,I){const A=i.toString();i=this.g[A],i||(i=this.g[A]=[],this.h++);const P=Es(i,c,f,I);return P>-1?(c=i[P],l||(c.fa=!1)):(c=new Ou(c,this.src,A,!!f,I),c.fa=l,i.push(c)),c};function ys(i,c){const l=c.type;if(l in i.g){var f=i.g[l],I=Array.prototype.indexOf.call(f,c,void 0),A;(A=I>=0)&&Array.prototype.splice.call(f,I,1),A&&(or(c),i.g[l].length==0&&(delete i.g[l],i.h--))}}function Es(i,c,l,f){for(let I=0;I<i.length;++I){const A=i[I];if(!A.da&&A.listener==c&&A.capture==!!l&&A.ha==f)return I}return-1}var Ts="closure_lm_"+(Math.random()*1e6|0),vs={};function vo(i,c,l,f,I){if(Array.isArray(c)){for(let A=0;A<c.length;A++)vo(i,c[A],l,f,I);return null}return l=Ao(l),i&&i[fe]?i.J(c,l,u(f)?!!f.capture:!1,I):Lu(i,c,l,!1,f,I)}function Lu(i,c,l,f,I,A){if(!c)throw Error("Invalid event type");const P=u(I)?!!I.capture:!!I;let j=ws(i);if(j||(i[Ts]=j=new cr(i)),l=j.add(c,l,f,P,A),l.proxy)return l;if(f=Fu(),l.proxy=f,f.src=i,f.listener=l,i.addEventListener)w||(I=P),I===void 0&&(I=!1),i.addEventListener(c.toString(),f,I);else if(i.attachEvent)i.attachEvent(wo(c.toString()),f);else if(i.addListener&&i.removeListener)i.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return l}function Fu(){function i(l){return c.call(i.src,i.listener,l)}const c=Bu;return i}function Io(i,c,l,f,I){if(Array.isArray(c))for(var A=0;A<c.length;A++)Io(i,c[A],l,f,I);else f=u(f)?!!f.capture:!!f,l=Ao(l),i&&i[fe]?(i=i.i,A=String(c).toString(),A in i.g&&(c=i.g[A],l=Es(c,l,f,I),l>-1&&(or(c[l]),Array.prototype.splice.call(c,l,1),c.length==0&&(delete i.g[A],i.h--)))):i&&(i=ws(i))&&(c=i.g[c.toString()],i=-1,c&&(i=Es(c,l,f,I)),(l=i>-1?c[i]:null)&&Is(l))}function Is(i){if(typeof i!="number"&&i&&!i.da){var c=i.src;if(c&&c[fe])ys(c.i,i);else{var l=i.type,f=i.proxy;c.removeEventListener?c.removeEventListener(l,f,i.capture):c.detachEvent?c.detachEvent(wo(l),f):c.addListener&&c.removeListener&&c.removeListener(f),(l=ws(c))?(ys(l,i),l.h==0&&(l.src=null,c[Ts]=null)):or(i)}}}function wo(i){return i in vs?vs[i]:vs[i]="on"+i}function Bu(i,c){if(i.da)i=!0;else{c=new St(c,this);const l=i.listener,f=i.ha||i.src;i.fa&&Is(i),i=l.call(f,c)}return i}function ws(i){return i=i[Ts],i instanceof cr?i:null}var As="__closure_events_fn_"+(Math.random()*1e9>>>0);function Ao(i){return typeof i=="function"?i:(i[As]||(i[As]=function(c){return i.handleEvent(c)}),i[As])}function pt(){T.call(this),this.i=new cr(this),this.M=this,this.G=null}v(pt,T),pt.prototype[fe]=!0,pt.prototype.removeEventListener=function(i,c,l,f){Io(this,i,c,l,f)};function vt(i,c){var l,f=i.G;if(f)for(l=[];f;f=f.G)l.push(f);if(i=i.M,f=c.type||c,typeof c=="string")c=new y(c,i);else if(c instanceof y)c.target=c.target||i;else{var I=c;c=new y(f,i),To(c,I)}I=!0;let A,P;if(l)for(P=l.length-1;P>=0;P--)A=c.g=l[P],I=lr(A,f,!0,c)&&I;if(A=c.g=i,I=lr(A,f,!0,c)&&I,I=lr(A,f,!1,c)&&I,l)for(P=0;P<l.length;P++)A=c.g=l[P],I=lr(A,f,!1,c)&&I}pt.prototype.N=function(){if(pt.Z.N.call(this),this.i){var i=this.i;for(const c in i.g){const l=i.g[c];for(let f=0;f<l.length;f++)or(l[f]);delete i.g[c],i.h--}}this.G=null},pt.prototype.J=function(i,c,l,f){return this.i.add(String(i),c,!1,l,f)},pt.prototype.K=function(i,c,l,f){return this.i.add(String(i),c,!0,l,f)};function lr(i,c,l,f){if(c=i.i.g[String(c)],!c)return!0;c=c.concat();let I=!0;for(let A=0;A<c.length;++A){const P=c[A];if(P&&!P.da&&P.capture==l){const j=P.listener,ot=P.ha||P.src;P.fa&&ys(i.i,P),I=j.call(ot,f)!==!1&&I}}return I&&!f.defaultPrevented}function Uu(i,c){if(typeof i!="function")if(i&&typeof i.handleEvent=="function")i=d(i.handleEvent,i);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(i,c||0)}function So(i){i.g=Uu(()=>{i.g=null,i.i&&(i.i=!1,So(i))},i.l);const c=i.h;i.h=null,i.m.apply(null,c)}class ju extends T{constructor(c,l){super(),this.m=c,this.l=l,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:So(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ln(i){T.call(this),this.h=i,this.g={}}v(ln,T);var Ro=[];function Co(i){ar(i.g,function(c,l){this.g.hasOwnProperty(l)&&Is(c)},i),i.g={}}ln.prototype.N=function(){ln.Z.N.call(this),Co(this)},ln.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ss=a.JSON.stringify,qu=a.JSON.parse,$u=class{stringify(i){return a.JSON.stringify(i,void 0)}parse(i){return a.JSON.parse(i,void 0)}};function bo(){}function Po(){}var un={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Rs(){y.call(this,"d")}v(Rs,y);function Cs(){y.call(this,"c")}v(Cs,y);var me={},Vo=null;function ur(){return Vo=Vo||new pt}me.Ia="serverreachability";function Do(i){y.call(this,me.Ia,i)}v(Do,y);function hn(i){const c=ur();vt(c,new Do(c))}me.STAT_EVENT="statevent";function ko(i,c){y.call(this,me.STAT_EVENT,i),this.stat=c}v(ko,y);function It(i){const c=ur();vt(c,new ko(c,i))}me.Ja="timingevent";function No(i,c){y.call(this,me.Ja,i),this.size=c}v(No,y);function dn(i,c){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){i()},c)}function fn(){this.g=!0}fn.prototype.ua=function(){this.g=!1};function zu(i,c,l,f,I,A){i.info(function(){if(i.g)if(A){var P="",j=A.split("&");for(let X=0;X<j.length;X++){var ot=j[X].split("=");if(ot.length>1){const ht=ot[0];ot=ot[1];const Ot=ht.split("_");P=Ot.length>=2&&Ot[1]=="type"?P+(ht+"="+ot+"&"):P+(ht+"=redacted&")}}}else P=null;else P=A;return"XMLHTTP REQ ("+f+") [attempt "+I+"]: "+c+`
`+l+`
`+P})}function Gu(i,c,l,f,I,A,P){i.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+I+"]: "+c+`
`+l+`
`+A+" "+P})}function ke(i,c,l,f){i.info(function(){return"XMLHTTP TEXT ("+c+"): "+Ku(i,l)+(f?" "+f:"")})}function Hu(i,c){i.info(function(){return"TIMEOUT: "+c})}fn.prototype.info=function(){};function Ku(i,c){if(!i.g)return c;if(!c)return null;try{const A=JSON.parse(c);if(A){for(i=0;i<A.length;i++)if(Array.isArray(A[i])){var l=A[i];if(!(l.length<2)){var f=l[1];if(Array.isArray(f)&&!(f.length<1)){var I=f[0];if(I!="noop"&&I!="stop"&&I!="close")for(let P=1;P<f.length;P++)f[P]=""}}}}return Ss(A)}catch{return c}}var hr={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Mo={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},Oo;function bs(){}v(bs,bo),bs.prototype.g=function(){return new XMLHttpRequest},Oo=new bs;function mn(i){return encodeURIComponent(String(i))}function Wu(i){var c=1;i=i.split(":");const l=[];for(;c>0&&i.length;)l.push(i.shift()),c--;return i.length&&l.push(i.join(":")),l}function Wt(i,c,l,f){this.j=i,this.i=c,this.l=l,this.S=f||1,this.V=new ln(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new xo}function xo(){this.i=null,this.g="",this.h=!1}var Lo={},Ps={};function Vs(i,c,l){i.M=1,i.A=fr(Mt(c)),i.u=l,i.R=!0,Fo(i,null)}function Fo(i,c){i.F=Date.now(),dr(i),i.B=Mt(i.A);var l=i.B,f=i.S;Array.isArray(f)||(f=[String(f)]),Jo(l.i,"t",f),i.C=0,l=i.j.L,i.h=new xo,i.g=ga(i.j,l?c:null,!i.u),i.P>0&&(i.O=new ju(d(i.Y,i,i.g),i.P)),c=i.V,l=i.g,f=i.ba;var I="readystatechange";Array.isArray(I)||(I&&(Ro[0]=I.toString()),I=Ro);for(let A=0;A<I.length;A++){const P=vo(l,I[A],f||c.handleEvent,!1,c.h||c);if(!P)break;c.g[P.key]=P}c=i.J?yo(i.J):{},i.u?(i.v||(i.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.B,i.v,i.u,c)):(i.v="GET",i.g.ea(i.B,i.v,null,c)),hn(),zu(i.i,i.v,i.B,i.l,i.S,i.u)}Wt.prototype.ba=function(i){i=i.target;const c=this.O;c&&Jt(i)==3?c.j():this.Y(i)},Wt.prototype.Y=function(i){try{if(i==this.g)t:{const j=Jt(this.g),ot=this.g.ya(),X=this.g.ca();if(!(j<3)&&(j!=3||this.g&&(this.h.h||this.g.la()||sa(this.g)))){this.K||j!=4||ot==7||(ot==8||X<=0?hn(3):hn(2)),Ds(this);var c=this.g.ca();this.X=c;var l=Qu(this);if(this.o=c==200,Gu(this.i,this.v,this.B,this.l,this.S,j,c),this.o){if(this.U&&!this.L){e:{if(this.g){var f,I=this.g;if((f=I.g?I.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!g(f)){var A=f;break e}}A=null}if(i=A)ke(this.i,this.l,i,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ks(this,i);else{this.o=!1,this.m=3,It(12),ge(this),gn(this);break t}}if(this.R){i=!0;let ht;for(;!this.K&&this.C<l.length;)if(ht=Xu(this,l),ht==Ps){j==4&&(this.m=4,It(14),i=!1),ke(this.i,this.l,null,"[Incomplete Response]");break}else if(ht==Lo){this.m=4,It(15),ke(this.i,this.l,l,"[Invalid Chunk]"),i=!1;break}else ke(this.i,this.l,ht,null),ks(this,ht);if(Bo(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),j!=4||l.length!=0||this.h.h||(this.m=1,It(16),i=!1),this.o=this.o&&i,!i)ke(this.i,this.l,l,"[Invalid Chunked Response]"),ge(this),gn(this);else if(l.length>0&&!this.W){this.W=!0;var P=this.j;P.g==this&&P.aa&&!P.P&&(P.j.info("Great, no buffering proxy detected. Bytes received: "+l.length),Us(P),P.P=!0,It(11))}}else ke(this.i,this.l,l,null),ks(this,l);j==4&&ge(this),this.o&&!this.K&&(j==4?ha(this.j,this):(this.o=!1,dr(this)))}else uh(this.g),c==400&&l.indexOf("Unknown SID")>0?(this.m=3,It(12)):(this.m=0,It(13)),ge(this),gn(this)}}}catch{}finally{}};function Qu(i){if(!Bo(i))return i.g.la();const c=sa(i.g);if(c==="")return"";let l="";const f=c.length,I=Jt(i.g)==4;if(!i.h.i){if(typeof TextDecoder>"u")return ge(i),gn(i),"";i.h.i=new a.TextDecoder}for(let A=0;A<f;A++)i.h.h=!0,l+=i.h.i.decode(c[A],{stream:!(I&&A==f-1)});return c.length=0,i.h.g+=l,i.C=0,i.h.g}function Bo(i){return i.g?i.v=="GET"&&i.M!=2&&i.j.Aa:!1}function Xu(i,c){var l=i.C,f=c.indexOf(`
`,l);return f==-1?Ps:(l=Number(c.substring(l,f)),isNaN(l)?Lo:(f+=1,f+l>c.length?Ps:(c=c.slice(f,f+l),i.C=f+l,c)))}Wt.prototype.cancel=function(){this.K=!0,ge(this)};function dr(i){i.T=Date.now()+i.H,Uo(i,i.H)}function Uo(i,c){if(i.D!=null)throw Error("WatchDog timer not null");i.D=dn(d(i.aa,i),c)}function Ds(i){i.D&&(a.clearTimeout(i.D),i.D=null)}Wt.prototype.aa=function(){this.D=null;const i=Date.now();i-this.T>=0?(Hu(this.i,this.B),this.M!=2&&(hn(),It(17)),ge(this),this.m=2,gn(this)):Uo(this,this.T-i)};function gn(i){i.j.I==0||i.K||ha(i.j,i)}function ge(i){Ds(i);var c=i.O;c&&typeof c.dispose=="function"&&c.dispose(),i.O=null,Co(i.V),i.g&&(c=i.g,i.g=null,c.abort(),c.dispose())}function ks(i,c){try{var l=i.j;if(l.I!=0&&(l.g==i||Ns(l.h,i))){if(!i.L&&Ns(l.h,i)&&l.I==3){try{var f=l.Ba.g.parse(c)}catch{f=null}if(Array.isArray(f)&&f.length==3){var I=f;if(I[0]==0){t:if(!l.v){if(l.g)if(l.g.F+3e3<i.F)yr(l),pr(l);else break t;Bs(l),It(18)}}else l.xa=I[1],0<l.xa-l.K&&I[2]<37500&&l.F&&l.A==0&&!l.C&&(l.C=dn(d(l.Va,l),6e3));$o(l.h)<=1&&l.ta&&(l.ta=void 0)}else _e(l,11)}else if((i.L||l.g==i)&&yr(l),!g(c))for(I=l.Ba.g.parse(c),c=0;c<I.length;c++){let X=I[c];const ht=X[0];if(!(ht<=l.K))if(l.K=ht,X=X[1],l.I==2)if(X[0]=="c"){l.M=X[1],l.ba=X[2];const Ot=X[3];Ot!=null&&(l.ka=Ot,l.j.info("VER="+l.ka));const ye=X[4];ye!=null&&(l.za=ye,l.j.info("SVER="+l.za));const Yt=X[5];Yt!=null&&typeof Yt=="number"&&Yt>0&&(f=1.5*Yt,l.O=f,l.j.info("backChannelRequestTimeoutMs_="+f)),f=l;const Zt=i.g;if(Zt){const Tr=Zt.g?Zt.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Tr){var A=f.h;A.g||Tr.indexOf("spdy")==-1&&Tr.indexOf("quic")==-1&&Tr.indexOf("h2")==-1||(A.j=A.l,A.g=new Set,A.h&&(Ms(A,A.h),A.h=null))}if(f.G){const js=Zt.g?Zt.g.getResponseHeader("X-HTTP-Session-Id"):null;js&&(f.wa=js,J(f.J,f.G,js))}}l.I=3,l.l&&l.l.ra(),l.aa&&(l.T=Date.now()-i.F,l.j.info("Handshake RTT: "+l.T+"ms")),f=l;var P=i;if(f.na=ma(f,f.L?f.ba:null,f.W),P.L){zo(f.h,P);var j=P,ot=f.O;ot&&(j.H=ot),j.D&&(Ds(j),dr(j)),f.g=P}else la(f);l.i.length>0&&_r(l)}else X[0]!="stop"&&X[0]!="close"||_e(l,7);else l.I==3&&(X[0]=="stop"||X[0]=="close"?X[0]=="stop"?_e(l,7):Fs(l):X[0]!="noop"&&l.l&&l.l.qa(X),l.A=0)}}hn(4)}catch{}}var Ju=class{constructor(i,c){this.g=i,this.map=c}};function jo(i){this.l=i||10,a.PerformanceNavigationTiming?(i=a.performance.getEntriesByType("navigation"),i=i.length>0&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function qo(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function $o(i){return i.h?1:i.g?i.g.size:0}function Ns(i,c){return i.h?i.h==c:i.g?i.g.has(c):!1}function Ms(i,c){i.g?i.g.add(c):i.h=c}function zo(i,c){i.h&&i.h==c?i.h=null:i.g&&i.g.has(c)&&i.g.delete(c)}jo.prototype.cancel=function(){if(this.i=Go(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function Go(i){if(i.h!=null)return i.i.concat(i.h.G);if(i.g!=null&&i.g.size!==0){let c=i.i;for(const l of i.g.values())c=c.concat(l.G);return c}return b(i.i)}var Ho=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Yu(i,c){if(i){i=i.split("&");for(let l=0;l<i.length;l++){const f=i[l].indexOf("=");let I,A=null;f>=0?(I=i[l].substring(0,f),A=i[l].substring(f+1)):I=i[l],c(I,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function Qt(i){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;i instanceof Qt?(this.l=i.l,pn(this,i.j),this.o=i.o,this.g=i.g,_n(this,i.u),this.h=i.h,Os(this,Yo(i.i)),this.m=i.m):i&&(c=String(i).match(Ho))?(this.l=!1,pn(this,c[1]||"",!0),this.o=yn(c[2]||""),this.g=yn(c[3]||"",!0),_n(this,c[4]),this.h=yn(c[5]||"",!0),Os(this,c[6]||"",!0),this.m=yn(c[7]||"")):(this.l=!1,this.i=new Tn(null,this.l))}Qt.prototype.toString=function(){const i=[];var c=this.j;c&&i.push(En(c,Ko,!0),":");var l=this.g;return(l||c=="file")&&(i.push("//"),(c=this.o)&&i.push(En(c,Ko,!0),"@"),i.push(mn(l).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l=this.u,l!=null&&i.push(":",String(l))),(l=this.h)&&(this.g&&l.charAt(0)!="/"&&i.push("/"),i.push(En(l,l.charAt(0)=="/"?eh:th,!0))),(l=this.i.toString())&&i.push("?",l),(l=this.m)&&i.push("#",En(l,rh)),i.join("")},Qt.prototype.resolve=function(i){const c=Mt(this);let l=!!i.j;l?pn(c,i.j):l=!!i.o,l?c.o=i.o:l=!!i.g,l?c.g=i.g:l=i.u!=null;var f=i.h;if(l)_n(c,i.u);else if(l=!!i.h){if(f.charAt(0)!="/")if(this.g&&!this.h)f="/"+f;else{var I=c.h.lastIndexOf("/");I!=-1&&(f=c.h.slice(0,I+1)+f)}if(I=f,I==".."||I==".")f="";else if(I.indexOf("./")!=-1||I.indexOf("/.")!=-1){f=I.lastIndexOf("/",0)==0,I=I.split("/");const A=[];for(let P=0;P<I.length;){const j=I[P++];j=="."?f&&P==I.length&&A.push(""):j==".."?((A.length>1||A.length==1&&A[0]!="")&&A.pop(),f&&P==I.length&&A.push("")):(A.push(j),f=!0)}f=A.join("/")}else f=I}return l?c.h=f:l=i.i.toString()!=="",l?Os(c,Yo(i.i)):l=!!i.m,l&&(c.m=i.m),c};function Mt(i){return new Qt(i)}function pn(i,c,l){i.j=l?yn(c,!0):c,i.j&&(i.j=i.j.replace(/:$/,""))}function _n(i,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);i.u=c}else i.u=null}function Os(i,c,l){c instanceof Tn?(i.i=c,sh(i.i,i.l)):(l||(c=En(c,nh)),i.i=new Tn(c,i.l))}function J(i,c,l){i.i.set(c,l)}function fr(i){return J(i,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),i}function yn(i,c){return i?c?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function En(i,c,l){return typeof i=="string"?(i=encodeURI(i).replace(c,Zu),l&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function Zu(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var Ko=/[#\/\?@]/g,th=/[#\?:]/g,eh=/[#\?]/g,nh=/[#\?@]/g,rh=/#/g;function Tn(i,c){this.h=this.g=null,this.i=i||null,this.j=!!c}function pe(i){i.g||(i.g=new Map,i.h=0,i.i&&Yu(i.i,function(c,l){i.add(decodeURIComponent(c.replace(/\+/g," ")),l)}))}n=Tn.prototype,n.add=function(i,c){pe(this),this.i=null,i=Ne(this,i);let l=this.g.get(i);return l||this.g.set(i,l=[]),l.push(c),this.h+=1,this};function Wo(i,c){pe(i),c=Ne(i,c),i.g.has(c)&&(i.i=null,i.h-=i.g.get(c).length,i.g.delete(c))}function Qo(i,c){return pe(i),c=Ne(i,c),i.g.has(c)}n.forEach=function(i,c){pe(this),this.g.forEach(function(l,f){l.forEach(function(I){i.call(c,I,f,this)},this)},this)};function Xo(i,c){pe(i);let l=[];if(typeof c=="string")Qo(i,c)&&(l=l.concat(i.g.get(Ne(i,c))));else for(i=Array.from(i.g.values()),c=0;c<i.length;c++)l=l.concat(i[c]);return l}n.set=function(i,c){return pe(this),this.i=null,i=Ne(this,i),Qo(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[c]),this.h+=1,this},n.get=function(i,c){return i?(i=Xo(this,i),i.length>0?String(i[0]):c):c};function Jo(i,c,l){Wo(i,c),l.length>0&&(i.i=null,i.g.set(Ne(i,c),b(l)),i.h+=l.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],c=Array.from(this.g.keys());for(let f=0;f<c.length;f++){var l=c[f];const I=mn(l);l=Xo(this,l);for(let A=0;A<l.length;A++){let P=I;l[A]!==""&&(P+="="+mn(l[A])),i.push(P)}}return this.i=i.join("&")};function Yo(i){const c=new Tn;return c.i=i.i,i.g&&(c.g=new Map(i.g),c.h=i.h),c}function Ne(i,c){return c=String(c),i.j&&(c=c.toLowerCase()),c}function sh(i,c){c&&!i.j&&(pe(i),i.i=null,i.g.forEach(function(l,f){const I=f.toLowerCase();f!=I&&(Wo(this,f),Jo(this,I,l))},i)),i.j=c}function ih(i,c){const l=new fn;if(a.Image){const f=new Image;f.onload=_(Xt,l,"TestLoadImage: loaded",!0,c,f),f.onerror=_(Xt,l,"TestLoadImage: error",!1,c,f),f.onabort=_(Xt,l,"TestLoadImage: abort",!1,c,f),f.ontimeout=_(Xt,l,"TestLoadImage: timeout",!1,c,f),a.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=i}else c(!1)}function oh(i,c){const l=new fn,f=new AbortController,I=setTimeout(()=>{f.abort(),Xt(l,"TestPingServer: timeout",!1,c)},1e4);fetch(i,{signal:f.signal}).then(A=>{clearTimeout(I),A.ok?Xt(l,"TestPingServer: ok",!0,c):Xt(l,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(I),Xt(l,"TestPingServer: error",!1,c)})}function Xt(i,c,l,f,I){try{I&&(I.onload=null,I.onerror=null,I.onabort=null,I.ontimeout=null),f(l)}catch{}}function ah(){this.g=new $u}function xs(i){this.i=i.Sb||null,this.h=i.ab||!1}v(xs,bo),xs.prototype.g=function(){return new mr(this.i,this.h)};function mr(i,c){pt.call(this),this.H=i,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}v(mr,pt),n=mr.prototype,n.open=function(i,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=i,this.D=c,this.readyState=1,In(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};i&&(c.body=i),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,vn(this)),this.readyState=0},n.Pa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,In(this)),this.g&&(this.readyState=3,In(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Zo(this)}else i.text().then(this.Oa.bind(this),this.ga.bind(this))};function Zo(i){i.j.read().then(i.Ma.bind(i)).catch(i.ga.bind(i))}n.Ma=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var c=i.value?i.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!i.done}))&&(this.response=this.responseText+=c)}i.done?vn(this):In(this),this.readyState==3&&Zo(this)}},n.Oa=function(i){this.g&&(this.response=this.responseText=i,vn(this))},n.Na=function(i){this.g&&(this.response=i,vn(this))},n.ga=function(){this.g&&vn(this)};function vn(i){i.readyState=4,i.l=null,i.j=null,i.B=null,In(i)}n.setRequestHeader=function(i,c){this.A.append(i,c)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],c=this.h.entries();for(var l=c.next();!l.done;)l=l.value,i.push(l[0]+": "+l[1]),l=c.next();return i.join(`\r
`)};function In(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(mr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function ta(i){let c="";return ar(i,function(l,f){c+=f,c+=":",c+=l,c+=`\r
`}),c}function Ls(i,c,l){t:{for(f in l){var f=!1;break t}f=!0}f||(l=ta(l),typeof i=="string"?l!=null&&mn(l):J(i,c,l))}function et(i){pt.call(this),this.headers=new Map,this.L=i||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}v(et,pt);var ch=/^https?$/i,lh=["POST","PUT"];n=et.prototype,n.Fa=function(i){this.H=i},n.ea=function(i,c,l,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);c=c?c.toUpperCase():"GET",this.D=i,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Oo.g(),this.g.onreadystatechange=S(d(this.Ca,this));try{this.B=!0,this.g.open(c,String(i),!0),this.B=!1}catch(A){ea(this,A);return}if(i=l||"",l=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var I in f)l.set(I,f[I]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(const A of f.keys())l.set(A,f.get(A));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(l.keys()).find(A=>A.toLowerCase()=="content-type"),I=a.FormData&&i instanceof a.FormData,!(Array.prototype.indexOf.call(lh,c,void 0)>=0)||f||I||l.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[A,P]of l)this.g.setRequestHeader(A,P);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(i),this.v=!1}catch(A){ea(this,A)}};function ea(i,c){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=c,i.o=5,na(i),gr(i)}function na(i){i.A||(i.A=!0,vt(i,"complete"),vt(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=i||7,vt(this,"complete"),vt(this,"abort"),gr(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),gr(this,!0)),et.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?ra(this):this.Xa())},n.Xa=function(){ra(this)};function ra(i){if(i.h&&typeof o<"u"){if(i.v&&Jt(i)==4)setTimeout(i.Ca.bind(i),0);else if(vt(i,"readystatechange"),Jt(i)==4){i.h=!1;try{const A=i.ca();t:switch(A){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break t;default:c=!1}var l;if(!(l=c)){var f;if(f=A===0){let P=String(i.D).match(Ho)[1]||null;!P&&a.self&&a.self.location&&(P=a.self.location.protocol.slice(0,-1)),f=!ch.test(P?P.toLowerCase():"")}l=f}if(l)vt(i,"complete"),vt(i,"success");else{i.o=6;try{var I=Jt(i)>2?i.g.statusText:""}catch{I=""}i.l=I+" ["+i.ca()+"]",na(i)}}finally{gr(i)}}}}function gr(i,c){if(i.g){i.m&&(clearTimeout(i.m),i.m=null);const l=i.g;i.g=null,c||vt(i,"ready");try{l.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Jt(i){return i.g?i.g.readyState:0}n.ca=function(){try{return Jt(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(i){if(this.g){var c=this.g.responseText;return i&&c.indexOf(i)==0&&(c=c.substring(i.length)),qu(c)}};function sa(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.F){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function uh(i){const c={};i=(i.g&&Jt(i)>=2&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<i.length;f++){if(g(i[f]))continue;var l=Wu(i[f]);const I=l[0];if(l=l[1],typeof l!="string")continue;l=l.trim();const A=c[I]||[];c[I]=A,A.push(l)}xu(c,function(f){return f.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function wn(i,c,l){return l&&l.internalChannelParams&&l.internalChannelParams[i]||c}function ia(i){this.za=0,this.i=[],this.j=new fn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=wn("failFast",!1,i),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=wn("baseRetryDelayMs",5e3,i),this.Za=wn("retryDelaySeedMs",1e4,i),this.Ta=wn("forwardChannelMaxRetries",2,i),this.va=wn("forwardChannelRequestTimeoutMs",2e4,i),this.ma=i&&i.xmlHttpFactory||void 0,this.Ua=i&&i.Rb||void 0,this.Aa=i&&i.useFetchStreams||!1,this.O=void 0,this.L=i&&i.supportsCrossDomainXhr||!1,this.M="",this.h=new jo(i&&i.concurrentRequestLimit),this.Ba=new ah,this.S=i&&i.fastHandshake||!1,this.R=i&&i.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=i&&i.Pb||!1,i&&i.ua&&this.j.ua(),i&&i.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&i&&i.detectBufferingProxy||!1,this.ia=void 0,i&&i.longPollingTimeout&&i.longPollingTimeout>0&&(this.ia=i.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=ia.prototype,n.ka=8,n.I=1,n.connect=function(i,c,l,f){It(0),this.W=i,this.H=c||{},l&&f!==void 0&&(this.H.OSID=l,this.H.OAID=f),this.F=this.X,this.J=ma(this,null,this.W),_r(this)};function Fs(i){if(oa(i),i.I==3){var c=i.V++,l=Mt(i.J);if(J(l,"SID",i.M),J(l,"RID",c),J(l,"TYPE","terminate"),An(i,l),c=new Wt(i,i.j,c),c.M=2,c.A=fr(Mt(l)),l=!1,a.navigator&&a.navigator.sendBeacon)try{l=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!l&&a.Image&&(new Image().src=c.A,l=!0),l||(c.g=ga(c.j,null),c.g.ea(c.A)),c.F=Date.now(),dr(c)}fa(i)}function pr(i){i.g&&(Us(i),i.g.cancel(),i.g=null)}function oa(i){pr(i),i.v&&(a.clearTimeout(i.v),i.v=null),yr(i),i.h.cancel(),i.m&&(typeof i.m=="number"&&a.clearTimeout(i.m),i.m=null)}function _r(i){if(!qo(i.h)&&!i.m){i.m=!0;var c=i.Ea;At||m(),ut||(At(),ut=!0),E.add(c,i),i.D=0}}function hh(i,c){return $o(i.h)>=i.h.j-(i.m?1:0)?!1:i.m?(i.i=c.G.concat(i.i),!0):i.I==1||i.I==2||i.D>=(i.Sa?0:i.Ta)?!1:(i.m=dn(d(i.Ea,i,c),da(i,i.D)),i.D++,!0)}n.Ea=function(i){if(this.m)if(this.m=null,this.I==1){if(!i){this.V=Math.floor(Math.random()*1e5),i=this.V++;const I=new Wt(this,this.j,i);let A=this.o;if(this.U&&(A?(A=yo(A),To(A,this.U)):A=this.U),this.u!==null||this.R||(I.J=A,A=null),this.S)t:{for(var c=0,l=0;l<this.i.length;l++){e:{var f=this.i[l];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break e}f=void 0}if(f===void 0)break;if(c+=f,c>4096){c=l;break t}if(c===4096||l===this.i.length-1){c=l+1;break t}}c=1e3}else c=1e3;c=ca(this,I,c),l=Mt(this.J),J(l,"RID",i),J(l,"CVER",22),this.G&&J(l,"X-HTTP-Session-Id",this.G),An(this,l),A&&(this.R?c="headers="+mn(ta(A))+"&"+c:this.u&&Ls(l,this.u,A)),Ms(this.h,I),this.Ra&&J(l,"TYPE","init"),this.S?(J(l,"$req",c),J(l,"SID","null"),I.U=!0,Vs(I,l,null)):Vs(I,l,c),this.I=2}}else this.I==3&&(i?aa(this,i):this.i.length==0||qo(this.h)||aa(this))};function aa(i,c){var l;c?l=c.l:l=i.V++;const f=Mt(i.J);J(f,"SID",i.M),J(f,"RID",l),J(f,"AID",i.K),An(i,f),i.u&&i.o&&Ls(f,i.u,i.o),l=new Wt(i,i.j,l,i.D+1),i.u===null&&(l.J=i.o),c&&(i.i=c.G.concat(i.i)),c=ca(i,l,1e3),l.H=Math.round(i.va*.5)+Math.round(i.va*.5*Math.random()),Ms(i.h,l),Vs(l,f,c)}function An(i,c){i.H&&ar(i.H,function(l,f){J(c,f,l)}),i.l&&ar({},function(l,f){J(c,f,l)})}function ca(i,c,l){l=Math.min(i.i.length,l);const f=i.l?d(i.l.Ka,i.l,i):null;t:{var I=i.i;let j=-1;for(;;){const ot=["count="+l];j==-1?l>0?(j=I[0].g,ot.push("ofs="+j)):j=0:ot.push("ofs="+j);let X=!0;for(let ht=0;ht<l;ht++){var A=I[ht].g;const Ot=I[ht].map;if(A-=j,A<0)j=Math.max(0,I[ht].g-100),X=!1;else try{A="req"+A+"_"||"";try{var P=Ot instanceof Map?Ot:Object.entries(Ot);for(const[ye,Yt]of P){let Zt=Yt;u(Yt)&&(Zt=Ss(Yt)),ot.push(A+ye+"="+encodeURIComponent(Zt))}}catch(ye){throw ot.push(A+"type="+encodeURIComponent("_badmap")),ye}}catch{f&&f(Ot)}}if(X){P=ot.join("&");break t}}P=void 0}return i=i.i.splice(0,l),c.G=i,P}function la(i){if(!i.g&&!i.v){i.Y=1;var c=i.Da;At||m(),ut||(At(),ut=!0),E.add(c,i),i.A=0}}function Bs(i){return i.g||i.v||i.A>=3?!1:(i.Y++,i.v=dn(d(i.Da,i),da(i,i.A)),i.A++,!0)}n.Da=function(){if(this.v=null,ua(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var i=4*this.T;this.j.info("BP detection timer enabled: "+i),this.B=dn(d(this.Wa,this),i)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,It(10),pr(this),ua(this))};function Us(i){i.B!=null&&(a.clearTimeout(i.B),i.B=null)}function ua(i){i.g=new Wt(i,i.j,"rpc",i.Y),i.u===null&&(i.g.J=i.o),i.g.P=0;var c=Mt(i.na);J(c,"RID","rpc"),J(c,"SID",i.M),J(c,"AID",i.K),J(c,"CI",i.F?"0":"1"),!i.F&&i.ia&&J(c,"TO",i.ia),J(c,"TYPE","xmlhttp"),An(i,c),i.u&&i.o&&Ls(c,i.u,i.o),i.O&&(i.g.H=i.O);var l=i.g;i=i.ba,l.M=1,l.A=fr(Mt(c)),l.u=null,l.R=!0,Fo(l,i)}n.Va=function(){this.C!=null&&(this.C=null,pr(this),Bs(this),It(19))};function yr(i){i.C!=null&&(a.clearTimeout(i.C),i.C=null)}function ha(i,c){var l=null;if(i.g==c){yr(i),Us(i),i.g=null;var f=2}else if(Ns(i.h,c))l=c.G,zo(i.h,c),f=1;else return;if(i.I!=0){if(c.o)if(f==1){l=c.u?c.u.length:0,c=Date.now()-c.F;var I=i.D;f=ur(),vt(f,new No(f,l)),_r(i)}else la(i);else if(I=c.m,I==3||I==0&&c.X>0||!(f==1&&hh(i,c)||f==2&&Bs(i)))switch(l&&l.length>0&&(c=i.h,c.i=c.i.concat(l)),I){case 1:_e(i,5);break;case 4:_e(i,10);break;case 3:_e(i,6);break;default:_e(i,2)}}}function da(i,c){let l=i.Qa+Math.floor(Math.random()*i.Za);return i.isActive()||(l*=2),l*c}function _e(i,c){if(i.j.info("Error code "+c),c==2){var l=d(i.bb,i),f=i.Ua;const I=!f;f=new Qt(f||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||pn(f,"https"),fr(f),I?ih(f.toString(),l):oh(f.toString(),l)}else It(2);i.I=0,i.l&&i.l.pa(c),fa(i),oa(i)}n.bb=function(i){i?(this.j.info("Successfully pinged google.com"),It(2)):(this.j.info("Failed to ping google.com"),It(1))};function fa(i){if(i.I=0,i.ja=[],i.l){const c=Go(i.h);(c.length!=0||i.i.length!=0)&&(N(i.ja,c),N(i.ja,i.i),i.h.i.length=0,b(i.i),i.i.length=0),i.l.oa()}}function ma(i,c,l){var f=l instanceof Qt?Mt(l):new Qt(l);if(f.g!="")c&&(f.g=c+"."+f.g),_n(f,f.u);else{var I=a.location;f=I.protocol,c=c?c+"."+I.hostname:I.hostname,I=+I.port;const A=new Qt(null);f&&pn(A,f),c&&(A.g=c),I&&_n(A,I),l&&(A.h=l),f=A}return l=i.G,c=i.wa,l&&c&&J(f,l,c),J(f,"VER",i.ka),An(i,f),f}function ga(i,c,l){if(c&&!i.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=i.Aa&&!i.ma?new et(new xs({ab:l})):new et(i.ma),c.Fa(i.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function pa(){}n=pa.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Er(){}Er.prototype.g=function(i,c){return new Ct(i,c)};function Ct(i,c){pt.call(this),this.g=new ia(c),this.l=i,this.h=c&&c.messageUrlParams||null,i=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(i?i["X-WebChannel-Content-Type"]=c.messageContentType:i={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(i?i["X-WebChannel-Client-Profile"]=c.sa:i={"X-WebChannel-Client-Profile":c.sa}),this.g.U=i,(i=c&&c.Qb)&&!g(i)&&(this.g.u=i),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!g(c)&&(this.g.G=c,i=this.h,i!==null&&c in i&&(i=this.h,c in i&&delete i[c])),this.j=new Me(this)}v(Ct,pt),Ct.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Ct.prototype.close=function(){Fs(this.g)},Ct.prototype.o=function(i){var c=this.g;if(typeof i=="string"){var l={};l.__data__=i,i=l}else this.v&&(l={},l.__data__=Ss(i),i=l);c.i.push(new Ju(c.Ya++,i)),c.I==3&&_r(c)},Ct.prototype.N=function(){this.g.l=null,delete this.j,Fs(this.g),delete this.g,Ct.Z.N.call(this)};function _a(i){Rs.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var c=i.__sm__;if(c){t:{for(const l in c){i=l;break t}i=void 0}(this.i=i)&&(i=this.i,c=c!==null&&i in c?c[i]:void 0),this.data=c}else this.data=i}v(_a,Rs);function ya(){Cs.call(this),this.status=1}v(ya,Cs);function Me(i){this.g=i}v(Me,pa),Me.prototype.ra=function(){vt(this.g,"a")},Me.prototype.qa=function(i){vt(this.g,new _a(i))},Me.prototype.pa=function(i){vt(this.g,new ya)},Me.prototype.oa=function(){vt(this.g,"b")},Er.prototype.createWebChannel=Er.prototype.g,Ct.prototype.send=Ct.prototype.o,Ct.prototype.open=Ct.prototype.m,Ct.prototype.close=Ct.prototype.close,Wc=function(){return new Er},Kc=function(){return ur()},Hc=me,ri={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},hr.NO_ERROR=0,hr.TIMEOUT=8,hr.HTTP_ERROR=6,Pr=hr,Mo.COMPLETE="complete",Gc=Mo,Po.EventType=un,un.OPEN="a",un.CLOSE="b",un.ERROR="c",un.MESSAGE="d",pt.prototype.listen=pt.prototype.J,Sn=Po,et.prototype.listenOnce=et.prototype.K,et.prototype.getLastError=et.prototype.Ha,et.prototype.getLastErrorCode=et.prototype.ya,et.prototype.getStatus=et.prototype.ca,et.prototype.getResponseJson=et.prototype.La,et.prototype.getResponseText=et.prototype.la,et.prototype.send=et.prototype.ea,et.prototype.setWithCredentials=et.prototype.Fa,zc=et}).apply(typeof vr<"u"?vr:typeof self<"u"?self:typeof window<"u"?window:{});const Da="@firebase/firestore",ka="4.9.2";class yt{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}yt.UNAUTHENTICATED=new yt(null),yt.GOOGLE_CREDENTIALS=new yt("google-credentials-uid"),yt.FIRST_PARTY=new yt("first-party-uid"),yt.MOCK_USER=new yt("mock-user");let sn="12.3.0";const Se=new Lc("@firebase/firestore");function Oe(){return Se.logLevel}function D(n,...t){if(Se.logLevel<=G.DEBUG){const e=t.map(ki);Se.debug(`Firestore (${sn}): ${n}`,...e)}}function Ht(n,...t){if(Se.logLevel<=G.ERROR){const e=t.map(ki);Se.error(`Firestore (${sn}): ${n}`,...e)}}function Xe(n,...t){if(Se.logLevel<=G.WARN){const e=t.map(ki);Se.warn(`Firestore (${sn}): ${n}`,...e)}}function ki(n){if(typeof n=="string")return n;try{return(function(e){return JSON.stringify(e)})(n)}catch{return n}}function L(n,t,e){let r="Unexpected state";typeof t=="string"?r=t:e=t,Qc(n,r,e)}function Qc(n,t,e){let r=`FIRESTORE (${sn}) INTERNAL ASSERTION FAILED: ${t} (ID: ${n.toString(16)})`;if(e!==void 0)try{r+=" CONTEXT: "+JSON.stringify(e)}catch{r+=" CONTEXT: "+e}throw Ht(r),new Error(r)}function Q(n,t,e,r){let s="Unexpected state";typeof e=="string"?s=e:r=e,n||Qc(t,s,r)}function B(n,t){return n}const C={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class k extends rn{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class se{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Xc{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Jd{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(yt.UNAUTHENTICATED)))}shutdown(){}}class Yd{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class Zd{constructor(t){this.t=t,this.currentUser=yt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){Q(this.o===void 0,42304);let r=this.i;const s=h=>this.i!==r?(r=this.i,e(h)):Promise.resolve();let o=new se;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new se,t.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const h=o;t.enqueueRetryable((async()=>{await h.promise,await s(this.currentUser)}))},u=h=>{D("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((h=>u(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?u(h):(D("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new se)}}),0),a()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((r=>this.i!==t?(D("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Q(typeof r.accessToken=="string",31837,{l:r}),new Xc(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return Q(t===null||typeof t=="string",2055,{h:t}),new yt(t)}}class tf{constructor(t,e,r){this.P=t,this.T=e,this.I=r,this.type="FirstParty",this.user=yt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class ef{constructor(t,e,r){this.P=t,this.T=e,this.I=r}getToken(){return Promise.resolve(new tf(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable((()=>e(yt.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Na{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class nf{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Md(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){Q(this.o===void 0,3512);const r=o=>{o.error!=null&&D("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,D("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(o.token):Promise.resolve()};this.o=o=>{t.enqueueRetryable((()=>r(o)))};const s=o=>{D("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>s(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):D("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Na(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((e=>e?(Q(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new Na(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function rf(n){const t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let r=0;r<n;r++)e[r]=Math.floor(256*Math.random());return e}class Ni{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=rf(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<e&&(r+=t.charAt(s[o]%62))}return r}}function q(n,t){return n<t?-1:n>t?1:0}function si(n,t){const e=Math.min(n.length,t.length);for(let r=0;r<e;r++){const s=n.charAt(r),o=t.charAt(r);if(s!==o)return Hs(s)===Hs(o)?q(s,o):Hs(s)?1:-1}return q(n.length,t.length)}const sf=55296,of=57343;function Hs(n){const t=n.charCodeAt(0);return t>=sf&&t<=of}function Je(n,t,e){return n.length===t.length&&n.every(((r,s)=>e(r,t[s])))}const Ma="__name__";class xt{constructor(t,e,r){e===void 0?e=0:e>t.length&&L(637,{offset:e,range:t.length}),r===void 0?r=t.length-e:r>t.length-e&&L(1746,{length:r,range:t.length-e}),this.segments=t,this.offset=e,this.len=r}get length(){return this.len}isEqual(t){return xt.comparator(this,t)===0}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof xt?t.forEach((r=>{e.push(r)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,r=this.limit();e<r;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const r=Math.min(t.length,e.length);for(let s=0;s<r;s++){const o=xt.compareSegments(t.get(s),e.get(s));if(o!==0)return o}return q(t.length,e.length)}static compareSegments(t,e){const r=xt.isNumericId(t),s=xt.isNumericId(e);return r&&!s?-1:!r&&s?1:r&&s?xt.extractNumericId(t).compare(xt.extractNumericId(e)):si(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return re.fromString(t.substring(4,t.length-2))}}class Y extends xt{construct(t,e,r){return new Y(t,e,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const r of t){if(r.indexOf("//")>=0)throw new k(C.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter((s=>s.length>0)))}return new Y(e)}static emptyPath(){return new Y([])}}const af=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class mt extends xt{construct(t,e,r){return new mt(t,e,r)}static isValidIdentifier(t){return af.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),mt.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Ma}static keyField(){return new mt([Ma])}static fromServerFormat(t){const e=[];let r="",s=0;const o=()=>{if(r.length===0)throw new k(C.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""};let a=!1;for(;s<t.length;){const u=t[s];if(u==="\\"){if(s+1===t.length)throw new k(C.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const h=t[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new k(C.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=h,s+=2}else u==="`"?(a=!a,s++):u!=="."||a?(r+=u,s++):(o(),s++)}if(o(),a)throw new k(C.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new mt(e)}static emptyPath(){return new mt([])}}class O{constructor(t){this.path=t}static fromPath(t){return new O(Y.fromString(t))}static fromName(t){return new O(Y.fromString(t).popFirst(5))}static empty(){return new O(Y.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Y.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return Y.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new O(new Y(t.slice()))}}function Jc(n,t,e){if(!e)throw new k(C.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function cf(n,t,e,r){if(t===!0&&r===!0)throw new k(C.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function Oa(n){if(!O.isDocumentKey(n))throw new k(C.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function xa(n){if(O.isDocumentKey(n))throw new k(C.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Yc(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Mi(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const t=(function(r){return r.constructor?r.constructor.name:null})(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":L(12329,{type:typeof n})}function Lt(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new k(C.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=Mi(n);throw new k(C.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}function it(n,t){const e={typeString:n};return t&&(e.value=t),e}function Yn(n,t){if(!Yc(n))throw new k(C.INVALID_ARGUMENT,"JSON must be an object");let e;for(const r in t)if(t[r]){const s=t[r].typeString,o="value"in t[r]?{value:t[r].value}:void 0;if(!(r in n)){e=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){e=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&a!==o.value){e=`Expected '${r}' field to equal '${o.value}'`;break}}if(e)throw new k(C.INVALID_ARGUMENT,e);return!0}const La=-62135596800,Fa=1e6;class Z{static now(){return Z.fromMillis(Date.now())}static fromDate(t){return Z.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),r=Math.floor((t-1e3*e)*Fa);return new Z(e,r)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new k(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new k(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<La)throw new k(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new k(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Fa}_compareTo(t){return this.seconds===t.seconds?q(this.nanoseconds,t.nanoseconds):q(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Z._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(Yn(t,Z._jsonSchema))return new Z(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-La;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Z._jsonSchemaVersion="firestore/timestamp/1.0",Z._jsonSchema={type:it("string",Z._jsonSchemaVersion),seconds:it("number"),nanoseconds:it("number")};class F{static fromTimestamp(t){return new F(t)}static min(){return new F(new Z(0,0))}static max(){return new F(new Z(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Bn=-1;function lf(n,t){const e=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=F.fromTimestamp(r===1e9?new Z(e+1,0):new Z(e,r));return new ae(s,O.empty(),t)}function uf(n){return new ae(n.readTime,n.key,Bn)}class ae{constructor(t,e,r){this.readTime=t,this.documentKey=e,this.largestBatchId=r}static min(){return new ae(F.min(),O.empty(),Bn)}static max(){return new ae(F.max(),O.empty(),Bn)}}function hf(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=O.comparator(n.documentKey,t.documentKey),e!==0?e:q(n.largestBatchId,t.largestBatchId))}const df="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class ff{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function on(n){if(n.code!==C.FAILED_PRECONDITION||n.message!==df)throw n;D("LocalStore","Unexpectedly lost primary lease")}class R{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&L(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new R(((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(t,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(e,o).next(r,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof R?e:R.resolve(e)}catch(e){return R.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):R.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):R.reject(e)}static resolve(t){return new R(((e,r)=>{e(t)}))}static reject(t){return new R(((e,r)=>{r(t)}))}static waitFor(t){return new R(((e,r)=>{let s=0,o=0,a=!1;t.forEach((u=>{++s,u.next((()=>{++o,a&&o===s&&e()}),(h=>r(h)))})),a=!0,o===s&&e()}))}static or(t){let e=R.resolve(!1);for(const r of t)e=e.next((s=>s?R.resolve(s):r()));return e}static forEach(t,e){const r=[];return t.forEach(((s,o)=>{r.push(e.call(this,s,o))})),this.waitFor(r)}static mapArray(t,e){return new R(((r,s)=>{const o=t.length,a=new Array(o);let u=0;for(let h=0;h<o;h++){const d=h;e(t[d]).next((_=>{a[d]=_,++u,u===o&&r(a)}),(_=>s(_)))}}))}static doWhile(t,e){return new R(((r,s)=>{const o=()=>{t()===!0?e().next((()=>{o()}),s):r()};o()}))}}function mf(n){const t=n.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function an(n){return n.name==="IndexedDbTransactionError"}class is{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>e.writeSequenceNumber(r))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}is.ce=-1;const Oi=-1;function os(n){return n==null}function $r(n){return n===0&&1/n==-1/0}function gf(n){return typeof n=="number"&&Number.isInteger(n)&&!$r(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const Zc="";function pf(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=Ba(t)),t=_f(n.get(e),t);return Ba(t)}function _f(n,t){let e=t;const r=n.length;for(let s=0;s<r;s++){const o=n.charAt(s);switch(o){case"\0":e+="";break;case Zc:e+="";break;default:e+=o}}return e}function Ba(n){return n+Zc+""}function Ua(n){let t=0;for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function be(n,t){for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function tl(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}class tt{constructor(t,e){this.comparator=t,this.root=e||ft.EMPTY}insert(t,e){return new tt(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,ft.BLACK,null,null))}remove(t){return new tt(this.comparator,this.root.remove(t,this.comparator).copy(null,null,ft.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const r=this.comparator(t,e.key);if(r===0)return e.value;r<0?e=e.left:r>0&&(e=e.right)}return null}indexOf(t){let e=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(t,r.key);if(s===0)return e+r.left.size;s<0?r=r.left:(e+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,r)=>(t(e,r),!1)))}toString(){const t=[];return this.inorderTraversal(((e,r)=>(t.push(`${e}:${r}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Ir(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Ir(this.root,t,this.comparator,!1)}getReverseIterator(){return new Ir(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Ir(this.root,t,this.comparator,!0)}}class Ir{constructor(t,e,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!t.isEmpty();)if(o=e?r(t.key,e):1,e&&s&&(o*=-1),o<0)t=this.isReverse?t.left:t.right;else{if(o===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class ft{constructor(t,e,r,s,o){this.key=t,this.value=e,this.color=r??ft.RED,this.left=s??ft.EMPTY,this.right=o??ft.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,r,s,o){return new ft(t??this.key,e??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,r){let s=this;const o=r(t,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(t,e,r),null):o===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return ft.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let r,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return ft.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,ft.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,ft.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw L(43730,{key:this.key,value:this.value});if(this.right.isRed())throw L(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw L(27949);return t+(this.isRed()?0:1)}}ft.EMPTY=null,ft.RED=!0,ft.BLACK=!1;ft.EMPTY=new class{constructor(){this.size=0}get key(){throw L(57766)}get value(){throw L(16141)}get color(){throw L(16727)}get left(){throw L(29726)}get right(){throw L(36894)}copy(t,e,r,s,o){return this}insert(t,e,r){return new ft(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class lt{constructor(t){this.comparator=t,this.data=new tt(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,r)=>(t(e),!1)))}forEachInRange(t,e){const r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let r;for(r=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new ja(this.data.getIterator())}getIteratorFrom(t){return new ja(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((r=>{e=e.add(r)})),e}isEqual(t){if(!(t instanceof lt)||this.size!==t.size)return!1;const e=this.data.getIterator(),r=t.data.getIterator();for(;e.hasNext();){const s=e.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new lt(this.comparator);return e.data=t,e}}class ja{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class kt{constructor(t){this.fields=t,t.sort(mt.comparator)}static empty(){return new kt([])}unionWith(t){let e=new lt(mt.comparator);for(const r of this.fields)e=e.add(r);for(const r of t)e=e.add(r);return new kt(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Je(this.fields,t.fields,((e,r)=>e.isEqual(r)))}}class el extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class gt{constructor(t){this.binaryString=t}static fromBase64String(t){const e=(function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new el("Invalid base64 string: "+o):o}})(t);return new gt(e)}static fromUint8Array(t){const e=(function(s){let o="";for(let a=0;a<s.length;++a)o+=String.fromCharCode(s[a]);return o})(t);return new gt(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(e){return btoa(e)})(this.binaryString)}toUint8Array(){return(function(e){const r=new Uint8Array(e.length);for(let s=0;s<e.length;s++)r[s]=e.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return q(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}gt.EMPTY_BYTE_STRING=new gt("");const yf=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ce(n){if(Q(!!n,39018),typeof n=="string"){let t=0;const e=yf.exec(n);if(Q(!!e,46558,{timestamp:n}),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:rt(n.seconds),nanos:rt(n.nanos)}}function rt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function le(n){return typeof n=="string"?gt.fromBase64String(n):gt.fromUint8Array(n)}const nl="server_timestamp",rl="__type__",sl="__previous_value__",il="__local_write_time__";function xi(n){return(n?.mapValue?.fields||{})[rl]?.stringValue===nl}function as(n){const t=n.mapValue.fields[sl];return xi(t)?as(t):t}function Un(n){const t=ce(n.mapValue.fields[il].timestampValue);return new Z(t.seconds,t.nanos)}class Ef{constructor(t,e,r,s,o,a,u,h,d,_){this.databaseId=t,this.appId=e,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=d,this.isUsingEmulator=_}}const zr="(default)";class jn{constructor(t,e){this.projectId=t,this.database=e||zr}static empty(){return new jn("","")}get isDefaultDatabase(){return this.database===zr}isEqual(t){return t instanceof jn&&t.projectId===this.projectId&&t.database===this.database}}const ol="__type__",Tf="__max__",wr={mapValue:{}},al="__vector__",Gr="value";function ue(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?xi(n)?4:If(n)?9007199254740991:vf(n)?10:11:L(28295,{value:n})}function qt(n,t){if(n===t)return!0;const e=ue(n);if(e!==ue(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return Un(n).isEqual(Un(t));case 3:return(function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const a=ce(s.timestampValue),u=ce(o.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos})(n,t);case 5:return n.stringValue===t.stringValue;case 6:return(function(s,o){return le(s.bytesValue).isEqual(le(o.bytesValue))})(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return(function(s,o){return rt(s.geoPointValue.latitude)===rt(o.geoPointValue.latitude)&&rt(s.geoPointValue.longitude)===rt(o.geoPointValue.longitude)})(n,t);case 2:return(function(s,o){if("integerValue"in s&&"integerValue"in o)return rt(s.integerValue)===rt(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const a=rt(s.doubleValue),u=rt(o.doubleValue);return a===u?$r(a)===$r(u):isNaN(a)&&isNaN(u)}return!1})(n,t);case 9:return Je(n.arrayValue.values||[],t.arrayValue.values||[],qt);case 10:case 11:return(function(s,o){const a=s.mapValue.fields||{},u=o.mapValue.fields||{};if(Ua(a)!==Ua(u))return!1;for(const h in a)if(a.hasOwnProperty(h)&&(u[h]===void 0||!qt(a[h],u[h])))return!1;return!0})(n,t);default:return L(52216,{left:n})}}function qn(n,t){return(n.values||[]).find((e=>qt(e,t)))!==void 0}function Ye(n,t){if(n===t)return 0;const e=ue(n),r=ue(t);if(e!==r)return q(e,r);switch(e){case 0:case 9007199254740991:return 0;case 1:return q(n.booleanValue,t.booleanValue);case 2:return(function(o,a){const u=rt(o.integerValue||o.doubleValue),h=rt(a.integerValue||a.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1})(n,t);case 3:return qa(n.timestampValue,t.timestampValue);case 4:return qa(Un(n),Un(t));case 5:return si(n.stringValue,t.stringValue);case 6:return(function(o,a){const u=le(o),h=le(a);return u.compareTo(h)})(n.bytesValue,t.bytesValue);case 7:return(function(o,a){const u=o.split("/"),h=a.split("/");for(let d=0;d<u.length&&d<h.length;d++){const _=q(u[d],h[d]);if(_!==0)return _}return q(u.length,h.length)})(n.referenceValue,t.referenceValue);case 8:return(function(o,a){const u=q(rt(o.latitude),rt(a.latitude));return u!==0?u:q(rt(o.longitude),rt(a.longitude))})(n.geoPointValue,t.geoPointValue);case 9:return $a(n.arrayValue,t.arrayValue);case 10:return(function(o,a){const u=o.fields||{},h=a.fields||{},d=u[Gr]?.arrayValue,_=h[Gr]?.arrayValue,v=q(d?.values?.length||0,_?.values?.length||0);return v!==0?v:$a(d,_)})(n.mapValue,t.mapValue);case 11:return(function(o,a){if(o===wr.mapValue&&a===wr.mapValue)return 0;if(o===wr.mapValue)return 1;if(a===wr.mapValue)return-1;const u=o.fields||{},h=Object.keys(u),d=a.fields||{},_=Object.keys(d);h.sort(),_.sort();for(let v=0;v<h.length&&v<_.length;++v){const S=si(h[v],_[v]);if(S!==0)return S;const b=Ye(u[h[v]],d[_[v]]);if(b!==0)return b}return q(h.length,_.length)})(n.mapValue,t.mapValue);default:throw L(23264,{he:e})}}function qa(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return q(n,t);const e=ce(n),r=ce(t),s=q(e.seconds,r.seconds);return s!==0?s:q(e.nanos,r.nanos)}function $a(n,t){const e=n.values||[],r=t.values||[];for(let s=0;s<e.length&&s<r.length;++s){const o=Ye(e[s],r[s]);if(o)return o}return q(e.length,r.length)}function Ze(n){return ii(n)}function ii(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(e){const r=ce(e);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(e){return le(e).toBase64()})(n.bytesValue):"referenceValue"in n?(function(e){return O.fromName(e).toString()})(n.referenceValue):"geoPointValue"in n?(function(e){return`geo(${e.latitude},${e.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(e){let r="[",s=!0;for(const o of e.values||[])s?s=!1:r+=",",r+=ii(o);return r+"]"})(n.arrayValue):"mapValue"in n?(function(e){const r=Object.keys(e.fields||{}).sort();let s="{",o=!0;for(const a of r)o?o=!1:s+=",",s+=`${a}:${ii(e.fields[a])}`;return s+"}"})(n.mapValue):L(61005,{value:n})}function Vr(n){switch(ue(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=as(n);return t?16+Vr(t):16;case 5:return 2*n.stringValue.length;case 6:return le(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,o)=>s+Vr(o)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return be(r.fields,((o,a)=>{s+=o.length+Vr(a)})),s})(n.mapValue);default:throw L(13486,{value:n})}}function oi(n){return!!n&&"integerValue"in n}function Li(n){return!!n&&"arrayValue"in n}function za(n){return!!n&&"nullValue"in n}function Ga(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Dr(n){return!!n&&"mapValue"in n}function vf(n){return(n?.mapValue?.fields||{})[ol]?.stringValue===al}function Vn(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const t={mapValue:{fields:{}}};return be(n.mapValue.fields,((e,r)=>t.mapValue.fields[e]=Vn(r))),t}if(n.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=Vn(n.arrayValue.values[e]);return t}return{...n}}function If(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Tf}class bt{constructor(t){this.value=t}static empty(){return new bt({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let r=0;r<t.length-1;++r)if(e=(e.mapValue.fields||{})[t.get(r)],!Dr(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Vn(e)}setAll(t){let e=mt.emptyPath(),r={},s=[];t.forEach(((a,u)=>{if(!e.isImmediateParentOf(u)){const h=this.getFieldsMap(e);this.applyChanges(h,r,s),r={},s=[],e=u.popLast()}a?r[u.lastSegment()]=Vn(a):s.push(u.lastSegment())}));const o=this.getFieldsMap(e);this.applyChanges(o,r,s)}delete(t){const e=this.field(t.popLast());Dr(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return qt(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let r=0;r<t.length;++r){let s=e.mapValue.fields[t.get(r)];Dr(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(r)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,r){be(e,((s,o)=>t[s]=o));for(const s of r)delete t[s]}clone(){return new bt(Vn(this.value))}}function cl(n){const t=[];return be(n.fields,((e,r)=>{const s=new mt([e]);if(Dr(r)){const o=cl(r.mapValue).fields;if(o.length===0)t.push(s);else for(const a of o)t.push(s.child(a))}else t.push(s)})),new kt(t)}class Et{constructor(t,e,r,s,o,a,u){this.key=t,this.documentType=e,this.version=r,this.readTime=s,this.createTime=o,this.data=a,this.documentState=u}static newInvalidDocument(t){return new Et(t,0,F.min(),F.min(),F.min(),bt.empty(),0)}static newFoundDocument(t,e,r,s){return new Et(t,1,e,F.min(),r,s,0)}static newNoDocument(t,e){return new Et(t,2,e,F.min(),F.min(),bt.empty(),0)}static newUnknownDocument(t,e){return new Et(t,3,e,F.min(),F.min(),bt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(F.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=bt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=bt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=F.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof Et&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Et(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Hr{constructor(t,e){this.position=t,this.inclusive=e}}function Ha(n,t,e){let r=0;for(let s=0;s<n.position.length;s++){const o=t[s],a=n.position[s];if(o.field.isKeyField()?r=O.comparator(O.fromName(a.referenceValue),e.key):r=Ye(a,e.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Ka(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!qt(n.position[e],t.position[e]))return!1;return!0}class Kr{constructor(t,e="asc"){this.field=t,this.dir=e}}function wf(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}class ll{}class at extends ll{constructor(t,e,r){super(),this.field=t,this.op=e,this.value=r}static create(t,e,r){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,r):new Sf(t,e,r):e==="array-contains"?new bf(t,r):e==="in"?new Pf(t,r):e==="not-in"?new Vf(t,r):e==="array-contains-any"?new Df(t,r):new at(t,e,r)}static createKeyFieldInFilter(t,e,r){return e==="in"?new Rf(t,r):new Cf(t,r)}matches(t){const e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(Ye(e,this.value)):e!==null&&ue(this.value)===ue(e)&&this.matchesComparison(Ye(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return L(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class $t extends ll{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new $t(t,e)}matches(t){return ul(this)?this.filters.find((e=>!e.matches(t)))===void 0:this.filters.find((e=>e.matches(t)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function ul(n){return n.op==="and"}function hl(n){return Af(n)&&ul(n)}function Af(n){for(const t of n.filters)if(t instanceof $t)return!1;return!0}function ai(n){if(n instanceof at)return n.field.canonicalString()+n.op.toString()+Ze(n.value);if(hl(n))return n.filters.map((t=>ai(t))).join(",");{const t=n.filters.map((e=>ai(e))).join(",");return`${n.op}(${t})`}}function dl(n,t){return n instanceof at?(function(r,s){return s instanceof at&&r.op===s.op&&r.field.isEqual(s.field)&&qt(r.value,s.value)})(n,t):n instanceof $t?(function(r,s){return s instanceof $t&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((o,a,u)=>o&&dl(a,s.filters[u])),!0):!1})(n,t):void L(19439)}function fl(n){return n instanceof at?(function(e){return`${e.field.canonicalString()} ${e.op} ${Ze(e.value)}`})(n):n instanceof $t?(function(e){return e.op.toString()+" {"+e.getFilters().map(fl).join(" ,")+"}"})(n):"Filter"}class Sf extends at{constructor(t,e,r){super(t,e,r),this.key=O.fromName(r.referenceValue)}matches(t){const e=O.comparator(t.key,this.key);return this.matchesComparison(e)}}class Rf extends at{constructor(t,e){super(t,"in",e),this.keys=ml("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Cf extends at{constructor(t,e){super(t,"not-in",e),this.keys=ml("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function ml(n,t){return(t.arrayValue?.values||[]).map((e=>O.fromName(e.referenceValue)))}class bf extends at{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Li(e)&&qn(e.arrayValue,this.value)}}class Pf extends at{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return e!==null&&qn(this.value.arrayValue,e)}}class Vf extends at{constructor(t,e){super(t,"not-in",e)}matches(t){if(qn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!qn(this.value.arrayValue,e)}}class Df extends at{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Li(e)||!e.arrayValue.values)&&e.arrayValue.values.some((r=>qn(this.value.arrayValue,r)))}}class kf{constructor(t,e=null,r=[],s=[],o=null,a=null,u=null){this.path=t,this.collectionGroup=e,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=a,this.endAt=u,this.Te=null}}function Wa(n,t=null,e=[],r=[],s=null,o=null,a=null){return new kf(n,t,e,r,s,o,a)}function Fi(n){const t=B(n);if(t.Te===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((r=>ai(r))).join(","),e+="|ob:",e+=t.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),os(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((r=>Ze(r))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((r=>Ze(r))).join(",")),t.Te=e}return t.Te}function Bi(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!wf(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!dl(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!Ka(n.startAt,t.startAt)&&Ka(n.endAt,t.endAt)}function ci(n){return O.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class cs{constructor(t,e=null,r=[],s=[],o=null,a="F",u=null,h=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=a,this.startAt=u,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Nf(n,t,e,r,s,o,a,u){return new cs(n,t,e,r,s,o,a,u)}function Ui(n){return new cs(n)}function Qa(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Mf(n){return n.collectionGroup!==null}function Dn(n){const t=B(n);if(t.Ie===null){t.Ie=[];const e=new Set;for(const o of t.explicitOrderBy)t.Ie.push(o),e.add(o.field.canonicalString());const r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new lt(mt.comparator);return a.filters.forEach((h=>{h.getFlattenedFilters().forEach((d=>{d.isInequality()&&(u=u.add(d.field))}))})),u})(t).forEach((o=>{e.has(o.canonicalString())||o.isKeyField()||t.Ie.push(new Kr(o,r))})),e.has(mt.keyField().canonicalString())||t.Ie.push(new Kr(mt.keyField(),r))}return t.Ie}function Ft(n){const t=B(n);return t.Ee||(t.Ee=Of(t,Dn(n))),t.Ee}function Of(n,t){if(n.limitType==="F")return Wa(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map((s=>{const o=s.dir==="desc"?"asc":"desc";return new Kr(s.field,o)}));const e=n.endAt?new Hr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Hr(n.startAt.position,n.startAt.inclusive):null;return Wa(n.path,n.collectionGroup,t,n.filters,n.limit,e,r)}}function li(n,t,e){return new cs(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function ls(n,t){return Bi(Ft(n),Ft(t))&&n.limitType===t.limitType}function gl(n){return`${Fi(Ft(n))}|lt:${n.limitType}`}function xe(n){return`Query(target=${(function(e){let r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map((s=>fl(s))).join(", ")}]`),os(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map((s=>Ze(s))).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map((s=>Ze(s))).join(",")),`Target(${r})`})(Ft(n))}; limitType=${n.limitType})`}function us(n,t){return t.isFoundDocument()&&(function(r,s){const o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):O.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(n,t)&&(function(r,s){for(const o of Dn(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0})(n,t)&&(function(r,s){for(const o of r.filters)if(!o.matches(s))return!1;return!0})(n,t)&&(function(r,s){return!(r.startAt&&!(function(a,u,h){const d=Ha(a,u,h);return a.inclusive?d<=0:d<0})(r.startAt,Dn(r),s)||r.endAt&&!(function(a,u,h){const d=Ha(a,u,h);return a.inclusive?d>=0:d>0})(r.endAt,Dn(r),s))})(n,t)}function xf(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function pl(n){return(t,e)=>{let r=!1;for(const s of Dn(n)){const o=Lf(s,t,e);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function Lf(n,t,e){const r=n.field.isKeyField()?O.comparator(t.key,e.key):(function(o,a,u){const h=a.data.field(o),d=u.data.field(o);return h!==null&&d!==null?Ye(h,d):L(42886)})(n.field,t,e);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return L(19790,{direction:n.dir})}}class Pe{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),r=this.inner[e];if(r!==void 0){for(const[s,o]of r)if(this.equalsFn(s,t))return o}}has(t){return this.get(t)!==void 0}set(t,e){const r=this.mapKeyFn(t),s=this.inner[r];if(s===void 0)return this.inner[r]=[[t,e]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],t))return void(s[o]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),r=this.inner[e];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],t))return r.length===1?delete this.inner[e]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(t){be(this.inner,((e,r)=>{for(const[s,o]of r)t(s,o)}))}isEmpty(){return tl(this.inner)}size(){return this.innerSize}}const Ff=new tt(O.comparator);function Kt(){return Ff}const _l=new tt(O.comparator);function Rn(...n){let t=_l;for(const e of n)t=t.insert(e.key,e);return t}function yl(n){let t=_l;return n.forEach(((e,r)=>t=t.insert(e,r.overlayedDocument))),t}function Te(){return kn()}function El(){return kn()}function kn(){return new Pe((n=>n.toString()),((n,t)=>n.isEqual(t)))}const Bf=new tt(O.comparator),Uf=new lt(O.comparator);function $(...n){let t=Uf;for(const e of n)t=t.add(e);return t}const jf=new lt(q);function qf(){return jf}function ji(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:$r(t)?"-0":t}}function Tl(n){return{integerValue:""+n}}function $f(n,t){return gf(t)?Tl(t):ji(n,t)}class hs{constructor(){this._=void 0}}function zf(n,t,e){return n instanceof $n?(function(s,o){const a={fields:{[rl]:{stringValue:nl},[il]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&xi(o)&&(o=as(o)),o&&(a.fields[sl]=o),{mapValue:a}})(e,t):n instanceof zn?Il(n,t):n instanceof Gn?wl(n,t):(function(s,o){const a=vl(s,o),u=Xa(a)+Xa(s.Ae);return oi(a)&&oi(s.Ae)?Tl(u):ji(s.serializer,u)})(n,t)}function Gf(n,t,e){return n instanceof zn?Il(n,t):n instanceof Gn?wl(n,t):e}function vl(n,t){return n instanceof Wr?(function(r){return oi(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(t)?t:{integerValue:0}:null}class $n extends hs{}class zn extends hs{constructor(t){super(),this.elements=t}}function Il(n,t){const e=Al(t);for(const r of n.elements)e.some((s=>qt(s,r)))||e.push(r);return{arrayValue:{values:e}}}class Gn extends hs{constructor(t){super(),this.elements=t}}function wl(n,t){let e=Al(t);for(const r of n.elements)e=e.filter((s=>!qt(s,r)));return{arrayValue:{values:e}}}class Wr extends hs{constructor(t,e){super(),this.serializer=t,this.Ae=e}}function Xa(n){return rt(n.integerValue||n.doubleValue)}function Al(n){return Li(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Hf{constructor(t,e){this.field=t,this.transform=e}}function Kf(n,t){return n.field.isEqual(t.field)&&(function(r,s){return r instanceof zn&&s instanceof zn||r instanceof Gn&&s instanceof Gn?Je(r.elements,s.elements,qt):r instanceof Wr&&s instanceof Wr?qt(r.Ae,s.Ae):r instanceof $n&&s instanceof $n})(n.transform,t.transform)}class Wf{constructor(t,e){this.version=t,this.transformResults=e}}class Nt{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Nt}static exists(t){return new Nt(void 0,t)}static updateTime(t){return new Nt(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function kr(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}class ds{}function Sl(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new qi(n.key,Nt.none()):new Zn(n.key,n.data,Nt.none());{const e=n.data,r=bt.empty();let s=new lt(mt.comparator);for(let o of t.fields)if(!s.has(o)){let a=e.field(o);a===null&&o.length>1&&(o=o.popLast(),a=e.field(o)),a===null?r.delete(o):r.set(o,a),s=s.add(o)}return new Ve(n.key,r,new kt(s.toArray()),Nt.none())}}function Qf(n,t,e){n instanceof Zn?(function(s,o,a){const u=s.value.clone(),h=Ya(s.fieldTransforms,o,a.transformResults);u.setAll(h),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,t,e):n instanceof Ve?(function(s,o,a){if(!kr(s.precondition,o))return void o.convertToUnknownDocument(a.version);const u=Ya(s.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(Rl(s)),h.setAll(u),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()})(n,t,e):(function(s,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()})(0,t,e)}function Nn(n,t,e,r){return n instanceof Zn?(function(o,a,u,h){if(!kr(o.precondition,a))return u;const d=o.value.clone(),_=Za(o.fieldTransforms,h,a);return d.setAll(_),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,t,e,r):n instanceof Ve?(function(o,a,u,h){if(!kr(o.precondition,a))return u;const d=Za(o.fieldTransforms,h,a),_=a.data;return _.setAll(Rl(o)),_.setAll(d),a.convertToFoundDocument(a.version,_).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((v=>v.field)))})(n,t,e,r):(function(o,a,u){return kr(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u})(n,t,e)}function Xf(n,t){let e=null;for(const r of n.fieldTransforms){const s=t.data.field(r.field),o=vl(r.transform,s||null);o!=null&&(e===null&&(e=bt.empty()),e.set(r.field,o))}return e||null}function Ja(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Je(r,s,((o,a)=>Kf(o,a)))})(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}class Zn extends ds{constructor(t,e,r,s=[]){super(),this.key=t,this.value=e,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Ve extends ds{constructor(t,e,r,s,o=[]){super(),this.key=t,this.data=e,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function Rl(n){const t=new Map;return n.fieldMask.fields.forEach((e=>{if(!e.isEmpty()){const r=n.data.field(e);t.set(e,r)}})),t}function Ya(n,t,e){const r=new Map;Q(n.length===e.length,32656,{Re:e.length,Ve:n.length});for(let s=0;s<e.length;s++){const o=n[s],a=o.transform,u=t.data.field(o.field);r.set(o.field,Gf(a,u,e[s]))}return r}function Za(n,t,e){const r=new Map;for(const s of n){const o=s.transform,a=e.data.field(s.field);r.set(s.field,zf(o,a,t))}return r}class qi extends ds{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Jf extends ds{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Yf{constructor(t,e,r,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(t,e){const r=e.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(t.key)&&Qf(o,t,r[s])}}applyToLocalView(t,e){for(const r of this.baseMutations)r.key.isEqual(t.key)&&(e=Nn(r,t,e,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(t.key)&&(e=Nn(r,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const r=El();return this.mutations.forEach((s=>{const o=t.get(s.key),a=o.overlayedDocument;let u=this.applyToLocalView(a,o.mutatedFields);u=e.has(s.key)?null:u;const h=Sl(a,u);h!==null&&r.set(s.key,h),a.isValidDocument()||a.convertToNoDocument(F.min())})),r}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),$())}isEqual(t){return this.batchId===t.batchId&&Je(this.mutations,t.mutations,((e,r)=>Ja(e,r)))&&Je(this.baseMutations,t.baseMutations,((e,r)=>Ja(e,r)))}}class $i{constructor(t,e,r,s){this.batch=t,this.commitVersion=e,this.mutationResults=r,this.docVersions=s}static from(t,e,r){Q(t.mutations.length===r.length,58842,{me:t.mutations.length,fe:r.length});let s=(function(){return Bf})();const o=t.mutations;for(let a=0;a<o.length;a++)s=s.insert(o[a].key,r[a].version);return new $i(t,e,r,s)}}class Zf{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class tm{constructor(t,e){this.count=t,this.unchangedNames=e}}var st,z;function em(n){switch(n){case C.OK:return L(64938);case C.CANCELLED:case C.UNKNOWN:case C.DEADLINE_EXCEEDED:case C.RESOURCE_EXHAUSTED:case C.INTERNAL:case C.UNAVAILABLE:case C.UNAUTHENTICATED:return!1;case C.INVALID_ARGUMENT:case C.NOT_FOUND:case C.ALREADY_EXISTS:case C.PERMISSION_DENIED:case C.FAILED_PRECONDITION:case C.ABORTED:case C.OUT_OF_RANGE:case C.UNIMPLEMENTED:case C.DATA_LOSS:return!0;default:return L(15467,{code:n})}}function Cl(n){if(n===void 0)return Ht("GRPC error has no .code"),C.UNKNOWN;switch(n){case st.OK:return C.OK;case st.CANCELLED:return C.CANCELLED;case st.UNKNOWN:return C.UNKNOWN;case st.DEADLINE_EXCEEDED:return C.DEADLINE_EXCEEDED;case st.RESOURCE_EXHAUSTED:return C.RESOURCE_EXHAUSTED;case st.INTERNAL:return C.INTERNAL;case st.UNAVAILABLE:return C.UNAVAILABLE;case st.UNAUTHENTICATED:return C.UNAUTHENTICATED;case st.INVALID_ARGUMENT:return C.INVALID_ARGUMENT;case st.NOT_FOUND:return C.NOT_FOUND;case st.ALREADY_EXISTS:return C.ALREADY_EXISTS;case st.PERMISSION_DENIED:return C.PERMISSION_DENIED;case st.FAILED_PRECONDITION:return C.FAILED_PRECONDITION;case st.ABORTED:return C.ABORTED;case st.OUT_OF_RANGE:return C.OUT_OF_RANGE;case st.UNIMPLEMENTED:return C.UNIMPLEMENTED;case st.DATA_LOSS:return C.DATA_LOSS;default:return L(39323,{code:n})}}(z=st||(st={}))[z.OK=0]="OK",z[z.CANCELLED=1]="CANCELLED",z[z.UNKNOWN=2]="UNKNOWN",z[z.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",z[z.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",z[z.NOT_FOUND=5]="NOT_FOUND",z[z.ALREADY_EXISTS=6]="ALREADY_EXISTS",z[z.PERMISSION_DENIED=7]="PERMISSION_DENIED",z[z.UNAUTHENTICATED=16]="UNAUTHENTICATED",z[z.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",z[z.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",z[z.ABORTED=10]="ABORTED",z[z.OUT_OF_RANGE=11]="OUT_OF_RANGE",z[z.UNIMPLEMENTED=12]="UNIMPLEMENTED",z[z.INTERNAL=13]="INTERNAL",z[z.UNAVAILABLE=14]="UNAVAILABLE",z[z.DATA_LOSS=15]="DATA_LOSS";function nm(){return new TextEncoder}const rm=new re([4294967295,4294967295],0);function tc(n){const t=nm().encode(n),e=new $c;return e.update(t),new Uint8Array(e.digest())}function ec(n){const t=new DataView(n.buffer),e=t.getUint32(0,!0),r=t.getUint32(4,!0),s=t.getUint32(8,!0),o=t.getUint32(12,!0);return[new re([e,r],0),new re([s,o],0)]}class zi{constructor(t,e,r){if(this.bitmap=t,this.padding=e,this.hashCount=r,e<0||e>=8)throw new Cn(`Invalid padding: ${e}`);if(r<0)throw new Cn(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new Cn(`Invalid hash count: ${r}`);if(t.length===0&&e!==0)throw new Cn(`Invalid padding when bitmap length is 0: ${e}`);this.ge=8*t.length-e,this.pe=re.fromNumber(this.ge)}ye(t,e,r){let s=t.add(e.multiply(re.fromNumber(r)));return s.compare(rm)===1&&(s=new re([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.ge===0)return!1;const e=tc(t),[r,s]=ec(e);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);if(!this.we(a))return!1}return!0}static create(t,e,r){const s=t%8==0?0:8-t%8,o=new Uint8Array(Math.ceil(t/8)),a=new zi(o,s,e);return r.forEach((u=>a.insert(u))),a}insert(t){if(this.ge===0)return;const e=tc(t),[r,s]=ec(e);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);this.Se(a)}}Se(t){const e=Math.floor(t/8),r=t%8;this.bitmap[e]|=1<<r}}class Cn extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class fs{constructor(t,e,r,s,o){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(t,e,r){const s=new Map;return s.set(t,tr.createSynthesizedTargetChangeForCurrentChange(t,e,r)),new fs(F.min(),s,new tt(q),Kt(),$())}}class tr{constructor(t,e,r,s,o){this.resumeToken=t,this.current=e,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(t,e,r){return new tr(r,e,$(),$(),$())}}class Nr{constructor(t,e,r,s){this.be=t,this.removedTargetIds=e,this.key=r,this.De=s}}class bl{constructor(t,e){this.targetId=t,this.Ce=e}}class Pl{constructor(t,e,r=gt.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=r,this.cause=s}}class nc{constructor(){this.ve=0,this.Fe=rc(),this.Me=gt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=$(),e=$(),r=$();return this.Fe.forEach(((s,o)=>{switch(o){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:r=r.add(s);break;default:L(38017,{changeType:o})}})),new tr(this.Me,this.xe,t,e,r)}qe(){this.Oe=!1,this.Fe=rc()}Qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,Q(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class sm{constructor(t){this.Ge=t,this.ze=new Map,this.je=Kt(),this.Je=Ar(),this.He=Ar(),this.Ye=new tt(q)}Ze(t){for(const e of t.be)t.De&&t.De.isFoundDocument()?this.Xe(e,t.De):this.et(e,t.key,t.De);for(const e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,(e=>{const r=this.nt(e);switch(t.state){case 0:this.rt(e)&&r.Le(t.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(t.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(r.We(),r.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),r.Le(t.resumeToken));break;default:L(56790,{state:t.state})}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach(((r,s)=>{this.rt(s)&&e(s)}))}st(t){const e=t.targetId,r=t.Ce.count,s=this.ot(e);if(s){const o=s.target;if(ci(o))if(r===0){const a=new O(o.path);this.et(e,a,Et.newNoDocument(a,F.min()))}else Q(r===1,20013,{expectedCount:r});else{const a=this._t(e);if(a!==r){const u=this.ut(t),h=u?this.ct(u,t,a):1;if(h!==0){this.it(e);const d=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(e,d)}}}}}ut(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=e;let a,u;try{a=le(r).toUint8Array()}catch(h){if(h instanceof el)return Xe("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new zi(a,s,o)}catch(h){return Xe(h instanceof Cn?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return u.ge===0?null:u}ct(t,e,r){return e.Ce.count===r-this.Pt(t,e.targetId)?0:2}Pt(t,e){const r=this.Ge.getRemoteKeysForTarget(e);let s=0;return r.forEach((o=>{const a=this.Ge.ht(),u=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;t.mightContain(u)||(this.et(e,o,null),s++)})),s}Tt(t){const e=new Map;this.ze.forEach(((o,a)=>{const u=this.ot(a);if(u){if(o.current&&ci(u.target)){const h=new O(u.target.path);this.It(h).has(a)||this.Et(a,h)||this.et(a,h,Et.newNoDocument(h,t))}o.Be&&(e.set(a,o.ke()),o.qe())}}));let r=$();this.He.forEach(((o,a)=>{let u=!0;a.forEachWhile((h=>{const d=this.ot(h);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(r=r.add(o))})),this.je.forEach(((o,a)=>a.setReadTime(t)));const s=new fs(t,e,this.Ye,this.je,r);return this.je=Kt(),this.Je=Ar(),this.He=Ar(),this.Ye=new tt(q),s}Xe(t,e){if(!this.rt(t))return;const r=this.Et(t,e.key)?2:0;this.nt(t).Qe(e.key,r),this.je=this.je.insert(e.key,e),this.Je=this.Je.insert(e.key,this.It(e.key).add(t)),this.He=this.He.insert(e.key,this.dt(e.key).add(t))}et(t,e,r){if(!this.rt(t))return;const s=this.nt(t);this.Et(t,e)?s.Qe(e,1):s.$e(e),this.He=this.He.insert(e,this.dt(e).delete(t)),this.He=this.He.insert(e,this.dt(e).add(t)),r&&(this.je=this.je.insert(e,r))}removeTarget(t){this.ze.delete(t)}_t(t){const e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let e=this.ze.get(t);return e||(e=new nc,this.ze.set(t,e)),e}dt(t){let e=this.He.get(t);return e||(e=new lt(q),this.He=this.He.insert(t,e)),e}It(t){let e=this.Je.get(t);return e||(e=new lt(q),this.Je=this.Je.insert(t,e)),e}rt(t){const e=this.ot(t)!==null;return e||D("WatchChangeAggregator","Detected inactive target",t),e}ot(t){const e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new nc),this.Ge.getRemoteKeysForTarget(t).forEach((e=>{this.et(t,e,null)}))}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}}function Ar(){return new tt(O.comparator)}function rc(){return new tt(O.comparator)}const im={asc:"ASCENDING",desc:"DESCENDING"},om={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},am={and:"AND",or:"OR"};class cm{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function ui(n,t){return n.useProto3Json||os(t)?t:{value:t}}function Qr(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Vl(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function lm(n,t){return Qr(n,t.toTimestamp())}function Bt(n){return Q(!!n,49232),F.fromTimestamp((function(e){const r=ce(e);return new Z(r.seconds,r.nanos)})(n))}function Gi(n,t){return hi(n,t).canonicalString()}function hi(n,t){const e=(function(s){return new Y(["projects",s.projectId,"databases",s.database])})(n).child("documents");return t===void 0?e:e.child(t)}function Dl(n){const t=Y.fromString(n);return Q(xl(t),10190,{key:t.toString()}),t}function di(n,t){return Gi(n.databaseId,t.path)}function Ks(n,t){const e=Dl(t);if(e.get(1)!==n.databaseId.projectId)throw new k(C.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new k(C.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new O(Nl(e))}function kl(n,t){return Gi(n.databaseId,t)}function um(n){const t=Dl(n);return t.length===4?Y.emptyPath():Nl(t)}function fi(n){return new Y(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Nl(n){return Q(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function sc(n,t,e){return{name:di(n,t),fields:e.value.mapValue.fields}}function hm(n,t){let e;if("targetChange"in t){t.targetChange;const r=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:L(39313,{state:d})})(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],o=(function(d,_){return d.useProto3Json?(Q(_===void 0||typeof _=="string",58123),gt.fromBase64String(_||"")):(Q(_===void 0||_ instanceof Buffer||_ instanceof Uint8Array,16193),gt.fromUint8Array(_||new Uint8Array))})(n,t.targetChange.resumeToken),a=t.targetChange.cause,u=a&&(function(d){const _=d.code===void 0?C.UNKNOWN:Cl(d.code);return new k(_,d.message||"")})(a);e=new Pl(r,s,o,u||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const s=Ks(n,r.document.name),o=Bt(r.document.updateTime),a=r.document.createTime?Bt(r.document.createTime):F.min(),u=new bt({mapValue:{fields:r.document.fields}}),h=Et.newFoundDocument(s,o,a,u),d=r.targetIds||[],_=r.removedTargetIds||[];e=new Nr(d,_,h.key,h)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const s=Ks(n,r.document),o=r.readTime?Bt(r.readTime):F.min(),a=Et.newNoDocument(s,o),u=r.removedTargetIds||[];e=new Nr([],u,a.key,a)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const s=Ks(n,r.document),o=r.removedTargetIds||[];e=new Nr([],o,s,null)}else{if(!("filter"in t))return L(11601,{Rt:t});{t.filter;const r=t.filter;r.targetId;const{count:s=0,unchangedNames:o}=r,a=new tm(s,o),u=r.targetId;e=new bl(u,a)}}return e}function dm(n,t){let e;if(t instanceof Zn)e={update:sc(n,t.key,t.value)};else if(t instanceof qi)e={delete:di(n,t.key)};else if(t instanceof Ve)e={update:sc(n,t.key,t.data),updateMask:vm(t.fieldMask)};else{if(!(t instanceof Jf))return L(16599,{Vt:t.type});e={verify:di(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map((r=>(function(o,a){const u=a.transform;if(u instanceof $n)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof zn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Gn)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Wr)return{fieldPath:a.field.canonicalString(),increment:u.Ae};throw L(20930,{transform:a.transform})})(0,r)))),t.precondition.isNone||(e.currentDocument=(function(s,o){return o.updateTime!==void 0?{updateTime:lm(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:L(27497)})(n,t.precondition)),e}function fm(n,t){return n&&n.length>0?(Q(t!==void 0,14353),n.map((e=>(function(s,o){let a=s.updateTime?Bt(s.updateTime):Bt(o);return a.isEqual(F.min())&&(a=Bt(o)),new Wf(a,s.transformResults||[])})(e,t)))):[]}function mm(n,t){return{documents:[kl(n,t.path)]}}function gm(n,t){const e={structuredQuery:{}},r=t.path;let s;t.collectionGroup!==null?(s=r,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=r.popLast(),e.structuredQuery.from=[{collectionId:r.lastSegment()}]),e.parent=kl(n,s);const o=(function(d){if(d.length!==0)return Ol($t.create(d,"and"))})(t.filters);o&&(e.structuredQuery.where=o);const a=(function(d){if(d.length!==0)return d.map((_=>(function(S){return{field:Le(S.field),direction:ym(S.dir)}})(_)))})(t.orderBy);a&&(e.structuredQuery.orderBy=a);const u=ui(n,t.limit);return u!==null&&(e.structuredQuery.limit=u),t.startAt&&(e.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(t.startAt)),t.endAt&&(e.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(t.endAt)),{ft:e,parent:s}}function pm(n){let t=um(n.parent);const e=n.structuredQuery,r=e.from?e.from.length:0;let s=null;if(r>0){Q(r===1,65062);const _=e.from[0];_.allDescendants?s=_.collectionId:t=t.child(_.collectionId)}let o=[];e.where&&(o=(function(v){const S=Ml(v);return S instanceof $t&&hl(S)?S.getFilters():[S]})(e.where));let a=[];e.orderBy&&(a=(function(v){return v.map((S=>(function(N){return new Kr(Fe(N.field),(function(V){switch(V){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(N.direction))})(S)))})(e.orderBy));let u=null;e.limit&&(u=(function(v){let S;return S=typeof v=="object"?v.value:v,os(S)?null:S})(e.limit));let h=null;e.startAt&&(h=(function(v){const S=!!v.before,b=v.values||[];return new Hr(b,S)})(e.startAt));let d=null;return e.endAt&&(d=(function(v){const S=!v.before,b=v.values||[];return new Hr(b,S)})(e.endAt)),Nf(t,s,a,o,u,"F",h,d)}function _m(n,t){const e=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L(28987,{purpose:s})}})(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Ml(n){return n.unaryFilter!==void 0?(function(e){switch(e.unaryFilter.op){case"IS_NAN":const r=Fe(e.unaryFilter.field);return at.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Fe(e.unaryFilter.field);return at.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Fe(e.unaryFilter.field);return at.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Fe(e.unaryFilter.field);return at.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return L(61313);default:return L(60726)}})(n):n.fieldFilter!==void 0?(function(e){return at.create(Fe(e.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return L(58110);default:return L(50506)}})(e.fieldFilter.op),e.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(e){return $t.create(e.compositeFilter.filters.map((r=>Ml(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return L(1026)}})(e.compositeFilter.op))})(n):L(30097,{filter:n})}function ym(n){return im[n]}function Em(n){return om[n]}function Tm(n){return am[n]}function Le(n){return{fieldPath:n.canonicalString()}}function Fe(n){return mt.fromServerFormat(n.fieldPath)}function Ol(n){return n instanceof at?(function(e){if(e.op==="=="){if(Ga(e.value))return{unaryFilter:{field:Le(e.field),op:"IS_NAN"}};if(za(e.value))return{unaryFilter:{field:Le(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(Ga(e.value))return{unaryFilter:{field:Le(e.field),op:"IS_NOT_NAN"}};if(za(e.value))return{unaryFilter:{field:Le(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Le(e.field),op:Em(e.op),value:e.value}}})(n):n instanceof $t?(function(e){const r=e.getFilters().map((s=>Ol(s)));return r.length===1?r[0]:{compositeFilter:{op:Tm(e.op),filters:r}}})(n):L(54877,{filter:n})}function vm(n){const t=[];return n.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function xl(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class te{constructor(t,e,r,s,o=F.min(),a=F.min(),u=gt.EMPTY_BYTE_STRING,h=null){this.target=t,this.targetId=e,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(t){return new te(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new te(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new te(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new te(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Im{constructor(t){this.yt=t}}function wm(n){const t=pm({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?li(t,t.limit,"L"):t}class Am{constructor(){this.Cn=new Sm}addToCollectionParentIndex(t,e){return this.Cn.add(e),R.resolve()}getCollectionParents(t,e){return R.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return R.resolve()}deleteFieldIndex(t,e){return R.resolve()}deleteAllFieldIndexes(t){return R.resolve()}createTargetIndexes(t,e){return R.resolve()}getDocumentsMatchingTarget(t,e){return R.resolve(null)}getIndexType(t,e){return R.resolve(0)}getFieldIndexes(t,e){return R.resolve([])}getNextCollectionGroupToUpdate(t){return R.resolve(null)}getMinOffset(t,e){return R.resolve(ae.min())}getMinOffsetFromCollectionGroup(t,e){return R.resolve(ae.min())}updateCollectionGroup(t,e,r){return R.resolve()}updateIndexEntries(t,e){return R.resolve()}}class Sm{constructor(){this.index={}}add(t){const e=t.lastSegment(),r=t.popLast(),s=this.index[e]||new lt(Y.comparator),o=!s.has(r);return this.index[e]=s.add(r),o}has(t){const e=t.lastSegment(),r=t.popLast(),s=this.index[e];return s&&s.has(r)}getEntries(t){return(this.index[t]||new lt(Y.comparator)).toArray()}}const ic={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Ll=41943040;class Rt{static withCacheSize(t){return new Rt(t,Rt.DEFAULT_COLLECTION_PERCENTILE,Rt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=r}}Rt.DEFAULT_COLLECTION_PERCENTILE=10,Rt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Rt.DEFAULT=new Rt(Ll,Rt.DEFAULT_COLLECTION_PERCENTILE,Rt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Rt.DISABLED=new Rt(-1,0,0);class tn{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new tn(0)}static cr(){return new tn(-1)}}const oc="LruGarbageCollector",Rm=1048576;function ac([n,t],[e,r]){const s=q(n,e);return s===0?q(t,r):s}class Cm{constructor(t){this.Ir=t,this.buffer=new lt(ac),this.Er=0}dr(){return++this.Er}Ar(t){const e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{const r=this.buffer.last();ac(e,r)<0&&(this.buffer=this.buffer.delete(r).add(e))}}get maxValue(){return this.buffer.last()[0]}}class bm{constructor(t,e,r){this.garbageCollector=t,this.asyncQueue=e,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(t){D(oc,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){an(e)?D(oc,"Ignoring IndexedDB error during garbage collection: ",e):await on(e)}await this.Vr(3e5)}))}}class Pm{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next((r=>Math.floor(e/100*r)))}nthSequenceNumber(t,e){if(e===0)return R.resolve(is.ce);const r=new Cm(e);return this.mr.forEachTarget(t,(s=>r.Ar(s.sequenceNumber))).next((()=>this.mr.pr(t,(s=>r.Ar(s))))).next((()=>r.maxValue))}removeTargets(t,e,r){return this.mr.removeTargets(t,e,r)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(D("LruGarbageCollector","Garbage collection skipped; disabled"),R.resolve(ic)):this.getCacheSize(t).next((r=>r<this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),ic):this.yr(t,e)))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let r,s,o,a,u,h,d;const _=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((v=>(v>this.params.maximumSequenceNumbersToCollect?(D("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${v}`),s=this.params.maximumSequenceNumbersToCollect):s=v,a=Date.now(),this.nthSequenceNumber(t,s)))).next((v=>(r=v,u=Date.now(),this.removeTargets(t,r,e)))).next((v=>(o=v,h=Date.now(),this.removeOrphanedDocuments(t,r)))).next((v=>(d=Date.now(),Oe()<=G.DEBUG&&D("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-_}ms
	Determined least recently used ${s} in `+(u-a)+`ms
	Removed ${o} targets in `+(h-u)+`ms
	Removed ${v} documents in `+(d-h)+`ms
Total Duration: ${d-_}ms`),R.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:v}))))}}function Vm(n,t){return new Pm(n,t)}class Dm{constructor(){this.changes=new Pe((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Et.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const r=this.changes.get(e);return r!==void 0?R.resolve(r):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class km{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Nm{constructor(t,e,r,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=r,this.indexManager=s}getDocument(t,e){let r=null;return this.documentOverlayCache.getOverlay(t,e).next((s=>(r=s,this.remoteDocumentCache.getEntry(t,e)))).next((s=>(r!==null&&Nn(r.mutation,s,kt.empty(),Z.now()),s)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((r=>this.getLocalViewOfDocuments(t,r,$()).next((()=>r))))}getLocalViewOfDocuments(t,e,r=$()){const s=Te();return this.populateOverlays(t,s,e).next((()=>this.computeViews(t,e,s,r).next((o=>{let a=Rn();return o.forEach(((u,h)=>{a=a.insert(u,h.overlayedDocument)})),a}))))}getOverlayedDocuments(t,e){const r=Te();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,$())))}populateOverlays(t,e,r){const s=[];return r.forEach((o=>{e.has(o)||s.push(o)})),this.documentOverlayCache.getOverlays(t,s).next((o=>{o.forEach(((a,u)=>{e.set(a,u)}))}))}computeViews(t,e,r,s){let o=Kt();const a=kn(),u=(function(){return kn()})();return e.forEach(((h,d)=>{const _=r.get(d.key);s.has(d.key)&&(_===void 0||_.mutation instanceof Ve)?o=o.insert(d.key,d):_!==void 0?(a.set(d.key,_.mutation.getFieldMask()),Nn(_.mutation,d,_.mutation.getFieldMask(),Z.now())):a.set(d.key,kt.empty())})),this.recalculateAndSaveOverlays(t,o).next((h=>(h.forEach(((d,_)=>a.set(d,_))),e.forEach(((d,_)=>u.set(d,new km(_,a.get(d)??null)))),u)))}recalculateAndSaveOverlays(t,e){const r=kn();let s=new tt(((a,u)=>a-u)),o=$();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((a=>{for(const u of a)u.keys().forEach((h=>{const d=e.get(h);if(d===null)return;let _=r.get(h)||kt.empty();_=u.applyToLocalView(d,_),r.set(h,_);const v=(s.get(u.batchId)||$()).add(h);s=s.insert(u.batchId,v)}))})).next((()=>{const a=[],u=s.getReverseIterator();for(;u.hasNext();){const h=u.getNext(),d=h.key,_=h.value,v=El();_.forEach((S=>{if(!o.has(S)){const b=Sl(e.get(S),r.get(S));b!==null&&v.set(S,b),o=o.add(S)}})),a.push(this.documentOverlayCache.saveOverlays(t,d,v))}return R.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((r=>this.recalculateAndSaveOverlays(t,r)))}getDocumentsMatchingQuery(t,e,r,s){return(function(a){return O.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Mf(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,s):this.getDocumentsMatchingCollectionQuery(t,e,r,s)}getNextDocuments(t,e,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,s).next((o=>{const a=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,s-o.size):R.resolve(Te());let u=Bn,h=o;return a.next((d=>R.forEach(d,((_,v)=>(u<v.largestBatchId&&(u=v.largestBatchId),o.get(_)?R.resolve():this.remoteDocumentCache.getEntry(t,_).next((S=>{h=h.insert(_,S)}))))).next((()=>this.populateOverlays(t,d,o))).next((()=>this.computeViews(t,h,d,$()))).next((_=>({batchId:u,changes:yl(_)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new O(e)).next((r=>{let s=Rn();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(t,e,r,s){const o=e.collectionGroup;let a=Rn();return this.indexManager.getCollectionParents(t,o).next((u=>R.forEach(u,(h=>{const d=(function(v,S){return new cs(S,null,v.explicitOrderBy.slice(),v.filters.slice(),v.limit,v.limitType,v.startAt,v.endAt)})(e,h.child(o));return this.getDocumentsMatchingCollectionQuery(t,d,r,s).next((_=>{_.forEach(((v,S)=>{a=a.insert(v,S)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(t,e,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next((a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,o,s)))).next((a=>{o.forEach(((h,d)=>{const _=d.getKey();a.get(_)===null&&(a=a.insert(_,Et.newInvalidDocument(_)))}));let u=Rn();return a.forEach(((h,d)=>{const _=o.get(h);_!==void 0&&Nn(_.mutation,d,kt.empty(),Z.now()),us(e,d)&&(u=u.insert(h,d))})),u}))}}class Mm{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return R.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,(function(s){return{id:s.id,version:s.version,createTime:Bt(s.createTime)}})(e)),R.resolve()}getNamedQuery(t,e){return R.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,(function(s){return{name:s.name,query:wm(s.bundledQuery),readTime:Bt(s.readTime)}})(e)),R.resolve()}}class Om{constructor(){this.overlays=new tt(O.comparator),this.qr=new Map}getOverlay(t,e){return R.resolve(this.overlays.get(e))}getOverlays(t,e){const r=Te();return R.forEach(e,(s=>this.getOverlay(t,s).next((o=>{o!==null&&r.set(s,o)})))).next((()=>r))}saveOverlays(t,e,r){return r.forEach(((s,o)=>{this.St(t,e,o)})),R.resolve()}removeOverlaysForBatchId(t,e,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),R.resolve()}getOverlaysForCollection(t,e,r){const s=Te(),o=e.length+1,a=new O(e.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const h=u.getNext().value,d=h.getKey();if(!e.isPrefixOf(d.path))break;d.path.length===o&&h.largestBatchId>r&&s.set(h.getKey(),h)}return R.resolve(s)}getOverlaysForCollectionGroup(t,e,r,s){let o=new tt(((d,_)=>d-_));const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===e&&d.largestBatchId>r){let _=o.get(d.largestBatchId);_===null&&(_=Te(),o=o.insert(d.largestBatchId,_)),_.set(d.getKey(),d)}}const u=Te(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((d,_)=>u.set(d,_))),!(u.size()>=s)););return R.resolve(u)}St(t,e,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Zf(e,r));let o=this.qr.get(e);o===void 0&&(o=$(),this.qr.set(e,o)),this.qr.set(e,o.add(r.key))}}class xm{constructor(){this.sessionToken=gt.EMPTY_BYTE_STRING}getSessionToken(t){return R.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,R.resolve()}}class Hi{constructor(){this.Qr=new lt(dt.$r),this.Ur=new lt(dt.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){const r=new dt(t,e);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(t,e){t.forEach((r=>this.addReference(r,e)))}removeReference(t,e){this.Gr(new dt(t,e))}zr(t,e){t.forEach((r=>this.removeReference(r,e)))}jr(t){const e=new O(new Y([])),r=new dt(e,t),s=new dt(e,t+1),o=[];return this.Ur.forEachInRange([r,s],(a=>{this.Gr(a),o.push(a.key)})),o}Jr(){this.Qr.forEach((t=>this.Gr(t)))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){const e=new O(new Y([])),r=new dt(e,t),s=new dt(e,t+1);let o=$();return this.Ur.forEachInRange([r,s],(a=>{o=o.add(a.key)})),o}containsKey(t){const e=new dt(t,0),r=this.Qr.firstAfterOrEqual(e);return r!==null&&t.isEqual(r.key)}}class dt{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return O.comparator(t.key,e.key)||q(t.Yr,e.Yr)}static Kr(t,e){return q(t.Yr,e.Yr)||O.comparator(t.key,e.key)}}class Lm{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new lt(dt.$r)}checkEmpty(t){return R.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,r,s){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Yf(o,e,r,s);this.mutationQueue.push(a);for(const u of s)this.Zr=this.Zr.add(new dt(u.key,o)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast());return R.resolve(a)}lookupMutationBatch(t,e){return R.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){const r=e+1,s=this.ei(r),o=s<0?0:s;return R.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return R.resolve(this.mutationQueue.length===0?Oi:this.tr-1)}getAllMutationBatches(t){return R.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const r=new dt(e,0),s=new dt(e,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,s],(a=>{const u=this.Xr(a.Yr);o.push(u)})),R.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new lt(q);return e.forEach((s=>{const o=new dt(s,0),a=new dt(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,a],(u=>{r=r.add(u.Yr)}))})),R.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(t,e){const r=e.path,s=r.length+1;let o=r;O.isDocumentKey(o)||(o=o.child(""));const a=new dt(new O(o),0);let u=new lt(q);return this.Zr.forEachWhile((h=>{const d=h.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(u=u.add(h.Yr)),!0)}),a),R.resolve(this.ti(u))}ti(t){const e=[];return t.forEach((r=>{const s=this.Xr(r);s!==null&&e.push(s)})),e}removeMutationBatch(t,e){Q(this.ni(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return R.forEach(e.mutations,(s=>{const o=new dt(s.key,e.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.Zr=r}))}ir(t){}containsKey(t,e){const r=new dt(e,0),s=this.Zr.firstAfterOrEqual(r);return R.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,R.resolve()}ni(t,e){return this.ei(t)}ei(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Xr(t){const e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Fm{constructor(t){this.ri=t,this.docs=(function(){return new tt(O.comparator)})(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const r=e.key,s=this.docs.get(r),o=s?s.size:0,a=this.ri(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const r=this.docs.get(e);return R.resolve(r?r.document.mutableCopy():Et.newInvalidDocument(e))}getEntries(t,e){let r=Kt();return e.forEach((s=>{const o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():Et.newInvalidDocument(s))})),R.resolve(r)}getDocumentsMatchingQuery(t,e,r,s){let o=Kt();const a=e.path,u=new O(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){const{key:d,value:{document:_}}=h.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||hf(uf(_),r)<=0||(s.has(_.key)||us(e,_))&&(o=o.insert(_.key,_.mutableCopy()))}return R.resolve(o)}getAllFromCollectionGroup(t,e,r,s){L(9500)}ii(t,e){return R.forEach(this.docs,(r=>e(r)))}newChangeBuffer(t){return new Bm(this)}getSize(t){return R.resolve(this.size)}}class Bm extends Dm{constructor(t){super(),this.Nr=t}applyChanges(t){const e=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?e.push(this.Nr.addEntry(t,s)):this.Nr.removeEntry(r)})),R.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}}class Um{constructor(t){this.persistence=t,this.si=new Pe((e=>Fi(e)),Bi),this.lastRemoteSnapshotVersion=F.min(),this.highestTargetId=0,this.oi=0,this._i=new Hi,this.targetCount=0,this.ai=tn.ur()}forEachTarget(t,e){return this.si.forEach(((r,s)=>e(s))),R.resolve()}getLastRemoteSnapshotVersion(t){return R.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return R.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),R.resolve(this.highestTargetId)}setTargetsMetadata(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this.oi&&(this.oi=e),R.resolve()}Pr(t){this.si.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.ai=new tn(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,R.resolve()}updateTargetData(t,e){return this.Pr(e),R.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,R.resolve()}removeTargets(t,e,r){let s=0;const o=[];return this.si.forEach(((a,u)=>{u.sequenceNumber<=e&&r.get(u.targetId)===null&&(this.si.delete(a),o.push(this.removeMatchingKeysForTargetId(t,u.targetId)),s++)})),R.waitFor(o).next((()=>s))}getTargetCount(t){return R.resolve(this.targetCount)}getTargetData(t,e){const r=this.si.get(e)||null;return R.resolve(r)}addMatchingKeys(t,e,r){return this._i.Wr(e,r),R.resolve()}removeMatchingKeys(t,e,r){this._i.zr(e,r);const s=this.persistence.referenceDelegate,o=[];return s&&e.forEach((a=>{o.push(s.markPotentiallyOrphaned(t,a))})),R.waitFor(o)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),R.resolve()}getMatchingKeysForTargetId(t,e){const r=this._i.Hr(e);return R.resolve(r)}containsKey(t,e){return R.resolve(this._i.containsKey(e))}}class Fl{constructor(t,e){this.ui={},this.overlays={},this.ci=new is(0),this.li=!1,this.li=!0,this.hi=new xm,this.referenceDelegate=t(this),this.Pi=new Um(this),this.indexManager=new Am,this.remoteDocumentCache=(function(s){return new Fm(s)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new Im(e),this.Ii=new Mm(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Om,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let r=this.ui[t.toKey()];return r||(r=new Lm(e,this.referenceDelegate),this.ui[t.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,r){D("MemoryPersistence","Starting transaction:",t);const s=new jm(this.ci.next());return this.referenceDelegate.Ei(),r(s).next((o=>this.referenceDelegate.di(s).next((()=>o)))).toPromise().then((o=>(s.raiseOnCommittedEvent(),o)))}Ai(t,e){return R.or(Object.values(this.ui).map((r=>()=>r.containsKey(t,e))))}}class jm extends ff{constructor(t){super(),this.currentSequenceNumber=t}}class Ki{constructor(t){this.persistence=t,this.Ri=new Hi,this.Vi=null}static mi(t){return new Ki(t)}get fi(){if(this.Vi)return this.Vi;throw L(60996)}addReference(t,e,r){return this.Ri.addReference(r,e),this.fi.delete(r.toString()),R.resolve()}removeReference(t,e,r){return this.Ri.removeReference(r,e),this.fi.add(r.toString()),R.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),R.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach((s=>this.fi.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((s=>{s.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(t,e)))}Ei(){this.Vi=new Set}di(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return R.forEach(this.fi,(r=>{const s=O.fromPath(r);return this.gi(t,s).next((o=>{o||e.removeEntry(s,F.min())}))})).next((()=>(this.Vi=null,e.apply(t))))}updateLimboDocument(t,e){return this.gi(t,e).next((r=>{r?this.fi.delete(e.toString()):this.fi.add(e.toString())}))}Ti(t){return 0}gi(t,e){return R.or([()=>R.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}}class Xr{constructor(t,e){this.persistence=t,this.pi=new Pe((r=>pf(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=Vm(this,e)}static mi(t,e){return new Xr(t,e)}Ei(){}di(t){return R.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){const e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next((r=>e.next((s=>r+s))))}wr(t){let e=0;return this.pr(t,(r=>{e++})).next((()=>e))}pr(t,e){return R.forEach(this.pi,((r,s)=>this.br(t,r,s).next((o=>o?R.resolve():e(s)))))}removeTargets(t,e,r){return this.persistence.getTargetCache().removeTargets(t,e,r)}removeOrphanedDocuments(t,e){let r=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ii(t,(a=>this.br(t,a,e).next((u=>{u||(r++,o.removeEntry(a,F.min()))})))).next((()=>o.apply(t))).next((()=>r))}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),R.resolve()}removeTarget(t,e){const r=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,r)}addReference(t,e,r){return this.pi.set(r,t.currentSequenceNumber),R.resolve()}removeReference(t,e,r){return this.pi.set(r,t.currentSequenceNumber),R.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),R.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Vr(t.data.value)),e}br(t,e,r){return R.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const s=this.pi.get(e);return R.resolve(s!==void 0&&s>r)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class Wi{constructor(t,e,r,s){this.targetId=t,this.fromCache=e,this.Es=r,this.ds=s}static As(t,e){let r=$(),s=$();for(const o of e.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new Wi(t,e.fromCache,r,s)}}class qm{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class $m{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return Dh()?8:mf(Ph())>0?6:4})()}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,r,s){const o={result:null};return this.ys(t,e).next((a=>{o.result=a})).next((()=>{if(!o.result)return this.ws(t,e,s,r).next((a=>{o.result=a}))})).next((()=>{if(o.result)return;const a=new qm;return this.Ss(t,e,a).next((u=>{if(o.result=u,this.Vs)return this.bs(t,e,a,u.size)}))})).next((()=>o.result))}bs(t,e,r,s){return r.documentReadCount<this.fs?(Oe()<=G.DEBUG&&D("QueryEngine","SDK will not create cache indexes for query:",xe(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),R.resolve()):(Oe()<=G.DEBUG&&D("QueryEngine","Query:",xe(e),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(Oe()<=G.DEBUG&&D("QueryEngine","The SDK decides to create cache indexes for query:",xe(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Ft(e))):R.resolve())}ys(t,e){if(Qa(e))return R.resolve(null);let r=Ft(e);return this.indexManager.getIndexType(t,r).next((s=>s===0?null:(e.limit!==null&&s===1&&(e=li(e,null,"F"),r=Ft(e)),this.indexManager.getDocumentsMatchingTarget(t,r).next((o=>{const a=$(...o);return this.ps.getDocuments(t,a).next((u=>this.indexManager.getMinOffset(t,r).next((h=>{const d=this.Ds(e,u);return this.Cs(e,d,a,h.readTime)?this.ys(t,li(e,null,"F")):this.vs(t,d,e,h)}))))})))))}ws(t,e,r,s){return Qa(e)||s.isEqual(F.min())?R.resolve(null):this.ps.getDocuments(t,r).next((o=>{const a=this.Ds(e,o);return this.Cs(e,a,r,s)?R.resolve(null):(Oe()<=G.DEBUG&&D("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),xe(e)),this.vs(t,a,e,lf(s,Bn)).next((u=>u)))}))}Ds(t,e){let r=new lt(pl(t));return e.forEach(((s,o)=>{us(t,o)&&(r=r.add(o))})),r}Cs(t,e,r,s){if(t.limit===null)return!1;if(r.size!==e.size)return!0;const o=t.limitType==="F"?e.last():e.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}Ss(t,e,r){return Oe()<=G.DEBUG&&D("QueryEngine","Using full collection scan to execute query:",xe(e)),this.ps.getDocumentsMatchingQuery(t,e,ae.min(),r)}vs(t,e,r,s){return this.ps.getDocumentsMatchingQuery(t,r,s).next((o=>(e.forEach((a=>{o=o.insert(a.key,a)})),o)))}}const Qi="LocalStore",zm=3e8;class Gm{constructor(t,e,r,s){this.persistence=t,this.Fs=e,this.serializer=s,this.Ms=new tt(q),this.xs=new Pe((o=>Fi(o)),Bi),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(r)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Nm(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ms)))}}function Hm(n,t,e,r){return new Gm(n,t,e,r)}async function Bl(n,t){const e=B(n);return await e.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return e.mutationQueue.getAllMutationBatches(r).next((o=>(s=o,e.Bs(t),e.mutationQueue.getAllMutationBatches(r)))).next((o=>{const a=[],u=[];let h=$();for(const d of s){a.push(d.batchId);for(const _ of d.mutations)h=h.add(_.key)}for(const d of o){u.push(d.batchId);for(const _ of d.mutations)h=h.add(_.key)}return e.localDocuments.getDocuments(r,h).next((d=>({Ls:d,removedBatchIds:a,addedBatchIds:u})))}))}))}function Km(n,t){const e=B(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=t.batch.keys(),o=e.Ns.newChangeBuffer({trackRemovals:!0});return(function(u,h,d,_){const v=d.batch,S=v.keys();let b=R.resolve();return S.forEach((N=>{b=b.next((()=>_.getEntry(h,N))).next((x=>{const V=d.docVersions.get(N);Q(V!==null,48541),x.version.compareTo(V)<0&&(v.applyToRemoteDocument(x,d),x.isValidDocument()&&(x.setReadTime(d.commitVersion),_.addEntry(x)))}))})),b.next((()=>u.mutationQueue.removeMutationBatch(h,v)))})(e,r,t,o).next((()=>o.apply(r))).next((()=>e.mutationQueue.performConsistencyCheck(r))).next((()=>e.documentOverlayCache.removeOverlaysForBatchId(r,s,t.batch.batchId))).next((()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(u){let h=$();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(h=h.add(u.batch.mutations[d].key));return h})(t)))).next((()=>e.localDocuments.getDocuments(r,s)))}))}function Ul(n){const t=B(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Pi.getLastRemoteSnapshotVersion(e)))}function Wm(n,t){const e=B(n),r=t.snapshotVersion;let s=e.Ms;return e.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const a=e.Ns.newChangeBuffer({trackRemovals:!0});s=e.Ms;const u=[];t.targetChanges.forEach(((_,v)=>{const S=s.get(v);if(!S)return;u.push(e.Pi.removeMatchingKeys(o,_.removedDocuments,v).next((()=>e.Pi.addMatchingKeys(o,_.addedDocuments,v))));let b=S.withSequenceNumber(o.currentSequenceNumber);t.targetMismatches.get(v)!==null?b=b.withResumeToken(gt.EMPTY_BYTE_STRING,F.min()).withLastLimboFreeSnapshotVersion(F.min()):_.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(_.resumeToken,r)),s=s.insert(v,b),(function(x,V,H){return x.resumeToken.approximateByteSize()===0||V.snapshotVersion.toMicroseconds()-x.snapshotVersion.toMicroseconds()>=zm?!0:H.addedDocuments.size+H.modifiedDocuments.size+H.removedDocuments.size>0})(S,b,_)&&u.push(e.Pi.updateTargetData(o,b))}));let h=Kt(),d=$();if(t.documentUpdates.forEach((_=>{t.resolvedLimboDocuments.has(_)&&u.push(e.persistence.referenceDelegate.updateLimboDocument(o,_))})),u.push(Qm(o,a,t.documentUpdates).next((_=>{h=_.ks,d=_.qs}))),!r.isEqual(F.min())){const _=e.Pi.getLastRemoteSnapshotVersion(o).next((v=>e.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));u.push(_)}return R.waitFor(u).next((()=>a.apply(o))).next((()=>e.localDocuments.getLocalViewOfDocuments(o,h,d))).next((()=>h))})).then((o=>(e.Ms=s,o)))}function Qm(n,t,e){let r=$(),s=$();return e.forEach((o=>r=r.add(o))),t.getEntries(n,r).next((o=>{let a=Kt();return e.forEach(((u,h)=>{const d=o.get(u);h.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(u)),h.isNoDocument()&&h.version.isEqual(F.min())?(t.removeEntry(u,h.readTime),a=a.insert(u,h)):!d.isValidDocument()||h.version.compareTo(d.version)>0||h.version.compareTo(d.version)===0&&d.hasPendingWrites?(t.addEntry(h),a=a.insert(u,h)):D(Qi,"Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",h.version)})),{ks:a,qs:s}}))}function Xm(n,t){const e=B(n);return e.persistence.runTransaction("Get next mutation batch","readonly",(r=>(t===void 0&&(t=Oi),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t))))}function Jm(n,t){const e=B(n);return e.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return e.Pi.getTargetData(r,t).next((o=>o?(s=o,R.resolve(s)):e.Pi.allocateTargetId(r).next((a=>(s=new te(t,a,"TargetPurposeListen",r.currentSequenceNumber),e.Pi.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=e.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.Ms=e.Ms.insert(r.targetId,r),e.xs.set(t,r.targetId)),r}))}async function mi(n,t,e){const r=B(n),s=r.Ms.get(t),o=e?"readwrite":"readwrite-primary";try{e||await r.persistence.runTransaction("Release target",o,(a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!an(a))throw a;D(Qi,`Failed to update sequence numbers for target ${t}: ${a}`)}r.Ms=r.Ms.remove(t),r.xs.delete(s.target)}function cc(n,t,e){const r=B(n);let s=F.min(),o=$();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(h,d,_){const v=B(h),S=v.xs.get(_);return S!==void 0?R.resolve(v.Ms.get(S)):v.Pi.getTargetData(d,_)})(r,a,Ft(t)).next((u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,u.targetId).next((h=>{o=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(a,t,e?s:F.min(),e?o:$()))).next((u=>(Ym(r,xf(t),u),{documents:u,Qs:o})))))}function Ym(n,t,e){let r=n.Os.get(t)||F.min();e.forEach(((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),n.Os.set(t,r)}class lc{constructor(){this.activeTargetIds=qf()}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Zm{constructor(){this.Mo=new lc,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,r){}addLocalQueryTarget(t,e=!0){return e&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,r){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new lc,Promise.resolve()}handleUserChange(t,e,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class tg{Oo(t){}shutdown(){}}const uc="ConnectivityMonitor";class hc{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){D(uc,"Network connectivity changed: AVAILABLE");for(const t of this.qo)t(0)}ko(){D(uc,"Network connectivity changed: UNAVAILABLE");for(const t of this.qo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Sr=null;function gi(){return Sr===null?Sr=(function(){return 268435456+Math.round(2147483648*Math.random())})():Sr++,"0x"+Sr.toString(16)}const Ws="RestConnection",eg={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class ng{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===zr?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(t,e,r,s,o){const a=gi(),u=this.zo(t,e.toUriEncodedString());D(Ws,`Sending RPC '${t}' ${a}:`,u,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,s,o);const{host:d}=new URL(u),_=Vi(d);return this.Jo(t,u,h,r,_).then((v=>(D(Ws,`Received RPC '${t}' ${a}: `,v),v)),(v=>{throw Xe(Ws,`RPC '${t}' ${a} failed with error: `,v,"url: ",u,"request:",r),v}))}Ho(t,e,r,s,o,a){return this.Go(t,e,r,s,o)}jo(t,e,r){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+sn})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((s,o)=>t[o]=s)),r&&r.headers.forEach(((s,o)=>t[o]=s))}zo(t,e){const r=eg[t];return`${this.Uo}/v1/${e}:${r}`}terminate(){}}class rg{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}}const _t="WebChannelConnection";class sg extends ng{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,r,s,o){const a=gi();return new Promise(((u,h)=>{const d=new zc;d.setWithCredentials(!0),d.listenOnce(Gc.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case Pr.NO_ERROR:const v=d.getResponseJson();D(_t,`XHR for RPC '${t}' ${a} received:`,JSON.stringify(v)),u(v);break;case Pr.TIMEOUT:D(_t,`RPC '${t}' ${a} timed out`),h(new k(C.DEADLINE_EXCEEDED,"Request time out"));break;case Pr.HTTP_ERROR:const S=d.getStatus();if(D(_t,`RPC '${t}' ${a} failed with status:`,S,"response text:",d.getResponseText()),S>0){let b=d.getResponseJson();Array.isArray(b)&&(b=b[0]);const N=b?.error;if(N&&N.status&&N.message){const x=(function(H){const K=H.toLowerCase().replace(/_/g,"-");return Object.values(C).indexOf(K)>=0?K:C.UNKNOWN})(N.status);h(new k(x,N.message))}else h(new k(C.UNKNOWN,"Server responded with status "+d.getStatus()))}else h(new k(C.UNAVAILABLE,"Connection failed."));break;default:L(9055,{l_:t,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{D(_t,`RPC '${t}' ${a} completed.`)}}));const _=JSON.stringify(s);D(_t,`RPC '${t}' ${a} sending request:`,s),d.send(e,"POST",_,r,15)}))}T_(t,e,r){const s=gi(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=Wc(),u=Kc(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(h.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,e,r),h.encodeInitMessageHeaders=!0;const _=o.join("");D(_t,`Creating RPC '${t}' stream ${s}: ${_}`,h);const v=a.createWebChannel(_,h);this.I_(v);let S=!1,b=!1;const N=new rg({Yo:V=>{b?D(_t,`Not sending because RPC '${t}' stream ${s} is closed:`,V):(S||(D(_t,`Opening RPC '${t}' stream ${s} transport.`),v.open(),S=!0),D(_t,`RPC '${t}' stream ${s} sending:`,V),v.send(V))},Zo:()=>v.close()}),x=(V,H,K)=>{V.listen(H,(W=>{try{K(W)}catch(Tt){setTimeout((()=>{throw Tt}),0)}}))};return x(v,Sn.EventType.OPEN,(()=>{b||(D(_t,`RPC '${t}' stream ${s} transport opened.`),N.o_())})),x(v,Sn.EventType.CLOSE,(()=>{b||(b=!0,D(_t,`RPC '${t}' stream ${s} transport closed`),N.a_(),this.E_(v))})),x(v,Sn.EventType.ERROR,(V=>{b||(b=!0,Xe(_t,`RPC '${t}' stream ${s} transport errored. Name:`,V.name,"Message:",V.message),N.a_(new k(C.UNAVAILABLE,"The operation could not be completed")))})),x(v,Sn.EventType.MESSAGE,(V=>{if(!b){const H=V.data[0];Q(!!H,16349);const K=H,W=K?.error||K[0]?.error;if(W){D(_t,`RPC '${t}' stream ${s} received error:`,W);const Tt=W.status;let At=(function(m){const p=st[m];if(p!==void 0)return Cl(p)})(Tt),ut=W.message;At===void 0&&(At=C.INTERNAL,ut="Unknown error status: "+Tt+" with message "+W.message),b=!0,N.a_(new k(At,ut)),v.close()}else D(_t,`RPC '${t}' stream ${s} received:`,H),N.u_(H)}})),x(u,Hc.STAT_EVENT,(V=>{V.stat===ri.PROXY?D(_t,`RPC '${t}' stream ${s} detected buffering proxy`):V.stat===ri.NOPROXY&&D(_t,`RPC '${t}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{N.__()}),0),N}terminate(){this.c_.forEach((t=>t.close())),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter((e=>e===t))}}function Qs(){return typeof document<"u"?document:null}function ms(n){return new cm(n,!0)}class jl{constructor(t,e,r=1e3,s=1.5,o=6e4){this.Mi=t,this.timerId=e,this.d_=r,this.A_=s,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();const e=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,e-r);s>0&&D("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${e} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),t()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const dc="PersistentStream";class ql{constructor(t,e,r,s,o,a,u,h){this.Mi=t,this.S_=r,this.b_=s,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new jl(t,e)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(t){this.Q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():e&&e.code===C.RESOURCE_EXHAUSTED?(Ht(e.toString()),Ht("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===C.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.r_(e)}K_(){}auth(){this.state=1;const t=this.W_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===e&&this.G_(r,s)}),(r=>{t((()=>{const s=new k(C.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(t,e){const r=this.W_(this.D_);this.stream=this.j_(t,e),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(t){return D(dc,`close with error: ${t}`),this.stream=null,this.close(4,t)}W_(t){return e=>{this.Mi.enqueueAndForget((()=>this.D_===t?e():(D(dc,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class ig extends ql{constructor(t,e,r,s,o,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,r,s,a),this.serializer=o}j_(t,e){return this.connection.T_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();const e=hm(this.serializer,t),r=(function(o){if(!("targetChange"in o))return F.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?F.min():a.readTime?Bt(a.readTime):F.min()})(t);return this.listener.H_(e,r)}Y_(t){const e={};e.database=fi(this.serializer),e.addTarget=(function(o,a){let u;const h=a.target;if(u=ci(h)?{documents:mm(o,h)}:{query:gm(o,h).ft},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=Vl(o,a.resumeToken);const d=ui(o,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(F.min())>0){u.readTime=Qr(o,a.snapshotVersion.toTimestamp());const d=ui(o,a.expectedCount);d!==null&&(u.expectedCount=d)}return u})(this.serializer,t);const r=_m(this.serializer,t);r&&(e.labels=r),this.q_(e)}Z_(t){const e={};e.database=fi(this.serializer),e.removeTarget=t,this.q_(e)}}class og extends ql{constructor(t,e,r,s,o,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,r,s,a),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}J_(t){return Q(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,Q(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){Q(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const e=fm(t.writeResults,t.commitTime),r=Bt(t.commitTime);return this.listener.na(r,e)}ra(){const t={};t.database=fi(this.serializer),this.q_(t)}ea(t){const e={streamToken:this.lastStreamToken,writes:t.map((r=>dm(this.serializer,r)))};this.q_(e)}}class ag{}class cg extends ag{constructor(t,e,r,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new k(C.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Go(t,hi(e,r),s,o,a))).catch((o=>{throw o.name==="FirebaseError"?(o.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new k(C.UNKNOWN,o.toString())}))}Ho(t,e,r,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,u])=>this.connection.Ho(t,hi(e,r),s,a,u,o))).catch((a=>{throw a.name==="FirebaseError"?(a.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new k(C.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class lg{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Ht(e),this.aa=!1):D("OnlineStateTracker",e)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Re="RemoteStore";class ug{constructor(t,e,r,s,o){this.localStore=t,this.datastore=e,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((a=>{r.enqueueAndForget((async()=>{De(this)&&(D(Re,"Restarting streams for network reachability change."),await(async function(h){const d=B(h);d.Ea.add(4),await er(d),d.Ra.set("Unknown"),d.Ea.delete(4),await gs(d)})(this))}))})),this.Ra=new lg(r,s)}}async function gs(n){if(De(n))for(const t of n.da)await t(!0)}async function er(n){for(const t of n.da)await t(!1)}function $l(n,t){const e=B(n);e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),Zi(e)?Yi(e):cn(e).O_()&&Ji(e,t))}function Xi(n,t){const e=B(n),r=cn(e);e.Ia.delete(t),r.O_()&&zl(e,t),e.Ia.size===0&&(r.O_()?r.L_():De(e)&&e.Ra.set("Unknown"))}function Ji(n,t){if(n.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(F.min())>0){const e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}cn(n).Y_(t)}function zl(n,t){n.Va.Ue(t),cn(n).Z_(t)}function Yi(n){n.Va=new sm({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),At:t=>n.Ia.get(t)||null,ht:()=>n.datastore.serializer.databaseId}),cn(n).start(),n.Ra.ua()}function Zi(n){return De(n)&&!cn(n).x_()&&n.Ia.size>0}function De(n){return B(n).Ea.size===0}function Gl(n){n.Va=void 0}async function hg(n){n.Ra.set("Online")}async function dg(n){n.Ia.forEach(((t,e)=>{Ji(n,t)}))}async function fg(n,t){Gl(n),Zi(n)?(n.Ra.ha(t),Yi(n)):n.Ra.set("Unknown")}async function mg(n,t,e){if(n.Ra.set("Online"),t instanceof Pl&&t.state===2&&t.cause)try{await(async function(s,o){const a=o.cause;for(const u of o.targetIds)s.Ia.has(u)&&(await s.remoteSyncer.rejectListen(u,a),s.Ia.delete(u),s.Va.removeTarget(u))})(n,t)}catch(r){D(Re,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await Jr(n,r)}else if(t instanceof Nr?n.Va.Ze(t):t instanceof bl?n.Va.st(t):n.Va.tt(t),!e.isEqual(F.min()))try{const r=await Ul(n.localStore);e.compareTo(r)>=0&&await(function(o,a){const u=o.Va.Tt(a);return u.targetChanges.forEach(((h,d)=>{if(h.resumeToken.approximateByteSize()>0){const _=o.Ia.get(d);_&&o.Ia.set(d,_.withResumeToken(h.resumeToken,a))}})),u.targetMismatches.forEach(((h,d)=>{const _=o.Ia.get(h);if(!_)return;o.Ia.set(h,_.withResumeToken(gt.EMPTY_BYTE_STRING,_.snapshotVersion)),zl(o,h);const v=new te(_.target,h,d,_.sequenceNumber);Ji(o,v)})),o.remoteSyncer.applyRemoteEvent(u)})(n,e)}catch(r){D(Re,"Failed to raise snapshot:",r),await Jr(n,r)}}async function Jr(n,t,e){if(!an(t))throw t;n.Ea.add(1),await er(n),n.Ra.set("Offline"),e||(e=()=>Ul(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{D(Re,"Retrying IndexedDB access"),await e(),n.Ea.delete(1),await gs(n)}))}function Hl(n,t){return t().catch((e=>Jr(n,e,t)))}async function ps(n){const t=B(n),e=he(t);let r=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:Oi;for(;gg(t);)try{const s=await Xm(t.localStore,r);if(s===null){t.Ta.length===0&&e.L_();break}r=s.batchId,pg(t,s)}catch(s){await Jr(t,s)}Kl(t)&&Wl(t)}function gg(n){return De(n)&&n.Ta.length<10}function pg(n,t){n.Ta.push(t);const e=he(n);e.O_()&&e.X_&&e.ea(t.mutations)}function Kl(n){return De(n)&&!he(n).x_()&&n.Ta.length>0}function Wl(n){he(n).start()}async function _g(n){he(n).ra()}async function yg(n){const t=he(n);for(const e of n.Ta)t.ea(e.mutations)}async function Eg(n,t,e){const r=n.Ta.shift(),s=$i.from(r,t,e);await Hl(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await ps(n)}async function Tg(n,t){t&&he(n).X_&&await(async function(r,s){if((function(a){return em(a)&&a!==C.ABORTED})(s.code)){const o=r.Ta.shift();he(r).B_(),await Hl(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s))),await ps(r)}})(n,t),Kl(n)&&Wl(n)}async function fc(n,t){const e=B(n);e.asyncQueue.verifyOperationInProgress(),D(Re,"RemoteStore received new credentials");const r=De(e);e.Ea.add(3),await er(e),r&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await gs(e)}async function vg(n,t){const e=B(n);t?(e.Ea.delete(2),await gs(e)):t||(e.Ea.add(2),await er(e),e.Ra.set("Unknown"))}function cn(n){return n.ma||(n.ma=(function(e,r,s){const o=B(e);return o.sa(),new ig(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:hg.bind(null,n),t_:dg.bind(null,n),r_:fg.bind(null,n),H_:mg.bind(null,n)}),n.da.push((async t=>{t?(n.ma.B_(),Zi(n)?Yi(n):n.Ra.set("Unknown")):(await n.ma.stop(),Gl(n))}))),n.ma}function he(n){return n.fa||(n.fa=(function(e,r,s){const o=B(e);return o.sa(),new og(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:_g.bind(null,n),r_:Tg.bind(null,n),ta:yg.bind(null,n),na:Eg.bind(null,n)}),n.da.push((async t=>{t?(n.fa.B_(),await ps(n)):(await n.fa.stop(),n.Ta.length>0&&(D(Re,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class to{constructor(t,e,r,s,o){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new se,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,r,s,o){const a=Date.now()+r,u=new to(t,e,a,s,o);return u.start(r),u}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new k(C.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function eo(n,t){if(Ht("AsyncQueue",`${t}: ${n}`),an(n))return new k(C.UNAVAILABLE,`${t}: ${n}`);throw n}class $e{static emptySet(t){return new $e(t.comparator)}constructor(t){this.comparator=t?(e,r)=>t(e,r)||O.comparator(e.key,r.key):(e,r)=>O.comparator(e.key,r.key),this.keyedMap=Rn(),this.sortedSet=new tt(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,r)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof $e)||this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;e.hasNext();){const s=e.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){const r=new $e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=e,r}}class mc{constructor(){this.ga=new tt(O.comparator)}track(t){const e=t.doc.key,r=this.ga.get(e);r?t.type!==0&&r.type===3?this.ga=this.ga.insert(e,t):t.type===3&&r.type!==1?this.ga=this.ga.insert(e,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.ga=this.ga.remove(e):t.type===1&&r.type===2?this.ga=this.ga.insert(e,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):L(63341,{Rt:t,pa:r}):this.ga=this.ga.insert(e,t)}ya(){const t=[];return this.ga.inorderTraversal(((e,r)=>{t.push(r)})),t}}class en{constructor(t,e,r,s,o,a,u,h,d){this.query=t,this.docs=e,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=d}static fromInitialDocuments(t,e,r,s,o){const a=[];return e.forEach((u=>{a.push({type:0,doc:u})})),new en(t,e,$e.emptySet(e),a,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&ls(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,r=t.docChanges;if(e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==r[s].type||!e[s].doc.isEqual(r[s].doc))return!1;return!0}}class Ig{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((t=>t.Da()))}}class wg{constructor(){this.queries=gc(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(e,r){const s=B(e),o=s.queries;s.queries=gc(),o.forEach(((a,u)=>{for(const h of u.Sa)h.onError(r)}))})(this,new k(C.ABORTED,"Firestore shutting down"))}}function gc(){return new Pe((n=>gl(n)),ls)}async function Ql(n,t){const e=B(n);let r=3;const s=t.query;let o=e.queries.get(s);o?!o.ba()&&t.Da()&&(r=2):(o=new Ig,r=t.Da()?0:1);try{switch(r){case 0:o.wa=await e.onListen(s,!0);break;case 1:o.wa=await e.onListen(s,!1);break;case 2:await e.onFirstRemoteStoreListen(s)}}catch(a){const u=eo(a,`Initialization of query '${xe(t.query)}' failed`);return void t.onError(u)}e.queries.set(s,o),o.Sa.push(t),t.va(e.onlineState),o.wa&&t.Fa(o.wa)&&no(e)}async function Xl(n,t){const e=B(n),r=t.query;let s=3;const o=e.queries.get(r);if(o){const a=o.Sa.indexOf(t);a>=0&&(o.Sa.splice(a,1),o.Sa.length===0?s=t.Da()?0:1:!o.ba()&&t.Da()&&(s=2))}switch(s){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function Ag(n,t){const e=B(n);let r=!1;for(const s of t){const o=s.query,a=e.queries.get(o);if(a){for(const u of a.Sa)u.Fa(s)&&(r=!0);a.wa=s}}r&&no(e)}function Sg(n,t,e){const r=B(n),s=r.queries.get(t);if(s)for(const o of s.Sa)o.onError(e);r.queries.delete(t)}function no(n){n.Ca.forEach((t=>{t.next()}))}var pi,pc;(pc=pi||(pi={})).Ma="default",pc.Cache="cache";class Jl{constructor(t,e,r){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(t){if(!this.options.includeMetadataChanges){const r=[];for(const s of t.docChanges)s.type!==3&&r.push(s);t=new en(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache||!this.Da())return!0;const r=e!=="Offline";return(!this.options.qa||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Ba(t){if(t.docChanges.length>0)return!0;const e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}ka(t){t=en.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==pi.Cache}}class Yl{constructor(t){this.key=t}}class Zl{constructor(t){this.key=t}}class Rg{constructor(t,e){this.query=t,this.Ya=e,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=$(),this.mutatedKeys=$(),this.eu=pl(t),this.tu=new $e(this.eu)}get nu(){return this.Ya}ru(t,e){const r=e?e.iu:new mc,s=e?e.tu:this.tu;let o=e?e.mutatedKeys:this.mutatedKeys,a=s,u=!1;const h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((_,v)=>{const S=s.get(_),b=us(this.query,v)?v:null,N=!!S&&this.mutatedKeys.has(S.key),x=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations);let V=!1;S&&b?S.data.isEqual(b.data)?N!==x&&(r.track({type:3,doc:b}),V=!0):this.su(S,b)||(r.track({type:2,doc:b}),V=!0,(h&&this.eu(b,h)>0||d&&this.eu(b,d)<0)&&(u=!0)):!S&&b?(r.track({type:0,doc:b}),V=!0):S&&!b&&(r.track({type:1,doc:S}),V=!0,(h||d)&&(u=!0)),V&&(b?(a=a.add(b),o=x?o.add(_):o.delete(_)):(a=a.delete(_),o=o.delete(_)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const _=this.query.limitType==="F"?a.last():a.first();a=a.delete(_.key),o=o.delete(_.key),r.track({type:1,doc:_})}return{tu:a,iu:r,Cs:u,mutatedKeys:o}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,r,s){const o=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const a=t.iu.ya();a.sort(((_,v)=>(function(b,N){const x=V=>{switch(V){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L(20277,{Rt:V})}};return x(b)-x(N)})(_.type,v.type)||this.eu(_.doc,v.doc))),this.ou(r),s=s??!1;const u=e&&!s?this._u():[],h=this.Xa.size===0&&this.current&&!s?1:0,d=h!==this.Za;return this.Za=h,a.length!==0||d?{snapshot:new en(this.query,t.tu,o,a,t.mutatedKeys,h===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new mc,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach((e=>this.Ya=this.Ya.add(e))),t.modifiedDocuments.forEach((e=>{})),t.removedDocuments.forEach((e=>this.Ya=this.Ya.delete(e))),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Xa;this.Xa=$(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const e=[];return t.forEach((r=>{this.Xa.has(r)||e.push(new Zl(r))})),this.Xa.forEach((r=>{t.has(r)||e.push(new Yl(r))})),e}cu(t){this.Ya=t.Qs,this.Xa=$();const e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return en.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const ro="SyncEngine";class Cg{constructor(t,e,r){this.query=t,this.targetId=e,this.view=r}}class bg{constructor(t){this.key=t,this.hu=!1}}class Pg{constructor(t,e,r,s,o,a){this.localStore=t,this.remoteStore=e,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Pe((u=>gl(u)),ls),this.Iu=new Map,this.Eu=new Set,this.du=new tt(O.comparator),this.Au=new Map,this.Ru=new Hi,this.Vu={},this.mu=new Map,this.fu=tn.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function Vg(n,t,e=!0){const r=iu(n);let s;const o=r.Tu.get(t);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.lu()):s=await tu(r,t,e,!0),s}async function Dg(n,t){const e=iu(n);await tu(e,t,!0,!1)}async function tu(n,t,e,r){const s=await Jm(n.localStore,Ft(t)),o=s.targetId,a=n.sharedClientState.addLocalQueryTarget(o,e);let u;return r&&(u=await kg(n,t,o,a==="current",s.resumeToken)),n.isPrimaryClient&&e&&$l(n.remoteStore,s),u}async function kg(n,t,e,r,s){n.pu=(v,S,b)=>(async function(x,V,H,K){let W=V.view.ru(H);W.Cs&&(W=await cc(x.localStore,V.query,!1).then((({documents:E})=>V.view.ru(E,W))));const Tt=K&&K.targetChanges.get(V.targetId),At=K&&K.targetMismatches.get(V.targetId)!=null,ut=V.view.applyChanges(W,x.isPrimaryClient,Tt,At);return yc(x,V.targetId,ut.au),ut.snapshot})(n,v,S,b);const o=await cc(n.localStore,t,!0),a=new Rg(t,o.Qs),u=a.ru(o.documents),h=tr.createSynthesizedTargetChangeForCurrentChange(e,r&&n.onlineState!=="Offline",s),d=a.applyChanges(u,n.isPrimaryClient,h);yc(n,e,d.au);const _=new Cg(t,e,a);return n.Tu.set(t,_),n.Iu.has(e)?n.Iu.get(e).push(t):n.Iu.set(e,[t]),d.snapshot}async function Ng(n,t,e){const r=B(n),s=r.Tu.get(t),o=r.Iu.get(s.targetId);if(o.length>1)return r.Iu.set(s.targetId,o.filter((a=>!ls(a,t)))),void r.Tu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await mi(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),e&&Xi(r.remoteStore,s.targetId),_i(r,s.targetId)})).catch(on)):(_i(r,s.targetId),await mi(r.localStore,s.targetId,!0))}async function Mg(n,t){const e=B(n),r=e.Tu.get(t),s=e.Iu.get(r.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),Xi(e.remoteStore,r.targetId))}async function Og(n,t,e){const r=qg(n);try{const s=await(function(a,u){const h=B(a),d=Z.now(),_=u.reduce(((b,N)=>b.add(N.key)),$());let v,S;return h.persistence.runTransaction("Locally write mutations","readwrite",(b=>{let N=Kt(),x=$();return h.Ns.getEntries(b,_).next((V=>{N=V,N.forEach(((H,K)=>{K.isValidDocument()||(x=x.add(H))}))})).next((()=>h.localDocuments.getOverlayedDocuments(b,N))).next((V=>{v=V;const H=[];for(const K of u){const W=Xf(K,v.get(K.key).overlayedDocument);W!=null&&H.push(new Ve(K.key,W,cl(W.value.mapValue),Nt.exists(!0)))}return h.mutationQueue.addMutationBatch(b,d,H,u)})).next((V=>{S=V;const H=V.applyToLocalDocumentSet(v,x);return h.documentOverlayCache.saveOverlays(b,V.batchId,H)}))})).then((()=>({batchId:S.batchId,changes:yl(v)})))})(r.localStore,t);r.sharedClientState.addPendingMutation(s.batchId),(function(a,u,h){let d=a.Vu[a.currentUser.toKey()];d||(d=new tt(q)),d=d.insert(u,h),a.Vu[a.currentUser.toKey()]=d})(r,s.batchId,e),await nr(r,s.changes),await ps(r.remoteStore)}catch(s){const o=eo(s,"Failed to persist write");e.reject(o)}}async function eu(n,t){const e=B(n);try{const r=await Wm(e.localStore,t);t.targetChanges.forEach(((s,o)=>{const a=e.Au.get(o);a&&(Q(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?Q(a.hu,14607):s.removedDocuments.size>0&&(Q(a.hu,42227),a.hu=!1))})),await nr(e,r,t)}catch(r){await on(r)}}function _c(n,t,e){const r=B(n);if(r.isPrimaryClient&&e===0||!r.isPrimaryClient&&e===1){const s=[];r.Tu.forEach(((o,a)=>{const u=a.view.va(t);u.snapshot&&s.push(u.snapshot)})),(function(a,u){const h=B(a);h.onlineState=u;let d=!1;h.queries.forEach(((_,v)=>{for(const S of v.Sa)S.va(u)&&(d=!0)})),d&&no(h)})(r.eventManager,t),s.length&&r.Pu.H_(s),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function xg(n,t,e){const r=B(n);r.sharedClientState.updateQueryState(t,"rejected",e);const s=r.Au.get(t),o=s&&s.key;if(o){let a=new tt(O.comparator);a=a.insert(o,Et.newNoDocument(o,F.min()));const u=$().add(o),h=new fs(F.min(),new Map,new tt(q),a,u);await eu(r,h),r.du=r.du.remove(o),r.Au.delete(t),so(r)}else await mi(r.localStore,t,!1).then((()=>_i(r,t,e))).catch(on)}async function Lg(n,t){const e=B(n),r=t.batch.batchId;try{const s=await Km(e.localStore,t);ru(e,r,null),nu(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await nr(e,s)}catch(s){await on(s)}}async function Fg(n,t,e){const r=B(n);try{const s=await(function(a,u){const h=B(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let _;return h.mutationQueue.lookupMutationBatch(d,u).next((v=>(Q(v!==null,37113),_=v.keys(),h.mutationQueue.removeMutationBatch(d,v)))).next((()=>h.mutationQueue.performConsistencyCheck(d))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(d,_,u))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,_))).next((()=>h.localDocuments.getDocuments(d,_)))}))})(r.localStore,t);ru(r,t,e),nu(r,t),r.sharedClientState.updateMutationState(t,"rejected",e),await nr(r,s)}catch(s){await on(s)}}function nu(n,t){(n.mu.get(t)||[]).forEach((e=>{e.resolve()})),n.mu.delete(t)}function ru(n,t,e){const r=B(n);let s=r.Vu[r.currentUser.toKey()];if(s){const o=s.get(t);o&&(e?o.reject(e):o.resolve(),s=s.remove(t)),r.Vu[r.currentUser.toKey()]=s}}function _i(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(const r of n.Iu.get(t))n.Tu.delete(r),e&&n.Pu.yu(r,e);n.Iu.delete(t),n.isPrimaryClient&&n.Ru.jr(t).forEach((r=>{n.Ru.containsKey(r)||su(n,r)}))}function su(n,t){n.Eu.delete(t.path.canonicalString());const e=n.du.get(t);e!==null&&(Xi(n.remoteStore,e),n.du=n.du.remove(t),n.Au.delete(e),so(n))}function yc(n,t,e){for(const r of e)r instanceof Yl?(n.Ru.addReference(r.key,t),Bg(n,r)):r instanceof Zl?(D(ro,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,t),n.Ru.containsKey(r.key)||su(n,r.key)):L(19791,{wu:r})}function Bg(n,t){const e=t.key,r=e.path.canonicalString();n.du.get(e)||n.Eu.has(r)||(D(ro,"New document in limbo: "+e),n.Eu.add(r),so(n))}function so(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const t=n.Eu.values().next().value;n.Eu.delete(t);const e=new O(Y.fromString(t)),r=n.fu.next();n.Au.set(r,new bg(e)),n.du=n.du.insert(e,r),$l(n.remoteStore,new te(Ft(Ui(e.path)),r,"TargetPurposeLimboResolution",is.ce))}}async function nr(n,t,e){const r=B(n),s=[],o=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((u,h)=>{a.push(r.pu(h,t,e).then((d=>{if((d||e)&&r.isPrimaryClient){const _=d?!d.fromCache:e?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,_?"current":"not-current")}if(d){s.push(d);const _=Wi.As(h.targetId,d);o.push(_)}})))})),await Promise.all(a),r.Pu.H_(s),await(async function(h,d){const _=B(h);try{await _.persistence.runTransaction("notifyLocalViewChanges","readwrite",(v=>R.forEach(d,(S=>R.forEach(S.Es,(b=>_.persistence.referenceDelegate.addReference(v,S.targetId,b))).next((()=>R.forEach(S.ds,(b=>_.persistence.referenceDelegate.removeReference(v,S.targetId,b)))))))))}catch(v){if(!an(v))throw v;D(Qi,"Failed to update sequence numbers: "+v)}for(const v of d){const S=v.targetId;if(!v.fromCache){const b=_.Ms.get(S),N=b.snapshotVersion,x=b.withLastLimboFreeSnapshotVersion(N);_.Ms=_.Ms.insert(S,x)}}})(r.localStore,o))}async function Ug(n,t){const e=B(n);if(!e.currentUser.isEqual(t)){D(ro,"User change. New user:",t.toKey());const r=await Bl(e.localStore,t);e.currentUser=t,(function(o,a){o.mu.forEach((u=>{u.forEach((h=>{h.reject(new k(C.CANCELLED,a))}))})),o.mu.clear()})(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await nr(e,r.Ls)}}function jg(n,t){const e=B(n),r=e.Au.get(t);if(r&&r.hu)return $().add(r.key);{let s=$();const o=e.Iu.get(t);if(!o)return s;for(const a of o){const u=e.Tu.get(a);s=s.unionWith(u.view.nu)}return s}}function iu(n){const t=B(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=eu.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=jg.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=xg.bind(null,t),t.Pu.H_=Ag.bind(null,t.eventManager),t.Pu.yu=Sg.bind(null,t.eventManager),t}function qg(n){const t=B(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Lg.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Fg.bind(null,t),t}class Yr{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=ms(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,e){return null}Mu(t,e){return null}vu(t){return Hm(this.persistence,new $m,t.initialUser,this.serializer)}Cu(t){return new Fl(Ki.mi,this.serializer)}Du(t){return new Zm}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Yr.provider={build:()=>new Yr};class $g extends Yr{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){Q(this.persistence.referenceDelegate instanceof Xr,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new bm(r,t.asyncQueue,e)}Cu(t){const e=this.cacheSizeBytes!==void 0?Rt.withCacheSize(this.cacheSizeBytes):Rt.DEFAULT;return new Fl((r=>Xr.mi(r,e)),this.serializer)}}class yi{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>_c(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Ug.bind(null,this.syncEngine),await vg(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return(function(){return new wg})()}createDatastore(t){const e=ms(t.databaseInfo.databaseId),r=(function(o){return new sg(o)})(t.databaseInfo);return(function(o,a,u,h){return new cg(o,a,u,h)})(t.authCredentials,t.appCheckCredentials,r,e)}createRemoteStore(t){return(function(r,s,o,a,u){return new ug(r,s,o,a,u)})(this.localStore,this.datastore,t.asyncQueue,(e=>_c(this.syncEngine,e,0)),(function(){return hc.v()?new hc:new tg})())}createSyncEngine(t,e){return(function(s,o,a,u,h,d,_){const v=new Pg(s,o,a,u,h,d);return _&&(v.gu=!0),v})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){await(async function(e){const r=B(e);D(Re,"RemoteStore shutting down."),r.Ea.add(5),await er(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}yi.provider={build:()=>new yi};class ou{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):Ht("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout((()=>{this.muted||t(e)}),0)}}const de="FirestoreClient";class zg{constructor(t,e,r,s,o){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=r,this.databaseInfo=s,this.user=yt.UNAUTHENTICATED,this.clientId=Ni.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async a=>{D(de,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(D(de,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new se;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const r=eo(e,"Failed to shutdown persistence");t.reject(r)}})),t.promise}}async function Xs(n,t){n.asyncQueue.verifyOperationInProgress(),D(de,"Initializing OfflineComponentProvider");const e=n.configuration;await t.initialize(e);let r=e.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await Bl(t.localStore,s),r=s)})),t.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=t}async function Ec(n,t){n.asyncQueue.verifyOperationInProgress();const e=await Gg(n);D(de,"Initializing OnlineComponentProvider"),await t.initialize(e,n.configuration),n.setCredentialChangeListener((r=>fc(t.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>fc(t.remoteStore,s))),n._onlineComponents=t}async function Gg(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){D(de,"Using user provided OfflineComponentProvider");try{await Xs(n,n._uninitializedComponentsProvider._offline)}catch(t){const e=t;if(!(function(s){return s.name==="FirebaseError"?s.code===C.FAILED_PRECONDITION||s.code===C.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(e))throw e;Xe("Error using user provided cache. Falling back to memory cache: "+e),await Xs(n,new Yr)}}else D(de,"Using default OfflineComponentProvider"),await Xs(n,new $g(void 0));return n._offlineComponents}async function au(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(D(de,"Using user provided OnlineComponentProvider"),await Ec(n,n._uninitializedComponentsProvider._online)):(D(de,"Using default OnlineComponentProvider"),await Ec(n,new yi))),n._onlineComponents}function Hg(n){return au(n).then((t=>t.syncEngine))}async function Ei(n){const t=await au(n),e=t.eventManager;return e.onListen=Vg.bind(null,t.syncEngine),e.onUnlisten=Ng.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=Dg.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=Mg.bind(null,t.syncEngine),e}function Kg(n,t,e={}){const r=new se;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,u,h,d){const _=new ou({next:S=>{_.Nu(),a.enqueueAndForget((()=>Xl(o,v))),S.fromCache&&h.source==="server"?d.reject(new k(C.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(S)},error:S=>d.reject(S)}),v=new Jl(u,_,{includeMetadataChanges:!0,qa:!0});return Ql(o,v)})(await Ei(n),n.asyncQueue,t,e,r))),r.promise}function cu(n){const t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}const Tc=new Map;const lu="firestore.googleapis.com",vc=!0;class Ic{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new k(C.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=lu,this.ssl=vc}else this.host=t.host,this.ssl=t.ssl??vc;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=Ll;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<Rm)throw new k(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}cf("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=cu(t.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new k(C.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new k(C.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new k(C.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class _s{constructor(t,e,r,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Ic({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new k(C.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new k(C.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Ic(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new Jd;switch(r.type){case"firstParty":return new ef(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new k(C.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(e){const r=Tc.get(e);r&&(D("ComponentProvider","Removing Datastore"),Tc.delete(e),r.terminate())})(this),Promise.resolve()}}function Wg(n,t,e,r={}){n=Lt(n,_s);const s=Vi(t),o=n._getSettings(),a={...o,emulatorOptions:n._getEmulatorOptions()},u=`${t}:${e}`;s&&(Ah(`https://${u}`),bh("Firestore",!0)),o.host!==lu&&o.host!==u&&Xe("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:u,ssl:s,emulatorOptions:r};if(!Ur(h,a)&&(n._setSettings(h),r.mockUserToken)){let d,_;if(typeof r.mockUserToken=="string")d=r.mockUserToken,_=yt.MOCK_USER;else{d=Sh(r.mockUserToken,n._app?.options.projectId);const v=r.mockUserToken.sub||r.mockUserToken.user_id;if(!v)throw new k(C.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");_=new yt(v)}n._authCredentials=new Yd(new Xc(d,_))}}class rr{constructor(t,e,r){this.converter=e,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new rr(this.firestore,t,this._query)}}class ct{constructor(t,e,r){this.converter=e,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ie(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new ct(this.firestore,t,this._key)}toJSON(){return{type:ct._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,r){if(Yn(e,ct._jsonSchema))return new ct(t,r||null,new O(Y.fromString(e.referencePath)))}}ct._jsonSchemaVersion="firestore/documentReference/1.0",ct._jsonSchema={type:it("string",ct._jsonSchemaVersion),referencePath:it("string")};class ie extends rr{constructor(t,e,r){super(t,e,Ui(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new ct(this.firestore,null,new O(t))}withConverter(t){return new ie(this.firestore,t,this._path)}}function Mn(n,t,...e){if(n=Qe(n),Jc("collection","path",t),n instanceof _s){const r=Y.fromString(t,...e);return xa(r),new ie(n,null,r)}{if(!(n instanceof ct||n instanceof ie))throw new k(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Y.fromString(t,...e));return xa(r),new ie(n.firestore,null,r)}}function nn(n,t,...e){if(n=Qe(n),arguments.length===1&&(t=Ni.newId()),Jc("doc","path",t),n instanceof _s){const r=Y.fromString(t,...e);return Oa(r),new ct(n,null,new O(r))}{if(!(n instanceof ct||n instanceof ie))throw new k(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Y.fromString(t,...e));return Oa(r),new ct(n.firestore,n instanceof ie?n.converter:null,new O(r))}}const wc="AsyncQueue";class Ac{constructor(t=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new jl(this,"async_queue_retry"),this._c=()=>{const r=Qs();r&&D(wc,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=t;const e=Qs();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const e=Qs();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise((()=>{}));const e=new se;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Xu.push(t),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!an(t))throw t;D(wc,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(t){const e=this.ac.then((()=>(this.rc=!0,t().catch((r=>{throw this.nc=r,this.rc=!1,Ht("INTERNAL UNHANDLED ERROR: ",Sc(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=e,e}enqueueAfterDelay(t,e,r){this.uc(),this.oc.indexOf(t)>-1&&(e=0);const s=to.createAndSchedule(this,t,e,r,(o=>this.hc(o)));return this.tc.push(s),s}uc(){this.nc&&L(47125,{Pc:Sc(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do t=this.ac,await t;while(t!==this.ac)}Ic(t){for(const e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then((()=>{this.tc.sort(((e,r)=>e.targetTimeMs-r.targetTimeMs));for(const e of this.tc)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Tc()}))}dc(t){this.oc.push(t)}hc(t){const e=this.tc.indexOf(t);this.tc.splice(e,1)}}function Sc(n){let t=n.message||"";return n.stack&&(t=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),t}function Rc(n){return(function(e,r){if(typeof e!="object"||e===null)return!1;const s=e;for(const o of r)if(o in s&&typeof s[o]=="function")return!0;return!1})(n,["next","error","complete"])}class Ce extends _s{constructor(t,e,r,s){super(t,e,r,s),this.type="firestore",this._queue=new Ac,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new Ac(t),this._firestoreClient=void 0,await t}}}function Qg(n,t){const e=typeof n=="object"?n:Fd(),r=typeof n=="string"?n:zr,s=Nd(e,"firestore").getImmediate({identifier:r});if(!s._initialized){const o=Ih("firestore");o&&Wg(s,...o)}return s}function io(n){if(n._terminated)throw new k(C.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Xg(n),n._firestoreClient}function Xg(n){const t=n._freezeSettings(),e=(function(s,o,a,u){return new Ef(s,o,a,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,cu(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,t);n._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),n._firestoreClient=new zg(n._authCredentials,n._appCheckCredentials,n._queue,e,n._componentsProvider&&(function(s){const o=s?._online.build();return{_offline:s?._offline.build(o),_online:o}})(n._componentsProvider))}class Pt{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Pt(gt.fromBase64String(t))}catch(e){throw new k(C.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new Pt(gt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:Pt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(Yn(t,Pt._jsonSchema))return Pt.fromBase64String(t.bytes)}}Pt._jsonSchemaVersion="firestore/bytes/1.0",Pt._jsonSchema={type:it("string",Pt._jsonSchemaVersion),bytes:it("string")};class oo{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new k(C.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new mt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class ao{constructor(t){this._methodName=t}}class Ut{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new k(C.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new k(C.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return q(this._lat,t._lat)||q(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ut._jsonSchemaVersion}}static fromJSON(t){if(Yn(t,Ut._jsonSchema))return new Ut(t.latitude,t.longitude)}}Ut._jsonSchemaVersion="firestore/geoPoint/1.0",Ut._jsonSchema={type:it("string",Ut._jsonSchemaVersion),latitude:it("number"),longitude:it("number")};class jt{constructor(t){this._values=(t||[]).map((e=>e))}toArray(){return this._values.map((t=>t))}isEqual(t){return(function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0})(this._values,t._values)}toJSON(){return{type:jt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(Yn(t,jt._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every((e=>typeof e=="number")))return new jt(t.vectorValues);throw new k(C.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}jt._jsonSchemaVersion="firestore/vectorValue/1.0",jt._jsonSchema={type:it("string",jt._jsonSchemaVersion),vectorValues:it("object")};const Jg=/^__.*__$/;class Yg{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return this.fieldMask!==null?new Ve(t,this.data,this.fieldMask,e,this.fieldTransforms):new Zn(t,this.data,e,this.fieldTransforms)}}function uu(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L(40011,{Ac:n})}}class co{constructor(t,e,r,s,o,a){this.settings=t,this.databaseId=e,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new co({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(t){const e=this.path?.child(t),r=this.Vc({path:e,fc:!1});return r.gc(t),r}yc(t){const e=this.path?.child(t),r=this.Vc({path:e,fc:!1});return r.Rc(),r}wc(t){return this.Vc({path:void 0,fc:!0})}Sc(t){return Zr(t,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return this.fieldMask.find((e=>t.isPrefixOf(e)))!==void 0||this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))!==void 0}Rc(){if(this.path)for(let t=0;t<this.path.length;t++)this.gc(this.path.get(t))}gc(t){if(t.length===0)throw this.Sc("Document fields must not be empty");if(uu(this.Ac)&&Jg.test(t))throw this.Sc('Document fields cannot begin and end with "__"')}}class Zg{constructor(t,e,r){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=r||ms(t)}Cc(t,e,r,s=!1){return new co({Ac:t,methodName:e,Dc:r,path:mt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function hu(n){const t=n._freezeSettings(),e=ms(n._databaseId);return new Zg(n._databaseId,!!t.ignoreUndefinedProperties,e)}function du(n,t,e,r,s,o={}){const a=n.Cc(o.merge||o.mergeFields?2:0,t,e,s);pu("Data must be an object, but it was:",a,r);const u=mu(r,a);let h,d;if(o.merge)h=new kt(a.fieldMask),d=a.fieldTransforms;else if(o.mergeFields){const _=[];for(const v of o.mergeFields){const S=tp(t,v,e);if(!a.contains(S))throw new k(C.INVALID_ARGUMENT,`Field '${S}' is specified in your field mask but missing from your input data.`);np(_,S)||_.push(S)}h=new kt(_),d=a.fieldTransforms.filter((v=>h.covers(v.field)))}else h=null,d=a.fieldTransforms;return new Yg(new bt(u),h,d)}class lo extends ao{_toFieldTransform(t){return new Hf(t.path,new $n)}isEqual(t){return t instanceof lo}}function fu(n,t){if(gu(n=Qe(n)))return pu("Unsupported field value:",t,n),mu(n,t);if(n instanceof ao)return(function(r,s){if(!uu(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)})(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.fc&&t.Ac!==4)throw t.Sc("Nested arrays are not supported");return(function(r,s){const o=[];let a=0;for(const u of r){let h=fu(u,s.wc(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}})(n,t)}return(function(r,s){if((r=Qe(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return $f(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=Z.fromDate(r);return{timestampValue:Qr(s.serializer,o)}}if(r instanceof Z){const o=new Z(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Qr(s.serializer,o)}}if(r instanceof Ut)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Pt)return{bytesValue:Vl(s.serializer,r._byteString)};if(r instanceof ct){const o=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Gi(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof jt)return(function(a,u){return{mapValue:{fields:{[ol]:{stringValue:al},[Gr]:{arrayValue:{values:a.toArray().map((d=>{if(typeof d!="number")throw u.Sc("VectorValues must only contain numeric values.");return ji(u.serializer,d)}))}}}}}})(r,s);throw s.Sc(`Unsupported field value: ${Mi(r)}`)})(n,t)}function mu(n,t){const e={};return tl(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):be(n,((r,s)=>{const o=fu(s,t.mc(r));o!=null&&(e[r]=o)})),{mapValue:{fields:e}}}function gu(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Z||n instanceof Ut||n instanceof Pt||n instanceof ct||n instanceof ao||n instanceof jt)}function pu(n,t,e){if(!gu(e)||!Yc(e)){const r=Mi(e);throw r==="an object"?t.Sc(n+" a custom object"):t.Sc(n+" "+r)}}function tp(n,t,e){if((t=Qe(t))instanceof oo)return t._internalPath;if(typeof t=="string")return _u(n,t);throw Zr("Field path arguments must be of type string or ",n,!1,void 0,e)}const ep=new RegExp("[~\\*/\\[\\]]");function _u(n,t,e){if(t.search(ep)>=0)throw Zr(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new oo(...t.split("."))._internalPath}catch{throw Zr(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function Zr(n,t,e,r,s){const o=r&&!r.isEmpty(),a=s!==void 0;let u=`Function ${t}() called with invalid data`;e&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${s}`),h+=")"),new k(C.INVALID_ARGUMENT,u+n+h)}function np(n,t){return n.some((e=>e.isEqual(t)))}class yu{constructor(t,e,r,s,o){this._firestore=t,this._userDataWriter=e,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new ct(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new rp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Eu("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}}class rp extends yu{data(){return super.data()}}function Eu(n,t){return typeof t=="string"?_u(n,t):t instanceof oo?t._internalPath:t._delegate._internalPath}function Tu(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new k(C.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class sp{convertValue(t,e="none"){switch(ue(t)){case 0:return null;case 1:return t.booleanValue;case 2:return rt(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(le(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw L(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const r={};return be(t,((s,o)=>{r[s]=this.convertValue(o,e)})),r}convertVectorValue(t){const e=t.fields?.[Gr].arrayValue?.values?.map((r=>rt(r.doubleValue)));return new jt(e)}convertGeoPoint(t){return new Ut(rt(t.latitude),rt(t.longitude))}convertArray(t,e){return(t.values||[]).map((r=>this.convertValue(r,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const r=as(t);return r==null?null:this.convertValue(r,e);case"estimate":return this.convertTimestamp(Un(t));default:return null}}convertTimestamp(t){const e=ce(t);return new Z(e.seconds,e.nanos)}convertDocumentKey(t,e){const r=Y.fromString(t);Q(xl(r),9688,{name:t});const s=new jn(r.get(1),r.get(3)),o=new O(r.popFirst(5));return s.isEqual(e)||Ht(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),o}}function vu(n,t,e){let r;return r=n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t,r}class bn{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Ie extends yu{constructor(t,e,r,s,o,a){super(t,e,r,s,a),this._firestore=t,this._firestoreImpl=t,this.metadata=o}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Mr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const r=this._document.data.field(Eu("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new k(C.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,e={};return e.type=Ie._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}}Ie._jsonSchemaVersion="firestore/documentSnapshot/1.0",Ie._jsonSchema={type:it("string",Ie._jsonSchemaVersion),bundleSource:it("string","DocumentSnapshot"),bundleName:it("string"),bundle:it("string")};class Mr extends Ie{data(t={}){return super.data(t)}}class we{constructor(t,e,r,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new bn(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach((r=>{t.call(e,new Mr(this._firestore,this._userDataWriter,r.key,r,new bn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new k(C.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=(function(s,o){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((u=>{const h=new Mr(s._firestore,s._userDataWriter,u.doc.key,u.doc,new bn(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);return u.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((u=>o||u.type!==3)).map((u=>{const h=new Mr(s._firestore,s._userDataWriter,u.doc.key,u.doc,new bn(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,_=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),_=a.indexOf(u.doc.key)),{type:ip(u.type),doc:h,oldIndex:d,newIndex:_}}))}})(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new k(C.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=we._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=Ni.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const e=[],r=[],s=[];return this.docs.forEach((o=>{o._document!==null&&(e.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))})),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function ip(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L(61501,{type:n})}}we._jsonSchemaVersion="firestore/querySnapshot/1.0",we._jsonSchema={type:it("string",we._jsonSchemaVersion),bundleSource:it("string","QuerySnapshot"),bundleName:it("string"),bundle:it("string")};class uo extends sp{constructor(t){super(),this.firestore=t}convertBytes(t){return new Pt(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new ct(this.firestore,null,e)}}function op(n){n=Lt(n,rr);const t=Lt(n.firestore,Ce),e=io(t),r=new uo(t);return Tu(n._query),Kg(e,n._query).then((s=>new we(t,r,n,s)))}function ts(n,t,e){n=Lt(n,ct);const r=Lt(n.firestore,Ce),s=vu(n.converter,t,e);return ho(r,[du(hu(r),"setDoc",n._key,s,n.converter!==null,e).toMutation(n._key,Nt.none())])}function ap(n){return ho(Lt(n.firestore,Ce),[new qi(n._key,Nt.none())])}function Iu(n,t){const e=Lt(n.firestore,Ce),r=nn(n),s=vu(n.converter,t);return ho(e,[du(hu(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Nt.exists(!1))]).then((()=>r))}function Cc(n,...t){n=Qe(n);let e={includeMetadataChanges:!1,source:"default"},r=0;typeof t[r]!="object"||Rc(t[r])||(e=t[r++]);const s={includeMetadataChanges:e.includeMetadataChanges,source:e.source};if(Rc(t[r])){const h=t[r];t[r]=h.next?.bind(h),t[r+1]=h.error?.bind(h),t[r+2]=h.complete?.bind(h)}let o,a,u;if(n instanceof ct)a=Lt(n.firestore,Ce),u=Ui(n._key.path),o={next:h=>{t[r]&&t[r](cp(a,n,h))},error:t[r+1],complete:t[r+2]};else{const h=Lt(n,rr);a=Lt(h.firestore,Ce),u=h._query;const d=new uo(a);o={next:_=>{t[r]&&t[r](new we(a,d,h,_))},error:t[r+1],complete:t[r+2]},Tu(n._query)}return(function(d,_,v,S){const b=new ou(S),N=new Jl(_,b,v);return d.asyncQueue.enqueueAndForget((async()=>Ql(await Ei(d),N))),()=>{b.Nu(),d.asyncQueue.enqueueAndForget((async()=>Xl(await Ei(d),N)))}})(io(a),u,s,o)}function ho(n,t){return(function(r,s){const o=new se;return r.asyncQueue.enqueueAndForget((async()=>Og(await Hg(r),s,o))),o.promise})(io(n),t)}function cp(n,t,e){const r=e.docs.get(t._key),s=new uo(n);return new Ie(n,s,t._key,r,new bn(e.hasPendingWrites,e.fromCache),t.converter)}function Hn(){return new lo("serverTimestamp")}(function(t,e=!0){(function(s){sn=s})(Ld),qr(new Ln("firestore",((r,{instanceIdentifier:s,options:o})=>{const a=r.getProvider("app").getImmediate(),u=new Ce(new Zd(r.getProvider("auth-internal")),new nf(a,r.getProvider("app-check-internal")),(function(d,_){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new k(C.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new jn(d.options.projectId,_)})(a,s),a);return o={useFetchStreams:e,...o},u._setSettings(o),u}),"PUBLIC").setMultipleInstances(!0)),qe(Da,ka,t),qe(Da,ka,"esm2020")})();const lp={apiKey:"AIzaSyC5fjkXd_lirXDEY5wyH-upF9yU_nzLAJw",authDomain:"web-rtc-server-50d56.firebaseapp.com",projectId:"web-rtc-server-50d56",storageBucket:"web-rtc-server-50d56.firebasestorage.app",messagingSenderId:"1017642181996",appId:"1:1017642181996:web:e325acd4ee82baa9087f49",measurementId:"G-KVDMZRQKBP"},up=Uc(lp),wu=Qg(up),hp={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10};let U=null;const bc=document.getElementById("webcamButton"),Au=document.getElementById("webcamVideo"),fo=document.getElementById("callButton"),Su=document.getElementById("answerButton"),oe=document.getElementById("remoteVideo"),Kn=document.getElementById("hangupButton"),Ru=document.getElementById("settingsButton"),On=document.getElementById("settingsModal"),dp=document.getElementById("closeSettings"),ze=document.getElementById("videoSelect"),Wn=document.getElementById("audioSelect"),es=document.getElementById("audioOutputSelect"),Ge=document.getElementById("createCallModal"),fp=document.getElementById("closeCreateCall"),sr=document.getElementById("callIdDisplay"),Rr=document.getElementById("copyCallId"),mp=document.getElementById("shareGmail"),gp=document.getElementById("shareOutlook"),Ae=document.getElementById("joinCallModal"),Ti=document.getElementById("joinCallInput"),pp=document.getElementById("confirmJoinCall"),_p=document.getElementById("closeJoinCall"),Or=document.getElementById("toggleMute"),xr=document.getElementById("toggleCamera"),Cu=document.getElementById("toggleFullscreen"),bu=document.getElementById("callTimer"),yp=document.getElementById("videoContainer"),Ep=document.getElementById("slot-0-camera-off"),Tp=document.getElementById("remoteCameraOff"),vp=document.getElementById("slot-0-muted"),Ip=document.getElementById("remoteMuted"),zt=document.getElementById("connectionIndicator"),ns=document.getElementById("networkStats"),wp=document.getElementById("videoStat"),Ap=document.getElementById("audioStat"),Sp=document.getElementById("latencyStat"),Rp=document.getElementById("packetLossStat"),mo=document.getElementById("chatPanel"),Cr=document.getElementById("chatMessages"),Pc=document.getElementById("chatInput"),Cp=document.getElementById("sendMessage"),Qn=document.getElementById("openChat"),bp=document.getElementById("toggleChat"),Vc=document.getElementById("showStatsToggle"),vi=document.getElementById("usernameInput"),go=document.getElementById("localNameTag"),He=document.getElementById("remoteNameTag");let Be=!1,br=!1,Ii=null,Lr=null,xn=null,wi=!1,Dt="Guest",Xn=null,Jn=null;const Vt=localStorage.getItem("clientId")||Math.random().toString(36).substring(2,10);localStorage.setItem("clientId",Vt);const M={},Ai=10;let nt=null;function ir(n){Object.values(M).forEach(t=>{const e=t.dataChannel;if(e&&e.readyState==="open")try{e.send(JSON.stringify(n))}catch{}})}let ve=null,Ue=null,je=0,Ke=null,We=null,Si=0,Dc=0;const Pp=1e3,rs=.03,Vp=.06;function Pu(){if(U&&U.getAudioTracks().length)try{ve||(ve=new(window.AudioContext||window.webkitAudioContext));const n=ve.createMediaStreamSource(U);Ue=ve.createAnalyser(),Ue.fftSize=2048,n.connect(Ue);const t=new Uint8Array(Ue.fftSize);Ke&&clearInterval(Ke),Ke=setInterval(()=>{Ue.getByteTimeDomainData(t);let e=0;for(let s=0;s<t.length;s++){const o=(t[s]-128)/128;e+=o*o}const r=Math.sqrt(e/t.length);je=Math.min(1,r),ir({type:"audio-level",level:je});try{const s=document.getElementById("slot-0");if(s){const o=s.querySelector(".audio-meter"),a=o&&o.querySelector(".level");o&&a&&(o.style.display="block",a.style.width=Math.min(100,Math.round(je*100))+"%"),s.classList.toggle("speaking",je>rs+.03)}}catch{}},200)}catch(n){console.warn("Failed to start local audio meter",n)}}function Dp(){if(Ke&&(clearInterval(Ke),Ke=null),ve){try{ve.close()}catch{}ve=null,Ue=null,je=0}}function kp(){We&&clearInterval(We),We=setInterval(()=>{if(Date.now()<Si)return;let n=null,t=-1;const e=Date.now();for(const[s,o]of Object.entries(M)){if(!o)continue;const a=typeof o.lastAudioLevel=="number"?o.lastAudioLevel:0,u=o&&o.levelTs?o.levelTs:0;e-u>2e3||a>t&&(t=a,n=s)}if(!n||t<rs||nt===n||Date.now()<Si||e-Dc<Pp)return;let r=0;if(nt&&M[nt]){const s=M[nt];r=typeof s.lastAudioLevel=="number"?s.lastAudioLevel:0}if(t>Math.max(r+Vp,rs)){nt=n;const s=M[n];s&&s.remoteStream&&(oe.srcObject=s.remoteStream),He.textContent=s&&s.username||"Guest",po(),Dc=Date.now()}},250)}function Np(){We&&(clearInterval(We),We=null)}function po(){if(document.querySelectorAll(".thumb-slot").forEach(n=>n.classList.remove("active")),nt){const n=M[nt];if(n&&n.slotIndex){const t=document.getElementById(`slot-${n.slotIndex}`);t&&t.classList.add("active")}}else{const n=document.getElementById("slot-0");n&&n.classList.add("active")}}function Mp(n){for(const[t,e]of Object.entries(M))if(t===n&&e.slotIndex)return e.slotIndex;for(let t=1;t<Ai;t++){if(!document.getElementById(`slot-${t}`))continue;if(!Object.values(M).some(s=>s.slotIndex===t))return t}return null}function ss(n){const t=M[n];return!t||!t.slotIndex?null:document.getElementById(`slot-${t.slotIndex}`)}function Vu(n){const t=M[n].slotIndex||Mp(n);if(!t)return null;M[n].slotIndex=t;const e=document.getElementById(`slot-${t}`);e.classList.remove("empty");let r=e.querySelector("video");r||(r=document.createElement("video"),r.className="thumb-video",r.autoplay=!0,r.playsInline=!0,r.id=`slot-${t}-video`,e.appendChild(r));let s=e.querySelector(".slot-name");if(s||(s=document.createElement("div"),s.className="video-name-tag slot-name",s.id=`slot-${t}-name`,s.textContent=M[n].username||"Guest",e.appendChild(s)),!e.querySelector(".camera-off-overlay")){const u=document.createElement("div");u.className="camera-off-overlay small",u.id=`slot-${t}-camera-off`,u.innerHTML='<div class="camera-off-icon"></div>',e.appendChild(u)}if(!e.querySelector(".muted-indicator")){const u=document.createElement("div");u.className="muted-indicator small",u.id=`slot-${t}-muted`,u.textContent="",e.appendChild(u)}if(!e.querySelector(".audio-meter")){const u=document.createElement("div");u.className="audio-meter",u.innerHTML='<div class="level"></div>',e.appendChild(u)}const o=e.querySelector(".camera-off-overlay"),a=e.querySelector(".muted-indicator");return o&&o.classList.remove("active"),a&&a.classList.remove("active"),r}let wt=null,Ri=null,Ci=null;async function Fr(n){if(!wt)return;const t=Mn(wt,"signals"),e=document.getElementById("signalWarning"),r=async(s=1)=>{try{return await Iu(t,{...n,createdAt:Hn()}),e&&(e.style.display="none"),!0}catch(o){return console.error("sendSignal failed (attempt",s,"):",o),e&&(e.style.display="block",e.innerHTML=`Signaling error: ${o.message||o}. Check adblocker/firewall and allowlist this site.<small>Retrying...</small>`),s<3?(await new Promise(a=>setTimeout(a,1e3*s)),await r(s+1)):!1}};return await r(1)}async function Du(){if(!wt)return;const n=nn(wt,"participants",Vt);try{await ts(n,{username:Dt},{merge:!0})}catch(t){console.error("Failed to update participant record:",t)}}async function _o(n,t=!1){if(wt=nn(wu,"calls",n),t)try{await ts(wt,{createdAt:Hn()})}catch(s){console.error("Error creating call doc:",s)}try{const s=Mn(wt,"participants"),o=await op(s);if(!t&&o.size>=Ai){alert("Call is full (maximum "+Ai+" participants)");return}await ts(nn(wt,"participants",Vt),{username:Dt,joinedAt:Hn()},{merge:!0})}catch(s){console.error("Failed to join call participants collection:",s)}const e=Mn(wt,"participants");Ri=Cc(e,s=>{s.docChanges().forEach(async o=>{const a=o.doc.id,u=o.doc.data();if(o.type==="added"){if(a===Vt)return;M[a]=M[a]||{},M[a].username=u.username||"Guest",Vu(a),Vt<a?await Js(a,!0):await Js(a,!1),nt||(nt=a,oe.srcObject=M[a].remoteStream,He.textContent=M[a].username||"Guest",po())}else if(o.type==="removed")bi(a);else if(o.type==="modified"&&M[a]){M[a].username=u.username||"Guest";const h=ss(a);if(h){const d=h.querySelector(".slot-name");d&&(d.textContent=M[a].username)}}})});const r=Mn(wt,"signals");Ci=Cc(r,s=>{s.docChanges().forEach(async o=>{if(o.type!=="added")return;const a=o.doc.data();if(!a||a.to!==Vt)return;const u=a.from;if(a.type==="offer"){M[u]=M[u]||{},M[u].username=M[u].username||"Guest";const h=await Js(u,!1),d={type:"offer",sdp:a.sdp};await h.setRemoteDescription(new RTCSessionDescription(d));const _=await h.createAnswer();await h.setLocalDescription(_),await Fr({type:"answer",from:Vt,to:u,sdp:_.sdp})}else if(a.type==="answer"){const h=M[u]&&M[u].pc;if(h){const d={type:"answer",sdp:a.sdp};await h.setRemoteDescription(new RTCSessionDescription(d))}}else if(a.type==="ice"){const h=M[u]&&M[u].pc;if(h&&a.candidate)try{await h.addIceCandidate(new RTCIceCandidate(a.candidate))}catch(d){console.warn("Failed to add remote ICE candidate",d)}else a.type==="left"&&(console.log("Peer left:",u),bi(u))}})}),await Du(),Bp(),jp(),Qn.classList.add("active"),kp()}async function Op(){if(wt){try{await Iu(Mn(wt,"signals"),{type:"left",from:Vt,createdAt:Hn()}),await ap(nn(wt,"participants",Vt))}catch{}Ri&&Ri(),Ci&&Ci()}Object.keys(M).forEach(n=>bi(n)),Np(),Dp(),wt=null,Up(),qp(),Qn.classList.remove("active")}async function Js(n,t=!1){if(!wt)throw new Error("Not in a call");if(M[n]&&M[n].pc)return M[n].pc;const e=new RTCPeerConnection(hp),r=new MediaStream;M[n]=M[n]||{},M[n].pc=e,M[n].remoteStream=r;const s=Vu(n);s&&(s.srcObject=r,po());try{const o=e.addTransceiver("audio",{direction:"sendrecv"}),a=e.addTransceiver("video",{direction:"sendrecv"});if(M[n].transceivers={audio:o,video:a},U){const u=U.getAudioTracks()[0],h=U.getVideoTracks()[0];try{u&&o.sender.replaceTrack(u)}catch{}try{h&&a.sender.replaceTrack(h)}catch{}}}catch{if(U){const a=U.getAudioTracks()[0],u=U.getVideoTracks()[0];if(a)try{e.addTrack(a,U)}catch{}if(u)try{e.addTrack(u,U)}catch{}}}if(t){const o=e.createDataChannel("data");M[n].dataChannel=o,kc(o,n)}else e.ondatachannel=o=>{M[n].dataChannel=o.channel,kc(o.channel,n)};if(e.ontrack=o=>{console.log("pc.ontrack",n,o.streams),o.streams[0].getTracks().forEach(u=>r.addTrack(u));const a=ss(n);if(a){const u=a.querySelector(".camera-off-overlay");u&&u.classList.remove("active");const h=a.querySelector(".audio-meter");h&&(h.style.display="block")}},e.onicecandidate=({candidate:o})=>{if(o){const a=o&&typeof o.toJSON=="function"?o.toJSON():o;console.log("pc.onicecandidate -> sending ICE to",n,a),Fr({type:"ice",from:Vt,to:n,candidate:a})}},e.onnegotiationneeded=async()=>{try{if(e.signalingState!=="stable")return;const o=await e.createOffer();await e.setLocalDescription(o),await Fr({type:"offer",from:Vt,to:n,sdp:o.sdp})}catch(o){console.warn("Negotiation failure for",n,o)}},e.onconnectionstatechange=()=>{console.log("pc.onconnectionstatechange",n,e.connectionState)},e.oniceconnectionstatechange=()=>{console.log("pc.oniceconnectionstatechange",n,e.iceConnectionState)},t){const o=await e.createOffer();await e.setLocalDescription(o),await Fr({type:"offer",from:Vt,to:n,sdp:o.sdp})}return e}function bi(n){const t=M[n];if(t){if(t.pc)try{t.pc.close()}catch{}if(t.dataChannel)try{t.dataChannel.close()}catch{}if(t.slotIndex){const e=document.getElementById(`slot-${t.slotIndex}`);e&&(e.innerHTML="",e.classList.add("empty"))}delete M[n]}}async function xp(){const n=await navigator.mediaDevices.enumerateDevices();ze.innerHTML="",Wn.innerHTML="",es.innerHTML="",n.forEach(t=>{const e=document.createElement("option");e.value=t.deviceId,e.text=t.label||`${t.kind} ${ze.length+1}`,t.kind==="videoinput"?ze.appendChild(e):t.kind==="audioinput"?Wn.appendChild(e):t.kind==="audiooutput"&&es.appendChild(e)})}ze.onchange=async()=>{Xn=ze.value,U&&await ku()};Wn.onchange=async()=>{Jn=Wn.value,U&&await ku()};es.onchange=async()=>{if(typeof oe.setSinkId<"u")try{await oe.setSinkId(es.value)}catch(n){console.error("Error setting audio output:",n)}};async function ku(){const n={video:Xn?{deviceId:{exact:Xn}}:!0,audio:Jn?{deviceId:{exact:Jn}}:!0},t=U;U=await navigator.mediaDevices.getUserMedia(n),Au.srcObject=U,Pu(),Object.values(M).forEach(e=>{if(!e.pc)return;const r=e.pc.getSenders?e.pc.getSenders():[],s=U.getVideoTracks()[0],o=U.getAudioTracks()[0];if(e.transceivers){try{e.transceivers.audio&&o&&e.transceivers.audio.sender.replaceTrack(o)}catch{}try{e.transceivers.video&&s&&e.transceivers.video.sender.replaceTrack(s)}catch{}}if(r.forEach(a=>{a.track&&(a.track.kind==="video"&&s?a.replaceTrack(s):a.track.kind==="audio"&&o&&a.replaceTrack(o))}),r.length===0&&!e.transceivers&&U.getTracks().length>0)try{const a=U.getAudioTracks()[0],u=U.getVideoTracks()[0];a&&e.pc.addTrack(a,U),u&&e.pc.addTrack(u,U)}catch(a){console.warn("Error adding initial tracks after updateStream",a)}}),t&&t.getTracks().forEach(e=>e.stop())}Ru.onclick=()=>{On.classList.add("active")};dp.onclick=()=>{On.classList.remove("active")};On.onclick=n=>{n.target===On&&On.classList.remove("active")};Vc.onchange=()=>{wi=Vc.checked,wi&&xn?(zt.classList.add("active"),ns.classList.add("active")):(zt.classList.remove("active"),ns.classList.remove("active"))};localStorage.getItem("username")&&(Dt=localStorage.getItem("username"),vi.value=Dt,go.textContent=Dt);vi.oninput=()=>{Dt=vi.value.trim()||"Guest",localStorage.setItem("username",Dt),go.textContent=Dt,Du(),ir({type:"username",username:Dt})};fp.onclick=()=>{Ge.classList.remove("active")};Ge.onclick=n=>{n.target===Ge&&Ge.classList.remove("active")};Rr.onclick=async()=>{try{const n=`${window.location.origin}${window.location.pathname}${window.location.pathname.endsWith("/"),""}?join=${sr.value}`;await navigator.clipboard.writeText(n);const t=Rr.textContent;Rr.textContent="Copied!",setTimeout(()=>{Rr.textContent=t},2e3)}catch(n){console.error("Failed to copy:",n)}};mp.onclick=()=>{const n=sr.value,t=`${window.location.origin}${window.location.pathname}${window.location.pathname.endsWith("/"),""}?join=${n}`,e=encodeURIComponent("Join my video call"),r=encodeURIComponent(`Hi,

Join my video call using this link: ${t}

Click the link and the join dialog will be pre-filled for you  no copy/paste needed.

See you soon!`);window.open(`https://mail.google.com/mail/?view=cm&fs=1&su=${e}&body=${r}`,"_blank")};gp.onclick=()=>{const n=sr.value,t=`${window.location.origin}${window.location.pathname}${window.location.pathname.endsWith("/"),""}?join=${n}`,e=encodeURIComponent("Join my video call"),r=encodeURIComponent(`Hi,

Join my video call using this link: ${t}

Click the link and the join dialog will be pre-filled for you  no copy/paste needed.

See you soon!`);window.open(`https://outlook.office.com/mail/deeplink/compose?subject=${e}&body=${r}`,"_blank")};Su.onclick=()=>{Ae.classList.add("active")};_p.onclick=()=>{Ae.classList.remove("active")};Ae.onclick=n=>{n.target===Ae&&Ae.classList.remove("active")};function Lp(){try{const n=new URL(window.location.href).searchParams;let t=n.get("join")||n.get("call");if(!t&&window.location.hash){const e=window.location.hash.substring(1),r=new URLSearchParams(e);t=r.get("join")||r.get("call")}if(t){Ti.value=t,Ae.classList.add("active"),Ti.focus();try{window.history.replaceState({},document.title,window.location.pathname)}catch{}}}catch(n){console.warn("Failed to parse incoming join param",n)}}Lp();Qn.onclick=()=>{mo.classList.add("open"),Qn.classList.remove("has-new")};bp.onclick=()=>{mo.classList.remove("open")};Cp.onclick=()=>{Fp()};function Fp(){const n=Pc.value.trim();n&&(Nu(n,"sent",Dt),ir({type:"chat",message:n,username:Dt,timestamp:Date.now()}),Pc.value="")}function Nu(n,t="received",e="Guest"){if(!Cr)return;const r=document.createElement("div");r.className=`chat-message ${t}`;const s=document.createElement("div");s.className="chat-meta",s.textContent=`${e}  ${new Date().toLocaleTimeString()}`;const o=document.createElement("div");o.className="chat-body",o.textContent=n,r.appendChild(s),r.appendChild(o),Cr.appendChild(r),Cr.scrollTop=Cr.scrollHeight}fo.onclick=async()=>{const n=Math.random().toString(36).substring(2,12);sr.value=n,Ge.classList.add("active");const t=nn(wu,"calls",n);await ts(t,{createdAt:Hn()}),await _o(n,!0),Kn.disabled=!1};Or.onclick=()=>{if(U){const n=U.getAudioTracks()[0];n&&(n.enabled=!n.enabled,Be=!n.enabled,Or.classList.toggle("muted",Be),Or.textContent=Be?"":"",vp.classList.toggle("active",Be),ir({type:"mute",muted:Be}))}};xr.onclick=()=>{if(U){const n=U.getVideoTracks()[0];n&&(n.enabled=!n.enabled,br=!n.enabled,xr.classList.toggle("camera-off",br),xr.textContent=br?"":"",Ep.classList.toggle("active",br),ir({type:"camera",enabled:n.enabled}))}};Cu.onclick=()=>{document.fullscreenElement?document.exitFullscreen():yp.requestFullscreen().catch(n=>{console.error("Error attempting to enable fullscreen:",n)})};function Bp(){Ii=Date.now(),Lr=setInterval(()=>{const n=Math.floor((Date.now()-Ii)/1e3),t=Math.floor(n/60),e=n%60;bu.textContent=`${String(t).padStart(2,"0")}:${String(e).padStart(2,"0")}`},1e3)}function Up(){Lr&&(clearInterval(Lr),Lr=null),bu.textContent="00:00",Ii=null}async function jp(){wi&&(zt.classList.add("active"),ns.classList.add("active")),xn=setInterval(async()=>{if(!nt)return;const n=M[nt];if(!n||!n.pc)return;const t=await n.pc.getStats();let e=0,r=0,s=0,o=0,a=0,u=0;t.forEach(d=>{d.type==="inbound-rtp"&&(d.kind==="video"&&d.bytesReceived?e=Math.round(d.bytesReceived*8/1e3):d.kind==="audio"&&d.bytesReceived&&(r=Math.round(d.bytesReceived*8/1e3)),d.packetsLost!==void 0&&(a+=d.packetsLost),d.packetsReceived!==void 0&&(u+=d.packetsReceived)),d.type==="candidate-pair"&&d.state==="succeeded"&&d.currentRoundTripTime!==void 0&&(s=Math.round(d.currentRoundTripTime*1e3))}),u>0&&(o=Math.round(a/(a+u)*100)),wp.textContent=`${e} kbps`,Ap.textContent=`${r} kbps`,Sp.textContent=`${s} ms`,Rp.textContent=`${o}%`;const h=zt.querySelector(".connection-text");zt.classList.remove("good","fair","poor"),s<150&&o<2?(zt.classList.add("good"),h.textContent="Good"):s<300&&o<5?(zt.classList.add("fair"),h.textContent="Fair"):(zt.classList.add("poor"),h.textContent="Poor")},1e3)}function qp(){xn&&(clearInterval(xn),xn=null),zt.classList.remove("active"),ns.classList.remove("active")}function kc(n,t){n.onopen=()=>{console.log("Data channel opened for",t);try{n.send(JSON.stringify({type:"username",username:Dt}));const e=U&&U.getVideoTracks().length?U.getVideoTracks()[0].enabled:!1;n.send(JSON.stringify({type:"camera",enabled:!!e})),n.send(JSON.stringify({type:"mute",muted:!!Be})),n.send(JSON.stringify({type:"audio-level",level:je||0}))}catch{}},n.onmessage=e=>{const r=JSON.parse(e.data),s=M[t];if(r.type==="audio-level"){const a=typeof r.level=="number"?r.level:0;s&&(s.lastAudioLevel=a,s.levelTs=Date.now());const u=ss(t);if(u){const h=u.querySelector(".audio-meter"),d=h&&h.querySelector(".level");h&&d&&(h.style.display="block",d.style.width=Math.min(100,Math.round(a*100))+"%");const _=a>rs+.02;u.classList.toggle("speaking",_)}return}const o=ss(t);if(r.type==="camera"){if(o){const a=o.querySelector(".camera-off-overlay");a&&a.classList.toggle("active",!r.enabled)}s&&(s.cameraEnabled=!!r.enabled),t===nt&&Tp.classList.toggle("active",!r.enabled)}else if(r.type==="mute"){if(o){const a=o.querySelector(".muted-indicator");a&&a.classList.toggle("active",r.muted)}s&&(s.muted=!!r.muted),t===nt&&Ip.classList.toggle("active",r.muted)}else if(r.type==="chat")Nu(r.message,"received",r.username||s&&s.username||"Guest"),mo.classList.contains("open")||Qn.classList.add("has-new");else if(r.type==="username"){if(s&&(s.username=r.username||"Guest"),o){const a=o.querySelector(".slot-name");a&&(a.textContent=r.username||"Guest")}t===nt&&(He.textContent=r.username||"Guest")}},n.onerror=e=>{console.error("Data channel error:",e)}}const $p=document.getElementById("topThumbnails");$p?.addEventListener("click",n=>{const t=n.target.closest(".thumb-slot");if(!t)return;const e=t.querySelector("video");if(e&&e.srcObject){const r=parseInt(t.dataset.index);if(r===0)Object.keys(M).length>0?(nt=Object.keys(M)[0]||null,nt&&M[nt]&&M[nt].remoteStream&&(oe.srcObject=M[nt].remoteStream,He.textContent=M[nt].username||"Guest")):(nt=null,oe.srcObject=U,He.textContent=go.textContent||"Guest");else{const s=Object.entries(M).find(([o,a])=>a.slotIndex===r);nt=s?s[0]:null}if(!(r===0&&Object.keys(M).length>0)){oe.srcObject=e.srcObject;const s=t.querySelector(".slot-name");He.textContent=s?s.textContent:"Guest"}}Si=Date.now()+3e3});bc.onclick=async()=>{console.log("Webcam button clicked");try{console.log("Requesting media devices..."),U=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),console.log("Media devices granted:",U)}catch(e){console.error("Error accessing media devices:",e),alert("Error accessing webcam: "+e.message);return}Object.keys(M).forEach(e=>{const r=M[e];if(!r.pc)return;const s=r.pc.getSenders?r.pc.getSenders():[],o=s.some(d=>d.track&&d.track.kind==="audio"),a=s.some(d=>d.track&&d.track.kind==="video"),u=U.getAudioTracks()[0],h=U.getVideoTracks()[0];if(r.transceivers){try{r.transceivers.audio&&u&&r.transceivers.audio.sender.replaceTrack(u)}catch{}try{r.transceivers.video&&h&&r.transceivers.video.sender.replaceTrack(h)}catch{}if(!r.transceivers.audio&&!o&&u)try{r.pc.addTrack(u,U)}catch{}if(!r.transceivers.video&&!a&&h)try{r.pc.addTrack(h,U)}catch{}}else{if(!o&&u)try{r.pc.addTrack(u,U)}catch{}if(!a&&h)try{r.pc.addTrack(h,U)}catch{}}}),Au.srcObject=U,Object.keys(M).length===0&&(oe.srcObject=U),Pu(),await xp();const n=U.getVideoTracks()[0],t=U.getAudioTracks()[0];n&&(Xn=n.getSettings().deviceId,ze.value=Xn),t&&(Jn=t.getSettings().deviceId,Wn.value=Jn),fo.disabled=!1,Su.disabled=!1,bc.disabled=!0,Kn.disabled=!1,Ru.disabled=!1,Or.disabled=!1,xr.disabled=!1,Cu.disabled=!1};fo.onclick=async()=>{const n=Math.random().toString(36).substring(2,12);sr.value=n,Ge.classList.add("active"),await _o(n,!0),Kn.disabled=!1};pp.onclick=async()=>{const n=Ti.value.trim();if(!n){alert("Please enter a call ID");return}Ae.classList.remove("active"),await _o(n,!1)};Kn.onclick=async()=>{await Op(),Kn.disabled=!0};
