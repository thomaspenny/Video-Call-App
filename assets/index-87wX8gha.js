(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();const ih=()=>{};var da={};const Ac=function(n){const t=[];let e=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},oh=function(n){const t=[];let e=0,r=0;for(;e<n.length;){const s=n[e++];if(s<128)t[r++]=String.fromCharCode(s);else if(s>191&&s<224){const o=n[e++];t[r++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=n[e++],a=n[e++],u=n[e++],h=((s&7)<<18|(o&63)<<12|(a&63)<<6|u&63)-65536;t[r++]=String.fromCharCode(55296+(h>>10)),t[r++]=String.fromCharCode(56320+(h&1023))}else{const o=n[e++],a=n[e++];t[r++]=String.fromCharCode((s&15)<<12|(o&63)<<6|a&63)}}return t.join("")},Rc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const o=n[s],a=s+1<n.length,u=a?n[s+1]:0,h=s+2<n.length,d=h?n[s+2]:0,_=o>>2,I=(o&3)<<4|u>>4;let R=(u&15)<<2|d>>6,b=d&63;h||(b=64,a||(R=64)),r.push(e[_],e[I],e[R],e[b])}return r.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(Ac(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):oh(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const o=e[n.charAt(s++)],u=s<n.length?e[n.charAt(s)]:0;++s;const d=s<n.length?e[n.charAt(s)]:64;++s;const I=s<n.length?e[n.charAt(s)]:64;if(++s,o==null||u==null||d==null||I==null)throw new ah;const R=o<<2|u>>4;if(r.push(R),d!==64){const b=u<<4&240|d>>2;if(r.push(b),I!==64){const N=d<<6&192|I;r.push(N)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class ah extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const ch=function(n){const t=Ac(n);return Rc.encodeByteArray(t,!0)},kr=function(n){return ch(n).replace(/\./g,"")},lh=function(n){try{return Rc.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function uh(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const hh=()=>uh().__FIREBASE_DEFAULTS__,dh=()=>{if(typeof process>"u"||typeof da>"u")return;const n=da.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},fh=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=n&&lh(n[1]);return t&&JSON.parse(t)},Ai=()=>{try{return ih()||hh()||dh()||fh()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},mh=n=>Ai()?.emulatorHosts?.[n],gh=n=>{const t=mh(n);if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),r]:[t.substring(0,e),r]},Cc=()=>Ai()?.config;class ph{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,r)=>{e?this.reject(e):this.resolve(r),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,r))}}}function Ri(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function _h(n){return(await fetch(n,{credentials:"include"})).ok}function yh(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e={alg:"none",type:"JWT"},r=t||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...n};return[kr(JSON.stringify(e)),kr(JSON.stringify(a)),""].join(".")}const Cn={};function Eh(){const n={prod:[],emulator:[]};for(const t of Object.keys(Cn))Cn[t]?n.emulator.push(t):n.prod.push(t);return n}function Th(n){let t=document.getElementById(n),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",n),e=!0),{created:e,element:t}}let fa=!1;function Ih(n,t){if(typeof window>"u"||typeof document>"u"||!Ri(window.location.host)||Cn[n]===t||Cn[n]||fa)return;Cn[n]=t;function e(R){return`__firebase__banner__${R}`}const r="__firebase__banner",o=Eh().prod.length>0;function a(){const R=document.getElementById(r);R&&R.remove()}function u(R){R.style.display="flex",R.style.background="#7faaf0",R.style.position="fixed",R.style.bottom="5px",R.style.left="5px",R.style.padding=".5em",R.style.borderRadius="5px",R.style.alignItems="center"}function h(R,b){R.setAttribute("width","24"),R.setAttribute("id",b),R.setAttribute("height","24"),R.setAttribute("viewBox","0 0 24 24"),R.setAttribute("fill","none"),R.style.marginLeft="-6px"}function d(){const R=document.createElement("span");return R.style.cursor="pointer",R.style.marginLeft="16px",R.style.fontSize="24px",R.innerHTML=" &times;",R.onclick=()=>{fa=!0,a()},R}function _(R,b){R.setAttribute("id",b),R.innerText="Learn more",R.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",R.setAttribute("target","__blank"),R.style.paddingLeft="5px",R.style.textDecoration="underline"}function I(){const R=Th(r),b=e("text"),N=document.getElementById(b)||document.createElement("span"),O=e("learnmore"),V=document.getElementById(O)||document.createElement("a"),G=e("preprendIcon"),H=document.getElementById(G)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(R.created){const K=R.element;u(K),_(V,O);const Tt=d();h(H,G),K.append(H,N,V,Tt),document.body.appendChild(K)}o?(N.innerText="Preview backend disconnected.",H.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(H.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,N.innerText="Preview backend running in this workspace."),N.setAttribute("id",b)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",I):I()}function vh(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function wh(){const n=Ai()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Ah(){return!wh()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Rh(){try{return typeof indexedDB=="object"}catch{return!1}}function Ch(){return new Promise((n,t)=>{try{let e=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{t(s.error?.message||"")}}catch(e){t(e)}})}const Sh="FirebaseError";class tn extends Error{constructor(t,e,r){super(e),this.code=t,this.customData=r,this.name=Sh,Object.setPrototypeOf(this,tn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Sc.prototype.create)}}class Sc{constructor(t,e,r){this.service=t,this.serviceName=e,this.errors=r}create(t,...e){const r=e[0]||{},s=`${this.service}/${t}`,o=this.errors[t],a=o?bh(o,r):"Error",u=`${this.serviceName}: ${a} (${s}).`;return new tn(s,u,r)}}function bh(n,t){return n.replace(Ph,(e,r)=>{const s=t[r];return s!=null?String(s):`<${r}?>`})}const Ph=/\{\$([^}]+)}/g;function Nr(n,t){if(n===t)return!0;const e=Object.keys(n),r=Object.keys(t);for(const s of e){if(!r.includes(s))return!1;const o=n[s],a=t[s];if(ma(o)&&ma(a)){if(!Nr(o,a))return!1}else if(o!==a)return!1}for(const s of r)if(!e.includes(s))return!1;return!0}function ma(n){return n!==null&&typeof n=="object"}function He(n){return n&&n._delegate?n._delegate:n}class Nn{constructor(t,e,r){this.name=t,this.instanceFactory=e,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const Te="[DEFAULT]";class Vh{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const r=new ph;if(this.instancesDeferred.set(e,r),this.isInitialized(e)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:e});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){const e=this.normalizeInstanceIdentifier(t?.identifier),r=t?.optional??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(kh(t))try{this.getOrInitializeService({instanceIdentifier:Te})}catch{}for(const[e,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(e);try{const o=this.getOrInitializeService({instanceIdentifier:s});r.resolve(o)}catch{}}}}clearInstance(t=Te){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=Te){return this.instances.has(t)}getOptions(t=Te){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,r=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:e});for(const[o,a]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(o);r===u&&a.resolve(s)}return s}onInit(t,e){const r=this.normalizeInstanceIdentifier(e),s=this.onInitCallbacks.get(r)??new Set;s.add(t),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&t(o,r),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const r=this.onInitCallbacks.get(e);if(r)for(const s of r)try{s(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Dh(t),options:e}),this.instances.set(t,r),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch{}return r||null}normalizeInstanceIdentifier(t=Te){return this.component?this.component.multipleInstances?t:Te:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Dh(n){return n===Te?void 0:n}function kh(n){return n.instantiationMode==="EAGER"}class Nh{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new Vh(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}var z;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(z||(z={}));const Mh={debug:z.DEBUG,verbose:z.VERBOSE,info:z.INFO,warn:z.WARN,error:z.ERROR,silent:z.SILENT},xh=z.INFO,Oh={[z.DEBUG]:"log",[z.VERBOSE]:"log",[z.INFO]:"info",[z.WARN]:"warn",[z.ERROR]:"error"},Lh=(n,t,...e)=>{if(t<n.logLevel)return;const r=new Date().toISOString(),s=Oh[t];if(s)console[s](`[${r}]  ${n.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class bc{constructor(t){this.name=t,this._logLevel=xh,this._logHandler=Lh,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in z))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Mh[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,z.DEBUG,...t),this._logHandler(this,z.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,z.VERBOSE,...t),this._logHandler(this,z.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,z.INFO,...t),this._logHandler(this,z.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,z.WARN,...t),this._logHandler(this,z.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,z.ERROR,...t),this._logHandler(this,z.ERROR,...t)}}const Fh=(n,t)=>t.some(e=>n instanceof e);let ga,pa;function Bh(){return ga||(ga=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Uh(){return pa||(pa=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Pc=new WeakMap,Ws=new WeakMap,Vc=new WeakMap,Ls=new WeakMap,Ci=new WeakMap;function jh(n){const t=new Promise((e,r)=>{const s=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{e(ne(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",o),n.addEventListener("error",a)});return t.then(e=>{e instanceof IDBCursor&&Pc.set(e,n)}).catch(()=>{}),Ci.set(t,n),t}function qh(n){if(Ws.has(n))return;const t=new Promise((e,r)=>{const s=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{e(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});Ws.set(n,t)}let Qs={get(n,t,e){if(n instanceof IDBTransaction){if(t==="done")return Ws.get(n);if(t==="objectStoreNames")return n.objectStoreNames||Vc.get(n);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return ne(n[t])},set(n,t,e){return n[t]=e,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function $h(n){Qs=n(Qs)}function zh(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const r=n.call(Fs(this),t,...e);return Vc.set(r,t.sort?t.sort():[t]),ne(r)}:Uh().includes(n)?function(...t){return n.apply(Fs(this),t),ne(Pc.get(this))}:function(...t){return ne(n.apply(Fs(this),t))}}function Gh(n){return typeof n=="function"?zh(n):(n instanceof IDBTransaction&&qh(n),Fh(n,Bh())?new Proxy(n,Qs):n)}function ne(n){if(n instanceof IDBRequest)return jh(n);if(Ls.has(n))return Ls.get(n);const t=Gh(n);return t!==n&&(Ls.set(n,t),Ci.set(t,n)),t}const Fs=n=>Ci.get(n);function Hh(n,t,{blocked:e,upgrade:r,blocking:s,terminated:o}={}){const a=indexedDB.open(n,t),u=ne(a);return r&&a.addEventListener("upgradeneeded",h=>{r(ne(a.result),h.oldVersion,h.newVersion,ne(a.transaction),h)}),e&&a.addEventListener("blocked",h=>e(h.oldVersion,h.newVersion,h)),u.then(h=>{o&&h.addEventListener("close",()=>o()),s&&h.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),u}const Kh=["get","getKey","getAll","getAllKeys","count"],Wh=["put","add","delete","clear"],Bs=new Map;function _a(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(Bs.get(t))return Bs.get(t);const e=t.replace(/FromIndex$/,""),r=t!==e,s=Wh.includes(e);if(!(e in(r?IDBIndex:IDBObjectStore).prototype)||!(s||Kh.includes(e)))return;const o=async function(a,...u){const h=this.transaction(a,s?"readwrite":"readonly");let d=h.store;return r&&(d=d.index(u.shift())),(await Promise.all([d[e](...u),s&&h.done]))[0]};return Bs.set(t,o),o}$h(n=>({...n,get:(t,e,r)=>_a(t,e)||n.get(t,e,r),has:(t,e)=>!!_a(t,e)||n.has(t,e)}));class Qh{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(Xh(e)){const r=e.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(e=>e).join(" ")}}function Xh(n){return n.getComponent()?.type==="VERSION"}const Xs="@firebase/app",ya="0.14.6";const Ht=new bc("@firebase/app"),Jh="@firebase/app-compat",Yh="@firebase/analytics-compat",Zh="@firebase/analytics",td="@firebase/app-check-compat",ed="@firebase/app-check",nd="@firebase/auth",rd="@firebase/auth-compat",sd="@firebase/database",id="@firebase/data-connect",od="@firebase/database-compat",ad="@firebase/functions",cd="@firebase/functions-compat",ld="@firebase/installations",ud="@firebase/installations-compat",hd="@firebase/messaging",dd="@firebase/messaging-compat",fd="@firebase/performance",md="@firebase/performance-compat",gd="@firebase/remote-config",pd="@firebase/remote-config-compat",_d="@firebase/storage",yd="@firebase/storage-compat",Ed="@firebase/firestore",Td="@firebase/ai",Id="@firebase/firestore-compat",vd="firebase",wd="12.6.0";const Js="[DEFAULT]",Ad={[Xs]:"fire-core",[Jh]:"fire-core-compat",[Zh]:"fire-analytics",[Yh]:"fire-analytics-compat",[ed]:"fire-app-check",[td]:"fire-app-check-compat",[nd]:"fire-auth",[rd]:"fire-auth-compat",[sd]:"fire-rtdb",[id]:"fire-data-connect",[od]:"fire-rtdb-compat",[ad]:"fire-fn",[cd]:"fire-fn-compat",[ld]:"fire-iid",[ud]:"fire-iid-compat",[hd]:"fire-fcm",[dd]:"fire-fcm-compat",[fd]:"fire-perf",[md]:"fire-perf-compat",[gd]:"fire-rc",[pd]:"fire-rc-compat",[_d]:"fire-gcs",[yd]:"fire-gcs-compat",[Ed]:"fire-fst",[Id]:"fire-fst-compat",[Td]:"fire-vertex","fire-js":"fire-js",[vd]:"fire-js-all"};const Mr=new Map,Rd=new Map,Ys=new Map;function Ea(n,t){try{n.container.addComponent(t)}catch(e){Ht.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,e)}}function xr(n){const t=n.name;if(Ys.has(t))return Ht.debug(`There were multiple attempts to register component ${t}.`),!1;Ys.set(t,n);for(const e of Mr.values())Ea(e,n);for(const e of Rd.values())Ea(e,n);return!0}function Cd(n,t){const e=n.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),n.container.getProvider(t)}function Sd(n){return n==null?!1:n.settings!==void 0}const bd={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},re=new Sc("app","Firebase",bd);class Pd{constructor(t,e,r){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Nn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw re.create("app-deleted",{appName:this._name})}}const Vd=wd;function Dc(n,t={}){let e=n;typeof t!="object"&&(t={name:t});const r={name:Js,automaticDataCollectionEnabled:!0,...t},s=r.name;if(typeof s!="string"||!s)throw re.create("bad-app-name",{appName:String(s)});if(e||(e=Cc()),!e)throw re.create("no-options");const o=Mr.get(s);if(o){if(Nr(e,o.options)&&Nr(r,o.config))return o;throw re.create("duplicate-app",{appName:s})}const a=new Nh(s);for(const h of Ys.values())a.addComponent(h);const u=new Pd(e,r,a);return Mr.set(s,u),u}function Dd(n=Js){const t=Mr.get(n);if(!t&&n===Js&&Cc())return Dc();if(!t)throw re.create("no-app",{appName:n});return t}function qe(n,t,e){let r=Ad[n]??n;e&&(r+=`-${e}`);const s=r.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const a=[`Unable to register library "${r}" with version "${t}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Ht.warn(a.join(" "));return}xr(new Nn(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}const kd="firebase-heartbeat-database",Nd=1,Mn="firebase-heartbeat-store";let Us=null;function kc(){return Us||(Us=Hh(kd,Nd,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(Mn)}catch(e){console.warn(e)}}}}).catch(n=>{throw re.create("idb-open",{originalErrorMessage:n.message})})),Us}async function Md(n){try{const e=(await kc()).transaction(Mn),r=await e.objectStore(Mn).get(Nc(n));return await e.done,r}catch(t){if(t instanceof tn)Ht.warn(t.message);else{const e=re.create("idb-get",{originalErrorMessage:t?.message});Ht.warn(e.message)}}}async function Ta(n,t){try{const r=(await kc()).transaction(Mn,"readwrite");await r.objectStore(Mn).put(t,Nc(n)),await r.done}catch(e){if(e instanceof tn)Ht.warn(e.message);else{const r=re.create("idb-set",{originalErrorMessage:e?.message});Ht.warn(r.message)}}}function Nc(n){return`${n.name}!${n.options.appId}`}const xd=1024,Od=30;class Ld{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Bd(e),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Ia();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:e}),this._heartbeatsCache.heartbeats.length>Od){const s=Ud(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){Ht.warn(t)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Ia(),{heartbeatsToSend:e,unsentEntries:r}=Fd(this._heartbeatsCache.heartbeats),s=kr(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return Ht.warn(t),""}}}function Ia(){return new Date().toISOString().substring(0,10)}function Fd(n,t=xd){const e=[];let r=n.slice();for(const s of n){const o=e.find(a=>a.agent===s.agent);if(o){if(o.dates.push(s.date),va(e)>t){o.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),va(e)>t){e.pop();break}r=r.slice(1)}return{heartbeatsToSend:e,unsentEntries:r}}class Bd{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Rh()?Ch().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await Md(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const r=await this.read();return Ta(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const r=await this.read();return Ta(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...t.heartbeats]})}else return}}function va(n){return kr(JSON.stringify({version:2,heartbeats:n})).length}function Ud(n){if(n.length===0)return-1;let t=0,e=n[0].date;for(let r=1;r<n.length;r++)n[r].date<e&&(e=n[r].date,t=r);return t}function jd(n){xr(new Nn("platform-logger",t=>new Qh(t),"PRIVATE")),xr(new Nn("heartbeat",t=>new Ld(t),"PRIVATE")),qe(Xs,ya,n),qe(Xs,ya,"esm2020"),qe("fire-js","")}jd("");var qd="firebase",$d="12.6.0";qe(qd,$d,"app");var wa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var se,Mc;(function(){var n;function t(E,m){function p(){}p.prototype=m.prototype,E.F=m.prototype,E.prototype=new p,E.prototype.constructor=E,E.D=function(T,y,w){for(var g=Array(arguments.length-2),Rt=2;Rt<arguments.length;Rt++)g[Rt-2]=arguments[Rt];return m.prototype[y].apply(T,g)}}function e(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}t(r,e),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(E,m,p){p||(p=0);const T=Array(16);if(typeof m=="string")for(var y=0;y<16;++y)T[y]=m.charCodeAt(p++)|m.charCodeAt(p++)<<8|m.charCodeAt(p++)<<16|m.charCodeAt(p++)<<24;else for(y=0;y<16;++y)T[y]=m[p++]|m[p++]<<8|m[p++]<<16|m[p++]<<24;m=E.g[0],p=E.g[1],y=E.g[2];let w=E.g[3],g;g=m+(w^p&(y^w))+T[0]+3614090360&4294967295,m=p+(g<<7&4294967295|g>>>25),g=w+(y^m&(p^y))+T[1]+3905402710&4294967295,w=m+(g<<12&4294967295|g>>>20),g=y+(p^w&(m^p))+T[2]+606105819&4294967295,y=w+(g<<17&4294967295|g>>>15),g=p+(m^y&(w^m))+T[3]+3250441966&4294967295,p=y+(g<<22&4294967295|g>>>10),g=m+(w^p&(y^w))+T[4]+4118548399&4294967295,m=p+(g<<7&4294967295|g>>>25),g=w+(y^m&(p^y))+T[5]+1200080426&4294967295,w=m+(g<<12&4294967295|g>>>20),g=y+(p^w&(m^p))+T[6]+2821735955&4294967295,y=w+(g<<17&4294967295|g>>>15),g=p+(m^y&(w^m))+T[7]+4249261313&4294967295,p=y+(g<<22&4294967295|g>>>10),g=m+(w^p&(y^w))+T[8]+1770035416&4294967295,m=p+(g<<7&4294967295|g>>>25),g=w+(y^m&(p^y))+T[9]+2336552879&4294967295,w=m+(g<<12&4294967295|g>>>20),g=y+(p^w&(m^p))+T[10]+4294925233&4294967295,y=w+(g<<17&4294967295|g>>>15),g=p+(m^y&(w^m))+T[11]+2304563134&4294967295,p=y+(g<<22&4294967295|g>>>10),g=m+(w^p&(y^w))+T[12]+1804603682&4294967295,m=p+(g<<7&4294967295|g>>>25),g=w+(y^m&(p^y))+T[13]+4254626195&4294967295,w=m+(g<<12&4294967295|g>>>20),g=y+(p^w&(m^p))+T[14]+2792965006&4294967295,y=w+(g<<17&4294967295|g>>>15),g=p+(m^y&(w^m))+T[15]+1236535329&4294967295,p=y+(g<<22&4294967295|g>>>10),g=m+(y^w&(p^y))+T[1]+4129170786&4294967295,m=p+(g<<5&4294967295|g>>>27),g=w+(p^y&(m^p))+T[6]+3225465664&4294967295,w=m+(g<<9&4294967295|g>>>23),g=y+(m^p&(w^m))+T[11]+643717713&4294967295,y=w+(g<<14&4294967295|g>>>18),g=p+(w^m&(y^w))+T[0]+3921069994&4294967295,p=y+(g<<20&4294967295|g>>>12),g=m+(y^w&(p^y))+T[5]+3593408605&4294967295,m=p+(g<<5&4294967295|g>>>27),g=w+(p^y&(m^p))+T[10]+38016083&4294967295,w=m+(g<<9&4294967295|g>>>23),g=y+(m^p&(w^m))+T[15]+3634488961&4294967295,y=w+(g<<14&4294967295|g>>>18),g=p+(w^m&(y^w))+T[4]+3889429448&4294967295,p=y+(g<<20&4294967295|g>>>12),g=m+(y^w&(p^y))+T[9]+568446438&4294967295,m=p+(g<<5&4294967295|g>>>27),g=w+(p^y&(m^p))+T[14]+3275163606&4294967295,w=m+(g<<9&4294967295|g>>>23),g=y+(m^p&(w^m))+T[3]+4107603335&4294967295,y=w+(g<<14&4294967295|g>>>18),g=p+(w^m&(y^w))+T[8]+1163531501&4294967295,p=y+(g<<20&4294967295|g>>>12),g=m+(y^w&(p^y))+T[13]+2850285829&4294967295,m=p+(g<<5&4294967295|g>>>27),g=w+(p^y&(m^p))+T[2]+4243563512&4294967295,w=m+(g<<9&4294967295|g>>>23),g=y+(m^p&(w^m))+T[7]+1735328473&4294967295,y=w+(g<<14&4294967295|g>>>18),g=p+(w^m&(y^w))+T[12]+2368359562&4294967295,p=y+(g<<20&4294967295|g>>>12),g=m+(p^y^w)+T[5]+4294588738&4294967295,m=p+(g<<4&4294967295|g>>>28),g=w+(m^p^y)+T[8]+2272392833&4294967295,w=m+(g<<11&4294967295|g>>>21),g=y+(w^m^p)+T[11]+1839030562&4294967295,y=w+(g<<16&4294967295|g>>>16),g=p+(y^w^m)+T[14]+4259657740&4294967295,p=y+(g<<23&4294967295|g>>>9),g=m+(p^y^w)+T[1]+2763975236&4294967295,m=p+(g<<4&4294967295|g>>>28),g=w+(m^p^y)+T[4]+1272893353&4294967295,w=m+(g<<11&4294967295|g>>>21),g=y+(w^m^p)+T[7]+4139469664&4294967295,y=w+(g<<16&4294967295|g>>>16),g=p+(y^w^m)+T[10]+3200236656&4294967295,p=y+(g<<23&4294967295|g>>>9),g=m+(p^y^w)+T[13]+681279174&4294967295,m=p+(g<<4&4294967295|g>>>28),g=w+(m^p^y)+T[0]+3936430074&4294967295,w=m+(g<<11&4294967295|g>>>21),g=y+(w^m^p)+T[3]+3572445317&4294967295,y=w+(g<<16&4294967295|g>>>16),g=p+(y^w^m)+T[6]+76029189&4294967295,p=y+(g<<23&4294967295|g>>>9),g=m+(p^y^w)+T[9]+3654602809&4294967295,m=p+(g<<4&4294967295|g>>>28),g=w+(m^p^y)+T[12]+3873151461&4294967295,w=m+(g<<11&4294967295|g>>>21),g=y+(w^m^p)+T[15]+530742520&4294967295,y=w+(g<<16&4294967295|g>>>16),g=p+(y^w^m)+T[2]+3299628645&4294967295,p=y+(g<<23&4294967295|g>>>9),g=m+(y^(p|~w))+T[0]+4096336452&4294967295,m=p+(g<<6&4294967295|g>>>26),g=w+(p^(m|~y))+T[7]+1126891415&4294967295,w=m+(g<<10&4294967295|g>>>22),g=y+(m^(w|~p))+T[14]+2878612391&4294967295,y=w+(g<<15&4294967295|g>>>17),g=p+(w^(y|~m))+T[5]+4237533241&4294967295,p=y+(g<<21&4294967295|g>>>11),g=m+(y^(p|~w))+T[12]+1700485571&4294967295,m=p+(g<<6&4294967295|g>>>26),g=w+(p^(m|~y))+T[3]+2399980690&4294967295,w=m+(g<<10&4294967295|g>>>22),g=y+(m^(w|~p))+T[10]+4293915773&4294967295,y=w+(g<<15&4294967295|g>>>17),g=p+(w^(y|~m))+T[1]+2240044497&4294967295,p=y+(g<<21&4294967295|g>>>11),g=m+(y^(p|~w))+T[8]+1873313359&4294967295,m=p+(g<<6&4294967295|g>>>26),g=w+(p^(m|~y))+T[15]+4264355552&4294967295,w=m+(g<<10&4294967295|g>>>22),g=y+(m^(w|~p))+T[6]+2734768916&4294967295,y=w+(g<<15&4294967295|g>>>17),g=p+(w^(y|~m))+T[13]+1309151649&4294967295,p=y+(g<<21&4294967295|g>>>11),g=m+(y^(p|~w))+T[4]+4149444226&4294967295,m=p+(g<<6&4294967295|g>>>26),g=w+(p^(m|~y))+T[11]+3174756917&4294967295,w=m+(g<<10&4294967295|g>>>22),g=y+(m^(w|~p))+T[2]+718787259&4294967295,y=w+(g<<15&4294967295|g>>>17),g=p+(w^(y|~m))+T[9]+3951481745&4294967295,E.g[0]=E.g[0]+m&4294967295,E.g[1]=E.g[1]+(y+(g<<21&4294967295|g>>>11))&4294967295,E.g[2]=E.g[2]+y&4294967295,E.g[3]=E.g[3]+w&4294967295}r.prototype.v=function(E,m){m===void 0&&(m=E.length);const p=m-this.blockSize,T=this.C;let y=this.h,w=0;for(;w<m;){if(y==0)for(;w<=p;)s(this,E,w),w+=this.blockSize;if(typeof E=="string"){for(;w<m;)if(T[y++]=E.charCodeAt(w++),y==this.blockSize){s(this,T),y=0;break}}else for(;w<m;)if(T[y++]=E[w++],y==this.blockSize){s(this,T),y=0;break}}this.h=y,this.o+=m},r.prototype.A=function(){var E=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);E[0]=128;for(var m=1;m<E.length-8;++m)E[m]=0;m=this.o*8;for(var p=E.length-8;p<E.length;++p)E[p]=m&255,m/=256;for(this.v(E),E=Array(16),m=0,p=0;p<4;++p)for(let T=0;T<32;T+=8)E[m++]=this.g[p]>>>T&255;return E};function o(E,m){var p=u;return Object.prototype.hasOwnProperty.call(p,E)?p[E]:p[E]=m(E)}function a(E,m){this.h=m;const p=[];let T=!0;for(let y=E.length-1;y>=0;y--){const w=E[y]|0;T&&w==m||(p[y]=w,T=!1)}this.g=p}var u={};function h(E){return-128<=E&&E<128?o(E,function(m){return new a([m|0],m<0?-1:0)}):new a([E|0],E<0?-1:0)}function d(E){if(isNaN(E)||!isFinite(E))return I;if(E<0)return V(d(-E));const m=[];let p=1;for(let T=0;E>=p;T++)m[T]=E/p|0,p*=4294967296;return new a(m,0)}function _(E,m){if(E.length==0)throw Error("number format error: empty string");if(m=m||10,m<2||36<m)throw Error("radix out of range: "+m);if(E.charAt(0)=="-")return V(_(E.substring(1),m));if(E.indexOf("-")>=0)throw Error('number format error: interior "-" character');const p=d(Math.pow(m,8));let T=I;for(let w=0;w<E.length;w+=8){var y=Math.min(8,E.length-w);const g=parseInt(E.substring(w,w+y),m);y<8?(y=d(Math.pow(m,y)),T=T.j(y).add(d(g))):(T=T.j(p),T=T.add(d(g)))}return T}var I=h(0),R=h(1),b=h(16777216);n=a.prototype,n.m=function(){if(O(this))return-V(this).m();let E=0,m=1;for(let p=0;p<this.g.length;p++){const T=this.i(p);E+=(T>=0?T:4294967296+T)*m,m*=4294967296}return E},n.toString=function(E){if(E=E||10,E<2||36<E)throw Error("radix out of range: "+E);if(N(this))return"0";if(O(this))return"-"+V(this).toString(E);const m=d(Math.pow(E,6));var p=this;let T="";for(;;){const y=Tt(p,m).g;p=G(p,y.j(m));let w=((p.g.length>0?p.g[0]:p.h)>>>0).toString(E);if(p=y,N(p))return w+T;for(;w.length<6;)w="0"+w;T=w+T}},n.i=function(E){return E<0?0:E<this.g.length?this.g[E]:this.h};function N(E){if(E.h!=0)return!1;for(let m=0;m<E.g.length;m++)if(E.g[m]!=0)return!1;return!0}function O(E){return E.h==-1}n.l=function(E){return E=G(this,E),O(E)?-1:N(E)?0:1};function V(E){const m=E.g.length,p=[];for(let T=0;T<m;T++)p[T]=~E.g[T];return new a(p,~E.h).add(R)}n.abs=function(){return O(this)?V(this):this},n.add=function(E){const m=Math.max(this.g.length,E.g.length),p=[];let T=0;for(let y=0;y<=m;y++){let w=T+(this.i(y)&65535)+(E.i(y)&65535),g=(w>>>16)+(this.i(y)>>>16)+(E.i(y)>>>16);T=g>>>16,w&=65535,g&=65535,p[y]=g<<16|w}return new a(p,p[p.length-1]&-2147483648?-1:0)};function G(E,m){return E.add(V(m))}n.j=function(E){if(N(this)||N(E))return I;if(O(this))return O(E)?V(this).j(V(E)):V(V(this).j(E));if(O(E))return V(this.j(V(E)));if(this.l(b)<0&&E.l(b)<0)return d(this.m()*E.m());const m=this.g.length+E.g.length,p=[];for(var T=0;T<2*m;T++)p[T]=0;for(T=0;T<this.g.length;T++)for(let y=0;y<E.g.length;y++){const w=this.i(T)>>>16,g=this.i(T)&65535,Rt=E.i(y)>>>16,me=E.i(y)&65535;p[2*T+2*y]+=g*me,H(p,2*T+2*y),p[2*T+2*y+1]+=w*me,H(p,2*T+2*y+1),p[2*T+2*y+1]+=g*Rt,H(p,2*T+2*y+1),p[2*T+2*y+2]+=w*Rt,H(p,2*T+2*y+2)}for(E=0;E<m;E++)p[E]=p[2*E+1]<<16|p[2*E];for(E=m;E<2*m;E++)p[E]=0;return new a(p,0)};function H(E,m){for(;(E[m]&65535)!=E[m];)E[m+1]+=E[m]>>>16,E[m]&=65535,m++}function K(E,m){this.g=E,this.h=m}function Tt(E,m){if(N(m))throw Error("division by zero");if(N(E))return new K(I,I);if(O(E))return m=Tt(V(E),m),new K(V(m.g),V(m.h));if(O(m))return m=Tt(E,V(m)),new K(V(m.g),m.h);if(E.g.length>30){if(O(E)||O(m))throw Error("slowDivide_ only works with positive integers.");for(var p=R,T=m;T.l(E)<=0;)p=At(p),T=At(T);var y=ut(p,1),w=ut(T,1);for(T=ut(T,2),p=ut(p,2);!N(T);){var g=w.add(T);g.l(E)<=0&&(y=y.add(p),w=g),T=ut(T,1),p=ut(p,1)}return m=G(E,y.j(m)),new K(y,m)}for(y=I;E.l(m)>=0;){for(p=Math.max(1,Math.floor(E.m()/m.m())),T=Math.ceil(Math.log(p)/Math.LN2),T=T<=48?1:Math.pow(2,T-48),w=d(p),g=w.j(m);O(g)||g.l(E)>0;)p-=T,w=d(p),g=w.j(m);N(w)&&(w=R),y=y.add(w),E=G(E,g)}return new K(y,E)}n.B=function(E){return Tt(this,E).h},n.and=function(E){const m=Math.max(this.g.length,E.g.length),p=[];for(let T=0;T<m;T++)p[T]=this.i(T)&E.i(T);return new a(p,this.h&E.h)},n.or=function(E){const m=Math.max(this.g.length,E.g.length),p=[];for(let T=0;T<m;T++)p[T]=this.i(T)|E.i(T);return new a(p,this.h|E.h)},n.xor=function(E){const m=Math.max(this.g.length,E.g.length),p=[];for(let T=0;T<m;T++)p[T]=this.i(T)^E.i(T);return new a(p,this.h^E.h)};function At(E){const m=E.g.length+1,p=[];for(let T=0;T<m;T++)p[T]=E.i(T)<<1|E.i(T-1)>>>31;return new a(p,E.h)}function ut(E,m){const p=m>>5;m%=32;const T=E.g.length-p,y=[];for(let w=0;w<T;w++)y[w]=m>0?E.i(w+p)>>>m|E.i(w+p+1)<<32-m:E.i(w+p);return new a(y,E.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,Mc=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=_,se=a}).apply(typeof wa<"u"?wa:typeof self<"u"?self:typeof window<"u"?window:{});var pr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var xc,vn,Oc,vr,Zs,Lc,Fc,Bc;(function(){var n,t=Object.defineProperty;function e(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof pr=="object"&&pr];for(var c=0;c<i.length;++c){var l=i[c];if(l&&l.Math==Math)return l}throw Error("Cannot find global object")}var r=e(this);function s(i,c){if(c)t:{var l=r;i=i.split(".");for(var f=0;f<i.length-1;f++){var v=i[f];if(!(v in l))break t;l=l[v]}i=i[i.length-1],f=l[i],c=c(f),c!=f&&c!=null&&t(l,i,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(i){return i||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(i){return i||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(i){return i||function(c){var l=[],f;for(f in c)Object.prototype.hasOwnProperty.call(c,f)&&l.push([f,c[f]]);return l}});var o=o||{},a=this||self;function u(i){var c=typeof i;return c=="object"&&i!=null||c=="function"}function h(i,c,l){return i.call.apply(i.bind,arguments)}function d(i,c,l){return d=h,d.apply(null,arguments)}function _(i,c){var l=Array.prototype.slice.call(arguments,1);return function(){var f=l.slice();return f.push.apply(f,arguments),i.apply(this,f)}}function I(i,c){function l(){}l.prototype=c.prototype,i.Z=c.prototype,i.prototype=new l,i.prototype.constructor=i,i.Ob=function(f,v,A){for(var P=Array(arguments.length-2),U=2;U<arguments.length;U++)P[U-2]=arguments[U];return c.prototype[v].apply(f,P)}}var R=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?i=>i&&AsyncContext.Snapshot.wrap(i):i=>i;function b(i){const c=i.length;if(c>0){const l=Array(c);for(let f=0;f<c;f++)l[f]=i[f];return l}return[]}function N(i,c){for(let f=1;f<arguments.length;f++){const v=arguments[f];var l=typeof v;if(l=l!="object"?l:v?Array.isArray(v)?"array":l:"null",l=="array"||l=="object"&&typeof v.length=="number"){l=i.length||0;const A=v.length||0;i.length=l+A;for(let P=0;P<A;P++)i[l+P]=v[P]}else i.push(v)}}class O{constructor(c,l){this.i=c,this.j=l,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function V(i){a.setTimeout(()=>{throw i},0)}function G(){var i=E;let c=null;return i.g&&(c=i.g,i.g=i.g.next,i.g||(i.h=null),c.next=null),c}class H{constructor(){this.h=this.g=null}add(c,l){const f=K.get();f.set(c,l),this.h?this.h.next=f:this.g=f,this.h=f}}var K=new O(()=>new Tt,i=>i.reset());class Tt{constructor(){this.next=this.g=this.h=null}set(c,l){this.h=c,this.g=l,this.next=null}reset(){this.next=this.g=this.h=null}}let At,ut=!1,E=new H,m=()=>{const i=Promise.resolve(void 0);At=()=>{i.then(p)}};function p(){for(var i;i=G();){try{i.h.call(i.g)}catch(l){V(l)}var c=K;c.j(i),c.h<100&&(c.h++,i.next=c.g,c.g=i)}ut=!1}function T(){this.u=this.u,this.C=this.C}T.prototype.u=!1,T.prototype.dispose=function(){this.u||(this.u=!0,this.N())},T.prototype[Symbol.dispose]=function(){this.dispose()},T.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function y(i,c){this.type=i,this.g=this.target=c,this.defaultPrevented=!1}y.prototype.h=function(){this.defaultPrevented=!0};var w=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var i=!1,c=Object.defineProperty({},"passive",{get:function(){i=!0}});try{const l=()=>{};a.addEventListener("test",l,c),a.removeEventListener("test",l,c)}catch{}return i})();function g(i){return/^[\s\xa0]*$/.test(i)}function Rt(i,c){y.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i&&this.init(i,c)}I(Rt,y),Rt.prototype.init=function(i,c){const l=this.type=i.type,f=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;this.target=i.target||i.srcElement,this.g=c,c=i.relatedTarget,c||(l=="mouseover"?c=i.fromElement:l=="mouseout"&&(c=i.toElement)),this.relatedTarget=c,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=i.pointerType,this.state=i.state,this.i=i,i.defaultPrevented&&Rt.Z.h.call(this)},Rt.prototype.h=function(){Rt.Z.h.call(this);const i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var me="closure_listenable_"+(Math.random()*1e6|0),Su=0;function bu(i,c,l,f,v){this.listener=i,this.proxy=null,this.src=c,this.type=l,this.capture=!!f,this.ha=v,this.key=++Su,this.da=this.fa=!1}function er(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function nr(i,c,l){for(const f in i)c.call(l,i[f],f,i)}function Pu(i,c){for(const l in i)c.call(void 0,i[l],l,i)}function uo(i){const c={};for(const l in i)c[l]=i[l];return c}const ho="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function fo(i,c){let l,f;for(let v=1;v<arguments.length;v++){f=arguments[v];for(l in f)i[l]=f[l];for(let A=0;A<ho.length;A++)l=ho[A],Object.prototype.hasOwnProperty.call(f,l)&&(i[l]=f[l])}}function rr(i){this.src=i,this.g={},this.h=0}rr.prototype.add=function(i,c,l,f,v){const A=i.toString();i=this.g[A],i||(i=this.g[A]=[],this.h++);const P=ms(i,c,f,v);return P>-1?(c=i[P],l||(c.fa=!1)):(c=new bu(c,this.src,A,!!f,v),c.fa=l,i.push(c)),c};function fs(i,c){const l=c.type;if(l in i.g){var f=i.g[l],v=Array.prototype.indexOf.call(f,c,void 0),A;(A=v>=0)&&Array.prototype.splice.call(f,v,1),A&&(er(c),i.g[l].length==0&&(delete i.g[l],i.h--))}}function ms(i,c,l,f){for(let v=0;v<i.length;++v){const A=i[v];if(!A.da&&A.listener==c&&A.capture==!!l&&A.ha==f)return v}return-1}var gs="closure_lm_"+(Math.random()*1e6|0),ps={};function mo(i,c,l,f,v){if(Array.isArray(c)){for(let A=0;A<c.length;A++)mo(i,c[A],l,f,v);return null}return l=_o(l),i&&i[me]?i.J(c,l,u(f)?!!f.capture:!1,v):Vu(i,c,l,!1,f,v)}function Vu(i,c,l,f,v,A){if(!c)throw Error("Invalid event type");const P=u(v)?!!v.capture:!!v;let U=ys(i);if(U||(i[gs]=U=new rr(i)),l=U.add(c,l,f,P,A),l.proxy)return l;if(f=Du(),l.proxy=f,f.src=i,f.listener=l,i.addEventListener)w||(v=P),v===void 0&&(v=!1),i.addEventListener(c.toString(),f,v);else if(i.attachEvent)i.attachEvent(po(c.toString()),f);else if(i.addListener&&i.removeListener)i.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return l}function Du(){function i(l){return c.call(i.src,i.listener,l)}const c=ku;return i}function go(i,c,l,f,v){if(Array.isArray(c))for(var A=0;A<c.length;A++)go(i,c[A],l,f,v);else f=u(f)?!!f.capture:!!f,l=_o(l),i&&i[me]?(i=i.i,A=String(c).toString(),A in i.g&&(c=i.g[A],l=ms(c,l,f,v),l>-1&&(er(c[l]),Array.prototype.splice.call(c,l,1),c.length==0&&(delete i.g[A],i.h--)))):i&&(i=ys(i))&&(c=i.g[c.toString()],i=-1,c&&(i=ms(c,l,f,v)),(l=i>-1?c[i]:null)&&_s(l))}function _s(i){if(typeof i!="number"&&i&&!i.da){var c=i.src;if(c&&c[me])fs(c.i,i);else{var l=i.type,f=i.proxy;c.removeEventListener?c.removeEventListener(l,f,i.capture):c.detachEvent?c.detachEvent(po(l),f):c.addListener&&c.removeListener&&c.removeListener(f),(l=ys(c))?(fs(l,i),l.h==0&&(l.src=null,c[gs]=null)):er(i)}}}function po(i){return i in ps?ps[i]:ps[i]="on"+i}function ku(i,c){if(i.da)i=!0;else{c=new Rt(c,this);const l=i.listener,f=i.ha||i.src;i.fa&&_s(i),i=l.call(f,c)}return i}function ys(i){return i=i[gs],i instanceof rr?i:null}var Es="__closure_events_fn_"+(Math.random()*1e9>>>0);function _o(i){return typeof i=="function"?i:(i[Es]||(i[Es]=function(c){return i.handleEvent(c)}),i[Es])}function pt(){T.call(this),this.i=new rr(this),this.M=this,this.G=null}I(pt,T),pt.prototype[me]=!0,pt.prototype.removeEventListener=function(i,c,l,f){go(this,i,c,l,f)};function It(i,c){var l,f=i.G;if(f)for(l=[];f;f=f.G)l.push(f);if(i=i.M,f=c.type||c,typeof c=="string")c=new y(c,i);else if(c instanceof y)c.target=c.target||i;else{var v=c;c=new y(f,i),fo(c,v)}v=!0;let A,P;if(l)for(P=l.length-1;P>=0;P--)A=c.g=l[P],v=sr(A,f,!0,c)&&v;if(A=c.g=i,v=sr(A,f,!0,c)&&v,v=sr(A,f,!1,c)&&v,l)for(P=0;P<l.length;P++)A=c.g=l[P],v=sr(A,f,!1,c)&&v}pt.prototype.N=function(){if(pt.Z.N.call(this),this.i){var i=this.i;for(const c in i.g){const l=i.g[c];for(let f=0;f<l.length;f++)er(l[f]);delete i.g[c],i.h--}}this.G=null},pt.prototype.J=function(i,c,l,f){return this.i.add(String(i),c,!1,l,f)},pt.prototype.K=function(i,c,l,f){return this.i.add(String(i),c,!0,l,f)};function sr(i,c,l,f){if(c=i.i.g[String(c)],!c)return!0;c=c.concat();let v=!0;for(let A=0;A<c.length;++A){const P=c[A];if(P&&!P.da&&P.capture==l){const U=P.listener,ot=P.ha||P.src;P.fa&&fs(i.i,P),v=U.call(ot,f)!==!1&&v}}return v&&!f.defaultPrevented}function Nu(i,c){if(typeof i!="function")if(i&&typeof i.handleEvent=="function")i=d(i.handleEvent,i);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(i,c||0)}function yo(i){i.g=Nu(()=>{i.g=null,i.i&&(i.i=!1,yo(i))},i.l);const c=i.h;i.h=null,i.m.apply(null,c)}class Mu extends T{constructor(c,l){super(),this.m=c,this.l=l,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:yo(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function on(i){T.call(this),this.h=i,this.g={}}I(on,T);var Eo=[];function To(i){nr(i.g,function(c,l){this.g.hasOwnProperty(l)&&_s(c)},i),i.g={}}on.prototype.N=function(){on.Z.N.call(this),To(this)},on.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ts=a.JSON.stringify,xu=a.JSON.parse,Ou=class{stringify(i){return a.JSON.stringify(i,void 0)}parse(i){return a.JSON.parse(i,void 0)}};function Io(){}function vo(){}var an={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Is(){y.call(this,"d")}I(Is,y);function vs(){y.call(this,"c")}I(vs,y);var ge={},wo=null;function ir(){return wo=wo||new pt}ge.Ia="serverreachability";function Ao(i){y.call(this,ge.Ia,i)}I(Ao,y);function cn(i){const c=ir();It(c,new Ao(c))}ge.STAT_EVENT="statevent";function Ro(i,c){y.call(this,ge.STAT_EVENT,i),this.stat=c}I(Ro,y);function vt(i){const c=ir();It(c,new Ro(c,i))}ge.Ja="timingevent";function Co(i,c){y.call(this,ge.Ja,i),this.size=c}I(Co,y);function ln(i,c){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){i()},c)}function un(){this.g=!0}un.prototype.ua=function(){this.g=!1};function Lu(i,c,l,f,v,A){i.info(function(){if(i.g)if(A){var P="",U=A.split("&");for(let Q=0;Q<U.length;Q++){var ot=U[Q].split("=");if(ot.length>1){const ht=ot[0];ot=ot[1];const xt=ht.split("_");P=xt.length>=2&&xt[1]=="type"?P+(ht+"="+ot+"&"):P+(ht+"=redacted&")}}}else P=null;else P=A;return"XMLHTTP REQ ("+f+") [attempt "+v+"]: "+c+`
`+l+`
`+P})}function Fu(i,c,l,f,v,A,P){i.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+v+"]: "+c+`
`+l+`
`+A+" "+P})}function Me(i,c,l,f){i.info(function(){return"XMLHTTP TEXT ("+c+"): "+Uu(i,l)+(f?" "+f:"")})}function Bu(i,c){i.info(function(){return"TIMEOUT: "+c})}un.prototype.info=function(){};function Uu(i,c){if(!i.g)return c;if(!c)return null;try{const A=JSON.parse(c);if(A){for(i=0;i<A.length;i++)if(Array.isArray(A[i])){var l=A[i];if(!(l.length<2)){var f=l[1];if(Array.isArray(f)&&!(f.length<1)){var v=f[0];if(v!="noop"&&v!="stop"&&v!="close")for(let P=1;P<f.length;P++)f[P]=""}}}}return Ts(A)}catch{return c}}var or={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},So={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},bo;function ws(){}I(ws,Io),ws.prototype.g=function(){return new XMLHttpRequest},bo=new ws;function hn(i){return encodeURIComponent(String(i))}function ju(i){var c=1;i=i.split(":");const l=[];for(;c>0&&i.length;)l.push(i.shift()),c--;return i.length&&l.push(i.join(":")),l}function Qt(i,c,l,f){this.j=i,this.i=c,this.l=l,this.S=f||1,this.V=new on(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Po}function Po(){this.i=null,this.g="",this.h=!1}var Vo={},As={};function Rs(i,c,l){i.M=1,i.A=cr(Mt(c)),i.u=l,i.R=!0,Do(i,null)}function Do(i,c){i.F=Date.now(),ar(i),i.B=Mt(i.A);var l=i.B,f=i.S;Array.isArray(f)||(f=[String(f)]),zo(l.i,"t",f),i.C=0,l=i.j.L,i.h=new Po,i.g=ca(i.j,l?c:null,!i.u),i.P>0&&(i.O=new Mu(d(i.Y,i,i.g),i.P)),c=i.V,l=i.g,f=i.ba;var v="readystatechange";Array.isArray(v)||(v&&(Eo[0]=v.toString()),v=Eo);for(let A=0;A<v.length;A++){const P=mo(l,v[A],f||c.handleEvent,!1,c.h||c);if(!P)break;c.g[P.key]=P}c=i.J?uo(i.J):{},i.u?(i.v||(i.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.B,i.v,i.u,c)):(i.v="GET",i.g.ea(i.B,i.v,null,c)),cn(),Lu(i.i,i.v,i.B,i.l,i.S,i.u)}Qt.prototype.ba=function(i){i=i.target;const c=this.O;c&&Yt(i)==3?c.j():this.Y(i)},Qt.prototype.Y=function(i){try{if(i==this.g)t:{const U=Yt(this.g),ot=this.g.ya(),Q=this.g.ca();if(!(U<3)&&(U!=3||this.g&&(this.h.h||this.g.la()||Jo(this.g)))){this.K||U!=4||ot==7||(ot==8||Q<=0?cn(3):cn(2)),Cs(this);var c=this.g.ca();this.X=c;var l=qu(this);if(this.o=c==200,Fu(this.i,this.v,this.B,this.l,this.S,U,c),this.o){if(this.U&&!this.L){e:{if(this.g){var f,v=this.g;if((f=v.g?v.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!g(f)){var A=f;break e}}A=null}if(i=A)Me(this.i,this.l,i,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ss(this,i);else{this.o=!1,this.m=3,vt(12),pe(this),dn(this);break t}}if(this.R){i=!0;let ht;for(;!this.K&&this.C<l.length;)if(ht=$u(this,l),ht==As){U==4&&(this.m=4,vt(14),i=!1),Me(this.i,this.l,null,"[Incomplete Response]");break}else if(ht==Vo){this.m=4,vt(15),Me(this.i,this.l,l,"[Invalid Chunk]"),i=!1;break}else Me(this.i,this.l,ht,null),Ss(this,ht);if(ko(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),U!=4||l.length!=0||this.h.h||(this.m=1,vt(16),i=!1),this.o=this.o&&i,!i)Me(this.i,this.l,l,"[Invalid Chunked Response]"),pe(this),dn(this);else if(l.length>0&&!this.W){this.W=!0;var P=this.j;P.g==this&&P.aa&&!P.P&&(P.j.info("Great, no buffering proxy detected. Bytes received: "+l.length),xs(P),P.P=!0,vt(11))}}else Me(this.i,this.l,l,null),Ss(this,l);U==4&&pe(this),this.o&&!this.K&&(U==4?sa(this.j,this):(this.o=!1,ar(this)))}else rh(this.g),c==400&&l.indexOf("Unknown SID")>0?(this.m=3,vt(12)):(this.m=0,vt(13)),pe(this),dn(this)}}}catch{}finally{}};function qu(i){if(!ko(i))return i.g.la();const c=Jo(i.g);if(c==="")return"";let l="";const f=c.length,v=Yt(i.g)==4;if(!i.h.i){if(typeof TextDecoder>"u")return pe(i),dn(i),"";i.h.i=new a.TextDecoder}for(let A=0;A<f;A++)i.h.h=!0,l+=i.h.i.decode(c[A],{stream:!(v&&A==f-1)});return c.length=0,i.h.g+=l,i.C=0,i.h.g}function ko(i){return i.g?i.v=="GET"&&i.M!=2&&i.j.Aa:!1}function $u(i,c){var l=i.C,f=c.indexOf(`
`,l);return f==-1?As:(l=Number(c.substring(l,f)),isNaN(l)?Vo:(f+=1,f+l>c.length?As:(c=c.slice(f,f+l),i.C=f+l,c)))}Qt.prototype.cancel=function(){this.K=!0,pe(this)};function ar(i){i.T=Date.now()+i.H,No(i,i.H)}function No(i,c){if(i.D!=null)throw Error("WatchDog timer not null");i.D=ln(d(i.aa,i),c)}function Cs(i){i.D&&(a.clearTimeout(i.D),i.D=null)}Qt.prototype.aa=function(){this.D=null;const i=Date.now();i-this.T>=0?(Bu(this.i,this.B),this.M!=2&&(cn(),vt(17)),pe(this),this.m=2,dn(this)):No(this,this.T-i)};function dn(i){i.j.I==0||i.K||sa(i.j,i)}function pe(i){Cs(i);var c=i.O;c&&typeof c.dispose=="function"&&c.dispose(),i.O=null,To(i.V),i.g&&(c=i.g,i.g=null,c.abort(),c.dispose())}function Ss(i,c){try{var l=i.j;if(l.I!=0&&(l.g==i||bs(l.h,i))){if(!i.L&&bs(l.h,i)&&l.I==3){try{var f=l.Ba.g.parse(c)}catch{f=null}if(Array.isArray(f)&&f.length==3){var v=f;if(v[0]==0){t:if(!l.v){if(l.g)if(l.g.F+3e3<i.F)fr(l),hr(l);else break t;Ms(l),vt(18)}}else l.xa=v[1],0<l.xa-l.K&&v[2]<37500&&l.F&&l.A==0&&!l.C&&(l.C=ln(d(l.Va,l),6e3));Oo(l.h)<=1&&l.ta&&(l.ta=void 0)}else ye(l,11)}else if((i.L||l.g==i)&&fr(l),!g(c))for(v=l.Ba.g.parse(c),c=0;c<v.length;c++){let Q=v[c];const ht=Q[0];if(!(ht<=l.K))if(l.K=ht,Q=Q[1],l.I==2)if(Q[0]=="c"){l.M=Q[1],l.ba=Q[2];const xt=Q[3];xt!=null&&(l.ka=xt,l.j.info("VER="+l.ka));const Ee=Q[4];Ee!=null&&(l.za=Ee,l.j.info("SVER="+l.za));const Zt=Q[5];Zt!=null&&typeof Zt=="number"&&Zt>0&&(f=1.5*Zt,l.O=f,l.j.info("backChannelRequestTimeoutMs_="+f)),f=l;const te=i.g;if(te){const gr=te.g?te.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(gr){var A=f.h;A.g||gr.indexOf("spdy")==-1&&gr.indexOf("quic")==-1&&gr.indexOf("h2")==-1||(A.j=A.l,A.g=new Set,A.h&&(Ps(A,A.h),A.h=null))}if(f.G){const Os=te.g?te.g.getResponseHeader("X-HTTP-Session-Id"):null;Os&&(f.wa=Os,X(f.J,f.G,Os))}}l.I=3,l.l&&l.l.ra(),l.aa&&(l.T=Date.now()-i.F,l.j.info("Handshake RTT: "+l.T+"ms")),f=l;var P=i;if(f.na=aa(f,f.L?f.ba:null,f.W),P.L){Lo(f.h,P);var U=P,ot=f.O;ot&&(U.H=ot),U.D&&(Cs(U),ar(U)),f.g=P}else na(f);l.i.length>0&&dr(l)}else Q[0]!="stop"&&Q[0]!="close"||ye(l,7);else l.I==3&&(Q[0]=="stop"||Q[0]=="close"?Q[0]=="stop"?ye(l,7):Ns(l):Q[0]!="noop"&&l.l&&l.l.qa(Q),l.A=0)}}cn(4)}catch{}}var zu=class{constructor(i,c){this.g=i,this.map=c}};function Mo(i){this.l=i||10,a.PerformanceNavigationTiming?(i=a.performance.getEntriesByType("navigation"),i=i.length>0&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function xo(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function Oo(i){return i.h?1:i.g?i.g.size:0}function bs(i,c){return i.h?i.h==c:i.g?i.g.has(c):!1}function Ps(i,c){i.g?i.g.add(c):i.h=c}function Lo(i,c){i.h&&i.h==c?i.h=null:i.g&&i.g.has(c)&&i.g.delete(c)}Mo.prototype.cancel=function(){if(this.i=Fo(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function Fo(i){if(i.h!=null)return i.i.concat(i.h.G);if(i.g!=null&&i.g.size!==0){let c=i.i;for(const l of i.g.values())c=c.concat(l.G);return c}return b(i.i)}var Bo=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Gu(i,c){if(i){i=i.split("&");for(let l=0;l<i.length;l++){const f=i[l].indexOf("=");let v,A=null;f>=0?(v=i[l].substring(0,f),A=i[l].substring(f+1)):v=i[l],c(v,A?decodeURIComponent(A.replace(/\+/g," ")):"")}}}function Xt(i){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;i instanceof Xt?(this.l=i.l,fn(this,i.j),this.o=i.o,this.g=i.g,mn(this,i.u),this.h=i.h,Vs(this,Go(i.i)),this.m=i.m):i&&(c=String(i).match(Bo))?(this.l=!1,fn(this,c[1]||"",!0),this.o=gn(c[2]||""),this.g=gn(c[3]||"",!0),mn(this,c[4]),this.h=gn(c[5]||"",!0),Vs(this,c[6]||"",!0),this.m=gn(c[7]||"")):(this.l=!1,this.i=new _n(null,this.l))}Xt.prototype.toString=function(){const i=[];var c=this.j;c&&i.push(pn(c,Uo,!0),":");var l=this.g;return(l||c=="file")&&(i.push("//"),(c=this.o)&&i.push(pn(c,Uo,!0),"@"),i.push(hn(l).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l=this.u,l!=null&&i.push(":",String(l))),(l=this.h)&&(this.g&&l.charAt(0)!="/"&&i.push("/"),i.push(pn(l,l.charAt(0)=="/"?Wu:Ku,!0))),(l=this.i.toString())&&i.push("?",l),(l=this.m)&&i.push("#",pn(l,Xu)),i.join("")},Xt.prototype.resolve=function(i){const c=Mt(this);let l=!!i.j;l?fn(c,i.j):l=!!i.o,l?c.o=i.o:l=!!i.g,l?c.g=i.g:l=i.u!=null;var f=i.h;if(l)mn(c,i.u);else if(l=!!i.h){if(f.charAt(0)!="/")if(this.g&&!this.h)f="/"+f;else{var v=c.h.lastIndexOf("/");v!=-1&&(f=c.h.slice(0,v+1)+f)}if(v=f,v==".."||v==".")f="";else if(v.indexOf("./")!=-1||v.indexOf("/.")!=-1){f=v.lastIndexOf("/",0)==0,v=v.split("/");const A=[];for(let P=0;P<v.length;){const U=v[P++];U=="."?f&&P==v.length&&A.push(""):U==".."?((A.length>1||A.length==1&&A[0]!="")&&A.pop(),f&&P==v.length&&A.push("")):(A.push(U),f=!0)}f=A.join("/")}else f=v}return l?c.h=f:l=i.i.toString()!=="",l?Vs(c,Go(i.i)):l=!!i.m,l&&(c.m=i.m),c};function Mt(i){return new Xt(i)}function fn(i,c,l){i.j=l?gn(c,!0):c,i.j&&(i.j=i.j.replace(/:$/,""))}function mn(i,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);i.u=c}else i.u=null}function Vs(i,c,l){c instanceof _n?(i.i=c,Ju(i.i,i.l)):(l||(c=pn(c,Qu)),i.i=new _n(c,i.l))}function X(i,c,l){i.i.set(c,l)}function cr(i){return X(i,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),i}function gn(i,c){return i?c?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function pn(i,c,l){return typeof i=="string"?(i=encodeURI(i).replace(c,Hu),l&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function Hu(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var Uo=/[#\/\?@]/g,Ku=/[#\?:]/g,Wu=/[#\?]/g,Qu=/[#\?@]/g,Xu=/#/g;function _n(i,c){this.h=this.g=null,this.i=i||null,this.j=!!c}function _e(i){i.g||(i.g=new Map,i.h=0,i.i&&Gu(i.i,function(c,l){i.add(decodeURIComponent(c.replace(/\+/g," ")),l)}))}n=_n.prototype,n.add=function(i,c){_e(this),this.i=null,i=xe(this,i);let l=this.g.get(i);return l||this.g.set(i,l=[]),l.push(c),this.h+=1,this};function jo(i,c){_e(i),c=xe(i,c),i.g.has(c)&&(i.i=null,i.h-=i.g.get(c).length,i.g.delete(c))}function qo(i,c){return _e(i),c=xe(i,c),i.g.has(c)}n.forEach=function(i,c){_e(this),this.g.forEach(function(l,f){l.forEach(function(v){i.call(c,v,f,this)},this)},this)};function $o(i,c){_e(i);let l=[];if(typeof c=="string")qo(i,c)&&(l=l.concat(i.g.get(xe(i,c))));else for(i=Array.from(i.g.values()),c=0;c<i.length;c++)l=l.concat(i[c]);return l}n.set=function(i,c){return _e(this),this.i=null,i=xe(this,i),qo(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[c]),this.h+=1,this},n.get=function(i,c){return i?(i=$o(this,i),i.length>0?String(i[0]):c):c};function zo(i,c,l){jo(i,c),l.length>0&&(i.i=null,i.g.set(xe(i,c),b(l)),i.h+=l.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],c=Array.from(this.g.keys());for(let f=0;f<c.length;f++){var l=c[f];const v=hn(l);l=$o(this,l);for(let A=0;A<l.length;A++){let P=v;l[A]!==""&&(P+="="+hn(l[A])),i.push(P)}}return this.i=i.join("&")};function Go(i){const c=new _n;return c.i=i.i,i.g&&(c.g=new Map(i.g),c.h=i.h),c}function xe(i,c){return c=String(c),i.j&&(c=c.toLowerCase()),c}function Ju(i,c){c&&!i.j&&(_e(i),i.i=null,i.g.forEach(function(l,f){const v=f.toLowerCase();f!=v&&(jo(this,f),zo(this,v,l))},i)),i.j=c}function Yu(i,c){const l=new un;if(a.Image){const f=new Image;f.onload=_(Jt,l,"TestLoadImage: loaded",!0,c,f),f.onerror=_(Jt,l,"TestLoadImage: error",!1,c,f),f.onabort=_(Jt,l,"TestLoadImage: abort",!1,c,f),f.ontimeout=_(Jt,l,"TestLoadImage: timeout",!1,c,f),a.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=i}else c(!1)}function Zu(i,c){const l=new un,f=new AbortController,v=setTimeout(()=>{f.abort(),Jt(l,"TestPingServer: timeout",!1,c)},1e4);fetch(i,{signal:f.signal}).then(A=>{clearTimeout(v),A.ok?Jt(l,"TestPingServer: ok",!0,c):Jt(l,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(v),Jt(l,"TestPingServer: error",!1,c)})}function Jt(i,c,l,f,v){try{v&&(v.onload=null,v.onerror=null,v.onabort=null,v.ontimeout=null),f(l)}catch{}}function th(){this.g=new Ou}function Ds(i){this.i=i.Sb||null,this.h=i.ab||!1}I(Ds,Io),Ds.prototype.g=function(){return new lr(this.i,this.h)};function lr(i,c){pt.call(this),this.H=i,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}I(lr,pt),n=lr.prototype,n.open=function(i,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=i,this.D=c,this.readyState=1,En(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};i&&(c.body=i),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,yn(this)),this.readyState=0},n.Pa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,En(this)),this.g&&(this.readyState=3,En(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Ho(this)}else i.text().then(this.Oa.bind(this),this.ga.bind(this))};function Ho(i){i.j.read().then(i.Ma.bind(i)).catch(i.ga.bind(i))}n.Ma=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var c=i.value?i.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!i.done}))&&(this.response=this.responseText+=c)}i.done?yn(this):En(this),this.readyState==3&&Ho(this)}},n.Oa=function(i){this.g&&(this.response=this.responseText=i,yn(this))},n.Na=function(i){this.g&&(this.response=i,yn(this))},n.ga=function(){this.g&&yn(this)};function yn(i){i.readyState=4,i.l=null,i.j=null,i.B=null,En(i)}n.setRequestHeader=function(i,c){this.A.append(i,c)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],c=this.h.entries();for(var l=c.next();!l.done;)l=l.value,i.push(l[0]+": "+l[1]),l=c.next();return i.join(`\r
`)};function En(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(lr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function Ko(i){let c="";return nr(i,function(l,f){c+=f,c+=":",c+=l,c+=`\r
`}),c}function ks(i,c,l){t:{for(f in l){var f=!1;break t}f=!0}f||(l=Ko(l),typeof i=="string"?l!=null&&hn(l):X(i,c,l))}function et(i){pt.call(this),this.headers=new Map,this.L=i||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}I(et,pt);var eh=/^https?$/i,nh=["POST","PUT"];n=et.prototype,n.Fa=function(i){this.H=i},n.ea=function(i,c,l,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);c=c?c.toUpperCase():"GET",this.D=i,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():bo.g(),this.g.onreadystatechange=R(d(this.Ca,this));try{this.B=!0,this.g.open(c,String(i),!0),this.B=!1}catch(A){Wo(this,A);return}if(i=l||"",l=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var v in f)l.set(v,f[v]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(const A of f.keys())l.set(A,f.get(A));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(l.keys()).find(A=>A.toLowerCase()=="content-type"),v=a.FormData&&i instanceof a.FormData,!(Array.prototype.indexOf.call(nh,c,void 0)>=0)||f||v||l.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[A,P]of l)this.g.setRequestHeader(A,P);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(i),this.v=!1}catch(A){Wo(this,A)}};function Wo(i,c){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=c,i.o=5,Qo(i),ur(i)}function Qo(i){i.A||(i.A=!0,It(i,"complete"),It(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=i||7,It(this,"complete"),It(this,"abort"),ur(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),ur(this,!0)),et.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Xo(this):this.Xa())},n.Xa=function(){Xo(this)};function Xo(i){if(i.h&&typeof o<"u"){if(i.v&&Yt(i)==4)setTimeout(i.Ca.bind(i),0);else if(It(i,"readystatechange"),Yt(i)==4){i.h=!1;try{const A=i.ca();t:switch(A){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break t;default:c=!1}var l;if(!(l=c)){var f;if(f=A===0){let P=String(i.D).match(Bo)[1]||null;!P&&a.self&&a.self.location&&(P=a.self.location.protocol.slice(0,-1)),f=!eh.test(P?P.toLowerCase():"")}l=f}if(l)It(i,"complete"),It(i,"success");else{i.o=6;try{var v=Yt(i)>2?i.g.statusText:""}catch{v=""}i.l=v+" ["+i.ca()+"]",Qo(i)}}finally{ur(i)}}}}function ur(i,c){if(i.g){i.m&&(clearTimeout(i.m),i.m=null);const l=i.g;i.g=null,c||It(i,"ready");try{l.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Yt(i){return i.g?i.g.readyState:0}n.ca=function(){try{return Yt(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(i){if(this.g){var c=this.g.responseText;return i&&c.indexOf(i)==0&&(c=c.substring(i.length)),xu(c)}};function Jo(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.F){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function rh(i){const c={};i=(i.g&&Yt(i)>=2&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<i.length;f++){if(g(i[f]))continue;var l=ju(i[f]);const v=l[0];if(l=l[1],typeof l!="string")continue;l=l.trim();const A=c[v]||[];c[v]=A,A.push(l)}Pu(c,function(f){return f.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Tn(i,c,l){return l&&l.internalChannelParams&&l.internalChannelParams[i]||c}function Yo(i){this.za=0,this.i=[],this.j=new un,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Tn("failFast",!1,i),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Tn("baseRetryDelayMs",5e3,i),this.Za=Tn("retryDelaySeedMs",1e4,i),this.Ta=Tn("forwardChannelMaxRetries",2,i),this.va=Tn("forwardChannelRequestTimeoutMs",2e4,i),this.ma=i&&i.xmlHttpFactory||void 0,this.Ua=i&&i.Rb||void 0,this.Aa=i&&i.useFetchStreams||!1,this.O=void 0,this.L=i&&i.supportsCrossDomainXhr||!1,this.M="",this.h=new Mo(i&&i.concurrentRequestLimit),this.Ba=new th,this.S=i&&i.fastHandshake||!1,this.R=i&&i.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=i&&i.Pb||!1,i&&i.ua&&this.j.ua(),i&&i.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&i&&i.detectBufferingProxy||!1,this.ia=void 0,i&&i.longPollingTimeout&&i.longPollingTimeout>0&&(this.ia=i.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Yo.prototype,n.ka=8,n.I=1,n.connect=function(i,c,l,f){vt(0),this.W=i,this.H=c||{},l&&f!==void 0&&(this.H.OSID=l,this.H.OAID=f),this.F=this.X,this.J=aa(this,null,this.W),dr(this)};function Ns(i){if(Zo(i),i.I==3){var c=i.V++,l=Mt(i.J);if(X(l,"SID",i.M),X(l,"RID",c),X(l,"TYPE","terminate"),In(i,l),c=new Qt(i,i.j,c),c.M=2,c.A=cr(Mt(l)),l=!1,a.navigator&&a.navigator.sendBeacon)try{l=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!l&&a.Image&&(new Image().src=c.A,l=!0),l||(c.g=ca(c.j,null),c.g.ea(c.A)),c.F=Date.now(),ar(c)}oa(i)}function hr(i){i.g&&(xs(i),i.g.cancel(),i.g=null)}function Zo(i){hr(i),i.v&&(a.clearTimeout(i.v),i.v=null),fr(i),i.h.cancel(),i.m&&(typeof i.m=="number"&&a.clearTimeout(i.m),i.m=null)}function dr(i){if(!xo(i.h)&&!i.m){i.m=!0;var c=i.Ea;At||m(),ut||(At(),ut=!0),E.add(c,i),i.D=0}}function sh(i,c){return Oo(i.h)>=i.h.j-(i.m?1:0)?!1:i.m?(i.i=c.G.concat(i.i),!0):i.I==1||i.I==2||i.D>=(i.Sa?0:i.Ta)?!1:(i.m=ln(d(i.Ea,i,c),ia(i,i.D)),i.D++,!0)}n.Ea=function(i){if(this.m)if(this.m=null,this.I==1){if(!i){this.V=Math.floor(Math.random()*1e5),i=this.V++;const v=new Qt(this,this.j,i);let A=this.o;if(this.U&&(A?(A=uo(A),fo(A,this.U)):A=this.U),this.u!==null||this.R||(v.J=A,A=null),this.S)t:{for(var c=0,l=0;l<this.i.length;l++){e:{var f=this.i[l];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break e}f=void 0}if(f===void 0)break;if(c+=f,c>4096){c=l;break t}if(c===4096||l===this.i.length-1){c=l+1;break t}}c=1e3}else c=1e3;c=ea(this,v,c),l=Mt(this.J),X(l,"RID",i),X(l,"CVER",22),this.G&&X(l,"X-HTTP-Session-Id",this.G),In(this,l),A&&(this.R?c="headers="+hn(Ko(A))+"&"+c:this.u&&ks(l,this.u,A)),Ps(this.h,v),this.Ra&&X(l,"TYPE","init"),this.S?(X(l,"$req",c),X(l,"SID","null"),v.U=!0,Rs(v,l,null)):Rs(v,l,c),this.I=2}}else this.I==3&&(i?ta(this,i):this.i.length==0||xo(this.h)||ta(this))};function ta(i,c){var l;c?l=c.l:l=i.V++;const f=Mt(i.J);X(f,"SID",i.M),X(f,"RID",l),X(f,"AID",i.K),In(i,f),i.u&&i.o&&ks(f,i.u,i.o),l=new Qt(i,i.j,l,i.D+1),i.u===null&&(l.J=i.o),c&&(i.i=c.G.concat(i.i)),c=ea(i,l,1e3),l.H=Math.round(i.va*.5)+Math.round(i.va*.5*Math.random()),Ps(i.h,l),Rs(l,f,c)}function In(i,c){i.H&&nr(i.H,function(l,f){X(c,f,l)}),i.l&&nr({},function(l,f){X(c,f,l)})}function ea(i,c,l){l=Math.min(i.i.length,l);const f=i.l?d(i.l.Ka,i.l,i):null;t:{var v=i.i;let U=-1;for(;;){const ot=["count="+l];U==-1?l>0?(U=v[0].g,ot.push("ofs="+U)):U=0:ot.push("ofs="+U);let Q=!0;for(let ht=0;ht<l;ht++){var A=v[ht].g;const xt=v[ht].map;if(A-=U,A<0)U=Math.max(0,v[ht].g-100),Q=!1;else try{A="req"+A+"_"||"";try{var P=xt instanceof Map?xt:Object.entries(xt);for(const[Ee,Zt]of P){let te=Zt;u(Zt)&&(te=Ts(Zt)),ot.push(A+Ee+"="+encodeURIComponent(te))}}catch(Ee){throw ot.push(A+"type="+encodeURIComponent("_badmap")),Ee}}catch{f&&f(xt)}}if(Q){P=ot.join("&");break t}}P=void 0}return i=i.i.splice(0,l),c.G=i,P}function na(i){if(!i.g&&!i.v){i.Y=1;var c=i.Da;At||m(),ut||(At(),ut=!0),E.add(c,i),i.A=0}}function Ms(i){return i.g||i.v||i.A>=3?!1:(i.Y++,i.v=ln(d(i.Da,i),ia(i,i.A)),i.A++,!0)}n.Da=function(){if(this.v=null,ra(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var i=4*this.T;this.j.info("BP detection timer enabled: "+i),this.B=ln(d(this.Wa,this),i)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,vt(10),hr(this),ra(this))};function xs(i){i.B!=null&&(a.clearTimeout(i.B),i.B=null)}function ra(i){i.g=new Qt(i,i.j,"rpc",i.Y),i.u===null&&(i.g.J=i.o),i.g.P=0;var c=Mt(i.na);X(c,"RID","rpc"),X(c,"SID",i.M),X(c,"AID",i.K),X(c,"CI",i.F?"0":"1"),!i.F&&i.ia&&X(c,"TO",i.ia),X(c,"TYPE","xmlhttp"),In(i,c),i.u&&i.o&&ks(c,i.u,i.o),i.O&&(i.g.H=i.O);var l=i.g;i=i.ba,l.M=1,l.A=cr(Mt(c)),l.u=null,l.R=!0,Do(l,i)}n.Va=function(){this.C!=null&&(this.C=null,hr(this),Ms(this),vt(19))};function fr(i){i.C!=null&&(a.clearTimeout(i.C),i.C=null)}function sa(i,c){var l=null;if(i.g==c){fr(i),xs(i),i.g=null;var f=2}else if(bs(i.h,c))l=c.G,Lo(i.h,c),f=1;else return;if(i.I!=0){if(c.o)if(f==1){l=c.u?c.u.length:0,c=Date.now()-c.F;var v=i.D;f=ir(),It(f,new Co(f,l)),dr(i)}else na(i);else if(v=c.m,v==3||v==0&&c.X>0||!(f==1&&sh(i,c)||f==2&&Ms(i)))switch(l&&l.length>0&&(c=i.h,c.i=c.i.concat(l)),v){case 1:ye(i,5);break;case 4:ye(i,10);break;case 3:ye(i,6);break;default:ye(i,2)}}}function ia(i,c){let l=i.Qa+Math.floor(Math.random()*i.Za);return i.isActive()||(l*=2),l*c}function ye(i,c){if(i.j.info("Error code "+c),c==2){var l=d(i.bb,i),f=i.Ua;const v=!f;f=new Xt(f||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||fn(f,"https"),cr(f),v?Yu(f.toString(),l):Zu(f.toString(),l)}else vt(2);i.I=0,i.l&&i.l.pa(c),oa(i),Zo(i)}n.bb=function(i){i?(this.j.info("Successfully pinged google.com"),vt(2)):(this.j.info("Failed to ping google.com"),vt(1))};function oa(i){if(i.I=0,i.ja=[],i.l){const c=Fo(i.h);(c.length!=0||i.i.length!=0)&&(N(i.ja,c),N(i.ja,i.i),i.h.i.length=0,b(i.i),i.i.length=0),i.l.oa()}}function aa(i,c,l){var f=l instanceof Xt?Mt(l):new Xt(l);if(f.g!="")c&&(f.g=c+"."+f.g),mn(f,f.u);else{var v=a.location;f=v.protocol,c=c?c+"."+v.hostname:v.hostname,v=+v.port;const A=new Xt(null);f&&fn(A,f),c&&(A.g=c),v&&mn(A,v),l&&(A.h=l),f=A}return l=i.G,c=i.wa,l&&c&&X(f,l,c),X(f,"VER",i.ka),In(i,f),f}function ca(i,c,l){if(c&&!i.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=i.Aa&&!i.ma?new et(new Ds({ab:l})):new et(i.ma),c.Fa(i.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function la(){}n=la.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function mr(){}mr.prototype.g=function(i,c){return new St(i,c)};function St(i,c){pt.call(this),this.g=new Yo(c),this.l=i,this.h=c&&c.messageUrlParams||null,i=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(i?i["X-WebChannel-Content-Type"]=c.messageContentType:i={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(i?i["X-WebChannel-Client-Profile"]=c.sa:i={"X-WebChannel-Client-Profile":c.sa}),this.g.U=i,(i=c&&c.Qb)&&!g(i)&&(this.g.u=i),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!g(c)&&(this.g.G=c,i=this.h,i!==null&&c in i&&(i=this.h,c in i&&delete i[c])),this.j=new Oe(this)}I(St,pt),St.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},St.prototype.close=function(){Ns(this.g)},St.prototype.o=function(i){var c=this.g;if(typeof i=="string"){var l={};l.__data__=i,i=l}else this.v&&(l={},l.__data__=Ts(i),i=l);c.i.push(new zu(c.Ya++,i)),c.I==3&&dr(c)},St.prototype.N=function(){this.g.l=null,delete this.j,Ns(this.g),delete this.g,St.Z.N.call(this)};function ua(i){Is.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var c=i.__sm__;if(c){t:{for(const l in c){i=l;break t}i=void 0}(this.i=i)&&(i=this.i,c=c!==null&&i in c?c[i]:void 0),this.data=c}else this.data=i}I(ua,Is);function ha(){vs.call(this),this.status=1}I(ha,vs);function Oe(i){this.g=i}I(Oe,la),Oe.prototype.ra=function(){It(this.g,"a")},Oe.prototype.qa=function(i){It(this.g,new ua(i))},Oe.prototype.pa=function(i){It(this.g,new ha)},Oe.prototype.oa=function(){It(this.g,"b")},mr.prototype.createWebChannel=mr.prototype.g,St.prototype.send=St.prototype.o,St.prototype.open=St.prototype.m,St.prototype.close=St.prototype.close,Bc=function(){return new mr},Fc=function(){return ir()},Lc=ge,Zs={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},or.NO_ERROR=0,or.TIMEOUT=8,or.HTTP_ERROR=6,vr=or,So.COMPLETE="complete",Oc=So,vo.EventType=an,an.OPEN="a",an.CLOSE="b",an.ERROR="c",an.MESSAGE="d",pt.prototype.listen=pt.prototype.J,vn=vo,et.prototype.listenOnce=et.prototype.K,et.prototype.getLastError=et.prototype.Ha,et.prototype.getLastErrorCode=et.prototype.ya,et.prototype.getStatus=et.prototype.ca,et.prototype.getResponseJson=et.prototype.La,et.prototype.getResponseText=et.prototype.la,et.prototype.send=et.prototype.ea,et.prototype.setWithCredentials=et.prototype.Fa,xc=et}).apply(typeof pr<"u"?pr:typeof self<"u"?self:typeof window<"u"?window:{});const Aa="@firebase/firestore",Ra="4.9.2";class yt{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}yt.UNAUTHENTICATED=new yt(null),yt.GOOGLE_CREDENTIALS=new yt("google-credentials-uid"),yt.FIRST_PARTY=new yt("first-party-uid"),yt.MOCK_USER=new yt("mock-user");let en="12.3.0";const Se=new bc("@firebase/firestore");function Le(){return Se.logLevel}function D(n,...t){if(Se.logLevel<=z.DEBUG){const e=t.map(Si);Se.debug(`Firestore (${en}): ${n}`,...e)}}function Kt(n,...t){if(Se.logLevel<=z.ERROR){const e=t.map(Si);Se.error(`Firestore (${en}): ${n}`,...e)}}function Ke(n,...t){if(Se.logLevel<=z.WARN){const e=t.map(Si);Se.warn(`Firestore (${en}): ${n}`,...e)}}function Si(n){if(typeof n=="string")return n;try{return(function(e){return JSON.stringify(e)})(n)}catch{return n}}function L(n,t,e){let r="Unexpected state";typeof t=="string"?r=t:e=t,Uc(n,r,e)}function Uc(n,t,e){let r=`FIRESTORE (${en}) INTERNAL ASSERTION FAILED: ${t} (ID: ${n.toString(16)})`;if(e!==void 0)try{r+=" CONTEXT: "+JSON.stringify(e)}catch{r+=" CONTEXT: "+e}throw Kt(r),new Error(r)}function W(n,t,e,r){let s="Unexpected state";typeof e=="string"?s=e:r=e,n||Uc(t,s,r)}function B(n,t){return n}const S={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class k extends tn{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ie{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class jc{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class zd{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(yt.UNAUTHENTICATED)))}shutdown(){}}class Gd{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class Hd{constructor(t){this.t=t,this.currentUser=yt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){W(this.o===void 0,42304);let r=this.i;const s=h=>this.i!==r?(r=this.i,e(h)):Promise.resolve();let o=new ie;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new ie,t.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const h=o;t.enqueueRetryable((async()=>{await h.promise,await s(this.currentUser)}))},u=h=>{D("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((h=>u(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?u(h):(D("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new ie)}}),0),a()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((r=>this.i!==t?(D("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(W(typeof r.accessToken=="string",31837,{l:r}),new jc(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return W(t===null||typeof t=="string",2055,{h:t}),new yt(t)}}class Kd{constructor(t,e,r){this.P=t,this.T=e,this.I=r,this.type="FirstParty",this.user=yt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Wd{constructor(t,e,r){this.P=t,this.T=e,this.I=r}getToken(){return Promise.resolve(new Kd(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable((()=>e(yt.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Ca{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Qd{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Sd(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){W(this.o===void 0,3512);const r=o=>{o.error!=null&&D("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,D("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(o.token):Promise.resolve()};this.o=o=>{t.enqueueRetryable((()=>r(o)))};const s=o=>{D("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>s(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):D("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Ca(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((e=>e?(W(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new Ca(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Xd(n){const t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let r=0;r<n;r++)e[r]=Math.floor(256*Math.random());return e}class bi{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=Xd(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<e&&(r+=t.charAt(s[o]%62))}return r}}function j(n,t){return n<t?-1:n>t?1:0}function ti(n,t){const e=Math.min(n.length,t.length);for(let r=0;r<e;r++){const s=n.charAt(r),o=t.charAt(r);if(s!==o)return js(s)===js(o)?j(s,o):js(s)?1:-1}return j(n.length,t.length)}const Jd=55296,Yd=57343;function js(n){const t=n.charCodeAt(0);return t>=Jd&&t<=Yd}function We(n,t,e){return n.length===t.length&&n.every(((r,s)=>e(r,t[s])))}const Sa="__name__";class Ot{constructor(t,e,r){e===void 0?e=0:e>t.length&&L(637,{offset:e,range:t.length}),r===void 0?r=t.length-e:r>t.length-e&&L(1746,{length:r,range:t.length-e}),this.segments=t,this.offset=e,this.len=r}get length(){return this.len}isEqual(t){return Ot.comparator(this,t)===0}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Ot?t.forEach((r=>{e.push(r)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,r=this.limit();e<r;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const r=Math.min(t.length,e.length);for(let s=0;s<r;s++){const o=Ot.compareSegments(t.get(s),e.get(s));if(o!==0)return o}return j(t.length,e.length)}static compareSegments(t,e){const r=Ot.isNumericId(t),s=Ot.isNumericId(e);return r&&!s?-1:!r&&s?1:r&&s?Ot.extractNumericId(t).compare(Ot.extractNumericId(e)):ti(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return se.fromString(t.substring(4,t.length-2))}}class J extends Ot{construct(t,e,r){return new J(t,e,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const r of t){if(r.indexOf("//")>=0)throw new k(S.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter((s=>s.length>0)))}return new J(e)}static emptyPath(){return new J([])}}const Zd=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class mt extends Ot{construct(t,e,r){return new mt(t,e,r)}static isValidIdentifier(t){return Zd.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),mt.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Sa}static keyField(){return new mt([Sa])}static fromServerFormat(t){const e=[];let r="",s=0;const o=()=>{if(r.length===0)throw new k(S.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""};let a=!1;for(;s<t.length;){const u=t[s];if(u==="\\"){if(s+1===t.length)throw new k(S.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const h=t[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new k(S.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=h,s+=2}else u==="`"?(a=!a,s++):u!=="."||a?(r+=u,s++):(o(),s++)}if(o(),a)throw new k(S.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new mt(e)}static emptyPath(){return new mt([])}}class M{constructor(t){this.path=t}static fromPath(t){return new M(J.fromString(t))}static fromName(t){return new M(J.fromString(t).popFirst(5))}static empty(){return new M(J.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&J.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return J.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new M(new J(t.slice()))}}function qc(n,t,e){if(!e)throw new k(S.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function tf(n,t,e,r){if(t===!0&&r===!0)throw new k(S.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function ba(n){if(!M.isDocumentKey(n))throw new k(S.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Pa(n){if(M.isDocumentKey(n))throw new k(S.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function $c(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Pi(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const t=(function(r){return r.constructor?r.constructor.name:null})(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":L(12329,{type:typeof n})}function Ft(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new k(S.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=Pi(n);throw new k(S.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}function it(n,t){const e={typeString:n};return t&&(e.value=t),e}function Wn(n,t){if(!$c(n))throw new k(S.INVALID_ARGUMENT,"JSON must be an object");let e;for(const r in t)if(t[r]){const s=t[r].typeString,o="value"in t[r]?{value:t[r].value}:void 0;if(!(r in n)){e=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){e=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&a!==o.value){e=`Expected '${r}' field to equal '${o.value}'`;break}}if(e)throw new k(S.INVALID_ARGUMENT,e);return!0}const Va=-62135596800,Da=1e6;class Y{static now(){return Y.fromMillis(Date.now())}static fromDate(t){return Y.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),r=Math.floor((t-1e3*e)*Da);return new Y(e,r)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new k(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new k(S.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<Va)throw new k(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new k(S.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Da}_compareTo(t){return this.seconds===t.seconds?j(this.nanoseconds,t.nanoseconds):j(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Y._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(Wn(t,Y._jsonSchema))return new Y(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-Va;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Y._jsonSchemaVersion="firestore/timestamp/1.0",Y._jsonSchema={type:it("string",Y._jsonSchemaVersion),seconds:it("number"),nanoseconds:it("number")};class F{static fromTimestamp(t){return new F(t)}static min(){return new F(new Y(0,0))}static max(){return new F(new Y(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const xn=-1;function ef(n,t){const e=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=F.fromTimestamp(r===1e9?new Y(e+1,0):new Y(e,r));return new ce(s,M.empty(),t)}function nf(n){return new ce(n.readTime,n.key,xn)}class ce{constructor(t,e,r){this.readTime=t,this.documentKey=e,this.largestBatchId=r}static min(){return new ce(F.min(),M.empty(),xn)}static max(){return new ce(F.max(),M.empty(),xn)}}function rf(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=M.comparator(n.documentKey,t.documentKey),e!==0?e:j(n.largestBatchId,t.largestBatchId))}const sf="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class of{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function nn(n){if(n.code!==S.FAILED_PRECONDITION||n.message!==sf)throw n;D("LocalStore","Unexpectedly lost primary lease")}class C{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&L(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new C(((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(t,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(e,o).next(r,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof C?e:C.resolve(e)}catch(e){return C.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):C.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):C.reject(e)}static resolve(t){return new C(((e,r)=>{e(t)}))}static reject(t){return new C(((e,r)=>{r(t)}))}static waitFor(t){return new C(((e,r)=>{let s=0,o=0,a=!1;t.forEach((u=>{++s,u.next((()=>{++o,a&&o===s&&e()}),(h=>r(h)))})),a=!0,o===s&&e()}))}static or(t){let e=C.resolve(!1);for(const r of t)e=e.next((s=>s?C.resolve(s):r()));return e}static forEach(t,e){const r=[];return t.forEach(((s,o)=>{r.push(e.call(this,s,o))})),this.waitFor(r)}static mapArray(t,e){return new C(((r,s)=>{const o=t.length,a=new Array(o);let u=0;for(let h=0;h<o;h++){const d=h;e(t[d]).next((_=>{a[d]=_,++u,u===o&&r(a)}),(_=>s(_)))}}))}static doWhile(t,e){return new C(((r,s)=>{const o=()=>{t()===!0?e().next((()=>{o()}),s):r()};o()}))}}function af(n){const t=n.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function rn(n){return n.name==="IndexedDbTransactionError"}class Zr{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>e.writeSequenceNumber(r))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}Zr.ce=-1;const Vi=-1;function ts(n){return n==null}function Or(n){return n===0&&1/n==-1/0}function cf(n){return typeof n=="number"&&Number.isInteger(n)&&!Or(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const zc="";function lf(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=ka(t)),t=uf(n.get(e),t);return ka(t)}function uf(n,t){let e=t;const r=n.length;for(let s=0;s<r;s++){const o=n.charAt(s);switch(o){case"\0":e+="";break;case zc:e+="";break;default:e+=o}}return e}function ka(n){return n+zc+""}function Na(n){let t=0;for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function Ve(n,t){for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function Gc(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}class tt{constructor(t,e){this.comparator=t,this.root=e||ft.EMPTY}insert(t,e){return new tt(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,ft.BLACK,null,null))}remove(t){return new tt(this.comparator,this.root.remove(t,this.comparator).copy(null,null,ft.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const r=this.comparator(t,e.key);if(r===0)return e.value;r<0?e=e.left:r>0&&(e=e.right)}return null}indexOf(t){let e=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(t,r.key);if(s===0)return e+r.left.size;s<0?r=r.left:(e+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,r)=>(t(e,r),!1)))}toString(){const t=[];return this.inorderTraversal(((e,r)=>(t.push(`${e}:${r}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new _r(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new _r(this.root,t,this.comparator,!1)}getReverseIterator(){return new _r(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new _r(this.root,t,this.comparator,!0)}}class _r{constructor(t,e,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!t.isEmpty();)if(o=e?r(t.key,e):1,e&&s&&(o*=-1),o<0)t=this.isReverse?t.left:t.right;else{if(o===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class ft{constructor(t,e,r,s,o){this.key=t,this.value=e,this.color=r??ft.RED,this.left=s??ft.EMPTY,this.right=o??ft.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,r,s,o){return new ft(t??this.key,e??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,r){let s=this;const o=r(t,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(t,e,r),null):o===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return ft.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let r,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return ft.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,ft.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,ft.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw L(43730,{key:this.key,value:this.value});if(this.right.isRed())throw L(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw L(27949);return t+(this.isRed()?0:1)}}ft.EMPTY=null,ft.RED=!0,ft.BLACK=!1;ft.EMPTY=new class{constructor(){this.size=0}get key(){throw L(57766)}get value(){throw L(16141)}get color(){throw L(16727)}get left(){throw L(29726)}get right(){throw L(36894)}copy(t,e,r,s,o){return this}insert(t,e,r){return new ft(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class lt{constructor(t){this.comparator=t,this.data=new tt(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,r)=>(t(e),!1)))}forEachInRange(t,e){const r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let r;for(r=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Ma(this.data.getIterator())}getIteratorFrom(t){return new Ma(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((r=>{e=e.add(r)})),e}isEqual(t){if(!(t instanceof lt)||this.size!==t.size)return!1;const e=this.data.getIterator(),r=t.data.getIterator();for(;e.hasNext();){const s=e.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new lt(this.comparator);return e.data=t,e}}class Ma{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class kt{constructor(t){this.fields=t,t.sort(mt.comparator)}static empty(){return new kt([])}unionWith(t){let e=new lt(mt.comparator);for(const r of this.fields)e=e.add(r);for(const r of t)e=e.add(r);return new kt(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return We(this.fields,t.fields,((e,r)=>e.isEqual(r)))}}class Hc extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class gt{constructor(t){this.binaryString=t}static fromBase64String(t){const e=(function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new Hc("Invalid base64 string: "+o):o}})(t);return new gt(e)}static fromUint8Array(t){const e=(function(s){let o="";for(let a=0;a<s.length;++a)o+=String.fromCharCode(s[a]);return o})(t);return new gt(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(e){return btoa(e)})(this.binaryString)}toUint8Array(){return(function(e){const r=new Uint8Array(e.length);for(let s=0;s<e.length;s++)r[s]=e.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return j(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}gt.EMPTY_BYTE_STRING=new gt("");const hf=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function le(n){if(W(!!n,39018),typeof n=="string"){let t=0;const e=hf.exec(n);if(W(!!e,46558,{timestamp:n}),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:nt(n.seconds),nanos:nt(n.nanos)}}function nt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ue(n){return typeof n=="string"?gt.fromBase64String(n):gt.fromUint8Array(n)}const Kc="server_timestamp",Wc="__type__",Qc="__previous_value__",Xc="__local_write_time__";function Di(n){return(n?.mapValue?.fields||{})[Wc]?.stringValue===Kc}function es(n){const t=n.mapValue.fields[Qc];return Di(t)?es(t):t}function On(n){const t=le(n.mapValue.fields[Xc].timestampValue);return new Y(t.seconds,t.nanos)}class df{constructor(t,e,r,s,o,a,u,h,d,_){this.databaseId=t,this.appId=e,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=d,this.isUsingEmulator=_}}const Lr="(default)";class Ln{constructor(t,e){this.projectId=t,this.database=e||Lr}static empty(){return new Ln("","")}get isDefaultDatabase(){return this.database===Lr}isEqual(t){return t instanceof Ln&&t.projectId===this.projectId&&t.database===this.database}}const Jc="__type__",ff="__max__",yr={mapValue:{}},Yc="__vector__",Fr="value";function he(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Di(n)?4:gf(n)?9007199254740991:mf(n)?10:11:L(28295,{value:n})}function $t(n,t){if(n===t)return!0;const e=he(n);if(e!==he(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return On(n).isEqual(On(t));case 3:return(function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const a=le(s.timestampValue),u=le(o.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos})(n,t);case 5:return n.stringValue===t.stringValue;case 6:return(function(s,o){return ue(s.bytesValue).isEqual(ue(o.bytesValue))})(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return(function(s,o){return nt(s.geoPointValue.latitude)===nt(o.geoPointValue.latitude)&&nt(s.geoPointValue.longitude)===nt(o.geoPointValue.longitude)})(n,t);case 2:return(function(s,o){if("integerValue"in s&&"integerValue"in o)return nt(s.integerValue)===nt(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const a=nt(s.doubleValue),u=nt(o.doubleValue);return a===u?Or(a)===Or(u):isNaN(a)&&isNaN(u)}return!1})(n,t);case 9:return We(n.arrayValue.values||[],t.arrayValue.values||[],$t);case 10:case 11:return(function(s,o){const a=s.mapValue.fields||{},u=o.mapValue.fields||{};if(Na(a)!==Na(u))return!1;for(const h in a)if(a.hasOwnProperty(h)&&(u[h]===void 0||!$t(a[h],u[h])))return!1;return!0})(n,t);default:return L(52216,{left:n})}}function Fn(n,t){return(n.values||[]).find((e=>$t(e,t)))!==void 0}function Qe(n,t){if(n===t)return 0;const e=he(n),r=he(t);if(e!==r)return j(e,r);switch(e){case 0:case 9007199254740991:return 0;case 1:return j(n.booleanValue,t.booleanValue);case 2:return(function(o,a){const u=nt(o.integerValue||o.doubleValue),h=nt(a.integerValue||a.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1})(n,t);case 3:return xa(n.timestampValue,t.timestampValue);case 4:return xa(On(n),On(t));case 5:return ti(n.stringValue,t.stringValue);case 6:return(function(o,a){const u=ue(o),h=ue(a);return u.compareTo(h)})(n.bytesValue,t.bytesValue);case 7:return(function(o,a){const u=o.split("/"),h=a.split("/");for(let d=0;d<u.length&&d<h.length;d++){const _=j(u[d],h[d]);if(_!==0)return _}return j(u.length,h.length)})(n.referenceValue,t.referenceValue);case 8:return(function(o,a){const u=j(nt(o.latitude),nt(a.latitude));return u!==0?u:j(nt(o.longitude),nt(a.longitude))})(n.geoPointValue,t.geoPointValue);case 9:return Oa(n.arrayValue,t.arrayValue);case 10:return(function(o,a){const u=o.fields||{},h=a.fields||{},d=u[Fr]?.arrayValue,_=h[Fr]?.arrayValue,I=j(d?.values?.length||0,_?.values?.length||0);return I!==0?I:Oa(d,_)})(n.mapValue,t.mapValue);case 11:return(function(o,a){if(o===yr.mapValue&&a===yr.mapValue)return 0;if(o===yr.mapValue)return 1;if(a===yr.mapValue)return-1;const u=o.fields||{},h=Object.keys(u),d=a.fields||{},_=Object.keys(d);h.sort(),_.sort();for(let I=0;I<h.length&&I<_.length;++I){const R=ti(h[I],_[I]);if(R!==0)return R;const b=Qe(u[h[I]],d[_[I]]);if(b!==0)return b}return j(h.length,_.length)})(n.mapValue,t.mapValue);default:throw L(23264,{he:e})}}function xa(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return j(n,t);const e=le(n),r=le(t),s=j(e.seconds,r.seconds);return s!==0?s:j(e.nanos,r.nanos)}function Oa(n,t){const e=n.values||[],r=t.values||[];for(let s=0;s<e.length&&s<r.length;++s){const o=Qe(e[s],r[s]);if(o)return o}return j(e.length,r.length)}function Xe(n){return ei(n)}function ei(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(e){const r=le(e);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(e){return ue(e).toBase64()})(n.bytesValue):"referenceValue"in n?(function(e){return M.fromName(e).toString()})(n.referenceValue):"geoPointValue"in n?(function(e){return`geo(${e.latitude},${e.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(e){let r="[",s=!0;for(const o of e.values||[])s?s=!1:r+=",",r+=ei(o);return r+"]"})(n.arrayValue):"mapValue"in n?(function(e){const r=Object.keys(e.fields||{}).sort();let s="{",o=!0;for(const a of r)o?o=!1:s+=",",s+=`${a}:${ei(e.fields[a])}`;return s+"}"})(n.mapValue):L(61005,{value:n})}function wr(n){switch(he(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=es(n);return t?16+wr(t):16;case 5:return 2*n.stringValue.length;case 6:return ue(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,o)=>s+wr(o)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return Ve(r.fields,((o,a)=>{s+=o.length+wr(a)})),s})(n.mapValue);default:throw L(13486,{value:n})}}function ni(n){return!!n&&"integerValue"in n}function ki(n){return!!n&&"arrayValue"in n}function La(n){return!!n&&"nullValue"in n}function Fa(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Ar(n){return!!n&&"mapValue"in n}function mf(n){return(n?.mapValue?.fields||{})[Jc]?.stringValue===Yc}function Sn(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const t={mapValue:{fields:{}}};return Ve(n.mapValue.fields,((e,r)=>t.mapValue.fields[e]=Sn(r))),t}if(n.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=Sn(n.arrayValue.values[e]);return t}return{...n}}function gf(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===ff}class bt{constructor(t){this.value=t}static empty(){return new bt({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let r=0;r<t.length-1;++r)if(e=(e.mapValue.fields||{})[t.get(r)],!Ar(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Sn(e)}setAll(t){let e=mt.emptyPath(),r={},s=[];t.forEach(((a,u)=>{if(!e.isImmediateParentOf(u)){const h=this.getFieldsMap(e);this.applyChanges(h,r,s),r={},s=[],e=u.popLast()}a?r[u.lastSegment()]=Sn(a):s.push(u.lastSegment())}));const o=this.getFieldsMap(e);this.applyChanges(o,r,s)}delete(t){const e=this.field(t.popLast());Ar(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return $t(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let r=0;r<t.length;++r){let s=e.mapValue.fields[t.get(r)];Ar(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(r)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,r){Ve(e,((s,o)=>t[s]=o));for(const s of r)delete t[s]}clone(){return new bt(Sn(this.value))}}function Zc(n){const t=[];return Ve(n.fields,((e,r)=>{const s=new mt([e]);if(Ar(r)){const o=Zc(r.mapValue).fields;if(o.length===0)t.push(s);else for(const a of o)t.push(s.child(a))}else t.push(s)})),new kt(t)}class Et{constructor(t,e,r,s,o,a,u){this.key=t,this.documentType=e,this.version=r,this.readTime=s,this.createTime=o,this.data=a,this.documentState=u}static newInvalidDocument(t){return new Et(t,0,F.min(),F.min(),F.min(),bt.empty(),0)}static newFoundDocument(t,e,r,s){return new Et(t,1,e,F.min(),r,s,0)}static newNoDocument(t,e){return new Et(t,2,e,F.min(),F.min(),bt.empty(),0)}static newUnknownDocument(t,e){return new Et(t,3,e,F.min(),F.min(),bt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(F.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=bt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=bt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=F.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof Et&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Et(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Br{constructor(t,e){this.position=t,this.inclusive=e}}function Ba(n,t,e){let r=0;for(let s=0;s<n.position.length;s++){const o=t[s],a=n.position[s];if(o.field.isKeyField()?r=M.comparator(M.fromName(a.referenceValue),e.key):r=Qe(a,e.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Ua(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!$t(n.position[e],t.position[e]))return!1;return!0}class Ur{constructor(t,e="asc"){this.field=t,this.dir=e}}function pf(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}class tl{}class at extends tl{constructor(t,e,r){super(),this.field=t,this.op=e,this.value=r}static create(t,e,r){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,r):new yf(t,e,r):e==="array-contains"?new If(t,r):e==="in"?new vf(t,r):e==="not-in"?new wf(t,r):e==="array-contains-any"?new Af(t,r):new at(t,e,r)}static createKeyFieldInFilter(t,e,r){return e==="in"?new Ef(t,r):new Tf(t,r)}matches(t){const e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(Qe(e,this.value)):e!==null&&he(this.value)===he(e)&&this.matchesComparison(Qe(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return L(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class zt extends tl{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new zt(t,e)}matches(t){return el(this)?this.filters.find((e=>!e.matches(t)))===void 0:this.filters.find((e=>e.matches(t)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function el(n){return n.op==="and"}function nl(n){return _f(n)&&el(n)}function _f(n){for(const t of n.filters)if(t instanceof zt)return!1;return!0}function ri(n){if(n instanceof at)return n.field.canonicalString()+n.op.toString()+Xe(n.value);if(nl(n))return n.filters.map((t=>ri(t))).join(",");{const t=n.filters.map((e=>ri(e))).join(",");return`${n.op}(${t})`}}function rl(n,t){return n instanceof at?(function(r,s){return s instanceof at&&r.op===s.op&&r.field.isEqual(s.field)&&$t(r.value,s.value)})(n,t):n instanceof zt?(function(r,s){return s instanceof zt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((o,a,u)=>o&&rl(a,s.filters[u])),!0):!1})(n,t):void L(19439)}function sl(n){return n instanceof at?(function(e){return`${e.field.canonicalString()} ${e.op} ${Xe(e.value)}`})(n):n instanceof zt?(function(e){return e.op.toString()+" {"+e.getFilters().map(sl).join(" ,")+"}"})(n):"Filter"}class yf extends at{constructor(t,e,r){super(t,e,r),this.key=M.fromName(r.referenceValue)}matches(t){const e=M.comparator(t.key,this.key);return this.matchesComparison(e)}}class Ef extends at{constructor(t,e){super(t,"in",e),this.keys=il("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Tf extends at{constructor(t,e){super(t,"not-in",e),this.keys=il("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function il(n,t){return(t.arrayValue?.values||[]).map((e=>M.fromName(e.referenceValue)))}class If extends at{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return ki(e)&&Fn(e.arrayValue,this.value)}}class vf extends at{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return e!==null&&Fn(this.value.arrayValue,e)}}class wf extends at{constructor(t,e){super(t,"not-in",e)}matches(t){if(Fn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!Fn(this.value.arrayValue,e)}}class Af extends at{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!ki(e)||!e.arrayValue.values)&&e.arrayValue.values.some((r=>Fn(this.value.arrayValue,r)))}}class Rf{constructor(t,e=null,r=[],s=[],o=null,a=null,u=null){this.path=t,this.collectionGroup=e,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=a,this.endAt=u,this.Te=null}}function ja(n,t=null,e=[],r=[],s=null,o=null,a=null){return new Rf(n,t,e,r,s,o,a)}function Ni(n){const t=B(n);if(t.Te===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((r=>ri(r))).join(","),e+="|ob:",e+=t.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),ts(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((r=>Xe(r))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((r=>Xe(r))).join(",")),t.Te=e}return t.Te}function Mi(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!pf(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!rl(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!Ua(n.startAt,t.startAt)&&Ua(n.endAt,t.endAt)}function si(n){return M.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class ns{constructor(t,e=null,r=[],s=[],o=null,a="F",u=null,h=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=a,this.startAt=u,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Cf(n,t,e,r,s,o,a,u){return new ns(n,t,e,r,s,o,a,u)}function xi(n){return new ns(n)}function qa(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Sf(n){return n.collectionGroup!==null}function bn(n){const t=B(n);if(t.Ie===null){t.Ie=[];const e=new Set;for(const o of t.explicitOrderBy)t.Ie.push(o),e.add(o.field.canonicalString());const r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new lt(mt.comparator);return a.filters.forEach((h=>{h.getFlattenedFilters().forEach((d=>{d.isInequality()&&(u=u.add(d.field))}))})),u})(t).forEach((o=>{e.has(o.canonicalString())||o.isKeyField()||t.Ie.push(new Ur(o,r))})),e.has(mt.keyField().canonicalString())||t.Ie.push(new Ur(mt.keyField(),r))}return t.Ie}function Bt(n){const t=B(n);return t.Ee||(t.Ee=bf(t,bn(n))),t.Ee}function bf(n,t){if(n.limitType==="F")return ja(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map((s=>{const o=s.dir==="desc"?"asc":"desc";return new Ur(s.field,o)}));const e=n.endAt?new Br(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Br(n.startAt.position,n.startAt.inclusive):null;return ja(n.path,n.collectionGroup,t,n.filters,n.limit,e,r)}}function ii(n,t,e){return new ns(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function rs(n,t){return Mi(Bt(n),Bt(t))&&n.limitType===t.limitType}function ol(n){return`${Ni(Bt(n))}|lt:${n.limitType}`}function Fe(n){return`Query(target=${(function(e){let r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map((s=>sl(s))).join(", ")}]`),ts(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map((s=>Xe(s))).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map((s=>Xe(s))).join(",")),`Target(${r})`})(Bt(n))}; limitType=${n.limitType})`}function ss(n,t){return t.isFoundDocument()&&(function(r,s){const o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):M.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(n,t)&&(function(r,s){for(const o of bn(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0})(n,t)&&(function(r,s){for(const o of r.filters)if(!o.matches(s))return!1;return!0})(n,t)&&(function(r,s){return!(r.startAt&&!(function(a,u,h){const d=Ba(a,u,h);return a.inclusive?d<=0:d<0})(r.startAt,bn(r),s)||r.endAt&&!(function(a,u,h){const d=Ba(a,u,h);return a.inclusive?d>=0:d>0})(r.endAt,bn(r),s))})(n,t)}function Pf(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function al(n){return(t,e)=>{let r=!1;for(const s of bn(n)){const o=Vf(s,t,e);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function Vf(n,t,e){const r=n.field.isKeyField()?M.comparator(t.key,e.key):(function(o,a,u){const h=a.data.field(o),d=u.data.field(o);return h!==null&&d!==null?Qe(h,d):L(42886)})(n.field,t,e);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return L(19790,{direction:n.dir})}}class De{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),r=this.inner[e];if(r!==void 0){for(const[s,o]of r)if(this.equalsFn(s,t))return o}}has(t){return this.get(t)!==void 0}set(t,e){const r=this.mapKeyFn(t),s=this.inner[r];if(s===void 0)return this.inner[r]=[[t,e]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],t))return void(s[o]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),r=this.inner[e];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],t))return r.length===1?delete this.inner[e]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(t){Ve(this.inner,((e,r)=>{for(const[s,o]of r)t(s,o)}))}isEmpty(){return Gc(this.inner)}size(){return this.innerSize}}const Df=new tt(M.comparator);function Wt(){return Df}const cl=new tt(M.comparator);function wn(...n){let t=cl;for(const e of n)t=t.insert(e.key,e);return t}function ll(n){let t=cl;return n.forEach(((e,r)=>t=t.insert(e,r.overlayedDocument))),t}function ve(){return Pn()}function ul(){return Pn()}function Pn(){return new De((n=>n.toString()),((n,t)=>n.isEqual(t)))}const kf=new tt(M.comparator),Nf=new lt(M.comparator);function q(...n){let t=Nf;for(const e of n)t=t.add(e);return t}const Mf=new lt(j);function xf(){return Mf}function Oi(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Or(t)?"-0":t}}function hl(n){return{integerValue:""+n}}function Of(n,t){return cf(t)?hl(t):Oi(n,t)}class is{constructor(){this._=void 0}}function Lf(n,t,e){return n instanceof Bn?(function(s,o){const a={fields:{[Wc]:{stringValue:Kc},[Xc]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&Di(o)&&(o=es(o)),o&&(a.fields[Qc]=o),{mapValue:a}})(e,t):n instanceof Un?fl(n,t):n instanceof jn?ml(n,t):(function(s,o){const a=dl(s,o),u=$a(a)+$a(s.Ae);return ni(a)&&ni(s.Ae)?hl(u):Oi(s.serializer,u)})(n,t)}function Ff(n,t,e){return n instanceof Un?fl(n,t):n instanceof jn?ml(n,t):e}function dl(n,t){return n instanceof jr?(function(r){return ni(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(t)?t:{integerValue:0}:null}class Bn extends is{}class Un extends is{constructor(t){super(),this.elements=t}}function fl(n,t){const e=gl(t);for(const r of n.elements)e.some((s=>$t(s,r)))||e.push(r);return{arrayValue:{values:e}}}class jn extends is{constructor(t){super(),this.elements=t}}function ml(n,t){let e=gl(t);for(const r of n.elements)e=e.filter((s=>!$t(s,r)));return{arrayValue:{values:e}}}class jr extends is{constructor(t,e){super(),this.serializer=t,this.Ae=e}}function $a(n){return nt(n.integerValue||n.doubleValue)}function gl(n){return ki(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Bf{constructor(t,e){this.field=t,this.transform=e}}function Uf(n,t){return n.field.isEqual(t.field)&&(function(r,s){return r instanceof Un&&s instanceof Un||r instanceof jn&&s instanceof jn?We(r.elements,s.elements,$t):r instanceof jr&&s instanceof jr?$t(r.Ae,s.Ae):r instanceof Bn&&s instanceof Bn})(n.transform,t.transform)}class jf{constructor(t,e){this.version=t,this.transformResults=e}}class Nt{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Nt}static exists(t){return new Nt(void 0,t)}static updateTime(t){return new Nt(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Rr(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}class os{}function pl(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new Li(n.key,Nt.none()):new Qn(n.key,n.data,Nt.none());{const e=n.data,r=bt.empty();let s=new lt(mt.comparator);for(let o of t.fields)if(!s.has(o)){let a=e.field(o);a===null&&o.length>1&&(o=o.popLast(),a=e.field(o)),a===null?r.delete(o):r.set(o,a),s=s.add(o)}return new ke(n.key,r,new kt(s.toArray()),Nt.none())}}function qf(n,t,e){n instanceof Qn?(function(s,o,a){const u=s.value.clone(),h=Ga(s.fieldTransforms,o,a.transformResults);u.setAll(h),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,t,e):n instanceof ke?(function(s,o,a){if(!Rr(s.precondition,o))return void o.convertToUnknownDocument(a.version);const u=Ga(s.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(_l(s)),h.setAll(u),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()})(n,t,e):(function(s,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()})(0,t,e)}function Vn(n,t,e,r){return n instanceof Qn?(function(o,a,u,h){if(!Rr(o.precondition,a))return u;const d=o.value.clone(),_=Ha(o.fieldTransforms,h,a);return d.setAll(_),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,t,e,r):n instanceof ke?(function(o,a,u,h){if(!Rr(o.precondition,a))return u;const d=Ha(o.fieldTransforms,h,a),_=a.data;return _.setAll(_l(o)),_.setAll(d),a.convertToFoundDocument(a.version,_).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((I=>I.field)))})(n,t,e,r):(function(o,a,u){return Rr(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u})(n,t,e)}function $f(n,t){let e=null;for(const r of n.fieldTransforms){const s=t.data.field(r.field),o=dl(r.transform,s||null);o!=null&&(e===null&&(e=bt.empty()),e.set(r.field,o))}return e||null}function za(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&We(r,s,((o,a)=>Uf(o,a)))})(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}class Qn extends os{constructor(t,e,r,s=[]){super(),this.key=t,this.value=e,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class ke extends os{constructor(t,e,r,s,o=[]){super(),this.key=t,this.data=e,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function _l(n){const t=new Map;return n.fieldMask.fields.forEach((e=>{if(!e.isEmpty()){const r=n.data.field(e);t.set(e,r)}})),t}function Ga(n,t,e){const r=new Map;W(n.length===e.length,32656,{Re:e.length,Ve:n.length});for(let s=0;s<e.length;s++){const o=n[s],a=o.transform,u=t.data.field(o.field);r.set(o.field,Ff(a,u,e[s]))}return r}function Ha(n,t,e){const r=new Map;for(const s of n){const o=s.transform,a=e.data.field(s.field);r.set(s.field,Lf(o,a,t))}return r}class Li extends os{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class zf extends os{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Gf{constructor(t,e,r,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(t,e){const r=e.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(t.key)&&qf(o,t,r[s])}}applyToLocalView(t,e){for(const r of this.baseMutations)r.key.isEqual(t.key)&&(e=Vn(r,t,e,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(t.key)&&(e=Vn(r,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const r=ul();return this.mutations.forEach((s=>{const o=t.get(s.key),a=o.overlayedDocument;let u=this.applyToLocalView(a,o.mutatedFields);u=e.has(s.key)?null:u;const h=pl(a,u);h!==null&&r.set(s.key,h),a.isValidDocument()||a.convertToNoDocument(F.min())})),r}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),q())}isEqual(t){return this.batchId===t.batchId&&We(this.mutations,t.mutations,((e,r)=>za(e,r)))&&We(this.baseMutations,t.baseMutations,((e,r)=>za(e,r)))}}class Fi{constructor(t,e,r,s){this.batch=t,this.commitVersion=e,this.mutationResults=r,this.docVersions=s}static from(t,e,r){W(t.mutations.length===r.length,58842,{me:t.mutations.length,fe:r.length});let s=(function(){return kf})();const o=t.mutations;for(let a=0;a<o.length;a++)s=s.insert(o[a].key,r[a].version);return new Fi(t,e,r,s)}}class Hf{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class Kf{constructor(t,e){this.count=t,this.unchangedNames=e}}var rt,$;function Wf(n){switch(n){case S.OK:return L(64938);case S.CANCELLED:case S.UNKNOWN:case S.DEADLINE_EXCEEDED:case S.RESOURCE_EXHAUSTED:case S.INTERNAL:case S.UNAVAILABLE:case S.UNAUTHENTICATED:return!1;case S.INVALID_ARGUMENT:case S.NOT_FOUND:case S.ALREADY_EXISTS:case S.PERMISSION_DENIED:case S.FAILED_PRECONDITION:case S.ABORTED:case S.OUT_OF_RANGE:case S.UNIMPLEMENTED:case S.DATA_LOSS:return!0;default:return L(15467,{code:n})}}function yl(n){if(n===void 0)return Kt("GRPC error has no .code"),S.UNKNOWN;switch(n){case rt.OK:return S.OK;case rt.CANCELLED:return S.CANCELLED;case rt.UNKNOWN:return S.UNKNOWN;case rt.DEADLINE_EXCEEDED:return S.DEADLINE_EXCEEDED;case rt.RESOURCE_EXHAUSTED:return S.RESOURCE_EXHAUSTED;case rt.INTERNAL:return S.INTERNAL;case rt.UNAVAILABLE:return S.UNAVAILABLE;case rt.UNAUTHENTICATED:return S.UNAUTHENTICATED;case rt.INVALID_ARGUMENT:return S.INVALID_ARGUMENT;case rt.NOT_FOUND:return S.NOT_FOUND;case rt.ALREADY_EXISTS:return S.ALREADY_EXISTS;case rt.PERMISSION_DENIED:return S.PERMISSION_DENIED;case rt.FAILED_PRECONDITION:return S.FAILED_PRECONDITION;case rt.ABORTED:return S.ABORTED;case rt.OUT_OF_RANGE:return S.OUT_OF_RANGE;case rt.UNIMPLEMENTED:return S.UNIMPLEMENTED;case rt.DATA_LOSS:return S.DATA_LOSS;default:return L(39323,{code:n})}}($=rt||(rt={}))[$.OK=0]="OK",$[$.CANCELLED=1]="CANCELLED",$[$.UNKNOWN=2]="UNKNOWN",$[$.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",$[$.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",$[$.NOT_FOUND=5]="NOT_FOUND",$[$.ALREADY_EXISTS=6]="ALREADY_EXISTS",$[$.PERMISSION_DENIED=7]="PERMISSION_DENIED",$[$.UNAUTHENTICATED=16]="UNAUTHENTICATED",$[$.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",$[$.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",$[$.ABORTED=10]="ABORTED",$[$.OUT_OF_RANGE=11]="OUT_OF_RANGE",$[$.UNIMPLEMENTED=12]="UNIMPLEMENTED",$[$.INTERNAL=13]="INTERNAL",$[$.UNAVAILABLE=14]="UNAVAILABLE",$[$.DATA_LOSS=15]="DATA_LOSS";function Qf(){return new TextEncoder}const Xf=new se([4294967295,4294967295],0);function Ka(n){const t=Qf().encode(n),e=new Mc;return e.update(t),new Uint8Array(e.digest())}function Wa(n){const t=new DataView(n.buffer),e=t.getUint32(0,!0),r=t.getUint32(4,!0),s=t.getUint32(8,!0),o=t.getUint32(12,!0);return[new se([e,r],0),new se([s,o],0)]}class Bi{constructor(t,e,r){if(this.bitmap=t,this.padding=e,this.hashCount=r,e<0||e>=8)throw new An(`Invalid padding: ${e}`);if(r<0)throw new An(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new An(`Invalid hash count: ${r}`);if(t.length===0&&e!==0)throw new An(`Invalid padding when bitmap length is 0: ${e}`);this.ge=8*t.length-e,this.pe=se.fromNumber(this.ge)}ye(t,e,r){let s=t.add(e.multiply(se.fromNumber(r)));return s.compare(Xf)===1&&(s=new se([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.ge===0)return!1;const e=Ka(t),[r,s]=Wa(e);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);if(!this.we(a))return!1}return!0}static create(t,e,r){const s=t%8==0?0:8-t%8,o=new Uint8Array(Math.ceil(t/8)),a=new Bi(o,s,e);return r.forEach((u=>a.insert(u))),a}insert(t){if(this.ge===0)return;const e=Ka(t),[r,s]=Wa(e);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);this.Se(a)}}Se(t){const e=Math.floor(t/8),r=t%8;this.bitmap[e]|=1<<r}}class An extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class as{constructor(t,e,r,s,o){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(t,e,r){const s=new Map;return s.set(t,Xn.createSynthesizedTargetChangeForCurrentChange(t,e,r)),new as(F.min(),s,new tt(j),Wt(),q())}}class Xn{constructor(t,e,r,s,o){this.resumeToken=t,this.current=e,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(t,e,r){return new Xn(r,e,q(),q(),q())}}class Cr{constructor(t,e,r,s){this.be=t,this.removedTargetIds=e,this.key=r,this.De=s}}class El{constructor(t,e){this.targetId=t,this.Ce=e}}class Tl{constructor(t,e,r=gt.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=r,this.cause=s}}class Qa{constructor(){this.ve=0,this.Fe=Xa(),this.Me=gt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=q(),e=q(),r=q();return this.Fe.forEach(((s,o)=>{switch(o){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:r=r.add(s);break;default:L(38017,{changeType:o})}})),new Xn(this.Me,this.xe,t,e,r)}qe(){this.Oe=!1,this.Fe=Xa()}Qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,W(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class Jf{constructor(t){this.Ge=t,this.ze=new Map,this.je=Wt(),this.Je=Er(),this.He=Er(),this.Ye=new tt(j)}Ze(t){for(const e of t.be)t.De&&t.De.isFoundDocument()?this.Xe(e,t.De):this.et(e,t.key,t.De);for(const e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,(e=>{const r=this.nt(e);switch(t.state){case 0:this.rt(e)&&r.Le(t.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(t.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(r.We(),r.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),r.Le(t.resumeToken));break;default:L(56790,{state:t.state})}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach(((r,s)=>{this.rt(s)&&e(s)}))}st(t){const e=t.targetId,r=t.Ce.count,s=this.ot(e);if(s){const o=s.target;if(si(o))if(r===0){const a=new M(o.path);this.et(e,a,Et.newNoDocument(a,F.min()))}else W(r===1,20013,{expectedCount:r});else{const a=this._t(e);if(a!==r){const u=this.ut(t),h=u?this.ct(u,t,a):1;if(h!==0){this.it(e);const d=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(e,d)}}}}}ut(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=e;let a,u;try{a=ue(r).toUint8Array()}catch(h){if(h instanceof Hc)return Ke("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new Bi(a,s,o)}catch(h){return Ke(h instanceof An?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return u.ge===0?null:u}ct(t,e,r){return e.Ce.count===r-this.Pt(t,e.targetId)?0:2}Pt(t,e){const r=this.Ge.getRemoteKeysForTarget(e);let s=0;return r.forEach((o=>{const a=this.Ge.ht(),u=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;t.mightContain(u)||(this.et(e,o,null),s++)})),s}Tt(t){const e=new Map;this.ze.forEach(((o,a)=>{const u=this.ot(a);if(u){if(o.current&&si(u.target)){const h=new M(u.target.path);this.It(h).has(a)||this.Et(a,h)||this.et(a,h,Et.newNoDocument(h,t))}o.Be&&(e.set(a,o.ke()),o.qe())}}));let r=q();this.He.forEach(((o,a)=>{let u=!0;a.forEachWhile((h=>{const d=this.ot(h);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(r=r.add(o))})),this.je.forEach(((o,a)=>a.setReadTime(t)));const s=new as(t,e,this.Ye,this.je,r);return this.je=Wt(),this.Je=Er(),this.He=Er(),this.Ye=new tt(j),s}Xe(t,e){if(!this.rt(t))return;const r=this.Et(t,e.key)?2:0;this.nt(t).Qe(e.key,r),this.je=this.je.insert(e.key,e),this.Je=this.Je.insert(e.key,this.It(e.key).add(t)),this.He=this.He.insert(e.key,this.dt(e.key).add(t))}et(t,e,r){if(!this.rt(t))return;const s=this.nt(t);this.Et(t,e)?s.Qe(e,1):s.$e(e),this.He=this.He.insert(e,this.dt(e).delete(t)),this.He=this.He.insert(e,this.dt(e).add(t)),r&&(this.je=this.je.insert(e,r))}removeTarget(t){this.ze.delete(t)}_t(t){const e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let e=this.ze.get(t);return e||(e=new Qa,this.ze.set(t,e)),e}dt(t){let e=this.He.get(t);return e||(e=new lt(j),this.He=this.He.insert(t,e)),e}It(t){let e=this.Je.get(t);return e||(e=new lt(j),this.Je=this.Je.insert(t,e)),e}rt(t){const e=this.ot(t)!==null;return e||D("WatchChangeAggregator","Detected inactive target",t),e}ot(t){const e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new Qa),this.Ge.getRemoteKeysForTarget(t).forEach((e=>{this.et(t,e,null)}))}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}}function Er(){return new tt(M.comparator)}function Xa(){return new tt(M.comparator)}const Yf={asc:"ASCENDING",desc:"DESCENDING"},Zf={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},tm={and:"AND",or:"OR"};class em{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function oi(n,t){return n.useProto3Json||ts(t)?t:{value:t}}function qr(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Il(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function nm(n,t){return qr(n,t.toTimestamp())}function Ut(n){return W(!!n,49232),F.fromTimestamp((function(e){const r=le(e);return new Y(r.seconds,r.nanos)})(n))}function Ui(n,t){return ai(n,t).canonicalString()}function ai(n,t){const e=(function(s){return new J(["projects",s.projectId,"databases",s.database])})(n).child("documents");return t===void 0?e:e.child(t)}function vl(n){const t=J.fromString(n);return W(Sl(t),10190,{key:t.toString()}),t}function ci(n,t){return Ui(n.databaseId,t.path)}function qs(n,t){const e=vl(t);if(e.get(1)!==n.databaseId.projectId)throw new k(S.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new k(S.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new M(Al(e))}function wl(n,t){return Ui(n.databaseId,t)}function rm(n){const t=vl(n);return t.length===4?J.emptyPath():Al(t)}function li(n){return new J(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Al(n){return W(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Ja(n,t,e){return{name:ci(n,t),fields:e.value.mapValue.fields}}function sm(n,t){let e;if("targetChange"in t){t.targetChange;const r=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:L(39313,{state:d})})(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],o=(function(d,_){return d.useProto3Json?(W(_===void 0||typeof _=="string",58123),gt.fromBase64String(_||"")):(W(_===void 0||_ instanceof Buffer||_ instanceof Uint8Array,16193),gt.fromUint8Array(_||new Uint8Array))})(n,t.targetChange.resumeToken),a=t.targetChange.cause,u=a&&(function(d){const _=d.code===void 0?S.UNKNOWN:yl(d.code);return new k(_,d.message||"")})(a);e=new Tl(r,s,o,u||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const s=qs(n,r.document.name),o=Ut(r.document.updateTime),a=r.document.createTime?Ut(r.document.createTime):F.min(),u=new bt({mapValue:{fields:r.document.fields}}),h=Et.newFoundDocument(s,o,a,u),d=r.targetIds||[],_=r.removedTargetIds||[];e=new Cr(d,_,h.key,h)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const s=qs(n,r.document),o=r.readTime?Ut(r.readTime):F.min(),a=Et.newNoDocument(s,o),u=r.removedTargetIds||[];e=new Cr([],u,a.key,a)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const s=qs(n,r.document),o=r.removedTargetIds||[];e=new Cr([],o,s,null)}else{if(!("filter"in t))return L(11601,{Rt:t});{t.filter;const r=t.filter;r.targetId;const{count:s=0,unchangedNames:o}=r,a=new Kf(s,o),u=r.targetId;e=new El(u,a)}}return e}function im(n,t){let e;if(t instanceof Qn)e={update:Ja(n,t.key,t.value)};else if(t instanceof Li)e={delete:ci(n,t.key)};else if(t instanceof ke)e={update:Ja(n,t.key,t.data),updateMask:mm(t.fieldMask)};else{if(!(t instanceof zf))return L(16599,{Vt:t.type});e={verify:ci(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map((r=>(function(o,a){const u=a.transform;if(u instanceof Bn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Un)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof jn)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof jr)return{fieldPath:a.field.canonicalString(),increment:u.Ae};throw L(20930,{transform:a.transform})})(0,r)))),t.precondition.isNone||(e.currentDocument=(function(s,o){return o.updateTime!==void 0?{updateTime:nm(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:L(27497)})(n,t.precondition)),e}function om(n,t){return n&&n.length>0?(W(t!==void 0,14353),n.map((e=>(function(s,o){let a=s.updateTime?Ut(s.updateTime):Ut(o);return a.isEqual(F.min())&&(a=Ut(o)),new jf(a,s.transformResults||[])})(e,t)))):[]}function am(n,t){return{documents:[wl(n,t.path)]}}function cm(n,t){const e={structuredQuery:{}},r=t.path;let s;t.collectionGroup!==null?(s=r,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=r.popLast(),e.structuredQuery.from=[{collectionId:r.lastSegment()}]),e.parent=wl(n,s);const o=(function(d){if(d.length!==0)return Cl(zt.create(d,"and"))})(t.filters);o&&(e.structuredQuery.where=o);const a=(function(d){if(d.length!==0)return d.map((_=>(function(R){return{field:Be(R.field),direction:hm(R.dir)}})(_)))})(t.orderBy);a&&(e.structuredQuery.orderBy=a);const u=oi(n,t.limit);return u!==null&&(e.structuredQuery.limit=u),t.startAt&&(e.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(t.startAt)),t.endAt&&(e.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(t.endAt)),{ft:e,parent:s}}function lm(n){let t=rm(n.parent);const e=n.structuredQuery,r=e.from?e.from.length:0;let s=null;if(r>0){W(r===1,65062);const _=e.from[0];_.allDescendants?s=_.collectionId:t=t.child(_.collectionId)}let o=[];e.where&&(o=(function(I){const R=Rl(I);return R instanceof zt&&nl(R)?R.getFilters():[R]})(e.where));let a=[];e.orderBy&&(a=(function(I){return I.map((R=>(function(N){return new Ur(Ue(N.field),(function(V){switch(V){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(N.direction))})(R)))})(e.orderBy));let u=null;e.limit&&(u=(function(I){let R;return R=typeof I=="object"?I.value:I,ts(R)?null:R})(e.limit));let h=null;e.startAt&&(h=(function(I){const R=!!I.before,b=I.values||[];return new Br(b,R)})(e.startAt));let d=null;return e.endAt&&(d=(function(I){const R=!I.before,b=I.values||[];return new Br(b,R)})(e.endAt)),Cf(t,s,a,o,u,"F",h,d)}function um(n,t){const e=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L(28987,{purpose:s})}})(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Rl(n){return n.unaryFilter!==void 0?(function(e){switch(e.unaryFilter.op){case"IS_NAN":const r=Ue(e.unaryFilter.field);return at.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Ue(e.unaryFilter.field);return at.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Ue(e.unaryFilter.field);return at.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Ue(e.unaryFilter.field);return at.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return L(61313);default:return L(60726)}})(n):n.fieldFilter!==void 0?(function(e){return at.create(Ue(e.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return L(58110);default:return L(50506)}})(e.fieldFilter.op),e.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(e){return zt.create(e.compositeFilter.filters.map((r=>Rl(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return L(1026)}})(e.compositeFilter.op))})(n):L(30097,{filter:n})}function hm(n){return Yf[n]}function dm(n){return Zf[n]}function fm(n){return tm[n]}function Be(n){return{fieldPath:n.canonicalString()}}function Ue(n){return mt.fromServerFormat(n.fieldPath)}function Cl(n){return n instanceof at?(function(e){if(e.op==="=="){if(Fa(e.value))return{unaryFilter:{field:Be(e.field),op:"IS_NAN"}};if(La(e.value))return{unaryFilter:{field:Be(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(Fa(e.value))return{unaryFilter:{field:Be(e.field),op:"IS_NOT_NAN"}};if(La(e.value))return{unaryFilter:{field:Be(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Be(e.field),op:dm(e.op),value:e.value}}})(n):n instanceof zt?(function(e){const r=e.getFilters().map((s=>Cl(s)));return r.length===1?r[0]:{compositeFilter:{op:fm(e.op),filters:r}}})(n):L(54877,{filter:n})}function mm(n){const t=[];return n.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Sl(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class ee{constructor(t,e,r,s,o=F.min(),a=F.min(),u=gt.EMPTY_BYTE_STRING,h=null){this.target=t,this.targetId=e,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(t){return new ee(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new ee(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new ee(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new ee(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class gm{constructor(t){this.yt=t}}function pm(n){const t=lm({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ii(t,t.limit,"L"):t}class _m{constructor(){this.Cn=new ym}addToCollectionParentIndex(t,e){return this.Cn.add(e),C.resolve()}getCollectionParents(t,e){return C.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return C.resolve()}deleteFieldIndex(t,e){return C.resolve()}deleteAllFieldIndexes(t){return C.resolve()}createTargetIndexes(t,e){return C.resolve()}getDocumentsMatchingTarget(t,e){return C.resolve(null)}getIndexType(t,e){return C.resolve(0)}getFieldIndexes(t,e){return C.resolve([])}getNextCollectionGroupToUpdate(t){return C.resolve(null)}getMinOffset(t,e){return C.resolve(ce.min())}getMinOffsetFromCollectionGroup(t,e){return C.resolve(ce.min())}updateCollectionGroup(t,e,r){return C.resolve()}updateIndexEntries(t,e){return C.resolve()}}class ym{constructor(){this.index={}}add(t){const e=t.lastSegment(),r=t.popLast(),s=this.index[e]||new lt(J.comparator),o=!s.has(r);return this.index[e]=s.add(r),o}has(t){const e=t.lastSegment(),r=t.popLast(),s=this.index[e];return s&&s.has(r)}getEntries(t){return(this.index[t]||new lt(J.comparator)).toArray()}}const Ya={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},bl=41943040;class Ct{static withCacheSize(t){return new Ct(t,Ct.DEFAULT_COLLECTION_PERCENTILE,Ct.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=r}}Ct.DEFAULT_COLLECTION_PERCENTILE=10,Ct.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ct.DEFAULT=new Ct(bl,Ct.DEFAULT_COLLECTION_PERCENTILE,Ct.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ct.DISABLED=new Ct(-1,0,0);class Je{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new Je(0)}static cr(){return new Je(-1)}}const Za="LruGarbageCollector",Em=1048576;function tc([n,t],[e,r]){const s=j(n,e);return s===0?j(t,r):s}class Tm{constructor(t){this.Ir=t,this.buffer=new lt(tc),this.Er=0}dr(){return++this.Er}Ar(t){const e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{const r=this.buffer.last();tc(e,r)<0&&(this.buffer=this.buffer.delete(r).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Im{constructor(t,e,r){this.garbageCollector=t,this.asyncQueue=e,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(t){D(Za,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){rn(e)?D(Za,"Ignoring IndexedDB error during garbage collection: ",e):await nn(e)}await this.Vr(3e5)}))}}class vm{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next((r=>Math.floor(e/100*r)))}nthSequenceNumber(t,e){if(e===0)return C.resolve(Zr.ce);const r=new Tm(e);return this.mr.forEachTarget(t,(s=>r.Ar(s.sequenceNumber))).next((()=>this.mr.pr(t,(s=>r.Ar(s))))).next((()=>r.maxValue))}removeTargets(t,e,r){return this.mr.removeTargets(t,e,r)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(D("LruGarbageCollector","Garbage collection skipped; disabled"),C.resolve(Ya)):this.getCacheSize(t).next((r=>r<this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ya):this.yr(t,e)))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let r,s,o,a,u,h,d;const _=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((I=>(I>this.params.maximumSequenceNumbersToCollect?(D("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${I}`),s=this.params.maximumSequenceNumbersToCollect):s=I,a=Date.now(),this.nthSequenceNumber(t,s)))).next((I=>(r=I,u=Date.now(),this.removeTargets(t,r,e)))).next((I=>(o=I,h=Date.now(),this.removeOrphanedDocuments(t,r)))).next((I=>(d=Date.now(),Le()<=z.DEBUG&&D("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-_}ms
	Determined least recently used ${s} in `+(u-a)+`ms
	Removed ${o} targets in `+(h-u)+`ms
	Removed ${I} documents in `+(d-h)+`ms
Total Duration: ${d-_}ms`),C.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:I}))))}}function wm(n,t){return new vm(n,t)}class Am{constructor(){this.changes=new De((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Et.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const r=this.changes.get(e);return r!==void 0?C.resolve(r):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Rm{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Cm{constructor(t,e,r,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=r,this.indexManager=s}getDocument(t,e){let r=null;return this.documentOverlayCache.getOverlay(t,e).next((s=>(r=s,this.remoteDocumentCache.getEntry(t,e)))).next((s=>(r!==null&&Vn(r.mutation,s,kt.empty(),Y.now()),s)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((r=>this.getLocalViewOfDocuments(t,r,q()).next((()=>r))))}getLocalViewOfDocuments(t,e,r=q()){const s=ve();return this.populateOverlays(t,s,e).next((()=>this.computeViews(t,e,s,r).next((o=>{let a=wn();return o.forEach(((u,h)=>{a=a.insert(u,h.overlayedDocument)})),a}))))}getOverlayedDocuments(t,e){const r=ve();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,q())))}populateOverlays(t,e,r){const s=[];return r.forEach((o=>{e.has(o)||s.push(o)})),this.documentOverlayCache.getOverlays(t,s).next((o=>{o.forEach(((a,u)=>{e.set(a,u)}))}))}computeViews(t,e,r,s){let o=Wt();const a=Pn(),u=(function(){return Pn()})();return e.forEach(((h,d)=>{const _=r.get(d.key);s.has(d.key)&&(_===void 0||_.mutation instanceof ke)?o=o.insert(d.key,d):_!==void 0?(a.set(d.key,_.mutation.getFieldMask()),Vn(_.mutation,d,_.mutation.getFieldMask(),Y.now())):a.set(d.key,kt.empty())})),this.recalculateAndSaveOverlays(t,o).next((h=>(h.forEach(((d,_)=>a.set(d,_))),e.forEach(((d,_)=>u.set(d,new Rm(_,a.get(d)??null)))),u)))}recalculateAndSaveOverlays(t,e){const r=Pn();let s=new tt(((a,u)=>a-u)),o=q();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((a=>{for(const u of a)u.keys().forEach((h=>{const d=e.get(h);if(d===null)return;let _=r.get(h)||kt.empty();_=u.applyToLocalView(d,_),r.set(h,_);const I=(s.get(u.batchId)||q()).add(h);s=s.insert(u.batchId,I)}))})).next((()=>{const a=[],u=s.getReverseIterator();for(;u.hasNext();){const h=u.getNext(),d=h.key,_=h.value,I=ul();_.forEach((R=>{if(!o.has(R)){const b=pl(e.get(R),r.get(R));b!==null&&I.set(R,b),o=o.add(R)}})),a.push(this.documentOverlayCache.saveOverlays(t,d,I))}return C.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((r=>this.recalculateAndSaveOverlays(t,r)))}getDocumentsMatchingQuery(t,e,r,s){return(function(a){return M.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Sf(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,s):this.getDocumentsMatchingCollectionQuery(t,e,r,s)}getNextDocuments(t,e,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,s).next((o=>{const a=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,s-o.size):C.resolve(ve());let u=xn,h=o;return a.next((d=>C.forEach(d,((_,I)=>(u<I.largestBatchId&&(u=I.largestBatchId),o.get(_)?C.resolve():this.remoteDocumentCache.getEntry(t,_).next((R=>{h=h.insert(_,R)}))))).next((()=>this.populateOverlays(t,d,o))).next((()=>this.computeViews(t,h,d,q()))).next((_=>({batchId:u,changes:ll(_)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new M(e)).next((r=>{let s=wn();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(t,e,r,s){const o=e.collectionGroup;let a=wn();return this.indexManager.getCollectionParents(t,o).next((u=>C.forEach(u,(h=>{const d=(function(I,R){return new ns(R,null,I.explicitOrderBy.slice(),I.filters.slice(),I.limit,I.limitType,I.startAt,I.endAt)})(e,h.child(o));return this.getDocumentsMatchingCollectionQuery(t,d,r,s).next((_=>{_.forEach(((I,R)=>{a=a.insert(I,R)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(t,e,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next((a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,o,s)))).next((a=>{o.forEach(((h,d)=>{const _=d.getKey();a.get(_)===null&&(a=a.insert(_,Et.newInvalidDocument(_)))}));let u=wn();return a.forEach(((h,d)=>{const _=o.get(h);_!==void 0&&Vn(_.mutation,d,kt.empty(),Y.now()),ss(e,d)&&(u=u.insert(h,d))})),u}))}}class Sm{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return C.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,(function(s){return{id:s.id,version:s.version,createTime:Ut(s.createTime)}})(e)),C.resolve()}getNamedQuery(t,e){return C.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,(function(s){return{name:s.name,query:pm(s.bundledQuery),readTime:Ut(s.readTime)}})(e)),C.resolve()}}class bm{constructor(){this.overlays=new tt(M.comparator),this.qr=new Map}getOverlay(t,e){return C.resolve(this.overlays.get(e))}getOverlays(t,e){const r=ve();return C.forEach(e,(s=>this.getOverlay(t,s).next((o=>{o!==null&&r.set(s,o)})))).next((()=>r))}saveOverlays(t,e,r){return r.forEach(((s,o)=>{this.St(t,e,o)})),C.resolve()}removeOverlaysForBatchId(t,e,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),C.resolve()}getOverlaysForCollection(t,e,r){const s=ve(),o=e.length+1,a=new M(e.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const h=u.getNext().value,d=h.getKey();if(!e.isPrefixOf(d.path))break;d.path.length===o&&h.largestBatchId>r&&s.set(h.getKey(),h)}return C.resolve(s)}getOverlaysForCollectionGroup(t,e,r,s){let o=new tt(((d,_)=>d-_));const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===e&&d.largestBatchId>r){let _=o.get(d.largestBatchId);_===null&&(_=ve(),o=o.insert(d.largestBatchId,_)),_.set(d.getKey(),d)}}const u=ve(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((d,_)=>u.set(d,_))),!(u.size()>=s)););return C.resolve(u)}St(t,e,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new Hf(e,r));let o=this.qr.get(e);o===void 0&&(o=q(),this.qr.set(e,o)),this.qr.set(e,o.add(r.key))}}class Pm{constructor(){this.sessionToken=gt.EMPTY_BYTE_STRING}getSessionToken(t){return C.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,C.resolve()}}class ji{constructor(){this.Qr=new lt(dt.$r),this.Ur=new lt(dt.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){const r=new dt(t,e);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(t,e){t.forEach((r=>this.addReference(r,e)))}removeReference(t,e){this.Gr(new dt(t,e))}zr(t,e){t.forEach((r=>this.removeReference(r,e)))}jr(t){const e=new M(new J([])),r=new dt(e,t),s=new dt(e,t+1),o=[];return this.Ur.forEachInRange([r,s],(a=>{this.Gr(a),o.push(a.key)})),o}Jr(){this.Qr.forEach((t=>this.Gr(t)))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){const e=new M(new J([])),r=new dt(e,t),s=new dt(e,t+1);let o=q();return this.Ur.forEachInRange([r,s],(a=>{o=o.add(a.key)})),o}containsKey(t){const e=new dt(t,0),r=this.Qr.firstAfterOrEqual(e);return r!==null&&t.isEqual(r.key)}}class dt{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return M.comparator(t.key,e.key)||j(t.Yr,e.Yr)}static Kr(t,e){return j(t.Yr,e.Yr)||M.comparator(t.key,e.key)}}class Vm{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new lt(dt.$r)}checkEmpty(t){return C.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,r,s){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Gf(o,e,r,s);this.mutationQueue.push(a);for(const u of s)this.Zr=this.Zr.add(new dt(u.key,o)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast());return C.resolve(a)}lookupMutationBatch(t,e){return C.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){const r=e+1,s=this.ei(r),o=s<0?0:s;return C.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return C.resolve(this.mutationQueue.length===0?Vi:this.tr-1)}getAllMutationBatches(t){return C.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const r=new dt(e,0),s=new dt(e,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,s],(a=>{const u=this.Xr(a.Yr);o.push(u)})),C.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new lt(j);return e.forEach((s=>{const o=new dt(s,0),a=new dt(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,a],(u=>{r=r.add(u.Yr)}))})),C.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(t,e){const r=e.path,s=r.length+1;let o=r;M.isDocumentKey(o)||(o=o.child(""));const a=new dt(new M(o),0);let u=new lt(j);return this.Zr.forEachWhile((h=>{const d=h.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(u=u.add(h.Yr)),!0)}),a),C.resolve(this.ti(u))}ti(t){const e=[];return t.forEach((r=>{const s=this.Xr(r);s!==null&&e.push(s)})),e}removeMutationBatch(t,e){W(this.ni(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return C.forEach(e.mutations,(s=>{const o=new dt(s.key,e.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.Zr=r}))}ir(t){}containsKey(t,e){const r=new dt(e,0),s=this.Zr.firstAfterOrEqual(r);return C.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,C.resolve()}ni(t,e){return this.ei(t)}ei(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Xr(t){const e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Dm{constructor(t){this.ri=t,this.docs=(function(){return new tt(M.comparator)})(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const r=e.key,s=this.docs.get(r),o=s?s.size:0,a=this.ri(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const r=this.docs.get(e);return C.resolve(r?r.document.mutableCopy():Et.newInvalidDocument(e))}getEntries(t,e){let r=Wt();return e.forEach((s=>{const o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():Et.newInvalidDocument(s))})),C.resolve(r)}getDocumentsMatchingQuery(t,e,r,s){let o=Wt();const a=e.path,u=new M(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){const{key:d,value:{document:_}}=h.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||rf(nf(_),r)<=0||(s.has(_.key)||ss(e,_))&&(o=o.insert(_.key,_.mutableCopy()))}return C.resolve(o)}getAllFromCollectionGroup(t,e,r,s){L(9500)}ii(t,e){return C.forEach(this.docs,(r=>e(r)))}newChangeBuffer(t){return new km(this)}getSize(t){return C.resolve(this.size)}}class km extends Am{constructor(t){super(),this.Nr=t}applyChanges(t){const e=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?e.push(this.Nr.addEntry(t,s)):this.Nr.removeEntry(r)})),C.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}}class Nm{constructor(t){this.persistence=t,this.si=new De((e=>Ni(e)),Mi),this.lastRemoteSnapshotVersion=F.min(),this.highestTargetId=0,this.oi=0,this._i=new ji,this.targetCount=0,this.ai=Je.ur()}forEachTarget(t,e){return this.si.forEach(((r,s)=>e(s))),C.resolve()}getLastRemoteSnapshotVersion(t){return C.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return C.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),C.resolve(this.highestTargetId)}setTargetsMetadata(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this.oi&&(this.oi=e),C.resolve()}Pr(t){this.si.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.ai=new Je(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,C.resolve()}updateTargetData(t,e){return this.Pr(e),C.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,C.resolve()}removeTargets(t,e,r){let s=0;const o=[];return this.si.forEach(((a,u)=>{u.sequenceNumber<=e&&r.get(u.targetId)===null&&(this.si.delete(a),o.push(this.removeMatchingKeysForTargetId(t,u.targetId)),s++)})),C.waitFor(o).next((()=>s))}getTargetCount(t){return C.resolve(this.targetCount)}getTargetData(t,e){const r=this.si.get(e)||null;return C.resolve(r)}addMatchingKeys(t,e,r){return this._i.Wr(e,r),C.resolve()}removeMatchingKeys(t,e,r){this._i.zr(e,r);const s=this.persistence.referenceDelegate,o=[];return s&&e.forEach((a=>{o.push(s.markPotentiallyOrphaned(t,a))})),C.waitFor(o)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),C.resolve()}getMatchingKeysForTargetId(t,e){const r=this._i.Hr(e);return C.resolve(r)}containsKey(t,e){return C.resolve(this._i.containsKey(e))}}class Pl{constructor(t,e){this.ui={},this.overlays={},this.ci=new Zr(0),this.li=!1,this.li=!0,this.hi=new Pm,this.referenceDelegate=t(this),this.Pi=new Nm(this),this.indexManager=new _m,this.remoteDocumentCache=(function(s){return new Dm(s)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new gm(e),this.Ii=new Sm(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new bm,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let r=this.ui[t.toKey()];return r||(r=new Vm(e,this.referenceDelegate),this.ui[t.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,r){D("MemoryPersistence","Starting transaction:",t);const s=new Mm(this.ci.next());return this.referenceDelegate.Ei(),r(s).next((o=>this.referenceDelegate.di(s).next((()=>o)))).toPromise().then((o=>(s.raiseOnCommittedEvent(),o)))}Ai(t,e){return C.or(Object.values(this.ui).map((r=>()=>r.containsKey(t,e))))}}class Mm extends of{constructor(t){super(),this.currentSequenceNumber=t}}class qi{constructor(t){this.persistence=t,this.Ri=new ji,this.Vi=null}static mi(t){return new qi(t)}get fi(){if(this.Vi)return this.Vi;throw L(60996)}addReference(t,e,r){return this.Ri.addReference(r,e),this.fi.delete(r.toString()),C.resolve()}removeReference(t,e,r){return this.Ri.removeReference(r,e),this.fi.add(r.toString()),C.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),C.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach((s=>this.fi.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((s=>{s.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(t,e)))}Ei(){this.Vi=new Set}di(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return C.forEach(this.fi,(r=>{const s=M.fromPath(r);return this.gi(t,s).next((o=>{o||e.removeEntry(s,F.min())}))})).next((()=>(this.Vi=null,e.apply(t))))}updateLimboDocument(t,e){return this.gi(t,e).next((r=>{r?this.fi.delete(e.toString()):this.fi.add(e.toString())}))}Ti(t){return 0}gi(t,e){return C.or([()=>C.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}}class $r{constructor(t,e){this.persistence=t,this.pi=new De((r=>lf(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=wm(this,e)}static mi(t,e){return new $r(t,e)}Ei(){}di(t){return C.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){const e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next((r=>e.next((s=>r+s))))}wr(t){let e=0;return this.pr(t,(r=>{e++})).next((()=>e))}pr(t,e){return C.forEach(this.pi,((r,s)=>this.br(t,r,s).next((o=>o?C.resolve():e(s)))))}removeTargets(t,e,r){return this.persistence.getTargetCache().removeTargets(t,e,r)}removeOrphanedDocuments(t,e){let r=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ii(t,(a=>this.br(t,a,e).next((u=>{u||(r++,o.removeEntry(a,F.min()))})))).next((()=>o.apply(t))).next((()=>r))}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),C.resolve()}removeTarget(t,e){const r=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,r)}addReference(t,e,r){return this.pi.set(r,t.currentSequenceNumber),C.resolve()}removeReference(t,e,r){return this.pi.set(r,t.currentSequenceNumber),C.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),C.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=wr(t.data.value)),e}br(t,e,r){return C.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const s=this.pi.get(e);return C.resolve(s!==void 0&&s>r)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class $i{constructor(t,e,r,s){this.targetId=t,this.fromCache=e,this.Es=r,this.ds=s}static As(t,e){let r=q(),s=q();for(const o of e.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new $i(t,e.fromCache,r,s)}}class xm{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class Om{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return Ah()?8:af(vh())>0?6:4})()}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,r,s){const o={result:null};return this.ys(t,e).next((a=>{o.result=a})).next((()=>{if(!o.result)return this.ws(t,e,s,r).next((a=>{o.result=a}))})).next((()=>{if(o.result)return;const a=new xm;return this.Ss(t,e,a).next((u=>{if(o.result=u,this.Vs)return this.bs(t,e,a,u.size)}))})).next((()=>o.result))}bs(t,e,r,s){return r.documentReadCount<this.fs?(Le()<=z.DEBUG&&D("QueryEngine","SDK will not create cache indexes for query:",Fe(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),C.resolve()):(Le()<=z.DEBUG&&D("QueryEngine","Query:",Fe(e),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(Le()<=z.DEBUG&&D("QueryEngine","The SDK decides to create cache indexes for query:",Fe(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Bt(e))):C.resolve())}ys(t,e){if(qa(e))return C.resolve(null);let r=Bt(e);return this.indexManager.getIndexType(t,r).next((s=>s===0?null:(e.limit!==null&&s===1&&(e=ii(e,null,"F"),r=Bt(e)),this.indexManager.getDocumentsMatchingTarget(t,r).next((o=>{const a=q(...o);return this.ps.getDocuments(t,a).next((u=>this.indexManager.getMinOffset(t,r).next((h=>{const d=this.Ds(e,u);return this.Cs(e,d,a,h.readTime)?this.ys(t,ii(e,null,"F")):this.vs(t,d,e,h)}))))})))))}ws(t,e,r,s){return qa(e)||s.isEqual(F.min())?C.resolve(null):this.ps.getDocuments(t,r).next((o=>{const a=this.Ds(e,o);return this.Cs(e,a,r,s)?C.resolve(null):(Le()<=z.DEBUG&&D("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Fe(e)),this.vs(t,a,e,ef(s,xn)).next((u=>u)))}))}Ds(t,e){let r=new lt(al(t));return e.forEach(((s,o)=>{ss(t,o)&&(r=r.add(o))})),r}Cs(t,e,r,s){if(t.limit===null)return!1;if(r.size!==e.size)return!0;const o=t.limitType==="F"?e.last():e.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}Ss(t,e,r){return Le()<=z.DEBUG&&D("QueryEngine","Using full collection scan to execute query:",Fe(e)),this.ps.getDocumentsMatchingQuery(t,e,ce.min(),r)}vs(t,e,r,s){return this.ps.getDocumentsMatchingQuery(t,r,s).next((o=>(e.forEach((a=>{o=o.insert(a.key,a)})),o)))}}const zi="LocalStore",Lm=3e8;class Fm{constructor(t,e,r,s){this.persistence=t,this.Fs=e,this.serializer=s,this.Ms=new tt(j),this.xs=new De((o=>Ni(o)),Mi),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(r)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Cm(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ms)))}}function Bm(n,t,e,r){return new Fm(n,t,e,r)}async function Vl(n,t){const e=B(n);return await e.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return e.mutationQueue.getAllMutationBatches(r).next((o=>(s=o,e.Bs(t),e.mutationQueue.getAllMutationBatches(r)))).next((o=>{const a=[],u=[];let h=q();for(const d of s){a.push(d.batchId);for(const _ of d.mutations)h=h.add(_.key)}for(const d of o){u.push(d.batchId);for(const _ of d.mutations)h=h.add(_.key)}return e.localDocuments.getDocuments(r,h).next((d=>({Ls:d,removedBatchIds:a,addedBatchIds:u})))}))}))}function Um(n,t){const e=B(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=t.batch.keys(),o=e.Ns.newChangeBuffer({trackRemovals:!0});return(function(u,h,d,_){const I=d.batch,R=I.keys();let b=C.resolve();return R.forEach((N=>{b=b.next((()=>_.getEntry(h,N))).next((O=>{const V=d.docVersions.get(N);W(V!==null,48541),O.version.compareTo(V)<0&&(I.applyToRemoteDocument(O,d),O.isValidDocument()&&(O.setReadTime(d.commitVersion),_.addEntry(O)))}))})),b.next((()=>u.mutationQueue.removeMutationBatch(h,I)))})(e,r,t,o).next((()=>o.apply(r))).next((()=>e.mutationQueue.performConsistencyCheck(r))).next((()=>e.documentOverlayCache.removeOverlaysForBatchId(r,s,t.batch.batchId))).next((()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(u){let h=q();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(h=h.add(u.batch.mutations[d].key));return h})(t)))).next((()=>e.localDocuments.getDocuments(r,s)))}))}function Dl(n){const t=B(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Pi.getLastRemoteSnapshotVersion(e)))}function jm(n,t){const e=B(n),r=t.snapshotVersion;let s=e.Ms;return e.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const a=e.Ns.newChangeBuffer({trackRemovals:!0});s=e.Ms;const u=[];t.targetChanges.forEach(((_,I)=>{const R=s.get(I);if(!R)return;u.push(e.Pi.removeMatchingKeys(o,_.removedDocuments,I).next((()=>e.Pi.addMatchingKeys(o,_.addedDocuments,I))));let b=R.withSequenceNumber(o.currentSequenceNumber);t.targetMismatches.get(I)!==null?b=b.withResumeToken(gt.EMPTY_BYTE_STRING,F.min()).withLastLimboFreeSnapshotVersion(F.min()):_.resumeToken.approximateByteSize()>0&&(b=b.withResumeToken(_.resumeToken,r)),s=s.insert(I,b),(function(O,V,G){return O.resumeToken.approximateByteSize()===0||V.snapshotVersion.toMicroseconds()-O.snapshotVersion.toMicroseconds()>=Lm?!0:G.addedDocuments.size+G.modifiedDocuments.size+G.removedDocuments.size>0})(R,b,_)&&u.push(e.Pi.updateTargetData(o,b))}));let h=Wt(),d=q();if(t.documentUpdates.forEach((_=>{t.resolvedLimboDocuments.has(_)&&u.push(e.persistence.referenceDelegate.updateLimboDocument(o,_))})),u.push(qm(o,a,t.documentUpdates).next((_=>{h=_.ks,d=_.qs}))),!r.isEqual(F.min())){const _=e.Pi.getLastRemoteSnapshotVersion(o).next((I=>e.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));u.push(_)}return C.waitFor(u).next((()=>a.apply(o))).next((()=>e.localDocuments.getLocalViewOfDocuments(o,h,d))).next((()=>h))})).then((o=>(e.Ms=s,o)))}function qm(n,t,e){let r=q(),s=q();return e.forEach((o=>r=r.add(o))),t.getEntries(n,r).next((o=>{let a=Wt();return e.forEach(((u,h)=>{const d=o.get(u);h.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(u)),h.isNoDocument()&&h.version.isEqual(F.min())?(t.removeEntry(u,h.readTime),a=a.insert(u,h)):!d.isValidDocument()||h.version.compareTo(d.version)>0||h.version.compareTo(d.version)===0&&d.hasPendingWrites?(t.addEntry(h),a=a.insert(u,h)):D(zi,"Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",h.version)})),{ks:a,qs:s}}))}function $m(n,t){const e=B(n);return e.persistence.runTransaction("Get next mutation batch","readonly",(r=>(t===void 0&&(t=Vi),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t))))}function zm(n,t){const e=B(n);return e.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return e.Pi.getTargetData(r,t).next((o=>o?(s=o,C.resolve(s)):e.Pi.allocateTargetId(r).next((a=>(s=new ee(t,a,"TargetPurposeListen",r.currentSequenceNumber),e.Pi.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=e.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.Ms=e.Ms.insert(r.targetId,r),e.xs.set(t,r.targetId)),r}))}async function ui(n,t,e){const r=B(n),s=r.Ms.get(t),o=e?"readwrite":"readwrite-primary";try{e||await r.persistence.runTransaction("Release target",o,(a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!rn(a))throw a;D(zi,`Failed to update sequence numbers for target ${t}: ${a}`)}r.Ms=r.Ms.remove(t),r.xs.delete(s.target)}function ec(n,t,e){const r=B(n);let s=F.min(),o=q();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(h,d,_){const I=B(h),R=I.xs.get(_);return R!==void 0?C.resolve(I.Ms.get(R)):I.Pi.getTargetData(d,_)})(r,a,Bt(t)).next((u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,u.targetId).next((h=>{o=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(a,t,e?s:F.min(),e?o:q()))).next((u=>(Gm(r,Pf(t),u),{documents:u,Qs:o})))))}function Gm(n,t,e){let r=n.Os.get(t)||F.min();e.forEach(((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),n.Os.set(t,r)}class nc{constructor(){this.activeTargetIds=xf()}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Hm{constructor(){this.Mo=new nc,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,r){}addLocalQueryTarget(t,e=!0){return e&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,r){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new nc,Promise.resolve()}handleUserChange(t,e,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class Km{Oo(t){}shutdown(){}}const rc="ConnectivityMonitor";class sc{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){D(rc,"Network connectivity changed: AVAILABLE");for(const t of this.qo)t(0)}ko(){D(rc,"Network connectivity changed: UNAVAILABLE");for(const t of this.qo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Tr=null;function hi(){return Tr===null?Tr=(function(){return 268435456+Math.round(2147483648*Math.random())})():Tr++,"0x"+Tr.toString(16)}const $s="RestConnection",Wm={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Qm{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===Lr?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(t,e,r,s,o){const a=hi(),u=this.zo(t,e.toUriEncodedString());D($s,`Sending RPC '${t}' ${a}:`,u,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,s,o);const{host:d}=new URL(u),_=Ri(d);return this.Jo(t,u,h,r,_).then((I=>(D($s,`Received RPC '${t}' ${a}: `,I),I)),(I=>{throw Ke($s,`RPC '${t}' ${a} failed with error: `,I,"url: ",u,"request:",r),I}))}Ho(t,e,r,s,o,a){return this.Go(t,e,r,s,o)}jo(t,e,r){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+en})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((s,o)=>t[o]=s)),r&&r.headers.forEach(((s,o)=>t[o]=s))}zo(t,e){const r=Wm[t];return`${this.Uo}/v1/${e}:${r}`}terminate(){}}class Xm{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}}const _t="WebChannelConnection";class Jm extends Qm{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,r,s,o){const a=hi();return new Promise(((u,h)=>{const d=new xc;d.setWithCredentials(!0),d.listenOnce(Oc.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case vr.NO_ERROR:const I=d.getResponseJson();D(_t,`XHR for RPC '${t}' ${a} received:`,JSON.stringify(I)),u(I);break;case vr.TIMEOUT:D(_t,`RPC '${t}' ${a} timed out`),h(new k(S.DEADLINE_EXCEEDED,"Request time out"));break;case vr.HTTP_ERROR:const R=d.getStatus();if(D(_t,`RPC '${t}' ${a} failed with status:`,R,"response text:",d.getResponseText()),R>0){let b=d.getResponseJson();Array.isArray(b)&&(b=b[0]);const N=b?.error;if(N&&N.status&&N.message){const O=(function(G){const H=G.toLowerCase().replace(/_/g,"-");return Object.values(S).indexOf(H)>=0?H:S.UNKNOWN})(N.status);h(new k(O,N.message))}else h(new k(S.UNKNOWN,"Server responded with status "+d.getStatus()))}else h(new k(S.UNAVAILABLE,"Connection failed."));break;default:L(9055,{l_:t,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{D(_t,`RPC '${t}' ${a} completed.`)}}));const _=JSON.stringify(s);D(_t,`RPC '${t}' ${a} sending request:`,s),d.send(e,"POST",_,r,15)}))}T_(t,e,r){const s=hi(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=Bc(),u=Fc(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(h.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,e,r),h.encodeInitMessageHeaders=!0;const _=o.join("");D(_t,`Creating RPC '${t}' stream ${s}: ${_}`,h);const I=a.createWebChannel(_,h);this.I_(I);let R=!1,b=!1;const N=new Xm({Yo:V=>{b?D(_t,`Not sending because RPC '${t}' stream ${s} is closed:`,V):(R||(D(_t,`Opening RPC '${t}' stream ${s} transport.`),I.open(),R=!0),D(_t,`RPC '${t}' stream ${s} sending:`,V),I.send(V))},Zo:()=>I.close()}),O=(V,G,H)=>{V.listen(G,(K=>{try{H(K)}catch(Tt){setTimeout((()=>{throw Tt}),0)}}))};return O(I,vn.EventType.OPEN,(()=>{b||(D(_t,`RPC '${t}' stream ${s} transport opened.`),N.o_())})),O(I,vn.EventType.CLOSE,(()=>{b||(b=!0,D(_t,`RPC '${t}' stream ${s} transport closed`),N.a_(),this.E_(I))})),O(I,vn.EventType.ERROR,(V=>{b||(b=!0,Ke(_t,`RPC '${t}' stream ${s} transport errored. Name:`,V.name,"Message:",V.message),N.a_(new k(S.UNAVAILABLE,"The operation could not be completed")))})),O(I,vn.EventType.MESSAGE,(V=>{if(!b){const G=V.data[0];W(!!G,16349);const H=G,K=H?.error||H[0]?.error;if(K){D(_t,`RPC '${t}' stream ${s} received error:`,K);const Tt=K.status;let At=(function(m){const p=rt[m];if(p!==void 0)return yl(p)})(Tt),ut=K.message;At===void 0&&(At=S.INTERNAL,ut="Unknown error status: "+Tt+" with message "+K.message),b=!0,N.a_(new k(At,ut)),I.close()}else D(_t,`RPC '${t}' stream ${s} received:`,G),N.u_(G)}})),O(u,Lc.STAT_EVENT,(V=>{V.stat===Zs.PROXY?D(_t,`RPC '${t}' stream ${s} detected buffering proxy`):V.stat===Zs.NOPROXY&&D(_t,`RPC '${t}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{N.__()}),0),N}terminate(){this.c_.forEach((t=>t.close())),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter((e=>e===t))}}function zs(){return typeof document<"u"?document:null}function cs(n){return new em(n,!0)}class kl{constructor(t,e,r=1e3,s=1.5,o=6e4){this.Mi=t,this.timerId=e,this.d_=r,this.A_=s,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();const e=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,e-r);s>0&&D("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${e} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),t()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const ic="PersistentStream";class Nl{constructor(t,e,r,s,o,a,u,h){this.Mi=t,this.S_=r,this.b_=s,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new kl(t,e)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(t){this.Q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():e&&e.code===S.RESOURCE_EXHAUSTED?(Kt(e.toString()),Kt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===S.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.r_(e)}K_(){}auth(){this.state=1;const t=this.W_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===e&&this.G_(r,s)}),(r=>{t((()=>{const s=new k(S.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(t,e){const r=this.W_(this.D_);this.stream=this.j_(t,e),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(t){return D(ic,`close with error: ${t}`),this.stream=null,this.close(4,t)}W_(t){return e=>{this.Mi.enqueueAndForget((()=>this.D_===t?e():(D(ic,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Ym extends Nl{constructor(t,e,r,s,o,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,r,s,a),this.serializer=o}j_(t,e){return this.connection.T_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();const e=sm(this.serializer,t),r=(function(o){if(!("targetChange"in o))return F.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?F.min():a.readTime?Ut(a.readTime):F.min()})(t);return this.listener.H_(e,r)}Y_(t){const e={};e.database=li(this.serializer),e.addTarget=(function(o,a){let u;const h=a.target;if(u=si(h)?{documents:am(o,h)}:{query:cm(o,h).ft},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=Il(o,a.resumeToken);const d=oi(o,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(F.min())>0){u.readTime=qr(o,a.snapshotVersion.toTimestamp());const d=oi(o,a.expectedCount);d!==null&&(u.expectedCount=d)}return u})(this.serializer,t);const r=um(this.serializer,t);r&&(e.labels=r),this.q_(e)}Z_(t){const e={};e.database=li(this.serializer),e.removeTarget=t,this.q_(e)}}class Zm extends Nl{constructor(t,e,r,s,o,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,r,s,a),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}J_(t){return W(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,W(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){W(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const e=om(t.writeResults,t.commitTime),r=Ut(t.commitTime);return this.listener.na(r,e)}ra(){const t={};t.database=li(this.serializer),this.q_(t)}ea(t){const e={streamToken:this.lastStreamToken,writes:t.map((r=>im(this.serializer,r)))};this.q_(e)}}class tg{}class eg extends tg{constructor(t,e,r,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new k(S.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Go(t,ai(e,r),s,o,a))).catch((o=>{throw o.name==="FirebaseError"?(o.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new k(S.UNKNOWN,o.toString())}))}Ho(t,e,r,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,u])=>this.connection.Ho(t,ai(e,r),s,a,u,o))).catch((a=>{throw a.name==="FirebaseError"?(a.code===S.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new k(S.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class ng{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Kt(e),this.aa=!1):D("OnlineStateTracker",e)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const be="RemoteStore";class rg{constructor(t,e,r,s,o){this.localStore=t,this.datastore=e,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((a=>{r.enqueueAndForget((async()=>{Ne(this)&&(D(be,"Restarting streams for network reachability change."),await(async function(h){const d=B(h);d.Ea.add(4),await Jn(d),d.Ra.set("Unknown"),d.Ea.delete(4),await ls(d)})(this))}))})),this.Ra=new ng(r,s)}}async function ls(n){if(Ne(n))for(const t of n.da)await t(!0)}async function Jn(n){for(const t of n.da)await t(!1)}function Ml(n,t){const e=B(n);e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),Wi(e)?Ki(e):sn(e).O_()&&Hi(e,t))}function Gi(n,t){const e=B(n),r=sn(e);e.Ia.delete(t),r.O_()&&xl(e,t),e.Ia.size===0&&(r.O_()?r.L_():Ne(e)&&e.Ra.set("Unknown"))}function Hi(n,t){if(n.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(F.min())>0){const e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}sn(n).Y_(t)}function xl(n,t){n.Va.Ue(t),sn(n).Z_(t)}function Ki(n){n.Va=new Jf({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),At:t=>n.Ia.get(t)||null,ht:()=>n.datastore.serializer.databaseId}),sn(n).start(),n.Ra.ua()}function Wi(n){return Ne(n)&&!sn(n).x_()&&n.Ia.size>0}function Ne(n){return B(n).Ea.size===0}function Ol(n){n.Va=void 0}async function sg(n){n.Ra.set("Online")}async function ig(n){n.Ia.forEach(((t,e)=>{Hi(n,t)}))}async function og(n,t){Ol(n),Wi(n)?(n.Ra.ha(t),Ki(n)):n.Ra.set("Unknown")}async function ag(n,t,e){if(n.Ra.set("Online"),t instanceof Tl&&t.state===2&&t.cause)try{await(async function(s,o){const a=o.cause;for(const u of o.targetIds)s.Ia.has(u)&&(await s.remoteSyncer.rejectListen(u,a),s.Ia.delete(u),s.Va.removeTarget(u))})(n,t)}catch(r){D(be,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await zr(n,r)}else if(t instanceof Cr?n.Va.Ze(t):t instanceof El?n.Va.st(t):n.Va.tt(t),!e.isEqual(F.min()))try{const r=await Dl(n.localStore);e.compareTo(r)>=0&&await(function(o,a){const u=o.Va.Tt(a);return u.targetChanges.forEach(((h,d)=>{if(h.resumeToken.approximateByteSize()>0){const _=o.Ia.get(d);_&&o.Ia.set(d,_.withResumeToken(h.resumeToken,a))}})),u.targetMismatches.forEach(((h,d)=>{const _=o.Ia.get(h);if(!_)return;o.Ia.set(h,_.withResumeToken(gt.EMPTY_BYTE_STRING,_.snapshotVersion)),xl(o,h);const I=new ee(_.target,h,d,_.sequenceNumber);Hi(o,I)})),o.remoteSyncer.applyRemoteEvent(u)})(n,e)}catch(r){D(be,"Failed to raise snapshot:",r),await zr(n,r)}}async function zr(n,t,e){if(!rn(t))throw t;n.Ea.add(1),await Jn(n),n.Ra.set("Offline"),e||(e=()=>Dl(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{D(be,"Retrying IndexedDB access"),await e(),n.Ea.delete(1),await ls(n)}))}function Ll(n,t){return t().catch((e=>zr(n,e,t)))}async function us(n){const t=B(n),e=de(t);let r=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:Vi;for(;cg(t);)try{const s=await $m(t.localStore,r);if(s===null){t.Ta.length===0&&e.L_();break}r=s.batchId,lg(t,s)}catch(s){await zr(t,s)}Fl(t)&&Bl(t)}function cg(n){return Ne(n)&&n.Ta.length<10}function lg(n,t){n.Ta.push(t);const e=de(n);e.O_()&&e.X_&&e.ea(t.mutations)}function Fl(n){return Ne(n)&&!de(n).x_()&&n.Ta.length>0}function Bl(n){de(n).start()}async function ug(n){de(n).ra()}async function hg(n){const t=de(n);for(const e of n.Ta)t.ea(e.mutations)}async function dg(n,t,e){const r=n.Ta.shift(),s=Fi.from(r,t,e);await Ll(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await us(n)}async function fg(n,t){t&&de(n).X_&&await(async function(r,s){if((function(a){return Wf(a)&&a!==S.ABORTED})(s.code)){const o=r.Ta.shift();de(r).B_(),await Ll(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s))),await us(r)}})(n,t),Fl(n)&&Bl(n)}async function oc(n,t){const e=B(n);e.asyncQueue.verifyOperationInProgress(),D(be,"RemoteStore received new credentials");const r=Ne(e);e.Ea.add(3),await Jn(e),r&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await ls(e)}async function mg(n,t){const e=B(n);t?(e.Ea.delete(2),await ls(e)):t||(e.Ea.add(2),await Jn(e),e.Ra.set("Unknown"))}function sn(n){return n.ma||(n.ma=(function(e,r,s){const o=B(e);return o.sa(),new Ym(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:sg.bind(null,n),t_:ig.bind(null,n),r_:og.bind(null,n),H_:ag.bind(null,n)}),n.da.push((async t=>{t?(n.ma.B_(),Wi(n)?Ki(n):n.Ra.set("Unknown")):(await n.ma.stop(),Ol(n))}))),n.ma}function de(n){return n.fa||(n.fa=(function(e,r,s){const o=B(e);return o.sa(),new Zm(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:ug.bind(null,n),r_:fg.bind(null,n),ta:hg.bind(null,n),na:dg.bind(null,n)}),n.da.push((async t=>{t?(n.fa.B_(),await us(n)):(await n.fa.stop(),n.Ta.length>0&&(D(be,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class Qi{constructor(t,e,r,s,o){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new ie,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,r,s,o){const a=Date.now()+r,u=new Qi(t,e,a,s,o);return u.start(r),u}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new k(S.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Xi(n,t){if(Kt("AsyncQueue",`${t}: ${n}`),rn(n))return new k(S.UNAVAILABLE,`${t}: ${n}`);throw n}class $e{static emptySet(t){return new $e(t.comparator)}constructor(t){this.comparator=t?(e,r)=>t(e,r)||M.comparator(e.key,r.key):(e,r)=>M.comparator(e.key,r.key),this.keyedMap=wn(),this.sortedSet=new tt(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,r)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof $e)||this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;e.hasNext();){const s=e.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){const r=new $e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=e,r}}class ac{constructor(){this.ga=new tt(M.comparator)}track(t){const e=t.doc.key,r=this.ga.get(e);r?t.type!==0&&r.type===3?this.ga=this.ga.insert(e,t):t.type===3&&r.type!==1?this.ga=this.ga.insert(e,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.ga=this.ga.remove(e):t.type===1&&r.type===2?this.ga=this.ga.insert(e,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):L(63341,{Rt:t,pa:r}):this.ga=this.ga.insert(e,t)}ya(){const t=[];return this.ga.inorderTraversal(((e,r)=>{t.push(r)})),t}}class Ye{constructor(t,e,r,s,o,a,u,h,d){this.query=t,this.docs=e,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=d}static fromInitialDocuments(t,e,r,s,o){const a=[];return e.forEach((u=>{a.push({type:0,doc:u})})),new Ye(t,e,$e.emptySet(e),a,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&rs(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,r=t.docChanges;if(e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==r[s].type||!e[s].doc.isEqual(r[s].doc))return!1;return!0}}class gg{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((t=>t.Da()))}}class pg{constructor(){this.queries=cc(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(e,r){const s=B(e),o=s.queries;s.queries=cc(),o.forEach(((a,u)=>{for(const h of u.Sa)h.onError(r)}))})(this,new k(S.ABORTED,"Firestore shutting down"))}}function cc(){return new De((n=>ol(n)),rs)}async function Ul(n,t){const e=B(n);let r=3;const s=t.query;let o=e.queries.get(s);o?!o.ba()&&t.Da()&&(r=2):(o=new gg,r=t.Da()?0:1);try{switch(r){case 0:o.wa=await e.onListen(s,!0);break;case 1:o.wa=await e.onListen(s,!1);break;case 2:await e.onFirstRemoteStoreListen(s)}}catch(a){const u=Xi(a,`Initialization of query '${Fe(t.query)}' failed`);return void t.onError(u)}e.queries.set(s,o),o.Sa.push(t),t.va(e.onlineState),o.wa&&t.Fa(o.wa)&&Ji(e)}async function jl(n,t){const e=B(n),r=t.query;let s=3;const o=e.queries.get(r);if(o){const a=o.Sa.indexOf(t);a>=0&&(o.Sa.splice(a,1),o.Sa.length===0?s=t.Da()?0:1:!o.ba()&&t.Da()&&(s=2))}switch(s){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function _g(n,t){const e=B(n);let r=!1;for(const s of t){const o=s.query,a=e.queries.get(o);if(a){for(const u of a.Sa)u.Fa(s)&&(r=!0);a.wa=s}}r&&Ji(e)}function yg(n,t,e){const r=B(n),s=r.queries.get(t);if(s)for(const o of s.Sa)o.onError(e);r.queries.delete(t)}function Ji(n){n.Ca.forEach((t=>{t.next()}))}var di,lc;(lc=di||(di={})).Ma="default",lc.Cache="cache";class ql{constructor(t,e,r){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(t){if(!this.options.includeMetadataChanges){const r=[];for(const s of t.docChanges)s.type!==3&&r.push(s);t=new Ye(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache||!this.Da())return!0;const r=e!=="Offline";return(!this.options.qa||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Ba(t){if(t.docChanges.length>0)return!0;const e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}ka(t){t=Ye.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==di.Cache}}class $l{constructor(t){this.key=t}}class zl{constructor(t){this.key=t}}class Eg{constructor(t,e){this.query=t,this.Ya=e,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=q(),this.mutatedKeys=q(),this.eu=al(t),this.tu=new $e(this.eu)}get nu(){return this.Ya}ru(t,e){const r=e?e.iu:new ac,s=e?e.tu:this.tu;let o=e?e.mutatedKeys:this.mutatedKeys,a=s,u=!1;const h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((_,I)=>{const R=s.get(_),b=ss(this.query,I)?I:null,N=!!R&&this.mutatedKeys.has(R.key),O=!!b&&(b.hasLocalMutations||this.mutatedKeys.has(b.key)&&b.hasCommittedMutations);let V=!1;R&&b?R.data.isEqual(b.data)?N!==O&&(r.track({type:3,doc:b}),V=!0):this.su(R,b)||(r.track({type:2,doc:b}),V=!0,(h&&this.eu(b,h)>0||d&&this.eu(b,d)<0)&&(u=!0)):!R&&b?(r.track({type:0,doc:b}),V=!0):R&&!b&&(r.track({type:1,doc:R}),V=!0,(h||d)&&(u=!0)),V&&(b?(a=a.add(b),o=O?o.add(_):o.delete(_)):(a=a.delete(_),o=o.delete(_)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const _=this.query.limitType==="F"?a.last():a.first();a=a.delete(_.key),o=o.delete(_.key),r.track({type:1,doc:_})}return{tu:a,iu:r,Cs:u,mutatedKeys:o}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,r,s){const o=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const a=t.iu.ya();a.sort(((_,I)=>(function(b,N){const O=V=>{switch(V){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L(20277,{Rt:V})}};return O(b)-O(N)})(_.type,I.type)||this.eu(_.doc,I.doc))),this.ou(r),s=s??!1;const u=e&&!s?this._u():[],h=this.Xa.size===0&&this.current&&!s?1:0,d=h!==this.Za;return this.Za=h,a.length!==0||d?{snapshot:new Ye(this.query,t.tu,o,a,t.mutatedKeys,h===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new ac,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach((e=>this.Ya=this.Ya.add(e))),t.modifiedDocuments.forEach((e=>{})),t.removedDocuments.forEach((e=>this.Ya=this.Ya.delete(e))),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Xa;this.Xa=q(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const e=[];return t.forEach((r=>{this.Xa.has(r)||e.push(new zl(r))})),this.Xa.forEach((r=>{t.has(r)||e.push(new $l(r))})),e}cu(t){this.Ya=t.Qs,this.Xa=q();const e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return Ye.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Yi="SyncEngine";class Tg{constructor(t,e,r){this.query=t,this.targetId=e,this.view=r}}class Ig{constructor(t){this.key=t,this.hu=!1}}class vg{constructor(t,e,r,s,o,a){this.localStore=t,this.remoteStore=e,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new De((u=>ol(u)),rs),this.Iu=new Map,this.Eu=new Set,this.du=new tt(M.comparator),this.Au=new Map,this.Ru=new ji,this.Vu={},this.mu=new Map,this.fu=Je.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function wg(n,t,e=!0){const r=Xl(n);let s;const o=r.Tu.get(t);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.lu()):s=await Gl(r,t,e,!0),s}async function Ag(n,t){const e=Xl(n);await Gl(e,t,!0,!1)}async function Gl(n,t,e,r){const s=await zm(n.localStore,Bt(t)),o=s.targetId,a=n.sharedClientState.addLocalQueryTarget(o,e);let u;return r&&(u=await Rg(n,t,o,a==="current",s.resumeToken)),n.isPrimaryClient&&e&&Ml(n.remoteStore,s),u}async function Rg(n,t,e,r,s){n.pu=(I,R,b)=>(async function(O,V,G,H){let K=V.view.ru(G);K.Cs&&(K=await ec(O.localStore,V.query,!1).then((({documents:E})=>V.view.ru(E,K))));const Tt=H&&H.targetChanges.get(V.targetId),At=H&&H.targetMismatches.get(V.targetId)!=null,ut=V.view.applyChanges(K,O.isPrimaryClient,Tt,At);return hc(O,V.targetId,ut.au),ut.snapshot})(n,I,R,b);const o=await ec(n.localStore,t,!0),a=new Eg(t,o.Qs),u=a.ru(o.documents),h=Xn.createSynthesizedTargetChangeForCurrentChange(e,r&&n.onlineState!=="Offline",s),d=a.applyChanges(u,n.isPrimaryClient,h);hc(n,e,d.au);const _=new Tg(t,e,a);return n.Tu.set(t,_),n.Iu.has(e)?n.Iu.get(e).push(t):n.Iu.set(e,[t]),d.snapshot}async function Cg(n,t,e){const r=B(n),s=r.Tu.get(t),o=r.Iu.get(s.targetId);if(o.length>1)return r.Iu.set(s.targetId,o.filter((a=>!rs(a,t)))),void r.Tu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await ui(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),e&&Gi(r.remoteStore,s.targetId),fi(r,s.targetId)})).catch(nn)):(fi(r,s.targetId),await ui(r.localStore,s.targetId,!0))}async function Sg(n,t){const e=B(n),r=e.Tu.get(t),s=e.Iu.get(r.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),Gi(e.remoteStore,r.targetId))}async function bg(n,t,e){const r=xg(n);try{const s=await(function(a,u){const h=B(a),d=Y.now(),_=u.reduce(((b,N)=>b.add(N.key)),q());let I,R;return h.persistence.runTransaction("Locally write mutations","readwrite",(b=>{let N=Wt(),O=q();return h.Ns.getEntries(b,_).next((V=>{N=V,N.forEach(((G,H)=>{H.isValidDocument()||(O=O.add(G))}))})).next((()=>h.localDocuments.getOverlayedDocuments(b,N))).next((V=>{I=V;const G=[];for(const H of u){const K=$f(H,I.get(H.key).overlayedDocument);K!=null&&G.push(new ke(H.key,K,Zc(K.value.mapValue),Nt.exists(!0)))}return h.mutationQueue.addMutationBatch(b,d,G,u)})).next((V=>{R=V;const G=V.applyToLocalDocumentSet(I,O);return h.documentOverlayCache.saveOverlays(b,V.batchId,G)}))})).then((()=>({batchId:R.batchId,changes:ll(I)})))})(r.localStore,t);r.sharedClientState.addPendingMutation(s.batchId),(function(a,u,h){let d=a.Vu[a.currentUser.toKey()];d||(d=new tt(j)),d=d.insert(u,h),a.Vu[a.currentUser.toKey()]=d})(r,s.batchId,e),await Yn(r,s.changes),await us(r.remoteStore)}catch(s){const o=Xi(s,"Failed to persist write");e.reject(o)}}async function Hl(n,t){const e=B(n);try{const r=await jm(e.localStore,t);t.targetChanges.forEach(((s,o)=>{const a=e.Au.get(o);a&&(W(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?W(a.hu,14607):s.removedDocuments.size>0&&(W(a.hu,42227),a.hu=!1))})),await Yn(e,r,t)}catch(r){await nn(r)}}function uc(n,t,e){const r=B(n);if(r.isPrimaryClient&&e===0||!r.isPrimaryClient&&e===1){const s=[];r.Tu.forEach(((o,a)=>{const u=a.view.va(t);u.snapshot&&s.push(u.snapshot)})),(function(a,u){const h=B(a);h.onlineState=u;let d=!1;h.queries.forEach(((_,I)=>{for(const R of I.Sa)R.va(u)&&(d=!0)})),d&&Ji(h)})(r.eventManager,t),s.length&&r.Pu.H_(s),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Pg(n,t,e){const r=B(n);r.sharedClientState.updateQueryState(t,"rejected",e);const s=r.Au.get(t),o=s&&s.key;if(o){let a=new tt(M.comparator);a=a.insert(o,Et.newNoDocument(o,F.min()));const u=q().add(o),h=new as(F.min(),new Map,new tt(j),a,u);await Hl(r,h),r.du=r.du.remove(o),r.Au.delete(t),Zi(r)}else await ui(r.localStore,t,!1).then((()=>fi(r,t,e))).catch(nn)}async function Vg(n,t){const e=B(n),r=t.batch.batchId;try{const s=await Um(e.localStore,t);Wl(e,r,null),Kl(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await Yn(e,s)}catch(s){await nn(s)}}async function Dg(n,t,e){const r=B(n);try{const s=await(function(a,u){const h=B(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let _;return h.mutationQueue.lookupMutationBatch(d,u).next((I=>(W(I!==null,37113),_=I.keys(),h.mutationQueue.removeMutationBatch(d,I)))).next((()=>h.mutationQueue.performConsistencyCheck(d))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(d,_,u))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,_))).next((()=>h.localDocuments.getDocuments(d,_)))}))})(r.localStore,t);Wl(r,t,e),Kl(r,t),r.sharedClientState.updateMutationState(t,"rejected",e),await Yn(r,s)}catch(s){await nn(s)}}function Kl(n,t){(n.mu.get(t)||[]).forEach((e=>{e.resolve()})),n.mu.delete(t)}function Wl(n,t,e){const r=B(n);let s=r.Vu[r.currentUser.toKey()];if(s){const o=s.get(t);o&&(e?o.reject(e):o.resolve(),s=s.remove(t)),r.Vu[r.currentUser.toKey()]=s}}function fi(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(const r of n.Iu.get(t))n.Tu.delete(r),e&&n.Pu.yu(r,e);n.Iu.delete(t),n.isPrimaryClient&&n.Ru.jr(t).forEach((r=>{n.Ru.containsKey(r)||Ql(n,r)}))}function Ql(n,t){n.Eu.delete(t.path.canonicalString());const e=n.du.get(t);e!==null&&(Gi(n.remoteStore,e),n.du=n.du.remove(t),n.Au.delete(e),Zi(n))}function hc(n,t,e){for(const r of e)r instanceof $l?(n.Ru.addReference(r.key,t),kg(n,r)):r instanceof zl?(D(Yi,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,t),n.Ru.containsKey(r.key)||Ql(n,r.key)):L(19791,{wu:r})}function kg(n,t){const e=t.key,r=e.path.canonicalString();n.du.get(e)||n.Eu.has(r)||(D(Yi,"New document in limbo: "+e),n.Eu.add(r),Zi(n))}function Zi(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const t=n.Eu.values().next().value;n.Eu.delete(t);const e=new M(J.fromString(t)),r=n.fu.next();n.Au.set(r,new Ig(e)),n.du=n.du.insert(e,r),Ml(n.remoteStore,new ee(Bt(xi(e.path)),r,"TargetPurposeLimboResolution",Zr.ce))}}async function Yn(n,t,e){const r=B(n),s=[],o=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((u,h)=>{a.push(r.pu(h,t,e).then((d=>{if((d||e)&&r.isPrimaryClient){const _=d?!d.fromCache:e?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,_?"current":"not-current")}if(d){s.push(d);const _=$i.As(h.targetId,d);o.push(_)}})))})),await Promise.all(a),r.Pu.H_(s),await(async function(h,d){const _=B(h);try{await _.persistence.runTransaction("notifyLocalViewChanges","readwrite",(I=>C.forEach(d,(R=>C.forEach(R.Es,(b=>_.persistence.referenceDelegate.addReference(I,R.targetId,b))).next((()=>C.forEach(R.ds,(b=>_.persistence.referenceDelegate.removeReference(I,R.targetId,b)))))))))}catch(I){if(!rn(I))throw I;D(zi,"Failed to update sequence numbers: "+I)}for(const I of d){const R=I.targetId;if(!I.fromCache){const b=_.Ms.get(R),N=b.snapshotVersion,O=b.withLastLimboFreeSnapshotVersion(N);_.Ms=_.Ms.insert(R,O)}}})(r.localStore,o))}async function Ng(n,t){const e=B(n);if(!e.currentUser.isEqual(t)){D(Yi,"User change. New user:",t.toKey());const r=await Vl(e.localStore,t);e.currentUser=t,(function(o,a){o.mu.forEach((u=>{u.forEach((h=>{h.reject(new k(S.CANCELLED,a))}))})),o.mu.clear()})(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await Yn(e,r.Ls)}}function Mg(n,t){const e=B(n),r=e.Au.get(t);if(r&&r.hu)return q().add(r.key);{let s=q();const o=e.Iu.get(t);if(!o)return s;for(const a of o){const u=e.Tu.get(a);s=s.unionWith(u.view.nu)}return s}}function Xl(n){const t=B(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=Hl.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Mg.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Pg.bind(null,t),t.Pu.H_=_g.bind(null,t.eventManager),t.Pu.yu=yg.bind(null,t.eventManager),t}function xg(n){const t=B(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Vg.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Dg.bind(null,t),t}class Gr{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=cs(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,e){return null}Mu(t,e){return null}vu(t){return Bm(this.persistence,new Om,t.initialUser,this.serializer)}Cu(t){return new Pl(qi.mi,this.serializer)}Du(t){return new Hm}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Gr.provider={build:()=>new Gr};class Og extends Gr{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){W(this.persistence.referenceDelegate instanceof $r,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new Im(r,t.asyncQueue,e)}Cu(t){const e=this.cacheSizeBytes!==void 0?Ct.withCacheSize(this.cacheSizeBytes):Ct.DEFAULT;return new Pl((r=>$r.mi(r,e)),this.serializer)}}class mi{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>uc(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Ng.bind(null,this.syncEngine),await mg(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return(function(){return new pg})()}createDatastore(t){const e=cs(t.databaseInfo.databaseId),r=(function(o){return new Jm(o)})(t.databaseInfo);return(function(o,a,u,h){return new eg(o,a,u,h)})(t.authCredentials,t.appCheckCredentials,r,e)}createRemoteStore(t){return(function(r,s,o,a,u){return new rg(r,s,o,a,u)})(this.localStore,this.datastore,t.asyncQueue,(e=>uc(this.syncEngine,e,0)),(function(){return sc.v()?new sc:new Km})())}createSyncEngine(t,e){return(function(s,o,a,u,h,d,_){const I=new vg(s,o,a,u,h,d);return _&&(I.gu=!0),I})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){await(async function(e){const r=B(e);D(be,"RemoteStore shutting down."),r.Ea.add(5),await Jn(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}mi.provider={build:()=>new mi};class Jl{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):Kt("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout((()=>{this.muted||t(e)}),0)}}const fe="FirestoreClient";class Lg{constructor(t,e,r,s,o){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=r,this.databaseInfo=s,this.user=yt.UNAUTHENTICATED,this.clientId=bi.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async a=>{D(fe,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(D(fe,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new ie;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const r=Xi(e,"Failed to shutdown persistence");t.reject(r)}})),t.promise}}async function Gs(n,t){n.asyncQueue.verifyOperationInProgress(),D(fe,"Initializing OfflineComponentProvider");const e=n.configuration;await t.initialize(e);let r=e.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await Vl(t.localStore,s),r=s)})),t.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=t}async function dc(n,t){n.asyncQueue.verifyOperationInProgress();const e=await Fg(n);D(fe,"Initializing OnlineComponentProvider"),await t.initialize(e,n.configuration),n.setCredentialChangeListener((r=>oc(t.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>oc(t.remoteStore,s))),n._onlineComponents=t}async function Fg(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){D(fe,"Using user provided OfflineComponentProvider");try{await Gs(n,n._uninitializedComponentsProvider._offline)}catch(t){const e=t;if(!(function(s){return s.name==="FirebaseError"?s.code===S.FAILED_PRECONDITION||s.code===S.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(e))throw e;Ke("Error using user provided cache. Falling back to memory cache: "+e),await Gs(n,new Gr)}}else D(fe,"Using default OfflineComponentProvider"),await Gs(n,new Og(void 0));return n._offlineComponents}async function Yl(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(D(fe,"Using user provided OnlineComponentProvider"),await dc(n,n._uninitializedComponentsProvider._online)):(D(fe,"Using default OnlineComponentProvider"),await dc(n,new mi))),n._onlineComponents}function Bg(n){return Yl(n).then((t=>t.syncEngine))}async function gi(n){const t=await Yl(n),e=t.eventManager;return e.onListen=wg.bind(null,t.syncEngine),e.onUnlisten=Cg.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=Ag.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=Sg.bind(null,t.syncEngine),e}function Ug(n,t,e={}){const r=new ie;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,u,h,d){const _=new Jl({next:R=>{_.Nu(),a.enqueueAndForget((()=>jl(o,I))),R.fromCache&&h.source==="server"?d.reject(new k(S.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(R)},error:R=>d.reject(R)}),I=new ql(u,_,{includeMetadataChanges:!0,qa:!0});return Ul(o,I)})(await gi(n),n.asyncQueue,t,e,r))),r.promise}function Zl(n){const t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}const fc=new Map;const tu="firestore.googleapis.com",mc=!0;class gc{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new k(S.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=tu,this.ssl=mc}else this.host=t.host,this.ssl=t.ssl??mc;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=bl;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<Em)throw new k(S.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}tf("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Zl(t.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new k(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new k(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new k(S.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class hs{constructor(t,e,r,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new gc({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new k(S.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new k(S.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new gc(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new zd;switch(r.type){case"firstParty":return new Wd(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new k(S.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(e){const r=fc.get(e);r&&(D("ComponentProvider","Removing Datastore"),fc.delete(e),r.terminate())})(this),Promise.resolve()}}function jg(n,t,e,r={}){n=Ft(n,hs);const s=Ri(t),o=n._getSettings(),a={...o,emulatorOptions:n._getEmulatorOptions()},u=`${t}:${e}`;s&&(_h(`https://${u}`),Ih("Firestore",!0)),o.host!==tu&&o.host!==u&&Ke("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:u,ssl:s,emulatorOptions:r};if(!Nr(h,a)&&(n._setSettings(h),r.mockUserToken)){let d,_;if(typeof r.mockUserToken=="string")d=r.mockUserToken,_=yt.MOCK_USER;else{d=yh(r.mockUserToken,n._app?.options.projectId);const I=r.mockUserToken.sub||r.mockUserToken.user_id;if(!I)throw new k(S.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");_=new yt(I)}n._authCredentials=new Gd(new jc(d,_))}}class Zn{constructor(t,e,r){this.converter=e,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new Zn(this.firestore,t,this._query)}}class ct{constructor(t,e,r){this.converter=e,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new oe(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new ct(this.firestore,t,this._key)}toJSON(){return{type:ct._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,r){if(Wn(e,ct._jsonSchema))return new ct(t,r||null,new M(J.fromString(e.referencePath)))}}ct._jsonSchemaVersion="firestore/documentReference/1.0",ct._jsonSchema={type:it("string",ct._jsonSchemaVersion),referencePath:it("string")};class oe extends Zn{constructor(t,e,r){super(t,e,xi(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new ct(this.firestore,null,new M(t))}withConverter(t){return new oe(this.firestore,t,this._path)}}function Dn(n,t,...e){if(n=He(n),qc("collection","path",t),n instanceof hs){const r=J.fromString(t,...e);return Pa(r),new oe(n,null,r)}{if(!(n instanceof ct||n instanceof oe))throw new k(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(J.fromString(t,...e));return Pa(r),new oe(n.firestore,null,r)}}function Ze(n,t,...e){if(n=He(n),arguments.length===1&&(t=bi.newId()),qc("doc","path",t),n instanceof hs){const r=J.fromString(t,...e);return ba(r),new ct(n,null,new M(r))}{if(!(n instanceof ct||n instanceof oe))throw new k(S.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(J.fromString(t,...e));return ba(r),new ct(n.firestore,n instanceof oe?n.converter:null,new M(r))}}const pc="AsyncQueue";class _c{constructor(t=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new kl(this,"async_queue_retry"),this._c=()=>{const r=zs();r&&D(pc,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=t;const e=zs();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const e=zs();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise((()=>{}));const e=new ie;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Xu.push(t),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!rn(t))throw t;D(pc,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(t){const e=this.ac.then((()=>(this.rc=!0,t().catch((r=>{throw this.nc=r,this.rc=!1,Kt("INTERNAL UNHANDLED ERROR: ",yc(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=e,e}enqueueAfterDelay(t,e,r){this.uc(),this.oc.indexOf(t)>-1&&(e=0);const s=Qi.createAndSchedule(this,t,e,r,(o=>this.hc(o)));return this.tc.push(s),s}uc(){this.nc&&L(47125,{Pc:yc(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do t=this.ac,await t;while(t!==this.ac)}Ic(t){for(const e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then((()=>{this.tc.sort(((e,r)=>e.targetTimeMs-r.targetTimeMs));for(const e of this.tc)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Tc()}))}dc(t){this.oc.push(t)}hc(t){const e=this.tc.indexOf(t);this.tc.splice(e,1)}}function yc(n){let t=n.message||"";return n.stack&&(t=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),t}function Ec(n){return(function(e,r){if(typeof e!="object"||e===null)return!1;const s=e;for(const o of r)if(o in s&&typeof s[o]=="function")return!0;return!1})(n,["next","error","complete"])}class Pe extends hs{constructor(t,e,r,s){super(t,e,r,s),this.type="firestore",this._queue=new _c,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new _c(t),this._firestoreClient=void 0,await t}}}function qg(n,t){const e=typeof n=="object"?n:Dd(),r=typeof n=="string"?n:Lr,s=Cd(e,"firestore").getImmediate({identifier:r});if(!s._initialized){const o=gh("firestore");o&&jg(s,...o)}return s}function to(n){if(n._terminated)throw new k(S.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||$g(n),n._firestoreClient}function $g(n){const t=n._freezeSettings(),e=(function(s,o,a,u){return new df(s,o,a,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,Zl(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,t);n._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),n._firestoreClient=new Lg(n._authCredentials,n._appCheckCredentials,n._queue,e,n._componentsProvider&&(function(s){const o=s?._online.build();return{_offline:s?._offline.build(o),_online:o}})(n._componentsProvider))}class Pt{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Pt(gt.fromBase64String(t))}catch(e){throw new k(S.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new Pt(gt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:Pt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(Wn(t,Pt._jsonSchema))return Pt.fromBase64String(t.bytes)}}Pt._jsonSchemaVersion="firestore/bytes/1.0",Pt._jsonSchema={type:it("string",Pt._jsonSchemaVersion),bytes:it("string")};class eo{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new k(S.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new mt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class no{constructor(t){this._methodName=t}}class jt{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new k(S.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new k(S.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return j(this._lat,t._lat)||j(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:jt._jsonSchemaVersion}}static fromJSON(t){if(Wn(t,jt._jsonSchema))return new jt(t.latitude,t.longitude)}}jt._jsonSchemaVersion="firestore/geoPoint/1.0",jt._jsonSchema={type:it("string",jt._jsonSchemaVersion),latitude:it("number"),longitude:it("number")};class qt{constructor(t){this._values=(t||[]).map((e=>e))}toArray(){return this._values.map((t=>t))}isEqual(t){return(function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0})(this._values,t._values)}toJSON(){return{type:qt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(Wn(t,qt._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every((e=>typeof e=="number")))return new qt(t.vectorValues);throw new k(S.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}qt._jsonSchemaVersion="firestore/vectorValue/1.0",qt._jsonSchema={type:it("string",qt._jsonSchemaVersion),vectorValues:it("object")};const zg=/^__.*__$/;class Gg{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return this.fieldMask!==null?new ke(t,this.data,this.fieldMask,e,this.fieldTransforms):new Qn(t,this.data,e,this.fieldTransforms)}}function eu(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L(40011,{Ac:n})}}class ro{constructor(t,e,r,s,o,a){this.settings=t,this.databaseId=e,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new ro({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(t){const e=this.path?.child(t),r=this.Vc({path:e,fc:!1});return r.gc(t),r}yc(t){const e=this.path?.child(t),r=this.Vc({path:e,fc:!1});return r.Rc(),r}wc(t){return this.Vc({path:void 0,fc:!0})}Sc(t){return Hr(t,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return this.fieldMask.find((e=>t.isPrefixOf(e)))!==void 0||this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))!==void 0}Rc(){if(this.path)for(let t=0;t<this.path.length;t++)this.gc(this.path.get(t))}gc(t){if(t.length===0)throw this.Sc("Document fields must not be empty");if(eu(this.Ac)&&zg.test(t))throw this.Sc('Document fields cannot begin and end with "__"')}}class Hg{constructor(t,e,r){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=r||cs(t)}Cc(t,e,r,s=!1){return new ro({Ac:t,methodName:e,Dc:r,path:mt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function nu(n){const t=n._freezeSettings(),e=cs(n._databaseId);return new Hg(n._databaseId,!!t.ignoreUndefinedProperties,e)}function ru(n,t,e,r,s,o={}){const a=n.Cc(o.merge||o.mergeFields?2:0,t,e,s);au("Data must be an object, but it was:",a,r);const u=iu(r,a);let h,d;if(o.merge)h=new kt(a.fieldMask),d=a.fieldTransforms;else if(o.mergeFields){const _=[];for(const I of o.mergeFields){const R=Kg(t,I,e);if(!a.contains(R))throw new k(S.INVALID_ARGUMENT,`Field '${R}' is specified in your field mask but missing from your input data.`);Qg(_,R)||_.push(R)}h=new kt(_),d=a.fieldTransforms.filter((I=>h.covers(I.field)))}else h=null,d=a.fieldTransforms;return new Gg(new bt(u),h,d)}class so extends no{_toFieldTransform(t){return new Bf(t.path,new Bn)}isEqual(t){return t instanceof so}}function su(n,t){if(ou(n=He(n)))return au("Unsupported field value:",t,n),iu(n,t);if(n instanceof no)return(function(r,s){if(!eu(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)})(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.fc&&t.Ac!==4)throw t.Sc("Nested arrays are not supported");return(function(r,s){const o=[];let a=0;for(const u of r){let h=su(u,s.wc(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}})(n,t)}return(function(r,s){if((r=He(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Of(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=Y.fromDate(r);return{timestampValue:qr(s.serializer,o)}}if(r instanceof Y){const o=new Y(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:qr(s.serializer,o)}}if(r instanceof jt)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Pt)return{bytesValue:Il(s.serializer,r._byteString)};if(r instanceof ct){const o=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Ui(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof qt)return(function(a,u){return{mapValue:{fields:{[Jc]:{stringValue:Yc},[Fr]:{arrayValue:{values:a.toArray().map((d=>{if(typeof d!="number")throw u.Sc("VectorValues must only contain numeric values.");return Oi(u.serializer,d)}))}}}}}})(r,s);throw s.Sc(`Unsupported field value: ${Pi(r)}`)})(n,t)}function iu(n,t){const e={};return Gc(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Ve(n,((r,s)=>{const o=su(s,t.mc(r));o!=null&&(e[r]=o)})),{mapValue:{fields:e}}}function ou(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Y||n instanceof jt||n instanceof Pt||n instanceof ct||n instanceof no||n instanceof qt)}function au(n,t,e){if(!ou(e)||!$c(e)){const r=Pi(e);throw r==="an object"?t.Sc(n+" a custom object"):t.Sc(n+" "+r)}}function Kg(n,t,e){if((t=He(t))instanceof eo)return t._internalPath;if(typeof t=="string")return cu(n,t);throw Hr("Field path arguments must be of type string or ",n,!1,void 0,e)}const Wg=new RegExp("[~\\*/\\[\\]]");function cu(n,t,e){if(t.search(Wg)>=0)throw Hr(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new eo(...t.split("."))._internalPath}catch{throw Hr(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function Hr(n,t,e,r,s){const o=r&&!r.isEmpty(),a=s!==void 0;let u=`Function ${t}() called with invalid data`;e&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${s}`),h+=")"),new k(S.INVALID_ARGUMENT,u+n+h)}function Qg(n,t){return n.some((e=>e.isEqual(t)))}class lu{constructor(t,e,r,s,o){this._firestore=t,this._userDataWriter=e,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new ct(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new Xg(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(uu("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}}class Xg extends lu{data(){return super.data()}}function uu(n,t){return typeof t=="string"?cu(n,t):t instanceof eo?t._internalPath:t._delegate._internalPath}function hu(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new k(S.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Jg{convertValue(t,e="none"){switch(he(t)){case 0:return null;case 1:return t.booleanValue;case 2:return nt(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ue(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw L(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const r={};return Ve(t,((s,o)=>{r[s]=this.convertValue(o,e)})),r}convertVectorValue(t){const e=t.fields?.[Fr].arrayValue?.values?.map((r=>nt(r.doubleValue)));return new qt(e)}convertGeoPoint(t){return new jt(nt(t.latitude),nt(t.longitude))}convertArray(t,e){return(t.values||[]).map((r=>this.convertValue(r,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const r=es(t);return r==null?null:this.convertValue(r,e);case"estimate":return this.convertTimestamp(On(t));default:return null}}convertTimestamp(t){const e=le(t);return new Y(e.seconds,e.nanos)}convertDocumentKey(t,e){const r=J.fromString(t);W(Sl(r),9688,{name:t});const s=new Ln(r.get(1),r.get(3)),o=new M(r.popFirst(5));return s.isEqual(e)||Kt(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),o}}function du(n,t,e){let r;return r=n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t,r}class Rn{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Ae extends lu{constructor(t,e,r,s,o,a){super(t,e,r,s,a),this._firestore=t,this._firestoreImpl=t,this.metadata=o}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Sr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const r=this._document.data.field(uu("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new k(S.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,e={};return e.type=Ae._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}}Ae._jsonSchemaVersion="firestore/documentSnapshot/1.0",Ae._jsonSchema={type:it("string",Ae._jsonSchemaVersion),bundleSource:it("string","DocumentSnapshot"),bundleName:it("string"),bundle:it("string")};class Sr extends Ae{data(t={}){return super.data(t)}}class Re{constructor(t,e,r,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new Rn(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach((r=>{t.call(e,new Sr(this._firestore,this._userDataWriter,r.key,r,new Rn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new k(S.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=(function(s,o){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((u=>{const h=new Sr(s._firestore,s._userDataWriter,u.doc.key,u.doc,new Rn(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);return u.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((u=>o||u.type!==3)).map((u=>{const h=new Sr(s._firestore,s._userDataWriter,u.doc.key,u.doc,new Rn(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,_=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),_=a.indexOf(u.doc.key)),{type:Yg(u.type),doc:h,oldIndex:d,newIndex:_}}))}})(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new k(S.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=Re._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=bi.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const e=[],r=[],s=[];return this.docs.forEach((o=>{o._document!==null&&(e.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))})),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function Yg(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L(61501,{type:n})}}Re._jsonSchemaVersion="firestore/querySnapshot/1.0",Re._jsonSchema={type:it("string",Re._jsonSchemaVersion),bundleSource:it("string","QuerySnapshot"),bundleName:it("string"),bundle:it("string")};class io extends Jg{constructor(t){super(),this.firestore=t}convertBytes(t){return new Pt(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new ct(this.firestore,null,e)}}function Zg(n){n=Ft(n,Zn);const t=Ft(n.firestore,Pe),e=to(t),r=new io(t);return hu(n._query),Ug(e,n._query).then((s=>new Re(t,r,n,s)))}function Kr(n,t,e){n=Ft(n,ct);const r=Ft(n.firestore,Pe),s=du(n.converter,t,e);return oo(r,[ru(nu(r),"setDoc",n._key,s,n.converter!==null,e).toMutation(n._key,Nt.none())])}function tp(n){return oo(Ft(n.firestore,Pe),[new Li(n._key,Nt.none())])}function fu(n,t){const e=Ft(n.firestore,Pe),r=Ze(n),s=du(n.converter,t);return oo(e,[ru(nu(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Nt.exists(!1))]).then((()=>r))}function Tc(n,...t){n=He(n);let e={includeMetadataChanges:!1,source:"default"},r=0;typeof t[r]!="object"||Ec(t[r])||(e=t[r++]);const s={includeMetadataChanges:e.includeMetadataChanges,source:e.source};if(Ec(t[r])){const h=t[r];t[r]=h.next?.bind(h),t[r+1]=h.error?.bind(h),t[r+2]=h.complete?.bind(h)}let o,a,u;if(n instanceof ct)a=Ft(n.firestore,Pe),u=xi(n._key.path),o={next:h=>{t[r]&&t[r](ep(a,n,h))},error:t[r+1],complete:t[r+2]};else{const h=Ft(n,Zn);a=Ft(h.firestore,Pe),u=h._query;const d=new io(a);o={next:_=>{t[r]&&t[r](new Re(a,d,h,_))},error:t[r+1],complete:t[r+2]},hu(n._query)}return(function(d,_,I,R){const b=new Jl(R),N=new ql(_,b,I);return d.asyncQueue.enqueueAndForget((async()=>Ul(await gi(d),N))),()=>{b.Nu(),d.asyncQueue.enqueueAndForget((async()=>jl(await gi(d),N)))}})(to(a),u,s,o)}function oo(n,t){return(function(r,s){const o=new ie;return r.asyncQueue.enqueueAndForget((async()=>bg(await Bg(r),s,o))),o.promise})(to(n),t)}function ep(n,t,e){const r=e.docs.get(t._key),s=new io(n);return new Ae(n,s,t._key,r,new Rn(e.hasPendingWrites,e.fromCache),t.converter)}function qn(){return new so("serverTimestamp")}(function(t,e=!0){(function(s){en=s})(Vd),xr(new Nn("firestore",((r,{instanceIdentifier:s,options:o})=>{const a=r.getProvider("app").getImmediate(),u=new Pe(new Hd(r.getProvider("auth-internal")),new Qd(a,r.getProvider("app-check-internal")),(function(d,_){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new k(S.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Ln(d.options.projectId,_)})(a,s),a);return o={useFetchStreams:e,...o},u._setSettings(o),u}),"PUBLIC").setMultipleInstances(!0)),qe(Aa,Ra,t),qe(Aa,Ra,"esm2020")})();const np={apiKey:"AIzaSyC5fjkXd_lirXDEY5wyH-upF9yU_nzLAJw",authDomain:"web-rtc-server-50d56.firebaseapp.com",projectId:"web-rtc-server-50d56",storageBucket:"web-rtc-server-50d56.firebasestorage.app",messagingSenderId:"1017642181996",appId:"1:1017642181996:web:e325acd4ee82baa9087f49",measurementId:"G-KVDMZRQKBP"},rp=Dc(np),mu=qg(rp),sp={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10};let Z=null;const Ic=document.getElementById("webcamButton"),gu=document.getElementById("webcamVideo"),ao=document.getElementById("callButton"),pu=document.getElementById("answerButton"),Lt=document.getElementById("remoteVideo"),$n=document.getElementById("hangupButton"),_u=document.getElementById("settingsButton"),Ce=document.getElementById("settingsModal"),ip=document.getElementById("closeSettings"),ze=document.getElementById("videoSelect"),zn=document.getElementById("audioSelect"),Wr=document.getElementById("audioOutputSelect"),Ge=document.getElementById("createCallModal"),op=document.getElementById("closeCreateCall"),tr=document.getElementById("callIdDisplay"),Ir=document.getElementById("copyCallId"),ap=document.getElementById("shareGmail"),cp=document.getElementById("shareOutlook"),ae=document.getElementById("joinCallModal"),lp=document.getElementById("joinCallInput"),up=document.getElementById("confirmJoinCall"),hp=document.getElementById("closeJoinCall"),br=document.getElementById("toggleMute"),Pr=document.getElementById("toggleCamera"),yu=document.getElementById("toggleFullscreen"),Eu=document.getElementById("callTimer"),dp=document.getElementById("videoContainer"),Qr=document.getElementById("slot-0-camera-off"),fp=document.getElementById("remoteCameraOff"),Xr=document.getElementById("slot-0-muted"),mp=document.getElementById("remoteMuted"),Gt=document.getElementById("connectionIndicator"),Jr=document.getElementById("networkStats"),gp=document.getElementById("videoStat"),pp=document.getElementById("audioStat"),_p=document.getElementById("latencyStat"),yp=document.getElementById("packetLossStat"),co=document.getElementById("chatPanel"),Hs=document.getElementById("chatMessages"),pi=document.getElementById("chatInput"),Ep=document.getElementById("sendMessage"),Gn=document.getElementById("openChat"),Tp=document.getElementById("toggleChat"),vc=document.getElementById("showStatsToggle"),Yr=document.getElementById("usernameInput"),_i=document.getElementById("localNameTag"),we=document.getElementById("remoteNameTag");let Ie=!1,je=!1,yi=null,Vr=null,kn=null,Ei=!1,st="",Hn=null,Kn=null;const Dt=localStorage.getItem("clientId")||Math.random().toString(36).substring(2,10);localStorage.setItem("clientId",Dt);const x={},Dr=10;let Vt=null;function ds(n){Object.values(x).forEach(t=>{const e=t.dataChannel;if(e&&e.readyState==="open")try{e.send(JSON.stringify(n))}catch{}})}function Tu(){if(document.querySelectorAll(".thumb-slot").forEach(n=>n.classList.remove("active")),Vt){const n=x[Vt];if(n&&n.slotIndex){const t=document.getElementById(`slot-${n.slotIndex}`);t&&t.classList.add("active")}}else{const n=document.getElementById("slot-0");n&&n.classList.add("active")}}function Ip(n){for(const[t,e]of Object.entries(x))if(t===n&&e.slotIndex)return e.slotIndex;for(let t=1;t<Dr;t++){if(!document.getElementById(`slot-${t}`))continue;if(!Object.values(x).some(s=>s.slotIndex===t))return t}return null}function Iu(n){const t=x[n];return!t||!t.slotIndex?null:document.getElementById(`slot-${t.slotIndex}`)}function vu(n){const t=x[n].slotIndex||Ip(n);if(!t)return null;x[n].slotIndex=t;const e=document.getElementById(`slot-${t}`);e.classList.remove("empty");let r=e.querySelector("video");r||(r=document.createElement("video"),r.className="thumb-video",r.autoplay=!0,r.playsInline=!0,r.id=`slot-${t}-video`,e.appendChild(r));let s=e.querySelector(".slot-name");if(s||(s=document.createElement("div"),s.className="video-name-tag slot-name",s.id=`slot-${t}-name`,s.textContent=x[n].username||"Guest",e.appendChild(s)),!e.querySelector(".camera-off-overlay")){const o=document.createElement("div");o.className="camera-off-overlay small",o.id=`slot-${t}-camera-off`,o.innerHTML='<div class="camera-off-icon"></div>',e.appendChild(o)}if(!e.querySelector(".muted-indicator")){const o=document.createElement("div");o.className="muted-indicator small",o.id=`slot-${t}-muted`,o.textContent="",e.appendChild(o)}return r}let wt=null,Ti=null,Ii=null;async function vi(n){if(!wt)return;const t=Dn(wt,"signals");await fu(t,{...n,createdAt:qn()})}async function wu(){if(!wt)return;const n=Ze(wt,"participants",Dt);try{await Kr(n,{username:st},{merge:!0})}catch(t){console.error("Failed to update participant record:",t)}}async function lo(n,t=!1){if(wt=Ze(mu,"calls",n),t)try{await Kr(wt,{createdAt:qn()})}catch(s){console.error("Error creating call doc:",s)}try{const s=Dn(wt,"participants"),o=await Zg(s);if(console.log("Joining call - current participants:",o.size,"MAX:",Dr),o.size>=Dr){alert("Call is full (maximum "+Dr+" participants)");return}await Kr(Ze(wt,"participants",Dt),{username:st,joinedAt:qn()},{merge:!0})}catch(s){console.error("Failed to join call participants collection:",s)}const e=Dn(wt,"participants");Ti=Tc(e,s=>{s.docChanges().forEach(async o=>{const a=o.doc.id,u=o.doc.data();if(o.type==="added"){if(a===Dt)return;x[a]=x[a]||{},x[a].username=u.username||"Guest",vu(a),Dt<a?await Ks(a,!0):await Ks(a,!1),Vt||(Vt=a,Lt.srcObject=x[a].remoteStream,Lt.muted=!1,we.textContent=x[a].username||"Guest",we.classList.add("active"),Tu())}else if(o.type==="removed")wi(a);else if(o.type==="modified"&&x[a]){x[a].username=u.username||"Guest";const h=Iu(a);if(h){const d=h.querySelector(".slot-name");d&&(d.textContent=x[a].username)}}})});const r=Dn(wt,"signals");Ii=Tc(r,s=>{s.docChanges().forEach(async o=>{if(o.type!=="added")return;const a=o.doc.data();if(!a||a.to!==Dt)return;const u=a.from;if(a.type==="offer"){x[u]=x[u]||{},x[u].username=x[u].username||"Guest";const h=await Ks(u,!1),d={type:"offer",sdp:a.sdp};if(await h.setRemoteDescription(new RTCSessionDescription(d)),x[u].pendingIceCandidates){for(const I of x[u].pendingIceCandidates)try{await h.addIceCandidate(new RTCIceCandidate(I))}catch(R){console.warn("Failed to add pending ICE candidate",R)}x[u].pendingIceCandidates=[]}const _=await h.createAnswer();await h.setLocalDescription(_),await vi({type:"answer",from:Dt,to:u,sdp:_.sdp})}else if(a.type==="answer"){const h=x[u]&&x[u].pc;if(h&&h.signalingState!=="stable")try{const d={type:"answer",sdp:a.sdp};if(await h.setRemoteDescription(new RTCSessionDescription(d)),x[u].pendingIceCandidates){for(const _ of x[u].pendingIceCandidates)try{await h.addIceCandidate(new RTCIceCandidate(_))}catch(I){console.warn("Failed to add pending ICE candidate",I)}x[u].pendingIceCandidates=[]}}catch(d){console.error("Failed to set remote description:",d)}else console.log("Ignoring answer - PC not ready or already stable",h?.signalingState)}else if(a.type==="ice"){const h=x[u]&&x[u].pc;if(h&&a.candidate)try{h.remoteDescription?await h.addIceCandidate(new RTCIceCandidate(a.candidate)):(x[u].pendingIceCandidates||(x[u].pendingIceCandidates=[]),x[u].pendingIceCandidates.push(a.candidate),console.log("Queued ICE candidate from",u,"- remote description not set yet"))}catch(d){console.warn("Failed to add remote ICE candidate",d)}else a.type==="left"&&(console.log("Peer left:",u),wi(u))}})}),await wu(),Ap(),Cp(),Gn.classList.add("active")}async function vp(){if(wt){try{await fu(Dn(wt,"signals"),{type:"left",from:Dt,createdAt:qn()}),await tp(Ze(wt,"participants",Dt))}catch{}Ti&&Ti(),Ii&&Ii()}Object.keys(x).forEach(n=>wi(n)),wt=null,Rp(),Sp(),Gn.classList.remove("active")}async function Ks(n,t=!1){if(!wt)throw new Error("Not in a call");if(x[n]&&x[n].pc)return x[n].pc;const e=new RTCPeerConnection(sp),r=new MediaStream;x[n]=x[n]||{},x[n].pc=e,x[n].remoteStream=r,x[n].pendingIceCandidates=[];const s=vu(n);if(s&&(s.srcObject=r,Tu()),Z&&Z.getTracks().forEach(o=>e.addTrack(o,Z)),t){const o=e.createDataChannel("data");x[n].dataChannel=o,wc(o,n)}else e.ondatachannel=o=>{x[n].dataChannel=o.channel,wc(o.channel,n)};if(e.ontrack=o=>{console.log("Received track from",n,"streams:",o.streams.length),o.streams&&o.streams[0]?o.streams[0].getTracks().forEach(a=>r.addTrack(a)):o.track&&r.addTrack(o.track)},e.onicecandidate=({candidate:o})=>{if(o){const a=o&&typeof o.toJSON=="function"?o.toJSON():o;vi({type:"ice",from:Dt,to:n,candidate:a})}},t){const o=await e.createOffer();await e.setLocalDescription(o),await vi({type:"offer",from:Dt,to:n,sdp:o.sdp})}return e}function wi(n){const t=x[n];if(t){if(t.pc)try{t.pc.close()}catch{}if(t.dataChannel)try{t.dataChannel.close()}catch{}if(t.slotIndex){const e=document.getElementById(`slot-${t.slotIndex}`);e&&(e.innerHTML="",e.classList.add("empty"))}delete x[n]}}async function wp(){const n=await navigator.mediaDevices.enumerateDevices();ze.innerHTML="",zn.innerHTML="",Wr.innerHTML="",n.forEach(t=>{const e=document.createElement("option");e.value=t.deviceId,e.text=t.label||`${t.kind} ${ze.length+1}`,t.kind==="videoinput"?ze.appendChild(e):t.kind==="audioinput"?zn.appendChild(e):t.kind==="audiooutput"&&Wr.appendChild(e)})}ze.onchange=async()=>{Hn=ze.value,Z&&await Au()};zn.onchange=async()=>{Kn=zn.value,Z&&await Au()};Wr.onchange=async()=>{if(typeof Lt.setSinkId<"u")try{await Lt.setSinkId(Wr.value)}catch(n){console.error("Error setting audio output:",n)}};async function Au(){const n={video:Hn?{deviceId:{exact:Hn}}:!0,audio:Kn?{deviceId:{exact:Kn}}:!0},t=Z;Z=await navigator.mediaDevices.getUserMedia(n),gu.srcObject=Z,Object.values(x).forEach(e=>{if(!e.pc)return;const r=e.pc.getSenders?e.pc.getSenders():[],s=Z.getVideoTracks()[0],o=Z.getAudioTracks()[0];r.forEach(a=>{a.track&&(a.track.kind==="video"&&s?a.replaceTrack(s):a.track.kind==="audio"&&o&&a.replaceTrack(o))})}),t&&t.getTracks().forEach(e=>e.stop())}_u.onclick=()=>{Ce.classList.add("active")};ip.onclick=()=>{Ce.classList.remove("active")};Ce.onclick=n=>{n.target===Ce&&Ce.classList.remove("active")};vc.onchange=()=>{Ei=vc.checked,Ei&&kn?(Gt.classList.add("active"),Jr.classList.add("active")):(Gt.classList.remove("active"),Jr.classList.remove("active"))};Yr.oninput=()=>{const n=Yr.value.trim();n&&(st=n,_i.textContent=st,wu(),ds({type:"username",username:st}))};op.onclick=()=>{Ge.classList.remove("active")};Ge.onclick=n=>{n.target===Ge&&Ge.classList.remove("active")};Ir.onclick=async()=>{try{await navigator.clipboard.writeText(tr.value);const n=Ir.textContent;Ir.textContent="Copied!",setTimeout(()=>{Ir.textContent=n},2e3)}catch(n){console.error("Failed to copy:",n)}};ap.onclick=()=>{const n=tr.value,t=window.location.origin+window.location.pathname,e=encodeURIComponent("Join my video call"),r=encodeURIComponent(`Hi,

Join my video call!

Website: ${t}
Call ID: ${n}

Click "Join Call" and enter the Call ID above.

See you soon!`);window.open(`https://mail.google.com/mail/?view=cm&fs=1&su=${e}&body=${r}`,"_blank")};cp.onclick=()=>{const n=tr.value,t=window.location.origin+window.location.pathname,e=encodeURIComponent("Join my video call"),r=encodeURIComponent(`Hi,

Join my video call!

Website: ${t}
Call ID: ${n}

Click "Join Call" and enter the Call ID above.

See you soon!`);window.open(`https://outlook.office.com/mail/deeplink/compose?subject=${e}&body=${r}`,"_blank")};pu.onclick=()=>{ae.classList.add("active")};hp.onclick=()=>{ae.classList.remove("active")};ae.onclick=n=>{n.target===ae&&ae.classList.remove("active")};Gn.onclick=()=>{co.classList.add("open"),Gn.classList.remove("has-new")};Tp.onclick=()=>{co.classList.remove("open")};function Ru(n,t,e="Guest"){const r=document.createElement("div");r.className=`message ${t}`;const s=document.createElement("div");s.className="message-sender",s.textContent=e;const o=document.createElement("div");o.textContent=n;const a=document.createElement("span");a.className="message-time";const u=new Date;a.textContent=u.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),r.appendChild(s),r.appendChild(o),r.appendChild(a),Hs.appendChild(r),Hs.scrollTop=Hs.scrollHeight}function Cu(){const n=pi.value.trim();n&&(Ru(n,"sent",st),ds({type:"chat",message:n,username:st}),pi.value="")}pi.addEventListener("keypress",n=>{n.key==="Enter"&&Cu()});Ep.onclick=()=>{Cu()};ao.onclick=async()=>{const n=Math.random().toString(36).substring(2,12);tr.value=n,Ge.classList.add("active");const t=Ze(mu,"calls",n);await Kr(t,{createdAt:qn()}),await lo(n,!0),$n.disabled=!1};br.onclick=()=>{if(Z){const n=Z.getAudioTracks()[0];n&&(n.enabled=!n.enabled,Ie=!n.enabled,br.classList.toggle("muted",Ie),br.textContent=Ie?"":"",Xr.classList.toggle("active",!n.enabled),console.log("Mute toggled - audioTrack.enabled:",n.enabled,"isMuted:",Ie),console.log("localMuted classes:",Xr.className),ds({type:"mute",muted:Ie}))}};Pr.onclick=()=>{if(Z){const n=Z.getVideoTracks()[0];n&&(n.enabled=!n.enabled,je=!n.enabled,Pr.classList.toggle("camera-off",je),Pr.textContent=je?"":"",Qr.classList.toggle("active",!n.enabled),console.log("Camera toggled - videoTrack.enabled:",n.enabled,"isCameraOff:",je),console.log("localCameraOff classes:",Qr.className),ds({type:"camera",enabled:n.enabled}))}};yu.onclick=()=>{document.fullscreenElement?document.exitFullscreen():dp.requestFullscreen().catch(n=>{console.error("Error attempting to enable fullscreen:",n)})};function Ap(){yi=Date.now(),Vr=setInterval(()=>{const n=Math.floor((Date.now()-yi)/1e3),t=Math.floor(n/60),e=n%60;Eu.textContent=`${String(t).padStart(2,"0")}:${String(e).padStart(2,"0")}`},1e3)}function Rp(){Vr&&(clearInterval(Vr),Vr=null),Eu.textContent="00:00",yi=null}async function Cp(){Ei&&(Gt.classList.add("active"),Jr.classList.add("active")),kn=setInterval(async()=>{if(!Vt)return;const n=x[Vt];if(!n||!n.pc)return;const t=await n.pc.getStats();let e=0,r=0,s=0,o=0,a=0,u=0;t.forEach(d=>{d.type==="inbound-rtp"&&(d.kind==="video"&&d.bytesReceived?e=Math.round(d.bytesReceived*8/1e3):d.kind==="audio"&&d.bytesReceived&&(r=Math.round(d.bytesReceived*8/1e3)),d.packetsLost!==void 0&&(a+=d.packetsLost),d.packetsReceived!==void 0&&(u+=d.packetsReceived)),d.type==="candidate-pair"&&d.state==="succeeded"&&d.currentRoundTripTime!==void 0&&(s=Math.round(d.currentRoundTripTime*1e3))}),u>0&&(o=Math.round(a/(a+u)*100)),gp.textContent=`${e} kbps`,pp.textContent=`${r} kbps`,_p.textContent=`${s} ms`,yp.textContent=`${o}%`;const h=Gt.querySelector(".connection-text");Gt.classList.remove("good","fair","poor"),s<150&&o<2?(Gt.classList.add("good"),h.textContent="Good"):s<300&&o<5?(Gt.classList.add("fair"),h.textContent="Fair"):(Gt.classList.add("poor"),h.textContent="Poor")},1e3)}function Sp(){kn&&(clearInterval(kn),kn=null),Gt.classList.remove("active"),Jr.classList.remove("active")}function wc(n,t){n.onopen=()=>{console.log("Data channel opened for",t);try{n.send(JSON.stringify({type:"username",username:st}))}catch{}},n.onmessage=e=>{const r=JSON.parse(e.data),s=x[t],o=Iu(t);if(r.type==="camera"){if(o){const a=o.querySelector(".camera-off-overlay");a&&a.classList.toggle("active",!r.enabled)}t===Vt&&fp.classList.toggle("active",!r.enabled)}else if(r.type==="mute"){if(o){const a=o.querySelector(".muted-indicator");a&&a.classList.toggle("active",r.muted)}t===Vt&&mp.classList.toggle("active",r.muted)}else if(r.type==="chat")Ru(r.message,"received",r.username||s&&s.username||"Guest"),co.classList.contains("open")||Gn.classList.add("has-new");else if(r.type==="username"){if(s&&(s.username=r.username||"Guest"),o){const a=o.querySelector(".slot-name");a&&(a.textContent=r.username||"Guest")}t===Vt&&(we.textContent=r.username||"Guest")}},n.onerror=e=>{console.error("Data channel error:",e)}}const bp=document.getElementById("topThumbnails");bp?.addEventListener("click",n=>{const t=n.target.closest(".thumb-slot");if(!t)return;const e=t.querySelector("video");if(e&&e.srcObject){const r=parseInt(t.dataset.index);if(r===0)Vt=null,we.classList.remove("active"),Lt.muted=!0;else{const o=Object.entries(x).find(([a,u])=>u.slotIndex===r);Vt=o?o[0]:null,Vt?(we.classList.add("active"),Lt.muted=!1):(we.classList.remove("active"),Lt.muted=!0)}Lt.srcObject=e.srcObject;const s=t.querySelector(".slot-name");we.textContent=s?s.textContent:"Guest"}});Ic.onclick=async()=>{console.log("Webcam button clicked");try{console.log("Requesting media devices..."),Z=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1920,min:640},height:{ideal:1080,min:480},aspectRatio:{ideal:16/9}},audio:!0}),console.log("Media devices granted:",Z)}catch(e){console.error("Error accessing media devices:",e),alert("Error accessing webcam: "+e.message);return}Object.keys(x).forEach(e=>{const r=x[e];r.pc&&Z.getTracks().forEach(s=>r.pc.addTrack(s,Z))}),gu.srcObject=Z,Lt.srcObject=Z,Lt.muted=!0,await wp();const n=Z.getVideoTracks()[0],t=Z.getAudioTracks()[0];if(n&&(Hn=n.getSettings().deviceId,ze.value=Hn),t&&(Kn=t.getSettings().deviceId,zn.value=Kn),Xr.classList.remove("active"),Qr.classList.remove("active"),Ie=!1,je=!1,console.log("Initial state - isMuted:",Ie,"isCameraOff:",je),console.log("localMuted classes:",Xr.className),console.log("localCameraOff classes:",Qr.className),console.log("Video track enabled:",n?.enabled),console.log("Audio track enabled:",t?.enabled),!st||!st.trim()){const e=prompt("Please enter your name:");if(e&&e.trim())st=e.trim(),Yr.value=st,_i.textContent=st;else{alert("A name is required to use the video call app");const r=prompt("Please enter your name:");r&&r.trim()&&(st=r.trim(),Yr.value=st,_i.textContent=st)}}ao.disabled=!1,pu.disabled=!1,Ic.disabled=!0,$n.disabled=!1,_u.disabled=!1,br.disabled=!1,Pr.disabled=!1,yu.disabled=!1};ao.onclick=async()=>{if(!st||!st.trim()){alert("Please enter your name in Settings before creating a call"),Ce.classList.add("active");return}if(!Z){alert(`Please turn on your webcam before creating a call.

Click "Start Webcam" to enable your camera and microphone.`);return}const n=Math.random().toString(36).substring(2,12);tr.value=n,Ge.classList.add("active"),await lo(n,!0),$n.disabled=!1};up.onclick=async()=>{if(!st||!st.trim()){alert("Please enter your name in Settings before joining a call"),ae.classList.remove("active"),Ce.classList.add("active");return}if(!Z){alert(`Please turn on your webcam before joining a call.

Click "Start Webcam" to enable your camera and microphone.`),ae.classList.remove("active");return}const n=lp.value.trim();if(!n){alert("Please enter a call ID");return}ae.classList.remove("active"),await lo(n,!1)};$n.onclick=async()=>{await vp(),$n.disabled=!0};
