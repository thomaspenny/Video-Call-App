(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();const fh=()=>{};var Ta={};const Oc=function(n){const t=[];let e=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},mh=function(n){const t=[];let e=0,r=0;for(;e<n.length;){const s=n[e++];if(s<128)t[r++]=String.fromCharCode(s);else if(s>191&&s<224){const o=n[e++];t[r++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=n[e++],a=n[e++],u=n[e++],h=((s&7)<<18|(o&63)<<12|(a&63)<<6|u&63)-65536;t[r++]=String.fromCharCode(55296+(h>>10)),t[r++]=String.fromCharCode(56320+(h&1023))}else{const o=n[e++],a=n[e++];t[r++]=String.fromCharCode((s&15)<<12|(o&63)<<6|a&63)}}return t.join("")},Mc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const o=n[s],a=s+1<n.length,u=a?n[s+1]:0,h=s+2<n.length,d=h?n[s+2]:0,y=o>>2,I=(o&3)<<4|u>>4;let R=(u&15)<<2|d>>6,P=d&63;h||(P=64,a||(R=64)),r.push(e[y],e[I],e[R],e[P])}return r.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(Oc(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):mh(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const o=e[n.charAt(s++)],u=s<n.length?e[n.charAt(s)]:0;++s;const d=s<n.length?e[n.charAt(s)]:64;++s;const I=s<n.length?e[n.charAt(s)]:64;if(++s,o==null||u==null||d==null||I==null)throw new gh;const R=o<<2|u>>4;if(r.push(R),d!==64){const P=u<<4&240|d>>2;if(r.push(P),I!==64){const M=d<<6&192|I;r.push(M)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class gh extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const ph=function(n){const t=Oc(n);return Mc.encodeByteArray(t,!0)},Ur=function(n){return ph(n).replace(/\./g,"")},_h=function(n){try{return Mc.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function yh(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Eh=()=>yh().__FIREBASE_DEFAULTS__,Th=()=>{if(typeof process>"u"||typeof Ta>"u")return;const n=Ta.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},vh=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=n&&_h(n[1]);return t&&JSON.parse(t)},Vi=()=>{try{return fh()||Eh()||Th()||vh()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Ih=n=>Vi()?.emulatorHosts?.[n],wh=n=>{const t=Ih(n);if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),r]:[t.substring(0,e),r]},xc=()=>Vi()?.config;class Ah{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,r)=>{e?this.reject(e):this.resolve(r),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,r))}}}function Di(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Sh(n){return(await fetch(n,{credentials:"include"})).ok}function Rh(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e={alg:"none",type:"JWT"},r=t||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Ur(JSON.stringify(e)),Ur(JSON.stringify(a)),""].join(".")}const Vn={};function Ch(){const n={prod:[],emulator:[]};for(const t of Object.keys(Vn))Vn[t]?n.emulator.push(t):n.prod.push(t);return n}function bh(n){let t=document.getElementById(n),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",n),e=!0),{created:e,element:t}}let va=!1;function Ph(n,t){if(typeof window>"u"||typeof document>"u"||!Di(window.location.host)||Vn[n]===t||Vn[n]||va)return;Vn[n]=t;function e(R){return`__firebase__banner__${R}`}const r="__firebase__banner",o=Ch().prod.length>0;function a(){const R=document.getElementById(r);R&&R.remove()}function u(R){R.style.display="flex",R.style.background="#7faaf0",R.style.position="fixed",R.style.bottom="5px",R.style.left="5px",R.style.padding=".5em",R.style.borderRadius="5px",R.style.alignItems="center"}function h(R,P){R.setAttribute("width","24"),R.setAttribute("id",P),R.setAttribute("height","24"),R.setAttribute("viewBox","0 0 24 24"),R.setAttribute("fill","none"),R.style.marginLeft="-6px"}function d(){const R=document.createElement("span");return R.style.cursor="pointer",R.style.marginLeft="16px",R.style.fontSize="24px",R.innerHTML=" &times;",R.onclick=()=>{va=!0,a()},R}function y(R,P){R.setAttribute("id",P),R.innerText="Learn more",R.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",R.setAttribute("target","__blank"),R.style.paddingLeft="5px",R.style.textDecoration="underline"}function I(){const R=bh(r),P=e("text"),M=document.getElementById(P)||document.createElement("span"),L=e("learnmore"),D=document.getElementById(L)||document.createElement("a"),K=e("preprendIcon"),W=document.getElementById(K)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(R.created){const Q=R.element;u(Q),y(D,L);const vt=d();h(W,K),Q.append(W,M,D,vt),document.body.appendChild(Q)}o?(M.innerText="Preview backend disconnected.",W.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(W.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,M.innerText="Preview backend running in this workspace."),M.setAttribute("id",P)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",I):I()}function Vh(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Dh(){const n=Vi()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function kh(){return!Dh()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Nh(){try{return typeof indexedDB=="object"}catch{return!1}}function Oh(){return new Promise((n,t)=>{try{let e=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{t(s.error?.message||"")}}catch(e){t(e)}})}const Mh="FirebaseError";class sn extends Error{constructor(t,e,r){super(e),this.code=t,this.customData=r,this.name=Mh,Object.setPrototypeOf(this,sn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Lc.prototype.create)}}class Lc{constructor(t,e,r){this.service=t,this.serviceName=e,this.errors=r}create(t,...e){const r=e[0]||{},s=`${this.service}/${t}`,o=this.errors[t],a=o?xh(o,r):"Error",u=`${this.serviceName}: ${a} (${s}).`;return new sn(s,u,r)}}function xh(n,t){return n.replace(Lh,(e,r)=>{const s=t[r];return s!=null?String(s):`<${r}?>`})}const Lh=/\{\$([^}]+)}/g;function jr(n,t){if(n===t)return!0;const e=Object.keys(n),r=Object.keys(t);for(const s of e){if(!r.includes(s))return!1;const o=n[s],a=t[s];if(Ia(o)&&Ia(a)){if(!jr(o,a))return!1}else if(o!==a)return!1}for(const s of r)if(!e.includes(s))return!1;return!0}function Ia(n){return n!==null&&typeof n=="object"}function Xe(n){return n&&n._delegate?n._delegate:n}class Fn{constructor(t,e,r){this.name=t,this.instanceFactory=e,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const Te="[DEFAULT]";class Fh{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const r=new Ah;if(this.instancesDeferred.set(e,r),this.isInitialized(e)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:e});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){const e=this.normalizeInstanceIdentifier(t?.identifier),r=t?.optional??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Uh(t))try{this.getOrInitializeService({instanceIdentifier:Te})}catch{}for(const[e,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(e);try{const o=this.getOrInitializeService({instanceIdentifier:s});r.resolve(o)}catch{}}}}clearInstance(t=Te){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=Te){return this.instances.has(t)}getOptions(t=Te){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,r=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:e});for(const[o,a]of this.instancesDeferred.entries()){const u=this.normalizeInstanceIdentifier(o);r===u&&a.resolve(s)}return s}onInit(t,e){const r=this.normalizeInstanceIdentifier(e),s=this.onInitCallbacks.get(r)??new Set;s.add(t),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&t(o,r),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const r=this.onInitCallbacks.get(e);if(r)for(const s of r)try{s(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Bh(t),options:e}),this.instances.set(t,r),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch{}return r||null}normalizeInstanceIdentifier(t=Te){return this.component?this.component.multipleInstances?t:Te:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Bh(n){return n===Te?void 0:n}function Uh(n){return n.instantiationMode==="EAGER"}class jh{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new Fh(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}var H;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(H||(H={}));const qh={debug:H.DEBUG,verbose:H.VERBOSE,info:H.INFO,warn:H.WARN,error:H.ERROR,silent:H.SILENT},$h=H.INFO,zh={[H.DEBUG]:"log",[H.VERBOSE]:"log",[H.INFO]:"info",[H.WARN]:"warn",[H.ERROR]:"error"},Gh=(n,t,...e)=>{if(t<n.logLevel)return;const r=new Date().toISOString(),s=zh[t];if(s)console[s](`[${r}]  ${n.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Fc{constructor(t){this.name=t,this._logLevel=$h,this._logHandler=Gh,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in H))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?qh[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,H.DEBUG,...t),this._logHandler(this,H.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,H.VERBOSE,...t),this._logHandler(this,H.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,H.INFO,...t),this._logHandler(this,H.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,H.WARN,...t),this._logHandler(this,H.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,H.ERROR,...t),this._logHandler(this,H.ERROR,...t)}}const Hh=(n,t)=>t.some(e=>n instanceof e);let wa,Aa;function Kh(){return wa||(wa=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Wh(){return Aa||(Aa=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Bc=new WeakMap,Zs=new WeakMap,Uc=new WeakMap,$s=new WeakMap,ki=new WeakMap;function Qh(n){const t=new Promise((e,r)=>{const s=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{e(ne(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",o),n.addEventListener("error",a)});return t.then(e=>{e instanceof IDBCursor&&Bc.set(e,n)}).catch(()=>{}),ki.set(t,n),t}function Xh(n){if(Zs.has(n))return;const t=new Promise((e,r)=>{const s=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{e(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});Zs.set(n,t)}let ti={get(n,t,e){if(n instanceof IDBTransaction){if(t==="done")return Zs.get(n);if(t==="objectStoreNames")return n.objectStoreNames||Uc.get(n);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return ne(n[t])},set(n,t,e){return n[t]=e,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function Jh(n){ti=n(ti)}function Yh(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const r=n.call(zs(this),t,...e);return Uc.set(r,t.sort?t.sort():[t]),ne(r)}:Wh().includes(n)?function(...t){return n.apply(zs(this),t),ne(Bc.get(this))}:function(...t){return ne(n.apply(zs(this),t))}}function Zh(n){return typeof n=="function"?Yh(n):(n instanceof IDBTransaction&&Xh(n),Hh(n,Kh())?new Proxy(n,ti):n)}function ne(n){if(n instanceof IDBRequest)return Qh(n);if($s.has(n))return $s.get(n);const t=Zh(n);return t!==n&&($s.set(n,t),ki.set(t,n)),t}const zs=n=>ki.get(n);function td(n,t,{blocked:e,upgrade:r,blocking:s,terminated:o}={}){const a=indexedDB.open(n,t),u=ne(a);return r&&a.addEventListener("upgradeneeded",h=>{r(ne(a.result),h.oldVersion,h.newVersion,ne(a.transaction),h)}),e&&a.addEventListener("blocked",h=>e(h.oldVersion,h.newVersion,h)),u.then(h=>{o&&h.addEventListener("close",()=>o()),s&&h.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),u}const ed=["get","getKey","getAll","getAllKeys","count"],nd=["put","add","delete","clear"],Gs=new Map;function Sa(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(Gs.get(t))return Gs.get(t);const e=t.replace(/FromIndex$/,""),r=t!==e,s=nd.includes(e);if(!(e in(r?IDBIndex:IDBObjectStore).prototype)||!(s||ed.includes(e)))return;const o=async function(a,...u){const h=this.transaction(a,s?"readwrite":"readonly");let d=h.store;return r&&(d=d.index(u.shift())),(await Promise.all([d[e](...u),s&&h.done]))[0]};return Gs.set(t,o),o}Jh(n=>({...n,get:(t,e,r)=>Sa(t,e)||n.get(t,e,r),has:(t,e)=>!!Sa(t,e)||n.has(t,e)}));class rd{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(sd(e)){const r=e.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(e=>e).join(" ")}}function sd(n){return n.getComponent()?.type==="VERSION"}const ei="@firebase/app",Ra="0.14.6";const Ht=new Fc("@firebase/app"),id="@firebase/app-compat",od="@firebase/analytics-compat",ad="@firebase/analytics",cd="@firebase/app-check-compat",ld="@firebase/app-check",ud="@firebase/auth",hd="@firebase/auth-compat",dd="@firebase/database",fd="@firebase/data-connect",md="@firebase/database-compat",gd="@firebase/functions",pd="@firebase/functions-compat",_d="@firebase/installations",yd="@firebase/installations-compat",Ed="@firebase/messaging",Td="@firebase/messaging-compat",vd="@firebase/performance",Id="@firebase/performance-compat",wd="@firebase/remote-config",Ad="@firebase/remote-config-compat",Sd="@firebase/storage",Rd="@firebase/storage-compat",Cd="@firebase/firestore",bd="@firebase/ai",Pd="@firebase/firestore-compat",Vd="firebase",Dd="12.6.0";const ni="[DEFAULT]",kd={[ei]:"fire-core",[id]:"fire-core-compat",[ad]:"fire-analytics",[od]:"fire-analytics-compat",[ld]:"fire-app-check",[cd]:"fire-app-check-compat",[ud]:"fire-auth",[hd]:"fire-auth-compat",[dd]:"fire-rtdb",[fd]:"fire-data-connect",[md]:"fire-rtdb-compat",[gd]:"fire-fn",[pd]:"fire-fn-compat",[_d]:"fire-iid",[yd]:"fire-iid-compat",[Ed]:"fire-fcm",[Td]:"fire-fcm-compat",[vd]:"fire-perf",[Id]:"fire-perf-compat",[wd]:"fire-rc",[Ad]:"fire-rc-compat",[Sd]:"fire-gcs",[Rd]:"fire-gcs-compat",[Cd]:"fire-fst",[Pd]:"fire-fst-compat",[bd]:"fire-vertex","fire-js":"fire-js",[Vd]:"fire-js-all"};const qr=new Map,Nd=new Map,ri=new Map;function Ca(n,t){try{n.container.addComponent(t)}catch(e){Ht.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,e)}}function $r(n){const t=n.name;if(ri.has(t))return Ht.debug(`There were multiple attempts to register component ${t}.`),!1;ri.set(t,n);for(const e of qr.values())Ca(e,n);for(const e of Nd.values())Ca(e,n);return!0}function Od(n,t){const e=n.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),n.container.getProvider(t)}function Md(n){return n==null?!1:n.settings!==void 0}const xd={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},re=new Lc("app","Firebase",xd);class Ld{constructor(t,e,r){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new Fn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw re.create("app-deleted",{appName:this._name})}}const Fd=Dd;function jc(n,t={}){let e=n;typeof t!="object"&&(t={name:t});const r={name:ni,automaticDataCollectionEnabled:!0,...t},s=r.name;if(typeof s!="string"||!s)throw re.create("bad-app-name",{appName:String(s)});if(e||(e=xc()),!e)throw re.create("no-options");const o=qr.get(s);if(o){if(jr(e,o.options)&&jr(r,o.config))return o;throw re.create("duplicate-app",{appName:s})}const a=new jh(s);for(const h of ri.values())a.addComponent(h);const u=new Ld(e,r,a);return qr.set(s,u),u}function Bd(n=ni){const t=qr.get(n);if(!t&&n===ni&&xc())return jc();if(!t)throw re.create("no-app",{appName:n});return t}function $e(n,t,e){let r=kd[n]??n;e&&(r+=`-${e}`);const s=r.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const a=[`Unable to register library "${r}" with version "${t}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Ht.warn(a.join(" "));return}$r(new Fn(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}const Ud="firebase-heartbeat-database",jd=1,Bn="firebase-heartbeat-store";let Hs=null;function qc(){return Hs||(Hs=td(Ud,jd,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(Bn)}catch(e){console.warn(e)}}}}).catch(n=>{throw re.create("idb-open",{originalErrorMessage:n.message})})),Hs}async function qd(n){try{const e=(await qc()).transaction(Bn),r=await e.objectStore(Bn).get($c(n));return await e.done,r}catch(t){if(t instanceof sn)Ht.warn(t.message);else{const e=re.create("idb-get",{originalErrorMessage:t?.message});Ht.warn(e.message)}}}async function ba(n,t){try{const r=(await qc()).transaction(Bn,"readwrite");await r.objectStore(Bn).put(t,$c(n)),await r.done}catch(e){if(e instanceof sn)Ht.warn(e.message);else{const r=re.create("idb-set",{originalErrorMessage:e?.message});Ht.warn(r.message)}}}function $c(n){return`${n.name}!${n.options.appId}`}const $d=1024,zd=30;class Gd{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Kd(e),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Pa();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:e}),this._heartbeatsCache.heartbeats.length>zd){const s=Wd(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){Ht.warn(t)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=Pa(),{heartbeatsToSend:e,unsentEntries:r}=Hd(this._heartbeatsCache.heartbeats),s=Ur(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return Ht.warn(t),""}}}function Pa(){return new Date().toISOString().substring(0,10)}function Hd(n,t=$d){const e=[];let r=n.slice();for(const s of n){const o=e.find(a=>a.agent===s.agent);if(o){if(o.dates.push(s.date),Va(e)>t){o.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),Va(e)>t){e.pop();break}r=r.slice(1)}return{heartbeatsToSend:e,unsentEntries:r}}class Kd{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Nh()?Oh().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await qd(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const r=await this.read();return ba(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const r=await this.read();return ba(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...t.heartbeats]})}else return}}function Va(n){return Ur(JSON.stringify({version:2,heartbeats:n})).length}function Wd(n){if(n.length===0)return-1;let t=0,e=n[0].date;for(let r=1;r<n.length;r++)n[r].date<e&&(e=n[r].date,t=r);return t}function Qd(n){$r(new Fn("platform-logger",t=>new rd(t),"PRIVATE")),$r(new Fn("heartbeat",t=>new Gd(t),"PRIVATE")),$e(ei,Ra,n),$e(ei,Ra,"esm2020"),$e("fire-js","")}Qd("");var Xd="firebase",Jd="12.6.0";$e(Xd,Jd,"app");var Da=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var se,zc;(function(){var n;function t(T,m){function _(){}_.prototype=m.prototype,T.F=m.prototype,T.prototype=new _,T.prototype.constructor=T,T.D=function(v,E,A){for(var g=Array(arguments.length-2),Rt=2;Rt<arguments.length;Rt++)g[Rt-2]=arguments[Rt];return m.prototype[E].apply(v,g)}}function e(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}t(r,e),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(T,m,_){_||(_=0);const v=Array(16);if(typeof m=="string")for(var E=0;E<16;++E)v[E]=m.charCodeAt(_++)|m.charCodeAt(_++)<<8|m.charCodeAt(_++)<<16|m.charCodeAt(_++)<<24;else for(E=0;E<16;++E)v[E]=m[_++]|m[_++]<<8|m[_++]<<16|m[_++]<<24;m=T.g[0],_=T.g[1],E=T.g[2];let A=T.g[3],g;g=m+(A^_&(E^A))+v[0]+3614090360&4294967295,m=_+(g<<7&4294967295|g>>>25),g=A+(E^m&(_^E))+v[1]+3905402710&4294967295,A=m+(g<<12&4294967295|g>>>20),g=E+(_^A&(m^_))+v[2]+606105819&4294967295,E=A+(g<<17&4294967295|g>>>15),g=_+(m^E&(A^m))+v[3]+3250441966&4294967295,_=E+(g<<22&4294967295|g>>>10),g=m+(A^_&(E^A))+v[4]+4118548399&4294967295,m=_+(g<<7&4294967295|g>>>25),g=A+(E^m&(_^E))+v[5]+1200080426&4294967295,A=m+(g<<12&4294967295|g>>>20),g=E+(_^A&(m^_))+v[6]+2821735955&4294967295,E=A+(g<<17&4294967295|g>>>15),g=_+(m^E&(A^m))+v[7]+4249261313&4294967295,_=E+(g<<22&4294967295|g>>>10),g=m+(A^_&(E^A))+v[8]+1770035416&4294967295,m=_+(g<<7&4294967295|g>>>25),g=A+(E^m&(_^E))+v[9]+2336552879&4294967295,A=m+(g<<12&4294967295|g>>>20),g=E+(_^A&(m^_))+v[10]+4294925233&4294967295,E=A+(g<<17&4294967295|g>>>15),g=_+(m^E&(A^m))+v[11]+2304563134&4294967295,_=E+(g<<22&4294967295|g>>>10),g=m+(A^_&(E^A))+v[12]+1804603682&4294967295,m=_+(g<<7&4294967295|g>>>25),g=A+(E^m&(_^E))+v[13]+4254626195&4294967295,A=m+(g<<12&4294967295|g>>>20),g=E+(_^A&(m^_))+v[14]+2792965006&4294967295,E=A+(g<<17&4294967295|g>>>15),g=_+(m^E&(A^m))+v[15]+1236535329&4294967295,_=E+(g<<22&4294967295|g>>>10),g=m+(E^A&(_^E))+v[1]+4129170786&4294967295,m=_+(g<<5&4294967295|g>>>27),g=A+(_^E&(m^_))+v[6]+3225465664&4294967295,A=m+(g<<9&4294967295|g>>>23),g=E+(m^_&(A^m))+v[11]+643717713&4294967295,E=A+(g<<14&4294967295|g>>>18),g=_+(A^m&(E^A))+v[0]+3921069994&4294967295,_=E+(g<<20&4294967295|g>>>12),g=m+(E^A&(_^E))+v[5]+3593408605&4294967295,m=_+(g<<5&4294967295|g>>>27),g=A+(_^E&(m^_))+v[10]+38016083&4294967295,A=m+(g<<9&4294967295|g>>>23),g=E+(m^_&(A^m))+v[15]+3634488961&4294967295,E=A+(g<<14&4294967295|g>>>18),g=_+(A^m&(E^A))+v[4]+3889429448&4294967295,_=E+(g<<20&4294967295|g>>>12),g=m+(E^A&(_^E))+v[9]+568446438&4294967295,m=_+(g<<5&4294967295|g>>>27),g=A+(_^E&(m^_))+v[14]+3275163606&4294967295,A=m+(g<<9&4294967295|g>>>23),g=E+(m^_&(A^m))+v[3]+4107603335&4294967295,E=A+(g<<14&4294967295|g>>>18),g=_+(A^m&(E^A))+v[8]+1163531501&4294967295,_=E+(g<<20&4294967295|g>>>12),g=m+(E^A&(_^E))+v[13]+2850285829&4294967295,m=_+(g<<5&4294967295|g>>>27),g=A+(_^E&(m^_))+v[2]+4243563512&4294967295,A=m+(g<<9&4294967295|g>>>23),g=E+(m^_&(A^m))+v[7]+1735328473&4294967295,E=A+(g<<14&4294967295|g>>>18),g=_+(A^m&(E^A))+v[12]+2368359562&4294967295,_=E+(g<<20&4294967295|g>>>12),g=m+(_^E^A)+v[5]+4294588738&4294967295,m=_+(g<<4&4294967295|g>>>28),g=A+(m^_^E)+v[8]+2272392833&4294967295,A=m+(g<<11&4294967295|g>>>21),g=E+(A^m^_)+v[11]+1839030562&4294967295,E=A+(g<<16&4294967295|g>>>16),g=_+(E^A^m)+v[14]+4259657740&4294967295,_=E+(g<<23&4294967295|g>>>9),g=m+(_^E^A)+v[1]+2763975236&4294967295,m=_+(g<<4&4294967295|g>>>28),g=A+(m^_^E)+v[4]+1272893353&4294967295,A=m+(g<<11&4294967295|g>>>21),g=E+(A^m^_)+v[7]+4139469664&4294967295,E=A+(g<<16&4294967295|g>>>16),g=_+(E^A^m)+v[10]+3200236656&4294967295,_=E+(g<<23&4294967295|g>>>9),g=m+(_^E^A)+v[13]+681279174&4294967295,m=_+(g<<4&4294967295|g>>>28),g=A+(m^_^E)+v[0]+3936430074&4294967295,A=m+(g<<11&4294967295|g>>>21),g=E+(A^m^_)+v[3]+3572445317&4294967295,E=A+(g<<16&4294967295|g>>>16),g=_+(E^A^m)+v[6]+76029189&4294967295,_=E+(g<<23&4294967295|g>>>9),g=m+(_^E^A)+v[9]+3654602809&4294967295,m=_+(g<<4&4294967295|g>>>28),g=A+(m^_^E)+v[12]+3873151461&4294967295,A=m+(g<<11&4294967295|g>>>21),g=E+(A^m^_)+v[15]+530742520&4294967295,E=A+(g<<16&4294967295|g>>>16),g=_+(E^A^m)+v[2]+3299628645&4294967295,_=E+(g<<23&4294967295|g>>>9),g=m+(E^(_|~A))+v[0]+4096336452&4294967295,m=_+(g<<6&4294967295|g>>>26),g=A+(_^(m|~E))+v[7]+1126891415&4294967295,A=m+(g<<10&4294967295|g>>>22),g=E+(m^(A|~_))+v[14]+2878612391&4294967295,E=A+(g<<15&4294967295|g>>>17),g=_+(A^(E|~m))+v[5]+4237533241&4294967295,_=E+(g<<21&4294967295|g>>>11),g=m+(E^(_|~A))+v[12]+1700485571&4294967295,m=_+(g<<6&4294967295|g>>>26),g=A+(_^(m|~E))+v[3]+2399980690&4294967295,A=m+(g<<10&4294967295|g>>>22),g=E+(m^(A|~_))+v[10]+4293915773&4294967295,E=A+(g<<15&4294967295|g>>>17),g=_+(A^(E|~m))+v[1]+2240044497&4294967295,_=E+(g<<21&4294967295|g>>>11),g=m+(E^(_|~A))+v[8]+1873313359&4294967295,m=_+(g<<6&4294967295|g>>>26),g=A+(_^(m|~E))+v[15]+4264355552&4294967295,A=m+(g<<10&4294967295|g>>>22),g=E+(m^(A|~_))+v[6]+2734768916&4294967295,E=A+(g<<15&4294967295|g>>>17),g=_+(A^(E|~m))+v[13]+1309151649&4294967295,_=E+(g<<21&4294967295|g>>>11),g=m+(E^(_|~A))+v[4]+4149444226&4294967295,m=_+(g<<6&4294967295|g>>>26),g=A+(_^(m|~E))+v[11]+3174756917&4294967295,A=m+(g<<10&4294967295|g>>>22),g=E+(m^(A|~_))+v[2]+718787259&4294967295,E=A+(g<<15&4294967295|g>>>17),g=_+(A^(E|~m))+v[9]+3951481745&4294967295,T.g[0]=T.g[0]+m&4294967295,T.g[1]=T.g[1]+(E+(g<<21&4294967295|g>>>11))&4294967295,T.g[2]=T.g[2]+E&4294967295,T.g[3]=T.g[3]+A&4294967295}r.prototype.v=function(T,m){m===void 0&&(m=T.length);const _=m-this.blockSize,v=this.C;let E=this.h,A=0;for(;A<m;){if(E==0)for(;A<=_;)s(this,T,A),A+=this.blockSize;if(typeof T=="string"){for(;A<m;)if(v[E++]=T.charCodeAt(A++),E==this.blockSize){s(this,v),E=0;break}}else for(;A<m;)if(v[E++]=T[A++],E==this.blockSize){s(this,v),E=0;break}}this.h=E,this.o+=m},r.prototype.A=function(){var T=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);T[0]=128;for(var m=1;m<T.length-8;++m)T[m]=0;m=this.o*8;for(var _=T.length-8;_<T.length;++_)T[_]=m&255,m/=256;for(this.v(T),T=Array(16),m=0,_=0;_<4;++_)for(let v=0;v<32;v+=8)T[m++]=this.g[_]>>>v&255;return T};function o(T,m){var _=u;return Object.prototype.hasOwnProperty.call(_,T)?_[T]:_[T]=m(T)}function a(T,m){this.h=m;const _=[];let v=!0;for(let E=T.length-1;E>=0;E--){const A=T[E]|0;v&&A==m||(_[E]=A,v=!1)}this.g=_}var u={};function h(T){return-128<=T&&T<128?o(T,function(m){return new a([m|0],m<0?-1:0)}):new a([T|0],T<0?-1:0)}function d(T){if(isNaN(T)||!isFinite(T))return I;if(T<0)return D(d(-T));const m=[];let _=1;for(let v=0;T>=_;v++)m[v]=T/_|0,_*=4294967296;return new a(m,0)}function y(T,m){if(T.length==0)throw Error("number format error: empty string");if(m=m||10,m<2||36<m)throw Error("radix out of range: "+m);if(T.charAt(0)=="-")return D(y(T.substring(1),m));if(T.indexOf("-")>=0)throw Error('number format error: interior "-" character');const _=d(Math.pow(m,8));let v=I;for(let A=0;A<T.length;A+=8){var E=Math.min(8,T.length-A);const g=parseInt(T.substring(A,A+E),m);E<8?(E=d(Math.pow(m,E)),v=v.j(E).add(d(g))):(v=v.j(_),v=v.add(d(g)))}return v}var I=h(0),R=h(1),P=h(16777216);n=a.prototype,n.m=function(){if(L(this))return-D(this).m();let T=0,m=1;for(let _=0;_<this.g.length;_++){const v=this.i(_);T+=(v>=0?v:4294967296+v)*m,m*=4294967296}return T},n.toString=function(T){if(T=T||10,T<2||36<T)throw Error("radix out of range: "+T);if(M(this))return"0";if(L(this))return"-"+D(this).toString(T);const m=d(Math.pow(T,6));var _=this;let v="";for(;;){const E=vt(_,m).g;_=K(_,E.j(m));let A=((_.g.length>0?_.g[0]:_.h)>>>0).toString(T);if(_=E,M(_))return A+v;for(;A.length<6;)A="0"+A;v=A+v}},n.i=function(T){return T<0?0:T<this.g.length?this.g[T]:this.h};function M(T){if(T.h!=0)return!1;for(let m=0;m<T.g.length;m++)if(T.g[m]!=0)return!1;return!0}function L(T){return T.h==-1}n.l=function(T){return T=K(this,T),L(T)?-1:M(T)?0:1};function D(T){const m=T.g.length,_=[];for(let v=0;v<m;v++)_[v]=~T.g[v];return new a(_,~T.h).add(R)}n.abs=function(){return L(this)?D(this):this},n.add=function(T){const m=Math.max(this.g.length,T.g.length),_=[];let v=0;for(let E=0;E<=m;E++){let A=v+(this.i(E)&65535)+(T.i(E)&65535),g=(A>>>16)+(this.i(E)>>>16)+(T.i(E)>>>16);v=g>>>16,A&=65535,g&=65535,_[E]=g<<16|A}return new a(_,_[_.length-1]&-2147483648?-1:0)};function K(T,m){return T.add(D(m))}n.j=function(T){if(M(this)||M(T))return I;if(L(this))return L(T)?D(this).j(D(T)):D(D(this).j(T));if(L(T))return D(this.j(D(T)));if(this.l(P)<0&&T.l(P)<0)return d(this.m()*T.m());const m=this.g.length+T.g.length,_=[];for(var v=0;v<2*m;v++)_[v]=0;for(v=0;v<this.g.length;v++)for(let E=0;E<T.g.length;E++){const A=this.i(v)>>>16,g=this.i(v)&65535,Rt=T.i(E)>>>16,me=T.i(E)&65535;_[2*v+2*E]+=g*me,W(_,2*v+2*E),_[2*v+2*E+1]+=A*me,W(_,2*v+2*E+1),_[2*v+2*E+1]+=g*Rt,W(_,2*v+2*E+1),_[2*v+2*E+2]+=A*Rt,W(_,2*v+2*E+2)}for(T=0;T<m;T++)_[T]=_[2*T+1]<<16|_[2*T];for(T=m;T<2*m;T++)_[T]=0;return new a(_,0)};function W(T,m){for(;(T[m]&65535)!=T[m];)T[m+1]+=T[m]>>>16,T[m]&=65535,m++}function Q(T,m){this.g=T,this.h=m}function vt(T,m){if(M(m))throw Error("division by zero");if(M(T))return new Q(I,I);if(L(T))return m=vt(D(T),m),new Q(D(m.g),D(m.h));if(L(m))return m=vt(T,D(m)),new Q(D(m.g),m.h);if(T.g.length>30){if(L(T)||L(m))throw Error("slowDivide_ only works with positive integers.");for(var _=R,v=m;v.l(T)<=0;)_=St(_),v=St(v);var E=ht(_,1),A=ht(v,1);for(v=ht(v,2),_=ht(_,2);!M(v);){var g=A.add(v);g.l(T)<=0&&(E=E.add(_),A=g),v=ht(v,1),_=ht(_,1)}return m=K(T,E.j(m)),new Q(E,m)}for(E=I;T.l(m)>=0;){for(_=Math.max(1,Math.floor(T.m()/m.m())),v=Math.ceil(Math.log(_)/Math.LN2),v=v<=48?1:Math.pow(2,v-48),A=d(_),g=A.j(m);L(g)||g.l(T)>0;)_-=v,A=d(_),g=A.j(m);M(A)&&(A=R),E=E.add(A),T=K(T,g)}return new Q(E,T)}n.B=function(T){return vt(this,T).h},n.and=function(T){const m=Math.max(this.g.length,T.g.length),_=[];for(let v=0;v<m;v++)_[v]=this.i(v)&T.i(v);return new a(_,this.h&T.h)},n.or=function(T){const m=Math.max(this.g.length,T.g.length),_=[];for(let v=0;v<m;v++)_[v]=this.i(v)|T.i(v);return new a(_,this.h|T.h)},n.xor=function(T){const m=Math.max(this.g.length,T.g.length),_=[];for(let v=0;v<m;v++)_[v]=this.i(v)^T.i(v);return new a(_,this.h^T.h)};function St(T){const m=T.g.length+1,_=[];for(let v=0;v<m;v++)_[v]=T.i(v)<<1|T.i(v-1)>>>31;return new a(_,T.h)}function ht(T,m){const _=m>>5;m%=32;const v=T.g.length-_,E=[];for(let A=0;A<v;A++)E[A]=m>0?T.i(A+_)>>>m|T.i(A+_+1)<<32-m:T.i(A+_);return new a(E,T.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,zc=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=y,se=a}).apply(typeof Da<"u"?Da:typeof self<"u"?self:typeof window<"u"?window:{});var Ir=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Gc,Rn,Hc,Vr,si,Kc,Wc,Qc;(function(){var n,t=Object.defineProperty;function e(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof Ir=="object"&&Ir];for(var c=0;c<i.length;++c){var l=i[c];if(l&&l.Math==Math)return l}throw Error("Cannot find global object")}var r=e(this);function s(i,c){if(c)t:{var l=r;i=i.split(".");for(var f=0;f<i.length-1;f++){var w=i[f];if(!(w in l))break t;l=l[w]}i=i[i.length-1],f=l[i],c=c(f),c!=f&&c!=null&&t(l,i,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(i){return i||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(i){return i||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(i){return i||function(c){var l=[],f;for(f in c)Object.prototype.hasOwnProperty.call(c,f)&&l.push([f,c[f]]);return l}});var o=o||{},a=this||self;function u(i){var c=typeof i;return c=="object"&&i!=null||c=="function"}function h(i,c,l){return i.call.apply(i.bind,arguments)}function d(i,c,l){return d=h,d.apply(null,arguments)}function y(i,c){var l=Array.prototype.slice.call(arguments,1);return function(){var f=l.slice();return f.push.apply(f,arguments),i.apply(this,f)}}function I(i,c){function l(){}l.prototype=c.prototype,i.Z=c.prototype,i.prototype=new l,i.prototype.constructor=i,i.Ob=function(f,w,S){for(var V=Array(arguments.length-2),q=2;q<arguments.length;q++)V[q-2]=arguments[q];return c.prototype[w].apply(f,V)}}var R=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?i=>i&&AsyncContext.Snapshot.wrap(i):i=>i;function P(i){const c=i.length;if(c>0){const l=Array(c);for(let f=0;f<c;f++)l[f]=i[f];return l}return[]}function M(i,c){for(let f=1;f<arguments.length;f++){const w=arguments[f];var l=typeof w;if(l=l!="object"?l:w?Array.isArray(w)?"array":l:"null",l=="array"||l=="object"&&typeof w.length=="number"){l=i.length||0;const S=w.length||0;i.length=l+S;for(let V=0;V<S;V++)i[l+V]=w[V]}else i.push(w)}}class L{constructor(c,l){this.i=c,this.j=l,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function D(i){a.setTimeout(()=>{throw i},0)}function K(){var i=T;let c=null;return i.g&&(c=i.g,i.g=i.g.next,i.g||(i.h=null),c.next=null),c}class W{constructor(){this.h=this.g=null}add(c,l){const f=Q.get();f.set(c,l),this.h?this.h.next=f:this.g=f,this.h=f}}var Q=new L(()=>new vt,i=>i.reset());class vt{constructor(){this.next=this.g=this.h=null}set(c,l){this.h=c,this.g=l,this.next=null}reset(){this.next=this.g=this.h=null}}let St,ht=!1,T=new W,m=()=>{const i=Promise.resolve(void 0);St=()=>{i.then(_)}};function _(){for(var i;i=K();){try{i.h.call(i.g)}catch(l){D(l)}var c=Q;c.j(i),c.h<100&&(c.h++,i.next=c.g,c.g=i)}ht=!1}function v(){this.u=this.u,this.C=this.C}v.prototype.u=!1,v.prototype.dispose=function(){this.u||(this.u=!0,this.N())},v.prototype[Symbol.dispose]=function(){this.dispose()},v.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function E(i,c){this.type=i,this.g=this.target=c,this.defaultPrevented=!1}E.prototype.h=function(){this.defaultPrevented=!0};var A=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var i=!1,c=Object.defineProperty({},"passive",{get:function(){i=!0}});try{const l=()=>{};a.addEventListener("test",l,c),a.removeEventListener("test",l,c)}catch{}return i})();function g(i){return/^[\s\xa0]*$/.test(i)}function Rt(i,c){E.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i&&this.init(i,c)}I(Rt,E),Rt.prototype.init=function(i,c){const l=this.type=i.type,f=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;this.target=i.target||i.srcElement,this.g=c,c=i.relatedTarget,c||(l=="mouseover"?c=i.fromElement:l=="mouseout"&&(c=i.toElement)),this.relatedTarget=c,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=i.pointerType,this.state=i.state,this.i=i,i.defaultPrevented&&Rt.Z.h.call(this)},Rt.prototype.h=function(){Rt.Z.h.call(this);const i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var me="closure_listenable_"+(Math.random()*1e6|0),Mu=0;function xu(i,c,l,f,w){this.listener=i,this.proxy=null,this.src=c,this.type=l,this.capture=!!f,this.ha=w,this.key=++Mu,this.da=this.fa=!1}function ar(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function cr(i,c,l){for(const f in i)c.call(l,i[f],f,i)}function Lu(i,c){for(const l in i)c.call(void 0,i[l],l,i)}function Eo(i){const c={};for(const l in i)c[l]=i[l];return c}const To="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function vo(i,c){let l,f;for(let w=1;w<arguments.length;w++){f=arguments[w];for(l in f)i[l]=f[l];for(let S=0;S<To.length;S++)l=To[S],Object.prototype.hasOwnProperty.call(f,l)&&(i[l]=f[l])}}function lr(i){this.src=i,this.g={},this.h=0}lr.prototype.add=function(i,c,l,f,w){const S=i.toString();i=this.g[S],i||(i=this.g[S]=[],this.h++);const V=Ts(i,c,f,w);return V>-1?(c=i[V],l||(c.fa=!1)):(c=new xu(c,this.src,S,!!f,w),c.fa=l,i.push(c)),c};function Es(i,c){const l=c.type;if(l in i.g){var f=i.g[l],w=Array.prototype.indexOf.call(f,c,void 0),S;(S=w>=0)&&Array.prototype.splice.call(f,w,1),S&&(ar(c),i.g[l].length==0&&(delete i.g[l],i.h--))}}function Ts(i,c,l,f){for(let w=0;w<i.length;++w){const S=i[w];if(!S.da&&S.listener==c&&S.capture==!!l&&S.ha==f)return w}return-1}var vs="closure_lm_"+(Math.random()*1e6|0),Is={};function Io(i,c,l,f,w){if(Array.isArray(c)){for(let S=0;S<c.length;S++)Io(i,c[S],l,f,w);return null}return l=So(l),i&&i[me]?i.J(c,l,u(f)?!!f.capture:!1,w):Fu(i,c,l,!1,f,w)}function Fu(i,c,l,f,w,S){if(!c)throw Error("Invalid event type");const V=u(w)?!!w.capture:!!w;let q=As(i);if(q||(i[vs]=q=new lr(i)),l=q.add(c,l,f,V,S),l.proxy)return l;if(f=Bu(),l.proxy=f,f.src=i,f.listener=l,i.addEventListener)A||(w=V),w===void 0&&(w=!1),i.addEventListener(c.toString(),f,w);else if(i.attachEvent)i.attachEvent(Ao(c.toString()),f);else if(i.addListener&&i.removeListener)i.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return l}function Bu(){function i(l){return c.call(i.src,i.listener,l)}const c=Uu;return i}function wo(i,c,l,f,w){if(Array.isArray(c))for(var S=0;S<c.length;S++)wo(i,c[S],l,f,w);else f=u(f)?!!f.capture:!!f,l=So(l),i&&i[me]?(i=i.i,S=String(c).toString(),S in i.g&&(c=i.g[S],l=Ts(c,l,f,w),l>-1&&(ar(c[l]),Array.prototype.splice.call(c,l,1),c.length==0&&(delete i.g[S],i.h--)))):i&&(i=As(i))&&(c=i.g[c.toString()],i=-1,c&&(i=Ts(c,l,f,w)),(l=i>-1?c[i]:null)&&ws(l))}function ws(i){if(typeof i!="number"&&i&&!i.da){var c=i.src;if(c&&c[me])Es(c.i,i);else{var l=i.type,f=i.proxy;c.removeEventListener?c.removeEventListener(l,f,i.capture):c.detachEvent?c.detachEvent(Ao(l),f):c.addListener&&c.removeListener&&c.removeListener(f),(l=As(c))?(Es(l,i),l.h==0&&(l.src=null,c[vs]=null)):ar(i)}}}function Ao(i){return i in Is?Is[i]:Is[i]="on"+i}function Uu(i,c){if(i.da)i=!0;else{c=new Rt(c,this);const l=i.listener,f=i.ha||i.src;i.fa&&ws(i),i=l.call(f,c)}return i}function As(i){return i=i[vs],i instanceof lr?i:null}var Ss="__closure_events_fn_"+(Math.random()*1e9>>>0);function So(i){return typeof i=="function"?i:(i[Ss]||(i[Ss]=function(c){return i.handleEvent(c)}),i[Ss])}function _t(){v.call(this),this.i=new lr(this),this.M=this,this.G=null}I(_t,v),_t.prototype[me]=!0,_t.prototype.removeEventListener=function(i,c,l,f){wo(this,i,c,l,f)};function It(i,c){var l,f=i.G;if(f)for(l=[];f;f=f.G)l.push(f);if(i=i.M,f=c.type||c,typeof c=="string")c=new E(c,i);else if(c instanceof E)c.target=c.target||i;else{var w=c;c=new E(f,i),vo(c,w)}w=!0;let S,V;if(l)for(V=l.length-1;V>=0;V--)S=c.g=l[V],w=ur(S,f,!0,c)&&w;if(S=c.g=i,w=ur(S,f,!0,c)&&w,w=ur(S,f,!1,c)&&w,l)for(V=0;V<l.length;V++)S=c.g=l[V],w=ur(S,f,!1,c)&&w}_t.prototype.N=function(){if(_t.Z.N.call(this),this.i){var i=this.i;for(const c in i.g){const l=i.g[c];for(let f=0;f<l.length;f++)ar(l[f]);delete i.g[c],i.h--}}this.G=null},_t.prototype.J=function(i,c,l,f){return this.i.add(String(i),c,!1,l,f)},_t.prototype.K=function(i,c,l,f){return this.i.add(String(i),c,!0,l,f)};function ur(i,c,l,f){if(c=i.i.g[String(c)],!c)return!0;c=c.concat();let w=!0;for(let S=0;S<c.length;++S){const V=c[S];if(V&&!V.da&&V.capture==l){const q=V.listener,at=V.ha||V.src;V.fa&&Es(i.i,V),w=q.call(at,f)!==!1&&w}}return w&&!f.defaultPrevented}function ju(i,c){if(typeof i!="function")if(i&&typeof i.handleEvent=="function")i=d(i.handleEvent,i);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(i,c||0)}function Ro(i){i.g=ju(()=>{i.g=null,i.i&&(i.i=!1,Ro(i))},i.l);const c=i.h;i.h=null,i.m.apply(null,c)}class qu extends v{constructor(c,l){super(),this.m=c,this.l=l,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:Ro(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function un(i){v.call(this),this.h=i,this.g={}}I(un,v);var Co=[];function bo(i){cr(i.g,function(c,l){this.g.hasOwnProperty(l)&&ws(c)},i),i.g={}}un.prototype.N=function(){un.Z.N.call(this),bo(this)},un.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Rs=a.JSON.stringify,$u=a.JSON.parse,zu=class{stringify(i){return a.JSON.stringify(i,void 0)}parse(i){return a.JSON.parse(i,void 0)}};function Po(){}function Vo(){}var hn={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function Cs(){E.call(this,"d")}I(Cs,E);function bs(){E.call(this,"c")}I(bs,E);var ge={},Do=null;function hr(){return Do=Do||new _t}ge.Ia="serverreachability";function ko(i){E.call(this,ge.Ia,i)}I(ko,E);function dn(i){const c=hr();It(c,new ko(c))}ge.STAT_EVENT="statevent";function No(i,c){E.call(this,ge.STAT_EVENT,i),this.stat=c}I(No,E);function wt(i){const c=hr();It(c,new No(c,i))}ge.Ja="timingevent";function Oo(i,c){E.call(this,ge.Ja,i),this.size=c}I(Oo,E);function fn(i,c){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){i()},c)}function mn(){this.g=!0}mn.prototype.ua=function(){this.g=!1};function Gu(i,c,l,f,w,S){i.info(function(){if(i.g)if(S){var V="",q=S.split("&");for(let J=0;J<q.length;J++){var at=q[J].split("=");if(at.length>1){const dt=at[0];at=at[1];const xt=dt.split("_");V=xt.length>=2&&xt[1]=="type"?V+(dt+"="+at+"&"):V+(dt+"=redacted&")}}}else V=null;else V=S;return"XMLHTTP REQ ("+f+") [attempt "+w+"]: "+c+`
`+l+`
`+V})}function Hu(i,c,l,f,w,S,V){i.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+w+"]: "+c+`
`+l+`
`+S+" "+V})}function Ne(i,c,l,f){i.info(function(){return"XMLHTTP TEXT ("+c+"): "+Wu(i,l)+(f?" "+f:"")})}function Ku(i,c){i.info(function(){return"TIMEOUT: "+c})}mn.prototype.info=function(){};function Wu(i,c){if(!i.g)return c;if(!c)return null;try{const S=JSON.parse(c);if(S){for(i=0;i<S.length;i++)if(Array.isArray(S[i])){var l=S[i];if(!(l.length<2)){var f=l[1];if(Array.isArray(f)&&!(f.length<1)){var w=f[0];if(w!="noop"&&w!="stop"&&w!="close")for(let V=1;V<f.length;V++)f[V]=""}}}}return Rs(S)}catch{return c}}var dr={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},Mo={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},xo;function Ps(){}I(Ps,Po),Ps.prototype.g=function(){return new XMLHttpRequest},xo=new Ps;function gn(i){return encodeURIComponent(String(i))}function Qu(i){var c=1;i=i.split(":");const l=[];for(;c>0&&i.length;)l.push(i.shift()),c--;return i.length&&l.push(i.join(":")),l}function Qt(i,c,l,f){this.j=i,this.i=c,this.l=l,this.S=f||1,this.V=new un(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Lo}function Lo(){this.i=null,this.g="",this.h=!1}var Fo={},Vs={};function Ds(i,c,l){i.M=1,i.A=mr(Mt(c)),i.u=l,i.R=!0,Bo(i,null)}function Bo(i,c){i.F=Date.now(),fr(i),i.B=Mt(i.A);var l=i.B,f=i.S;Array.isArray(f)||(f=[String(f)]),Yo(l.i,"t",f),i.C=0,l=i.j.L,i.h=new Lo,i.g=pa(i.j,l?c:null,!i.u),i.P>0&&(i.O=new qu(d(i.Y,i,i.g),i.P)),c=i.V,l=i.g,f=i.ba;var w="readystatechange";Array.isArray(w)||(w&&(Co[0]=w.toString()),w=Co);for(let S=0;S<w.length;S++){const V=Io(l,w[S],f||c.handleEvent,!1,c.h||c);if(!V)break;c.g[V.key]=V}c=i.J?Eo(i.J):{},i.u?(i.v||(i.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.B,i.v,i.u,c)):(i.v="GET",i.g.ea(i.B,i.v,null,c)),dn(),Gu(i.i,i.v,i.B,i.l,i.S,i.u)}Qt.prototype.ba=function(i){i=i.target;const c=this.O;c&&Yt(i)==3?c.j():this.Y(i)},Qt.prototype.Y=function(i){try{if(i==this.g)t:{const q=Yt(this.g),at=this.g.ya(),J=this.g.ca();if(!(q<3)&&(q!=3||this.g&&(this.h.h||this.g.la()||ia(this.g)))){this.K||q!=4||at==7||(at==8||J<=0?dn(3):dn(2)),ks(this);var c=this.g.ca();this.X=c;var l=Xu(this);if(this.o=c==200,Hu(this.i,this.v,this.B,this.l,this.S,q,c),this.o){if(this.U&&!this.L){e:{if(this.g){var f,w=this.g;if((f=w.g?w.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!g(f)){var S=f;break e}}S=null}if(i=S)Ne(this.i,this.l,i,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Ns(this,i);else{this.o=!1,this.m=3,wt(12),pe(this),pn(this);break t}}if(this.R){i=!0;let dt;for(;!this.K&&this.C<l.length;)if(dt=Ju(this,l),dt==Vs){q==4&&(this.m=4,wt(14),i=!1),Ne(this.i,this.l,null,"[Incomplete Response]");break}else if(dt==Fo){this.m=4,wt(15),Ne(this.i,this.l,l,"[Invalid Chunk]"),i=!1;break}else Ne(this.i,this.l,dt,null),Ns(this,dt);if(Uo(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),q!=4||l.length!=0||this.h.h||(this.m=1,wt(16),i=!1),this.o=this.o&&i,!i)Ne(this.i,this.l,l,"[Invalid Chunked Response]"),pe(this),pn(this);else if(l.length>0&&!this.W){this.W=!0;var V=this.j;V.g==this&&V.aa&&!V.P&&(V.j.info("Great, no buffering proxy detected. Bytes received: "+l.length),js(V),V.P=!0,wt(11))}}else Ne(this.i,this.l,l,null),Ns(this,l);q==4&&pe(this),this.o&&!this.K&&(q==4?da(this.j,this):(this.o=!1,fr(this)))}else hh(this.g),c==400&&l.indexOf("Unknown SID")>0?(this.m=3,wt(12)):(this.m=0,wt(13)),pe(this),pn(this)}}}catch{}finally{}};function Xu(i){if(!Uo(i))return i.g.la();const c=ia(i.g);if(c==="")return"";let l="";const f=c.length,w=Yt(i.g)==4;if(!i.h.i){if(typeof TextDecoder>"u")return pe(i),pn(i),"";i.h.i=new a.TextDecoder}for(let S=0;S<f;S++)i.h.h=!0,l+=i.h.i.decode(c[S],{stream:!(w&&S==f-1)});return c.length=0,i.h.g+=l,i.C=0,i.h.g}function Uo(i){return i.g?i.v=="GET"&&i.M!=2&&i.j.Aa:!1}function Ju(i,c){var l=i.C,f=c.indexOf(`
`,l);return f==-1?Vs:(l=Number(c.substring(l,f)),isNaN(l)?Fo:(f+=1,f+l>c.length?Vs:(c=c.slice(f,f+l),i.C=f+l,c)))}Qt.prototype.cancel=function(){this.K=!0,pe(this)};function fr(i){i.T=Date.now()+i.H,jo(i,i.H)}function jo(i,c){if(i.D!=null)throw Error("WatchDog timer not null");i.D=fn(d(i.aa,i),c)}function ks(i){i.D&&(a.clearTimeout(i.D),i.D=null)}Qt.prototype.aa=function(){this.D=null;const i=Date.now();i-this.T>=0?(Ku(this.i,this.B),this.M!=2&&(dn(),wt(17)),pe(this),this.m=2,pn(this)):jo(this,this.T-i)};function pn(i){i.j.I==0||i.K||da(i.j,i)}function pe(i){ks(i);var c=i.O;c&&typeof c.dispose=="function"&&c.dispose(),i.O=null,bo(i.V),i.g&&(c=i.g,i.g=null,c.abort(),c.dispose())}function Ns(i,c){try{var l=i.j;if(l.I!=0&&(l.g==i||Os(l.h,i))){if(!i.L&&Os(l.h,i)&&l.I==3){try{var f=l.Ba.g.parse(c)}catch{f=null}if(Array.isArray(f)&&f.length==3){var w=f;if(w[0]==0){t:if(!l.v){if(l.g)if(l.g.F+3e3<i.F)Er(l),_r(l);else break t;Us(l),wt(18)}}else l.xa=w[1],0<l.xa-l.K&&w[2]<37500&&l.F&&l.A==0&&!l.C&&(l.C=fn(d(l.Va,l),6e3));zo(l.h)<=1&&l.ta&&(l.ta=void 0)}else ye(l,11)}else if((i.L||l.g==i)&&Er(l),!g(c))for(w=l.Ba.g.parse(c),c=0;c<w.length;c++){let J=w[c];const dt=J[0];if(!(dt<=l.K))if(l.K=dt,J=J[1],l.I==2)if(J[0]=="c"){l.M=J[1],l.ba=J[2];const xt=J[3];xt!=null&&(l.ka=xt,l.j.info("VER="+l.ka));const Ee=J[4];Ee!=null&&(l.za=Ee,l.j.info("SVER="+l.za));const Zt=J[5];Zt!=null&&typeof Zt=="number"&&Zt>0&&(f=1.5*Zt,l.O=f,l.j.info("backChannelRequestTimeoutMs_="+f)),f=l;const te=i.g;if(te){const vr=te.g?te.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(vr){var S=f.h;S.g||vr.indexOf("spdy")==-1&&vr.indexOf("quic")==-1&&vr.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(Ms(S,S.h),S.h=null))}if(f.G){const qs=te.g?te.g.getResponseHeader("X-HTTP-Session-Id"):null;qs&&(f.wa=qs,Y(f.J,f.G,qs))}}l.I=3,l.l&&l.l.ra(),l.aa&&(l.T=Date.now()-i.F,l.j.info("Handshake RTT: "+l.T+"ms")),f=l;var V=i;if(f.na=ga(f,f.L?f.ba:null,f.W),V.L){Go(f.h,V);var q=V,at=f.O;at&&(q.H=at),q.D&&(ks(q),fr(q)),f.g=V}else ua(f);l.i.length>0&&yr(l)}else J[0]!="stop"&&J[0]!="close"||ye(l,7);else l.I==3&&(J[0]=="stop"||J[0]=="close"?J[0]=="stop"?ye(l,7):Bs(l):J[0]!="noop"&&l.l&&l.l.qa(J),l.A=0)}}dn(4)}catch{}}var Yu=class{constructor(i,c){this.g=i,this.map=c}};function qo(i){this.l=i||10,a.PerformanceNavigationTiming?(i=a.performance.getEntriesByType("navigation"),i=i.length>0&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function $o(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function zo(i){return i.h?1:i.g?i.g.size:0}function Os(i,c){return i.h?i.h==c:i.g?i.g.has(c):!1}function Ms(i,c){i.g?i.g.add(c):i.h=c}function Go(i,c){i.h&&i.h==c?i.h=null:i.g&&i.g.has(c)&&i.g.delete(c)}qo.prototype.cancel=function(){if(this.i=Ho(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function Ho(i){if(i.h!=null)return i.i.concat(i.h.G);if(i.g!=null&&i.g.size!==0){let c=i.i;for(const l of i.g.values())c=c.concat(l.G);return c}return P(i.i)}var Ko=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Zu(i,c){if(i){i=i.split("&");for(let l=0;l<i.length;l++){const f=i[l].indexOf("=");let w,S=null;f>=0?(w=i[l].substring(0,f),S=i[l].substring(f+1)):w=i[l],c(w,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}function Xt(i){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;i instanceof Xt?(this.l=i.l,_n(this,i.j),this.o=i.o,this.g=i.g,yn(this,i.u),this.h=i.h,xs(this,Zo(i.i)),this.m=i.m):i&&(c=String(i).match(Ko))?(this.l=!1,_n(this,c[1]||"",!0),this.o=En(c[2]||""),this.g=En(c[3]||"",!0),yn(this,c[4]),this.h=En(c[5]||"",!0),xs(this,c[6]||"",!0),this.m=En(c[7]||"")):(this.l=!1,this.i=new vn(null,this.l))}Xt.prototype.toString=function(){const i=[];var c=this.j;c&&i.push(Tn(c,Wo,!0),":");var l=this.g;return(l||c=="file")&&(i.push("//"),(c=this.o)&&i.push(Tn(c,Wo,!0),"@"),i.push(gn(l).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),l=this.u,l!=null&&i.push(":",String(l))),(l=this.h)&&(this.g&&l.charAt(0)!="/"&&i.push("/"),i.push(Tn(l,l.charAt(0)=="/"?nh:eh,!0))),(l=this.i.toString())&&i.push("?",l),(l=this.m)&&i.push("#",Tn(l,sh)),i.join("")},Xt.prototype.resolve=function(i){const c=Mt(this);let l=!!i.j;l?_n(c,i.j):l=!!i.o,l?c.o=i.o:l=!!i.g,l?c.g=i.g:l=i.u!=null;var f=i.h;if(l)yn(c,i.u);else if(l=!!i.h){if(f.charAt(0)!="/")if(this.g&&!this.h)f="/"+f;else{var w=c.h.lastIndexOf("/");w!=-1&&(f=c.h.slice(0,w+1)+f)}if(w=f,w==".."||w==".")f="";else if(w.indexOf("./")!=-1||w.indexOf("/.")!=-1){f=w.lastIndexOf("/",0)==0,w=w.split("/");const S=[];for(let V=0;V<w.length;){const q=w[V++];q=="."?f&&V==w.length&&S.push(""):q==".."?((S.length>1||S.length==1&&S[0]!="")&&S.pop(),f&&V==w.length&&S.push("")):(S.push(q),f=!0)}f=S.join("/")}else f=w}return l?c.h=f:l=i.i.toString()!=="",l?xs(c,Zo(i.i)):l=!!i.m,l&&(c.m=i.m),c};function Mt(i){return new Xt(i)}function _n(i,c,l){i.j=l?En(c,!0):c,i.j&&(i.j=i.j.replace(/:$/,""))}function yn(i,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);i.u=c}else i.u=null}function xs(i,c,l){c instanceof vn?(i.i=c,ih(i.i,i.l)):(l||(c=Tn(c,rh)),i.i=new vn(c,i.l))}function Y(i,c,l){i.i.set(c,l)}function mr(i){return Y(i,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),i}function En(i,c){return i?c?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function Tn(i,c,l){return typeof i=="string"?(i=encodeURI(i).replace(c,th),l&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function th(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var Wo=/[#\/\?@]/g,eh=/[#\?:]/g,nh=/[#\?]/g,rh=/[#\?@]/g,sh=/#/g;function vn(i,c){this.h=this.g=null,this.i=i||null,this.j=!!c}function _e(i){i.g||(i.g=new Map,i.h=0,i.i&&Zu(i.i,function(c,l){i.add(decodeURIComponent(c.replace(/\+/g," ")),l)}))}n=vn.prototype,n.add=function(i,c){_e(this),this.i=null,i=Oe(this,i);let l=this.g.get(i);return l||this.g.set(i,l=[]),l.push(c),this.h+=1,this};function Qo(i,c){_e(i),c=Oe(i,c),i.g.has(c)&&(i.i=null,i.h-=i.g.get(c).length,i.g.delete(c))}function Xo(i,c){return _e(i),c=Oe(i,c),i.g.has(c)}n.forEach=function(i,c){_e(this),this.g.forEach(function(l,f){l.forEach(function(w){i.call(c,w,f,this)},this)},this)};function Jo(i,c){_e(i);let l=[];if(typeof c=="string")Xo(i,c)&&(l=l.concat(i.g.get(Oe(i,c))));else for(i=Array.from(i.g.values()),c=0;c<i.length;c++)l=l.concat(i[c]);return l}n.set=function(i,c){return _e(this),this.i=null,i=Oe(this,i),Xo(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[c]),this.h+=1,this},n.get=function(i,c){return i?(i=Jo(this,i),i.length>0?String(i[0]):c):c};function Yo(i,c,l){Qo(i,c),l.length>0&&(i.i=null,i.g.set(Oe(i,c),P(l)),i.h+=l.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],c=Array.from(this.g.keys());for(let f=0;f<c.length;f++){var l=c[f];const w=gn(l);l=Jo(this,l);for(let S=0;S<l.length;S++){let V=w;l[S]!==""&&(V+="="+gn(l[S])),i.push(V)}}return this.i=i.join("&")};function Zo(i){const c=new vn;return c.i=i.i,i.g&&(c.g=new Map(i.g),c.h=i.h),c}function Oe(i,c){return c=String(c),i.j&&(c=c.toLowerCase()),c}function ih(i,c){c&&!i.j&&(_e(i),i.i=null,i.g.forEach(function(l,f){const w=f.toLowerCase();f!=w&&(Qo(this,f),Yo(this,w,l))},i)),i.j=c}function oh(i,c){const l=new mn;if(a.Image){const f=new Image;f.onload=y(Jt,l,"TestLoadImage: loaded",!0,c,f),f.onerror=y(Jt,l,"TestLoadImage: error",!1,c,f),f.onabort=y(Jt,l,"TestLoadImage: abort",!1,c,f),f.ontimeout=y(Jt,l,"TestLoadImage: timeout",!1,c,f),a.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=i}else c(!1)}function ah(i,c){const l=new mn,f=new AbortController,w=setTimeout(()=>{f.abort(),Jt(l,"TestPingServer: timeout",!1,c)},1e4);fetch(i,{signal:f.signal}).then(S=>{clearTimeout(w),S.ok?Jt(l,"TestPingServer: ok",!0,c):Jt(l,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(w),Jt(l,"TestPingServer: error",!1,c)})}function Jt(i,c,l,f,w){try{w&&(w.onload=null,w.onerror=null,w.onabort=null,w.ontimeout=null),f(l)}catch{}}function ch(){this.g=new zu}function Ls(i){this.i=i.Sb||null,this.h=i.ab||!1}I(Ls,Po),Ls.prototype.g=function(){return new gr(this.i,this.h)};function gr(i,c){_t.call(this),this.H=i,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}I(gr,_t),n=gr.prototype,n.open=function(i,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=i,this.D=c,this.readyState=1,wn(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};i&&(c.body=i),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,In(this)),this.readyState=0},n.Pa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,wn(this)),this.g&&(this.readyState=3,wn(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;ta(this)}else i.text().then(this.Oa.bind(this),this.ga.bind(this))};function ta(i){i.j.read().then(i.Ma.bind(i)).catch(i.ga.bind(i))}n.Ma=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var c=i.value?i.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!i.done}))&&(this.response=this.responseText+=c)}i.done?In(this):wn(this),this.readyState==3&&ta(this)}},n.Oa=function(i){this.g&&(this.response=this.responseText=i,In(this))},n.Na=function(i){this.g&&(this.response=i,In(this))},n.ga=function(){this.g&&In(this)};function In(i){i.readyState=4,i.l=null,i.j=null,i.B=null,wn(i)}n.setRequestHeader=function(i,c){this.A.append(i,c)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],c=this.h.entries();for(var l=c.next();!l.done;)l=l.value,i.push(l[0]+": "+l[1]),l=c.next();return i.join(`\r
`)};function wn(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(gr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function ea(i){let c="";return cr(i,function(l,f){c+=f,c+=":",c+=l,c+=`\r
`}),c}function Fs(i,c,l){t:{for(f in l){var f=!1;break t}f=!0}f||(l=ea(l),typeof i=="string"?l!=null&&gn(l):Y(i,c,l))}function nt(i){_t.call(this),this.headers=new Map,this.L=i||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}I(nt,_t);var lh=/^https?$/i,uh=["POST","PUT"];n=nt.prototype,n.Fa=function(i){this.H=i},n.ea=function(i,c,l,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);c=c?c.toUpperCase():"GET",this.D=i,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():xo.g(),this.g.onreadystatechange=R(d(this.Ca,this));try{this.B=!0,this.g.open(c,String(i),!0),this.B=!1}catch(S){na(this,S);return}if(i=l||"",l=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var w in f)l.set(w,f[w]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(const S of f.keys())l.set(S,f.get(S));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(l.keys()).find(S=>S.toLowerCase()=="content-type"),w=a.FormData&&i instanceof a.FormData,!(Array.prototype.indexOf.call(uh,c,void 0)>=0)||f||w||l.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[S,V]of l)this.g.setRequestHeader(S,V);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(i),this.v=!1}catch(S){na(this,S)}};function na(i,c){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=c,i.o=5,ra(i),pr(i)}function ra(i){i.A||(i.A=!0,It(i,"complete"),It(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=i||7,It(this,"complete"),It(this,"abort"),pr(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),pr(this,!0)),nt.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?sa(this):this.Xa())},n.Xa=function(){sa(this)};function sa(i){if(i.h&&typeof o<"u"){if(i.v&&Yt(i)==4)setTimeout(i.Ca.bind(i),0);else if(It(i,"readystatechange"),Yt(i)==4){i.h=!1;try{const S=i.ca();t:switch(S){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break t;default:c=!1}var l;if(!(l=c)){var f;if(f=S===0){let V=String(i.D).match(Ko)[1]||null;!V&&a.self&&a.self.location&&(V=a.self.location.protocol.slice(0,-1)),f=!lh.test(V?V.toLowerCase():"")}l=f}if(l)It(i,"complete"),It(i,"success");else{i.o=6;try{var w=Yt(i)>2?i.g.statusText:""}catch{w=""}i.l=w+" ["+i.ca()+"]",ra(i)}}finally{pr(i)}}}}function pr(i,c){if(i.g){i.m&&(clearTimeout(i.m),i.m=null);const l=i.g;i.g=null,c||It(i,"ready");try{l.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Yt(i){return i.g?i.g.readyState:0}n.ca=function(){try{return Yt(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(i){if(this.g){var c=this.g.responseText;return i&&c.indexOf(i)==0&&(c=c.substring(i.length)),$u(c)}};function ia(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.F){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function hh(i){const c={};i=(i.g&&Yt(i)>=2&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<i.length;f++){if(g(i[f]))continue;var l=Qu(i[f]);const w=l[0];if(l=l[1],typeof l!="string")continue;l=l.trim();const S=c[w]||[];c[w]=S,S.push(l)}Lu(c,function(f){return f.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function An(i,c,l){return l&&l.internalChannelParams&&l.internalChannelParams[i]||c}function oa(i){this.za=0,this.i=[],this.j=new mn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=An("failFast",!1,i),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=An("baseRetryDelayMs",5e3,i),this.Za=An("retryDelaySeedMs",1e4,i),this.Ta=An("forwardChannelMaxRetries",2,i),this.va=An("forwardChannelRequestTimeoutMs",2e4,i),this.ma=i&&i.xmlHttpFactory||void 0,this.Ua=i&&i.Rb||void 0,this.Aa=i&&i.useFetchStreams||!1,this.O=void 0,this.L=i&&i.supportsCrossDomainXhr||!1,this.M="",this.h=new qo(i&&i.concurrentRequestLimit),this.Ba=new ch,this.S=i&&i.fastHandshake||!1,this.R=i&&i.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=i&&i.Pb||!1,i&&i.ua&&this.j.ua(),i&&i.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&i&&i.detectBufferingProxy||!1,this.ia=void 0,i&&i.longPollingTimeout&&i.longPollingTimeout>0&&(this.ia=i.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=oa.prototype,n.ka=8,n.I=1,n.connect=function(i,c,l,f){wt(0),this.W=i,this.H=c||{},l&&f!==void 0&&(this.H.OSID=l,this.H.OAID=f),this.F=this.X,this.J=ga(this,null,this.W),yr(this)};function Bs(i){if(aa(i),i.I==3){var c=i.V++,l=Mt(i.J);if(Y(l,"SID",i.M),Y(l,"RID",c),Y(l,"TYPE","terminate"),Sn(i,l),c=new Qt(i,i.j,c),c.M=2,c.A=mr(Mt(l)),l=!1,a.navigator&&a.navigator.sendBeacon)try{l=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!l&&a.Image&&(new Image().src=c.A,l=!0),l||(c.g=pa(c.j,null),c.g.ea(c.A)),c.F=Date.now(),fr(c)}ma(i)}function _r(i){i.g&&(js(i),i.g.cancel(),i.g=null)}function aa(i){_r(i),i.v&&(a.clearTimeout(i.v),i.v=null),Er(i),i.h.cancel(),i.m&&(typeof i.m=="number"&&a.clearTimeout(i.m),i.m=null)}function yr(i){if(!$o(i.h)&&!i.m){i.m=!0;var c=i.Ea;St||m(),ht||(St(),ht=!0),T.add(c,i),i.D=0}}function dh(i,c){return zo(i.h)>=i.h.j-(i.m?1:0)?!1:i.m?(i.i=c.G.concat(i.i),!0):i.I==1||i.I==2||i.D>=(i.Sa?0:i.Ta)?!1:(i.m=fn(d(i.Ea,i,c),fa(i,i.D)),i.D++,!0)}n.Ea=function(i){if(this.m)if(this.m=null,this.I==1){if(!i){this.V=Math.floor(Math.random()*1e5),i=this.V++;const w=new Qt(this,this.j,i);let S=this.o;if(this.U&&(S?(S=Eo(S),vo(S,this.U)):S=this.U),this.u!==null||this.R||(w.J=S,S=null),this.S)t:{for(var c=0,l=0;l<this.i.length;l++){e:{var f=this.i[l];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break e}f=void 0}if(f===void 0)break;if(c+=f,c>4096){c=l;break t}if(c===4096||l===this.i.length-1){c=l+1;break t}}c=1e3}else c=1e3;c=la(this,w,c),l=Mt(this.J),Y(l,"RID",i),Y(l,"CVER",22),this.G&&Y(l,"X-HTTP-Session-Id",this.G),Sn(this,l),S&&(this.R?c="headers="+gn(ea(S))+"&"+c:this.u&&Fs(l,this.u,S)),Ms(this.h,w),this.Ra&&Y(l,"TYPE","init"),this.S?(Y(l,"$req",c),Y(l,"SID","null"),w.U=!0,Ds(w,l,null)):Ds(w,l,c),this.I=2}}else this.I==3&&(i?ca(this,i):this.i.length==0||$o(this.h)||ca(this))};function ca(i,c){var l;c?l=c.l:l=i.V++;const f=Mt(i.J);Y(f,"SID",i.M),Y(f,"RID",l),Y(f,"AID",i.K),Sn(i,f),i.u&&i.o&&Fs(f,i.u,i.o),l=new Qt(i,i.j,l,i.D+1),i.u===null&&(l.J=i.o),c&&(i.i=c.G.concat(i.i)),c=la(i,l,1e3),l.H=Math.round(i.va*.5)+Math.round(i.va*.5*Math.random()),Ms(i.h,l),Ds(l,f,c)}function Sn(i,c){i.H&&cr(i.H,function(l,f){Y(c,f,l)}),i.l&&cr({},function(l,f){Y(c,f,l)})}function la(i,c,l){l=Math.min(i.i.length,l);const f=i.l?d(i.l.Ka,i.l,i):null;t:{var w=i.i;let q=-1;for(;;){const at=["count="+l];q==-1?l>0?(q=w[0].g,at.push("ofs="+q)):q=0:at.push("ofs="+q);let J=!0;for(let dt=0;dt<l;dt++){var S=w[dt].g;const xt=w[dt].map;if(S-=q,S<0)q=Math.max(0,w[dt].g-100),J=!1;else try{S="req"+S+"_"||"";try{var V=xt instanceof Map?xt:Object.entries(xt);for(const[Ee,Zt]of V){let te=Zt;u(Zt)&&(te=Rs(Zt)),at.push(S+Ee+"="+encodeURIComponent(te))}}catch(Ee){throw at.push(S+"type="+encodeURIComponent("_badmap")),Ee}}catch{f&&f(xt)}}if(J){V=at.join("&");break t}}V=void 0}return i=i.i.splice(0,l),c.G=i,V}function ua(i){if(!i.g&&!i.v){i.Y=1;var c=i.Da;St||m(),ht||(St(),ht=!0),T.add(c,i),i.A=0}}function Us(i){return i.g||i.v||i.A>=3?!1:(i.Y++,i.v=fn(d(i.Da,i),fa(i,i.A)),i.A++,!0)}n.Da=function(){if(this.v=null,ha(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var i=4*this.T;this.j.info("BP detection timer enabled: "+i),this.B=fn(d(this.Wa,this),i)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,wt(10),_r(this),ha(this))};function js(i){i.B!=null&&(a.clearTimeout(i.B),i.B=null)}function ha(i){i.g=new Qt(i,i.j,"rpc",i.Y),i.u===null&&(i.g.J=i.o),i.g.P=0;var c=Mt(i.na);Y(c,"RID","rpc"),Y(c,"SID",i.M),Y(c,"AID",i.K),Y(c,"CI",i.F?"0":"1"),!i.F&&i.ia&&Y(c,"TO",i.ia),Y(c,"TYPE","xmlhttp"),Sn(i,c),i.u&&i.o&&Fs(c,i.u,i.o),i.O&&(i.g.H=i.O);var l=i.g;i=i.ba,l.M=1,l.A=mr(Mt(c)),l.u=null,l.R=!0,Bo(l,i)}n.Va=function(){this.C!=null&&(this.C=null,_r(this),Us(this),wt(19))};function Er(i){i.C!=null&&(a.clearTimeout(i.C),i.C=null)}function da(i,c){var l=null;if(i.g==c){Er(i),js(i),i.g=null;var f=2}else if(Os(i.h,c))l=c.G,Go(i.h,c),f=1;else return;if(i.I!=0){if(c.o)if(f==1){l=c.u?c.u.length:0,c=Date.now()-c.F;var w=i.D;f=hr(),It(f,new Oo(f,l)),yr(i)}else ua(i);else if(w=c.m,w==3||w==0&&c.X>0||!(f==1&&dh(i,c)||f==2&&Us(i)))switch(l&&l.length>0&&(c=i.h,c.i=c.i.concat(l)),w){case 1:ye(i,5);break;case 4:ye(i,10);break;case 3:ye(i,6);break;default:ye(i,2)}}}function fa(i,c){let l=i.Qa+Math.floor(Math.random()*i.Za);return i.isActive()||(l*=2),l*c}function ye(i,c){if(i.j.info("Error code "+c),c==2){var l=d(i.bb,i),f=i.Ua;const w=!f;f=new Xt(f||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||_n(f,"https"),mr(f),w?oh(f.toString(),l):ah(f.toString(),l)}else wt(2);i.I=0,i.l&&i.l.pa(c),ma(i),aa(i)}n.bb=function(i){i?(this.j.info("Successfully pinged google.com"),wt(2)):(this.j.info("Failed to ping google.com"),wt(1))};function ma(i){if(i.I=0,i.ja=[],i.l){const c=Ho(i.h);(c.length!=0||i.i.length!=0)&&(M(i.ja,c),M(i.ja,i.i),i.h.i.length=0,P(i.i),i.i.length=0),i.l.oa()}}function ga(i,c,l){var f=l instanceof Xt?Mt(l):new Xt(l);if(f.g!="")c&&(f.g=c+"."+f.g),yn(f,f.u);else{var w=a.location;f=w.protocol,c=c?c+"."+w.hostname:w.hostname,w=+w.port;const S=new Xt(null);f&&_n(S,f),c&&(S.g=c),w&&yn(S,w),l&&(S.h=l),f=S}return l=i.G,c=i.wa,l&&c&&Y(f,l,c),Y(f,"VER",i.ka),Sn(i,f),f}function pa(i,c,l){if(c&&!i.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=i.Aa&&!i.ma?new nt(new Ls({ab:l})):new nt(i.ma),c.Fa(i.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function _a(){}n=_a.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function Tr(){}Tr.prototype.g=function(i,c){return new bt(i,c)};function bt(i,c){_t.call(this),this.g=new oa(c),this.l=i,this.h=c&&c.messageUrlParams||null,i=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(i?i["X-WebChannel-Content-Type"]=c.messageContentType:i={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(i?i["X-WebChannel-Client-Profile"]=c.sa:i={"X-WebChannel-Client-Profile":c.sa}),this.g.U=i,(i=c&&c.Qb)&&!g(i)&&(this.g.u=i),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!g(c)&&(this.g.G=c,i=this.h,i!==null&&c in i&&(i=this.h,c in i&&delete i[c])),this.j=new Me(this)}I(bt,_t),bt.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},bt.prototype.close=function(){Bs(this.g)},bt.prototype.o=function(i){var c=this.g;if(typeof i=="string"){var l={};l.__data__=i,i=l}else this.v&&(l={},l.__data__=Rs(i),i=l);c.i.push(new Yu(c.Ya++,i)),c.I==3&&yr(c)},bt.prototype.N=function(){this.g.l=null,delete this.j,Bs(this.g),delete this.g,bt.Z.N.call(this)};function ya(i){Cs.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var c=i.__sm__;if(c){t:{for(const l in c){i=l;break t}i=void 0}(this.i=i)&&(i=this.i,c=c!==null&&i in c?c[i]:void 0),this.data=c}else this.data=i}I(ya,Cs);function Ea(){bs.call(this),this.status=1}I(Ea,bs);function Me(i){this.g=i}I(Me,_a),Me.prototype.ra=function(){It(this.g,"a")},Me.prototype.qa=function(i){It(this.g,new ya(i))},Me.prototype.pa=function(i){It(this.g,new Ea)},Me.prototype.oa=function(){It(this.g,"b")},Tr.prototype.createWebChannel=Tr.prototype.g,bt.prototype.send=bt.prototype.o,bt.prototype.open=bt.prototype.m,bt.prototype.close=bt.prototype.close,Qc=function(){return new Tr},Wc=function(){return hr()},Kc=ge,si={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},dr.NO_ERROR=0,dr.TIMEOUT=8,dr.HTTP_ERROR=6,Vr=dr,Mo.COMPLETE="complete",Hc=Mo,Vo.EventType=hn,hn.OPEN="a",hn.CLOSE="b",hn.ERROR="c",hn.MESSAGE="d",_t.prototype.listen=_t.prototype.J,Rn=Vo,nt.prototype.listenOnce=nt.prototype.K,nt.prototype.getLastError=nt.prototype.Ha,nt.prototype.getLastErrorCode=nt.prototype.ya,nt.prototype.getStatus=nt.prototype.ca,nt.prototype.getResponseJson=nt.prototype.La,nt.prototype.getResponseText=nt.prototype.la,nt.prototype.send=nt.prototype.ea,nt.prototype.setWithCredentials=nt.prototype.Fa,Gc=nt}).apply(typeof Ir<"u"?Ir:typeof self<"u"?self:typeof window<"u"?window:{});const ka="@firebase/firestore",Na="4.9.2";class Et{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Et.UNAUTHENTICATED=new Et(null),Et.GOOGLE_CREDENTIALS=new Et("google-credentials-uid"),Et.FIRST_PARTY=new Et("first-party-uid"),Et.MOCK_USER=new Et("mock-user");let on="12.3.0";const Re=new Fc("@firebase/firestore");function xe(){return Re.logLevel}function k(n,...t){if(Re.logLevel<=H.DEBUG){const e=t.map(Ni);Re.debug(`Firestore (${on}): ${n}`,...e)}}function Kt(n,...t){if(Re.logLevel<=H.ERROR){const e=t.map(Ni);Re.error(`Firestore (${on}): ${n}`,...e)}}function Je(n,...t){if(Re.logLevel<=H.WARN){const e=t.map(Ni);Re.warn(`Firestore (${on}): ${n}`,...e)}}function Ni(n){if(typeof n=="string")return n;try{return(function(e){return JSON.stringify(e)})(n)}catch{return n}}function F(n,t,e){let r="Unexpected state";typeof t=="string"?r=t:e=t,Xc(n,r,e)}function Xc(n,t,e){let r=`FIRESTORE (${on}) INTERNAL ASSERTION FAILED: ${t} (ID: ${n.toString(16)})`;if(e!==void 0)try{r+=" CONTEXT: "+JSON.stringify(e)}catch{r+=" CONTEXT: "+e}throw Kt(r),new Error(r)}function X(n,t,e,r){let s="Unexpected state";typeof e=="string"?s=e:r=e,n||Xc(t,s,r)}function U(n,t){return n}const b={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class O extends sn{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ie{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Jc{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Yd{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Et.UNAUTHENTICATED)))}shutdown(){}}class Zd{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class tf{constructor(t){this.t=t,this.currentUser=Et.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){X(this.o===void 0,42304);let r=this.i;const s=h=>this.i!==r?(r=this.i,e(h)):Promise.resolve();let o=new ie;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new ie,t.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const h=o;t.enqueueRetryable((async()=>{await h.promise,await s(this.currentUser)}))},u=h=>{k("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((h=>u(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?u(h):(k("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new ie)}}),0),a()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((r=>this.i!==t?(k("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(X(typeof r.accessToken=="string",31837,{l:r}),new Jc(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return X(t===null||typeof t=="string",2055,{h:t}),new Et(t)}}class ef{constructor(t,e,r){this.P=t,this.T=e,this.I=r,this.type="FirstParty",this.user=Et.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class nf{constructor(t,e,r){this.P=t,this.T=e,this.I=r}getToken(){return Promise.resolve(new ef(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable((()=>e(Et.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Oa{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class rf{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Md(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){X(this.o===void 0,3512);const r=o=>{o.error!=null&&k("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,k("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(o.token):Promise.resolve()};this.o=o=>{t.enqueueRetryable((()=>r(o)))};const s=o=>{k("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>s(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):k("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Oa(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((e=>e?(X(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new Oa(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function sf(n){const t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let r=0;r<n;r++)e[r]=Math.floor(256*Math.random());return e}class Oi{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=sf(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<e&&(r+=t.charAt(s[o]%62))}return r}}function $(n,t){return n<t?-1:n>t?1:0}function ii(n,t){const e=Math.min(n.length,t.length);for(let r=0;r<e;r++){const s=n.charAt(r),o=t.charAt(r);if(s!==o)return Ks(s)===Ks(o)?$(s,o):Ks(s)?1:-1}return $(n.length,t.length)}const of=55296,af=57343;function Ks(n){const t=n.charCodeAt(0);return t>=of&&t<=af}function Ye(n,t,e){return n.length===t.length&&n.every(((r,s)=>e(r,t[s])))}const Ma="__name__";class Lt{constructor(t,e,r){e===void 0?e=0:e>t.length&&F(637,{offset:e,range:t.length}),r===void 0?r=t.length-e:r>t.length-e&&F(1746,{length:r,range:t.length-e}),this.segments=t,this.offset=e,this.len=r}get length(){return this.len}isEqual(t){return Lt.comparator(this,t)===0}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Lt?t.forEach((r=>{e.push(r)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,r=this.limit();e<r;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const r=Math.min(t.length,e.length);for(let s=0;s<r;s++){const o=Lt.compareSegments(t.get(s),e.get(s));if(o!==0)return o}return $(t.length,e.length)}static compareSegments(t,e){const r=Lt.isNumericId(t),s=Lt.isNumericId(e);return r&&!s?-1:!r&&s?1:r&&s?Lt.extractNumericId(t).compare(Lt.extractNumericId(e)):ii(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return se.fromString(t.substring(4,t.length-2))}}class Z extends Lt{construct(t,e,r){return new Z(t,e,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const r of t){if(r.indexOf("//")>=0)throw new O(b.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter((s=>s.length>0)))}return new Z(e)}static emptyPath(){return new Z([])}}const cf=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class gt extends Lt{construct(t,e,r){return new gt(t,e,r)}static isValidIdentifier(t){return cf.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),gt.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===Ma}static keyField(){return new gt([Ma])}static fromServerFormat(t){const e=[];let r="",s=0;const o=()=>{if(r.length===0)throw new O(b.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""};let a=!1;for(;s<t.length;){const u=t[s];if(u==="\\"){if(s+1===t.length)throw new O(b.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const h=t[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new O(b.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=h,s+=2}else u==="`"?(a=!a,s++):u!=="."||a?(r+=u,s++):(o(),s++)}if(o(),a)throw new O(b.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new gt(e)}static emptyPath(){return new gt([])}}class x{constructor(t){this.path=t}static fromPath(t){return new x(Z.fromString(t))}static fromName(t){return new x(Z.fromString(t).popFirst(5))}static empty(){return new x(Z.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Z.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return Z.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new x(new Z(t.slice()))}}function Yc(n,t,e){if(!e)throw new O(b.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function lf(n,t,e,r){if(t===!0&&r===!0)throw new O(b.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function xa(n){if(!x.isDocumentKey(n))throw new O(b.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function La(n){if(x.isDocumentKey(n))throw new O(b.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function Zc(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Mi(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const t=(function(r){return r.constructor?r.constructor.name:null})(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":F(12329,{type:typeof n})}function Ft(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new O(b.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=Mi(n);throw new O(b.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}function ot(n,t){const e={typeString:n};return t&&(e.value=t),e}function Zn(n,t){if(!Zc(n))throw new O(b.INVALID_ARGUMENT,"JSON must be an object");let e;for(const r in t)if(t[r]){const s=t[r].typeString,o="value"in t[r]?{value:t[r].value}:void 0;if(!(r in n)){e=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){e=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&a!==o.value){e=`Expected '${r}' field to equal '${o.value}'`;break}}if(e)throw new O(b.INVALID_ARGUMENT,e);return!0}const Fa=-62135596800,Ba=1e6;class tt{static now(){return tt.fromMillis(Date.now())}static fromDate(t){return tt.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),r=Math.floor((t-1e3*e)*Ba);return new tt(e,r)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new O(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new O(b.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<Fa)throw new O(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new O(b.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Ba}_compareTo(t){return this.seconds===t.seconds?$(this.nanoseconds,t.nanoseconds):$(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:tt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(Zn(t,tt._jsonSchema))return new tt(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-Fa;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}tt._jsonSchemaVersion="firestore/timestamp/1.0",tt._jsonSchema={type:ot("string",tt._jsonSchemaVersion),seconds:ot("number"),nanoseconds:ot("number")};class B{static fromTimestamp(t){return new B(t)}static min(){return new B(new tt(0,0))}static max(){return new B(new tt(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Un=-1;function uf(n,t){const e=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=B.fromTimestamp(r===1e9?new tt(e+1,0):new tt(e,r));return new ce(s,x.empty(),t)}function hf(n){return new ce(n.readTime,n.key,Un)}class ce{constructor(t,e,r){this.readTime=t,this.documentKey=e,this.largestBatchId=r}static min(){return new ce(B.min(),x.empty(),Un)}static max(){return new ce(B.max(),x.empty(),Un)}}function df(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=x.comparator(n.documentKey,t.documentKey),e!==0?e:$(n.largestBatchId,t.largestBatchId))}const ff="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class mf{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function an(n){if(n.code!==b.FAILED_PRECONDITION||n.message!==ff)throw n;k("LocalStore","Unexpectedly lost primary lease")}class C{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&F(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new C(((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(t,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(e,o).next(r,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof C?e:C.resolve(e)}catch(e){return C.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):C.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):C.reject(e)}static resolve(t){return new C(((e,r)=>{e(t)}))}static reject(t){return new C(((e,r)=>{r(t)}))}static waitFor(t){return new C(((e,r)=>{let s=0,o=0,a=!1;t.forEach((u=>{++s,u.next((()=>{++o,a&&o===s&&e()}),(h=>r(h)))})),a=!0,o===s&&e()}))}static or(t){let e=C.resolve(!1);for(const r of t)e=e.next((s=>s?C.resolve(s):r()));return e}static forEach(t,e){const r=[];return t.forEach(((s,o)=>{r.push(e.call(this,s,o))})),this.waitFor(r)}static mapArray(t,e){return new C(((r,s)=>{const o=t.length,a=new Array(o);let u=0;for(let h=0;h<o;h++){const d=h;e(t[d]).next((y=>{a[d]=y,++u,u===o&&r(a)}),(y=>s(y)))}}))}static doWhile(t,e){return new C(((r,s)=>{const o=()=>{t()===!0?e().next((()=>{o()}),s):r()};o()}))}}function gf(n){const t=n.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function cn(n){return n.name==="IndexedDbTransactionError"}class os{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>e.writeSequenceNumber(r))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}os.ce=-1;const xi=-1;function as(n){return n==null}function zr(n){return n===0&&1/n==-1/0}function pf(n){return typeof n=="number"&&Number.isInteger(n)&&!zr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const tl="";function _f(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=Ua(t)),t=yf(n.get(e),t);return Ua(t)}function yf(n,t){let e=t;const r=n.length;for(let s=0;s<r;s++){const o=n.charAt(s);switch(o){case"\0":e+="";break;case tl:e+="";break;default:e+=o}}return e}function Ua(n){return n+tl+""}function ja(n){let t=0;for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function Pe(n,t){for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function el(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}class et{constructor(t,e){this.comparator=t,this.root=e||mt.EMPTY}insert(t,e){return new et(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,mt.BLACK,null,null))}remove(t){return new et(this.comparator,this.root.remove(t,this.comparator).copy(null,null,mt.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const r=this.comparator(t,e.key);if(r===0)return e.value;r<0?e=e.left:r>0&&(e=e.right)}return null}indexOf(t){let e=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(t,r.key);if(s===0)return e+r.left.size;s<0?r=r.left:(e+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,r)=>(t(e,r),!1)))}toString(){const t=[];return this.inorderTraversal(((e,r)=>(t.push(`${e}:${r}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new wr(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new wr(this.root,t,this.comparator,!1)}getReverseIterator(){return new wr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new wr(this.root,t,this.comparator,!0)}}class wr{constructor(t,e,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!t.isEmpty();)if(o=e?r(t.key,e):1,e&&s&&(o*=-1),o<0)t=this.isReverse?t.left:t.right;else{if(o===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class mt{constructor(t,e,r,s,o){this.key=t,this.value=e,this.color=r??mt.RED,this.left=s??mt.EMPTY,this.right=o??mt.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,r,s,o){return new mt(t??this.key,e??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,r){let s=this;const o=r(t,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(t,e,r),null):o===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return mt.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let r,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return mt.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,mt.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,mt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw F(43730,{key:this.key,value:this.value});if(this.right.isRed())throw F(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw F(27949);return t+(this.isRed()?0:1)}}mt.EMPTY=null,mt.RED=!0,mt.BLACK=!1;mt.EMPTY=new class{constructor(){this.size=0}get key(){throw F(57766)}get value(){throw F(16141)}get color(){throw F(16727)}get left(){throw F(29726)}get right(){throw F(36894)}copy(t,e,r,s,o){return this}insert(t,e,r){return new mt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class ut{constructor(t){this.comparator=t,this.data=new et(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,r)=>(t(e),!1)))}forEachInRange(t,e){const r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let r;for(r=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new qa(this.data.getIterator())}getIteratorFrom(t){return new qa(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((r=>{e=e.add(r)})),e}isEqual(t){if(!(t instanceof ut)||this.size!==t.size)return!1;const e=this.data.getIterator(),r=t.data.getIterator();for(;e.hasNext();){const s=e.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new ut(this.comparator);return e.data=t,e}}class qa{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Nt{constructor(t){this.fields=t,t.sort(gt.comparator)}static empty(){return new Nt([])}unionWith(t){let e=new ut(gt.comparator);for(const r of this.fields)e=e.add(r);for(const r of t)e=e.add(r);return new Nt(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Ye(this.fields,t.fields,((e,r)=>e.isEqual(r)))}}class nl extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class pt{constructor(t){this.binaryString=t}static fromBase64String(t){const e=(function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new nl("Invalid base64 string: "+o):o}})(t);return new pt(e)}static fromUint8Array(t){const e=(function(s){let o="";for(let a=0;a<s.length;++a)o+=String.fromCharCode(s[a]);return o})(t);return new pt(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(e){return btoa(e)})(this.binaryString)}toUint8Array(){return(function(e){const r=new Uint8Array(e.length);for(let s=0;s<e.length;s++)r[s]=e.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return $(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}pt.EMPTY_BYTE_STRING=new pt("");const Ef=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function le(n){if(X(!!n,39018),typeof n=="string"){let t=0;const e=Ef.exec(n);if(X(!!e,46558,{timestamp:n}),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:st(n.seconds),nanos:st(n.nanos)}}function st(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function ue(n){return typeof n=="string"?pt.fromBase64String(n):pt.fromUint8Array(n)}const rl="server_timestamp",sl="__type__",il="__previous_value__",ol="__local_write_time__";function Li(n){return(n?.mapValue?.fields||{})[sl]?.stringValue===rl}function cs(n){const t=n.mapValue.fields[il];return Li(t)?cs(t):t}function jn(n){const t=le(n.mapValue.fields[ol].timestampValue);return new tt(t.seconds,t.nanos)}class Tf{constructor(t,e,r,s,o,a,u,h,d,y){this.databaseId=t,this.appId=e,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=u,this.longPollingOptions=h,this.useFetchStreams=d,this.isUsingEmulator=y}}const Gr="(default)";class qn{constructor(t,e){this.projectId=t,this.database=e||Gr}static empty(){return new qn("","")}get isDefaultDatabase(){return this.database===Gr}isEqual(t){return t instanceof qn&&t.projectId===this.projectId&&t.database===this.database}}const al="__type__",vf="__max__",Ar={mapValue:{}},cl="__vector__",Hr="value";function he(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?Li(n)?4:wf(n)?9007199254740991:If(n)?10:11:F(28295,{value:n})}function $t(n,t){if(n===t)return!0;const e=he(n);if(e!==he(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return jn(n).isEqual(jn(t));case 3:return(function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const a=le(s.timestampValue),u=le(o.timestampValue);return a.seconds===u.seconds&&a.nanos===u.nanos})(n,t);case 5:return n.stringValue===t.stringValue;case 6:return(function(s,o){return ue(s.bytesValue).isEqual(ue(o.bytesValue))})(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return(function(s,o){return st(s.geoPointValue.latitude)===st(o.geoPointValue.latitude)&&st(s.geoPointValue.longitude)===st(o.geoPointValue.longitude)})(n,t);case 2:return(function(s,o){if("integerValue"in s&&"integerValue"in o)return st(s.integerValue)===st(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const a=st(s.doubleValue),u=st(o.doubleValue);return a===u?zr(a)===zr(u):isNaN(a)&&isNaN(u)}return!1})(n,t);case 9:return Ye(n.arrayValue.values||[],t.arrayValue.values||[],$t);case 10:case 11:return(function(s,o){const a=s.mapValue.fields||{},u=o.mapValue.fields||{};if(ja(a)!==ja(u))return!1;for(const h in a)if(a.hasOwnProperty(h)&&(u[h]===void 0||!$t(a[h],u[h])))return!1;return!0})(n,t);default:return F(52216,{left:n})}}function $n(n,t){return(n.values||[]).find((e=>$t(e,t)))!==void 0}function Ze(n,t){if(n===t)return 0;const e=he(n),r=he(t);if(e!==r)return $(e,r);switch(e){case 0:case 9007199254740991:return 0;case 1:return $(n.booleanValue,t.booleanValue);case 2:return(function(o,a){const u=st(o.integerValue||o.doubleValue),h=st(a.integerValue||a.doubleValue);return u<h?-1:u>h?1:u===h?0:isNaN(u)?isNaN(h)?0:-1:1})(n,t);case 3:return $a(n.timestampValue,t.timestampValue);case 4:return $a(jn(n),jn(t));case 5:return ii(n.stringValue,t.stringValue);case 6:return(function(o,a){const u=ue(o),h=ue(a);return u.compareTo(h)})(n.bytesValue,t.bytesValue);case 7:return(function(o,a){const u=o.split("/"),h=a.split("/");for(let d=0;d<u.length&&d<h.length;d++){const y=$(u[d],h[d]);if(y!==0)return y}return $(u.length,h.length)})(n.referenceValue,t.referenceValue);case 8:return(function(o,a){const u=$(st(o.latitude),st(a.latitude));return u!==0?u:$(st(o.longitude),st(a.longitude))})(n.geoPointValue,t.geoPointValue);case 9:return za(n.arrayValue,t.arrayValue);case 10:return(function(o,a){const u=o.fields||{},h=a.fields||{},d=u[Hr]?.arrayValue,y=h[Hr]?.arrayValue,I=$(d?.values?.length||0,y?.values?.length||0);return I!==0?I:za(d,y)})(n.mapValue,t.mapValue);case 11:return(function(o,a){if(o===Ar.mapValue&&a===Ar.mapValue)return 0;if(o===Ar.mapValue)return 1;if(a===Ar.mapValue)return-1;const u=o.fields||{},h=Object.keys(u),d=a.fields||{},y=Object.keys(d);h.sort(),y.sort();for(let I=0;I<h.length&&I<y.length;++I){const R=ii(h[I],y[I]);if(R!==0)return R;const P=Ze(u[h[I]],d[y[I]]);if(P!==0)return P}return $(h.length,y.length)})(n.mapValue,t.mapValue);default:throw F(23264,{he:e})}}function $a(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return $(n,t);const e=le(n),r=le(t),s=$(e.seconds,r.seconds);return s!==0?s:$(e.nanos,r.nanos)}function za(n,t){const e=n.values||[],r=t.values||[];for(let s=0;s<e.length&&s<r.length;++s){const o=Ze(e[s],r[s]);if(o)return o}return $(e.length,r.length)}function tn(n){return oi(n)}function oi(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(e){const r=le(e);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(e){return ue(e).toBase64()})(n.bytesValue):"referenceValue"in n?(function(e){return x.fromName(e).toString()})(n.referenceValue):"geoPointValue"in n?(function(e){return`geo(${e.latitude},${e.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(e){let r="[",s=!0;for(const o of e.values||[])s?s=!1:r+=",",r+=oi(o);return r+"]"})(n.arrayValue):"mapValue"in n?(function(e){const r=Object.keys(e.fields||{}).sort();let s="{",o=!0;for(const a of r)o?o=!1:s+=",",s+=`${a}:${oi(e.fields[a])}`;return s+"}"})(n.mapValue):F(61005,{value:n})}function Dr(n){switch(he(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=cs(n);return t?16+Dr(t):16;case 5:return 2*n.stringValue.length;case 6:return ue(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,o)=>s+Dr(o)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return Pe(r.fields,((o,a)=>{s+=o.length+Dr(a)})),s})(n.mapValue);default:throw F(13486,{value:n})}}function ai(n){return!!n&&"integerValue"in n}function Fi(n){return!!n&&"arrayValue"in n}function Ga(n){return!!n&&"nullValue"in n}function Ha(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function kr(n){return!!n&&"mapValue"in n}function If(n){return(n?.mapValue?.fields||{})[al]?.stringValue===cl}function Dn(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const t={mapValue:{fields:{}}};return Pe(n.mapValue.fields,((e,r)=>t.mapValue.fields[e]=Dn(r))),t}if(n.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=Dn(n.arrayValue.values[e]);return t}return{...n}}function wf(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===vf}class Pt{constructor(t){this.value=t}static empty(){return new Pt({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let r=0;r<t.length-1;++r)if(e=(e.mapValue.fields||{})[t.get(r)],!kr(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Dn(e)}setAll(t){let e=gt.emptyPath(),r={},s=[];t.forEach(((a,u)=>{if(!e.isImmediateParentOf(u)){const h=this.getFieldsMap(e);this.applyChanges(h,r,s),r={},s=[],e=u.popLast()}a?r[u.lastSegment()]=Dn(a):s.push(u.lastSegment())}));const o=this.getFieldsMap(e);this.applyChanges(o,r,s)}delete(t){const e=this.field(t.popLast());kr(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return $t(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let r=0;r<t.length;++r){let s=e.mapValue.fields[t.get(r)];kr(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(r)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,r){Pe(e,((s,o)=>t[s]=o));for(const s of r)delete t[s]}clone(){return new Pt(Dn(this.value))}}function ll(n){const t=[];return Pe(n.fields,((e,r)=>{const s=new gt([e]);if(kr(r)){const o=ll(r.mapValue).fields;if(o.length===0)t.push(s);else for(const a of o)t.push(s.child(a))}else t.push(s)})),new Nt(t)}class Tt{constructor(t,e,r,s,o,a,u){this.key=t,this.documentType=e,this.version=r,this.readTime=s,this.createTime=o,this.data=a,this.documentState=u}static newInvalidDocument(t){return new Tt(t,0,B.min(),B.min(),B.min(),Pt.empty(),0)}static newFoundDocument(t,e,r,s){return new Tt(t,1,e,B.min(),r,s,0)}static newNoDocument(t,e){return new Tt(t,2,e,B.min(),B.min(),Pt.empty(),0)}static newUnknownDocument(t,e){return new Tt(t,3,e,B.min(),B.min(),Pt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(B.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=Pt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=Pt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=B.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof Tt&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new Tt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Kr{constructor(t,e){this.position=t,this.inclusive=e}}function Ka(n,t,e){let r=0;for(let s=0;s<n.position.length;s++){const o=t[s],a=n.position[s];if(o.field.isKeyField()?r=x.comparator(x.fromName(a.referenceValue),e.key):r=Ze(a,e.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function Wa(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!$t(n.position[e],t.position[e]))return!1;return!0}class Wr{constructor(t,e="asc"){this.field=t,this.dir=e}}function Af(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}class ul{}class ct extends ul{constructor(t,e,r){super(),this.field=t,this.op=e,this.value=r}static create(t,e,r){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,r):new Rf(t,e,r):e==="array-contains"?new Pf(t,r):e==="in"?new Vf(t,r):e==="not-in"?new Df(t,r):e==="array-contains-any"?new kf(t,r):new ct(t,e,r)}static createKeyFieldInFilter(t,e,r){return e==="in"?new Cf(t,r):new bf(t,r)}matches(t){const e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(Ze(e,this.value)):e!==null&&he(this.value)===he(e)&&this.matchesComparison(Ze(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return F(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class zt extends ul{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new zt(t,e)}matches(t){return hl(this)?this.filters.find((e=>!e.matches(t)))===void 0:this.filters.find((e=>e.matches(t)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function hl(n){return n.op==="and"}function dl(n){return Sf(n)&&hl(n)}function Sf(n){for(const t of n.filters)if(t instanceof zt)return!1;return!0}function ci(n){if(n instanceof ct)return n.field.canonicalString()+n.op.toString()+tn(n.value);if(dl(n))return n.filters.map((t=>ci(t))).join(",");{const t=n.filters.map((e=>ci(e))).join(",");return`${n.op}(${t})`}}function fl(n,t){return n instanceof ct?(function(r,s){return s instanceof ct&&r.op===s.op&&r.field.isEqual(s.field)&&$t(r.value,s.value)})(n,t):n instanceof zt?(function(r,s){return s instanceof zt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((o,a,u)=>o&&fl(a,s.filters[u])),!0):!1})(n,t):void F(19439)}function ml(n){return n instanceof ct?(function(e){return`${e.field.canonicalString()} ${e.op} ${tn(e.value)}`})(n):n instanceof zt?(function(e){return e.op.toString()+" {"+e.getFilters().map(ml).join(" ,")+"}"})(n):"Filter"}class Rf extends ct{constructor(t,e,r){super(t,e,r),this.key=x.fromName(r.referenceValue)}matches(t){const e=x.comparator(t.key,this.key);return this.matchesComparison(e)}}class Cf extends ct{constructor(t,e){super(t,"in",e),this.keys=gl("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class bf extends ct{constructor(t,e){super(t,"not-in",e),this.keys=gl("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function gl(n,t){return(t.arrayValue?.values||[]).map((e=>x.fromName(e.referenceValue)))}class Pf extends ct{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return Fi(e)&&$n(e.arrayValue,this.value)}}class Vf extends ct{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return e!==null&&$n(this.value.arrayValue,e)}}class Df extends ct{constructor(t,e){super(t,"not-in",e)}matches(t){if($n(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!$n(this.value.arrayValue,e)}}class kf extends ct{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!Fi(e)||!e.arrayValue.values)&&e.arrayValue.values.some((r=>$n(this.value.arrayValue,r)))}}class Nf{constructor(t,e=null,r=[],s=[],o=null,a=null,u=null){this.path=t,this.collectionGroup=e,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=a,this.endAt=u,this.Te=null}}function Qa(n,t=null,e=[],r=[],s=null,o=null,a=null){return new Nf(n,t,e,r,s,o,a)}function Bi(n){const t=U(n);if(t.Te===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((r=>ci(r))).join(","),e+="|ob:",e+=t.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),as(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((r=>tn(r))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((r=>tn(r))).join(",")),t.Te=e}return t.Te}function Ui(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!Af(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!fl(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!Wa(n.startAt,t.startAt)&&Wa(n.endAt,t.endAt)}function li(n){return x.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class ls{constructor(t,e=null,r=[],s=[],o=null,a="F",u=null,h=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=a,this.startAt=u,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Of(n,t,e,r,s,o,a,u){return new ls(n,t,e,r,s,o,a,u)}function ji(n){return new ls(n)}function Xa(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function Mf(n){return n.collectionGroup!==null}function kn(n){const t=U(n);if(t.Ie===null){t.Ie=[];const e=new Set;for(const o of t.explicitOrderBy)t.Ie.push(o),e.add(o.field.canonicalString());const r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let u=new ut(gt.comparator);return a.filters.forEach((h=>{h.getFlattenedFilters().forEach((d=>{d.isInequality()&&(u=u.add(d.field))}))})),u})(t).forEach((o=>{e.has(o.canonicalString())||o.isKeyField()||t.Ie.push(new Wr(o,r))})),e.has(gt.keyField().canonicalString())||t.Ie.push(new Wr(gt.keyField(),r))}return t.Ie}function Bt(n){const t=U(n);return t.Ee||(t.Ee=xf(t,kn(n))),t.Ee}function xf(n,t){if(n.limitType==="F")return Qa(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map((s=>{const o=s.dir==="desc"?"asc":"desc";return new Wr(s.field,o)}));const e=n.endAt?new Kr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Kr(n.startAt.position,n.startAt.inclusive):null;return Qa(n.path,n.collectionGroup,t,n.filters,n.limit,e,r)}}function ui(n,t,e){return new ls(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function us(n,t){return Ui(Bt(n),Bt(t))&&n.limitType===t.limitType}function pl(n){return`${Bi(Bt(n))}|lt:${n.limitType}`}function Le(n){return`Query(target=${(function(e){let r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map((s=>ml(s))).join(", ")}]`),as(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map((s=>tn(s))).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map((s=>tn(s))).join(",")),`Target(${r})`})(Bt(n))}; limitType=${n.limitType})`}function hs(n,t){return t.isFoundDocument()&&(function(r,s){const o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):x.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(n,t)&&(function(r,s){for(const o of kn(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0})(n,t)&&(function(r,s){for(const o of r.filters)if(!o.matches(s))return!1;return!0})(n,t)&&(function(r,s){return!(r.startAt&&!(function(a,u,h){const d=Ka(a,u,h);return a.inclusive?d<=0:d<0})(r.startAt,kn(r),s)||r.endAt&&!(function(a,u,h){const d=Ka(a,u,h);return a.inclusive?d>=0:d>0})(r.endAt,kn(r),s))})(n,t)}function Lf(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function _l(n){return(t,e)=>{let r=!1;for(const s of kn(n)){const o=Ff(s,t,e);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function Ff(n,t,e){const r=n.field.isKeyField()?x.comparator(t.key,e.key):(function(o,a,u){const h=a.data.field(o),d=u.data.field(o);return h!==null&&d!==null?Ze(h,d):F(42886)})(n.field,t,e);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return F(19790,{direction:n.dir})}}class Ve{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),r=this.inner[e];if(r!==void 0){for(const[s,o]of r)if(this.equalsFn(s,t))return o}}has(t){return this.get(t)!==void 0}set(t,e){const r=this.mapKeyFn(t),s=this.inner[r];if(s===void 0)return this.inner[r]=[[t,e]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],t))return void(s[o]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),r=this.inner[e];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],t))return r.length===1?delete this.inner[e]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(t){Pe(this.inner,((e,r)=>{for(const[s,o]of r)t(s,o)}))}isEmpty(){return el(this.inner)}size(){return this.innerSize}}const Bf=new et(x.comparator);function Wt(){return Bf}const yl=new et(x.comparator);function Cn(...n){let t=yl;for(const e of n)t=t.insert(e.key,e);return t}function El(n){let t=yl;return n.forEach(((e,r)=>t=t.insert(e,r.overlayedDocument))),t}function ve(){return Nn()}function Tl(){return Nn()}function Nn(){return new Ve((n=>n.toString()),((n,t)=>n.isEqual(t)))}const Uf=new et(x.comparator),jf=new ut(x.comparator);function z(...n){let t=jf;for(const e of n)t=t.add(e);return t}const qf=new ut($);function $f(){return qf}function qi(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:zr(t)?"-0":t}}function vl(n){return{integerValue:""+n}}function zf(n,t){return pf(t)?vl(t):qi(n,t)}class ds{constructor(){this._=void 0}}function Gf(n,t,e){return n instanceof zn?(function(s,o){const a={fields:{[sl]:{stringValue:rl},[ol]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&Li(o)&&(o=cs(o)),o&&(a.fields[il]=o),{mapValue:a}})(e,t):n instanceof Gn?wl(n,t):n instanceof Hn?Al(n,t):(function(s,o){const a=Il(s,o),u=Ja(a)+Ja(s.Ae);return ai(a)&&ai(s.Ae)?vl(u):qi(s.serializer,u)})(n,t)}function Hf(n,t,e){return n instanceof Gn?wl(n,t):n instanceof Hn?Al(n,t):e}function Il(n,t){return n instanceof Qr?(function(r){return ai(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(t)?t:{integerValue:0}:null}class zn extends ds{}class Gn extends ds{constructor(t){super(),this.elements=t}}function wl(n,t){const e=Sl(t);for(const r of n.elements)e.some((s=>$t(s,r)))||e.push(r);return{arrayValue:{values:e}}}class Hn extends ds{constructor(t){super(),this.elements=t}}function Al(n,t){let e=Sl(t);for(const r of n.elements)e=e.filter((s=>!$t(s,r)));return{arrayValue:{values:e}}}class Qr extends ds{constructor(t,e){super(),this.serializer=t,this.Ae=e}}function Ja(n){return st(n.integerValue||n.doubleValue)}function Sl(n){return Fi(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Kf{constructor(t,e){this.field=t,this.transform=e}}function Wf(n,t){return n.field.isEqual(t.field)&&(function(r,s){return r instanceof Gn&&s instanceof Gn||r instanceof Hn&&s instanceof Hn?Ye(r.elements,s.elements,$t):r instanceof Qr&&s instanceof Qr?$t(r.Ae,s.Ae):r instanceof zn&&s instanceof zn})(n.transform,t.transform)}class Qf{constructor(t,e){this.version=t,this.transformResults=e}}class Ot{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Ot}static exists(t){return new Ot(void 0,t)}static updateTime(t){return new Ot(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Nr(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}class fs{}function Rl(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new $i(n.key,Ot.none()):new tr(n.key,n.data,Ot.none());{const e=n.data,r=Pt.empty();let s=new ut(gt.comparator);for(let o of t.fields)if(!s.has(o)){let a=e.field(o);a===null&&o.length>1&&(o=o.popLast(),a=e.field(o)),a===null?r.delete(o):r.set(o,a),s=s.add(o)}return new De(n.key,r,new Nt(s.toArray()),Ot.none())}}function Xf(n,t,e){n instanceof tr?(function(s,o,a){const u=s.value.clone(),h=Za(s.fieldTransforms,o,a.transformResults);u.setAll(h),o.convertToFoundDocument(a.version,u).setHasCommittedMutations()})(n,t,e):n instanceof De?(function(s,o,a){if(!Nr(s.precondition,o))return void o.convertToUnknownDocument(a.version);const u=Za(s.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(Cl(s)),h.setAll(u),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()})(n,t,e):(function(s,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()})(0,t,e)}function On(n,t,e,r){return n instanceof tr?(function(o,a,u,h){if(!Nr(o.precondition,a))return u;const d=o.value.clone(),y=tc(o.fieldTransforms,h,a);return d.setAll(y),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,t,e,r):n instanceof De?(function(o,a,u,h){if(!Nr(o.precondition,a))return u;const d=tc(o.fieldTransforms,h,a),y=a.data;return y.setAll(Cl(o)),y.setAll(d),a.convertToFoundDocument(a.version,y).setHasLocalMutations(),u===null?null:u.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((I=>I.field)))})(n,t,e,r):(function(o,a,u){return Nr(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):u})(n,t,e)}function Jf(n,t){let e=null;for(const r of n.fieldTransforms){const s=t.data.field(r.field),o=Il(r.transform,s||null);o!=null&&(e===null&&(e=Pt.empty()),e.set(r.field,o))}return e||null}function Ya(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&Ye(r,s,((o,a)=>Wf(o,a)))})(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}class tr extends fs{constructor(t,e,r,s=[]){super(),this.key=t,this.value=e,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class De extends fs{constructor(t,e,r,s,o=[]){super(),this.key=t,this.data=e,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function Cl(n){const t=new Map;return n.fieldMask.fields.forEach((e=>{if(!e.isEmpty()){const r=n.data.field(e);t.set(e,r)}})),t}function Za(n,t,e){const r=new Map;X(n.length===e.length,32656,{Re:e.length,Ve:n.length});for(let s=0;s<e.length;s++){const o=n[s],a=o.transform,u=t.data.field(o.field);r.set(o.field,Hf(a,u,e[s]))}return r}function tc(n,t,e){const r=new Map;for(const s of n){const o=s.transform,a=e.data.field(s.field);r.set(s.field,Gf(o,a,t))}return r}class $i extends fs{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Yf extends fs{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Zf{constructor(t,e,r,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(t,e){const r=e.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(t.key)&&Xf(o,t,r[s])}}applyToLocalView(t,e){for(const r of this.baseMutations)r.key.isEqual(t.key)&&(e=On(r,t,e,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(t.key)&&(e=On(r,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const r=Tl();return this.mutations.forEach((s=>{const o=t.get(s.key),a=o.overlayedDocument;let u=this.applyToLocalView(a,o.mutatedFields);u=e.has(s.key)?null:u;const h=Rl(a,u);h!==null&&r.set(s.key,h),a.isValidDocument()||a.convertToNoDocument(B.min())})),r}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),z())}isEqual(t){return this.batchId===t.batchId&&Ye(this.mutations,t.mutations,((e,r)=>Ya(e,r)))&&Ye(this.baseMutations,t.baseMutations,((e,r)=>Ya(e,r)))}}class zi{constructor(t,e,r,s){this.batch=t,this.commitVersion=e,this.mutationResults=r,this.docVersions=s}static from(t,e,r){X(t.mutations.length===r.length,58842,{me:t.mutations.length,fe:r.length});let s=(function(){return Uf})();const o=t.mutations;for(let a=0;a<o.length;a++)s=s.insert(o[a].key,r[a].version);return new zi(t,e,r,s)}}class tm{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class em{constructor(t,e){this.count=t,this.unchangedNames=e}}var it,G;function nm(n){switch(n){case b.OK:return F(64938);case b.CANCELLED:case b.UNKNOWN:case b.DEADLINE_EXCEEDED:case b.RESOURCE_EXHAUSTED:case b.INTERNAL:case b.UNAVAILABLE:case b.UNAUTHENTICATED:return!1;case b.INVALID_ARGUMENT:case b.NOT_FOUND:case b.ALREADY_EXISTS:case b.PERMISSION_DENIED:case b.FAILED_PRECONDITION:case b.ABORTED:case b.OUT_OF_RANGE:case b.UNIMPLEMENTED:case b.DATA_LOSS:return!0;default:return F(15467,{code:n})}}function bl(n){if(n===void 0)return Kt("GRPC error has no .code"),b.UNKNOWN;switch(n){case it.OK:return b.OK;case it.CANCELLED:return b.CANCELLED;case it.UNKNOWN:return b.UNKNOWN;case it.DEADLINE_EXCEEDED:return b.DEADLINE_EXCEEDED;case it.RESOURCE_EXHAUSTED:return b.RESOURCE_EXHAUSTED;case it.INTERNAL:return b.INTERNAL;case it.UNAVAILABLE:return b.UNAVAILABLE;case it.UNAUTHENTICATED:return b.UNAUTHENTICATED;case it.INVALID_ARGUMENT:return b.INVALID_ARGUMENT;case it.NOT_FOUND:return b.NOT_FOUND;case it.ALREADY_EXISTS:return b.ALREADY_EXISTS;case it.PERMISSION_DENIED:return b.PERMISSION_DENIED;case it.FAILED_PRECONDITION:return b.FAILED_PRECONDITION;case it.ABORTED:return b.ABORTED;case it.OUT_OF_RANGE:return b.OUT_OF_RANGE;case it.UNIMPLEMENTED:return b.UNIMPLEMENTED;case it.DATA_LOSS:return b.DATA_LOSS;default:return F(39323,{code:n})}}(G=it||(it={}))[G.OK=0]="OK",G[G.CANCELLED=1]="CANCELLED",G[G.UNKNOWN=2]="UNKNOWN",G[G.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",G[G.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",G[G.NOT_FOUND=5]="NOT_FOUND",G[G.ALREADY_EXISTS=6]="ALREADY_EXISTS",G[G.PERMISSION_DENIED=7]="PERMISSION_DENIED",G[G.UNAUTHENTICATED=16]="UNAUTHENTICATED",G[G.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",G[G.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",G[G.ABORTED=10]="ABORTED",G[G.OUT_OF_RANGE=11]="OUT_OF_RANGE",G[G.UNIMPLEMENTED=12]="UNIMPLEMENTED",G[G.INTERNAL=13]="INTERNAL",G[G.UNAVAILABLE=14]="UNAVAILABLE",G[G.DATA_LOSS=15]="DATA_LOSS";function rm(){return new TextEncoder}const sm=new se([4294967295,4294967295],0);function ec(n){const t=rm().encode(n),e=new zc;return e.update(t),new Uint8Array(e.digest())}function nc(n){const t=new DataView(n.buffer),e=t.getUint32(0,!0),r=t.getUint32(4,!0),s=t.getUint32(8,!0),o=t.getUint32(12,!0);return[new se([e,r],0),new se([s,o],0)]}class Gi{constructor(t,e,r){if(this.bitmap=t,this.padding=e,this.hashCount=r,e<0||e>=8)throw new bn(`Invalid padding: ${e}`);if(r<0)throw new bn(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new bn(`Invalid hash count: ${r}`);if(t.length===0&&e!==0)throw new bn(`Invalid padding when bitmap length is 0: ${e}`);this.ge=8*t.length-e,this.pe=se.fromNumber(this.ge)}ye(t,e,r){let s=t.add(e.multiply(se.fromNumber(r)));return s.compare(sm)===1&&(s=new se([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.ge===0)return!1;const e=ec(t),[r,s]=nc(e);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);if(!this.we(a))return!1}return!0}static create(t,e,r){const s=t%8==0?0:8-t%8,o=new Uint8Array(Math.ceil(t/8)),a=new Gi(o,s,e);return r.forEach((u=>a.insert(u))),a}insert(t){if(this.ge===0)return;const e=ec(t),[r,s]=nc(e);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);this.Se(a)}}Se(t){const e=Math.floor(t/8),r=t%8;this.bitmap[e]|=1<<r}}class bn extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class ms{constructor(t,e,r,s,o){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(t,e,r){const s=new Map;return s.set(t,er.createSynthesizedTargetChangeForCurrentChange(t,e,r)),new ms(B.min(),s,new et($),Wt(),z())}}class er{constructor(t,e,r,s,o){this.resumeToken=t,this.current=e,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(t,e,r){return new er(r,e,z(),z(),z())}}class Or{constructor(t,e,r,s){this.be=t,this.removedTargetIds=e,this.key=r,this.De=s}}class Pl{constructor(t,e){this.targetId=t,this.Ce=e}}class Vl{constructor(t,e,r=pt.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=r,this.cause=s}}class rc{constructor(){this.ve=0,this.Fe=sc(),this.Me=pt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=z(),e=z(),r=z();return this.Fe.forEach(((s,o)=>{switch(o){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:r=r.add(s);break;default:F(38017,{changeType:o})}})),new er(this.Me,this.xe,t,e,r)}qe(){this.Oe=!1,this.Fe=sc()}Qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,X(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class im{constructor(t){this.Ge=t,this.ze=new Map,this.je=Wt(),this.Je=Sr(),this.He=Sr(),this.Ye=new et($)}Ze(t){for(const e of t.be)t.De&&t.De.isFoundDocument()?this.Xe(e,t.De):this.et(e,t.key,t.De);for(const e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,(e=>{const r=this.nt(e);switch(t.state){case 0:this.rt(e)&&r.Le(t.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(t.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(r.We(),r.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),r.Le(t.resumeToken));break;default:F(56790,{state:t.state})}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach(((r,s)=>{this.rt(s)&&e(s)}))}st(t){const e=t.targetId,r=t.Ce.count,s=this.ot(e);if(s){const o=s.target;if(li(o))if(r===0){const a=new x(o.path);this.et(e,a,Tt.newNoDocument(a,B.min()))}else X(r===1,20013,{expectedCount:r});else{const a=this._t(e);if(a!==r){const u=this.ut(t),h=u?this.ct(u,t,a):1;if(h!==0){this.it(e);const d=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(e,d)}}}}}ut(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=e;let a,u;try{a=ue(r).toUint8Array()}catch(h){if(h instanceof nl)return Je("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{u=new Gi(a,s,o)}catch(h){return Je(h instanceof bn?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return u.ge===0?null:u}ct(t,e,r){return e.Ce.count===r-this.Pt(t,e.targetId)?0:2}Pt(t,e){const r=this.Ge.getRemoteKeysForTarget(e);let s=0;return r.forEach((o=>{const a=this.Ge.ht(),u=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;t.mightContain(u)||(this.et(e,o,null),s++)})),s}Tt(t){const e=new Map;this.ze.forEach(((o,a)=>{const u=this.ot(a);if(u){if(o.current&&li(u.target)){const h=new x(u.target.path);this.It(h).has(a)||this.Et(a,h)||this.et(a,h,Tt.newNoDocument(h,t))}o.Be&&(e.set(a,o.ke()),o.qe())}}));let r=z();this.He.forEach(((o,a)=>{let u=!0;a.forEachWhile((h=>{const d=this.ot(h);return!d||d.purpose==="TargetPurposeLimboResolution"||(u=!1,!1)})),u&&(r=r.add(o))})),this.je.forEach(((o,a)=>a.setReadTime(t)));const s=new ms(t,e,this.Ye,this.je,r);return this.je=Wt(),this.Je=Sr(),this.He=Sr(),this.Ye=new et($),s}Xe(t,e){if(!this.rt(t))return;const r=this.Et(t,e.key)?2:0;this.nt(t).Qe(e.key,r),this.je=this.je.insert(e.key,e),this.Je=this.Je.insert(e.key,this.It(e.key).add(t)),this.He=this.He.insert(e.key,this.dt(e.key).add(t))}et(t,e,r){if(!this.rt(t))return;const s=this.nt(t);this.Et(t,e)?s.Qe(e,1):s.$e(e),this.He=this.He.insert(e,this.dt(e).delete(t)),this.He=this.He.insert(e,this.dt(e).add(t)),r&&(this.je=this.je.insert(e,r))}removeTarget(t){this.ze.delete(t)}_t(t){const e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let e=this.ze.get(t);return e||(e=new rc,this.ze.set(t,e)),e}dt(t){let e=this.He.get(t);return e||(e=new ut($),this.He=this.He.insert(t,e)),e}It(t){let e=this.Je.get(t);return e||(e=new ut($),this.Je=this.Je.insert(t,e)),e}rt(t){const e=this.ot(t)!==null;return e||k("WatchChangeAggregator","Detected inactive target",t),e}ot(t){const e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new rc),this.Ge.getRemoteKeysForTarget(t).forEach((e=>{this.et(t,e,null)}))}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}}function Sr(){return new et(x.comparator)}function sc(){return new et(x.comparator)}const om={asc:"ASCENDING",desc:"DESCENDING"},am={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},cm={and:"AND",or:"OR"};class lm{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function hi(n,t){return n.useProto3Json||as(t)?t:{value:t}}function Xr(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Dl(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function um(n,t){return Xr(n,t.toTimestamp())}function Ut(n){return X(!!n,49232),B.fromTimestamp((function(e){const r=le(e);return new tt(r.seconds,r.nanos)})(n))}function Hi(n,t){return di(n,t).canonicalString()}function di(n,t){const e=(function(s){return new Z(["projects",s.projectId,"databases",s.database])})(n).child("documents");return t===void 0?e:e.child(t)}function kl(n){const t=Z.fromString(n);return X(Ll(t),10190,{key:t.toString()}),t}function fi(n,t){return Hi(n.databaseId,t.path)}function Ws(n,t){const e=kl(t);if(e.get(1)!==n.databaseId.projectId)throw new O(b.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new O(b.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new x(Ol(e))}function Nl(n,t){return Hi(n.databaseId,t)}function hm(n){const t=kl(n);return t.length===4?Z.emptyPath():Ol(t)}function mi(n){return new Z(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Ol(n){return X(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function ic(n,t,e){return{name:fi(n,t),fields:e.value.mapValue.fields}}function dm(n,t){let e;if("targetChange"in t){t.targetChange;const r=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:F(39313,{state:d})})(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],o=(function(d,y){return d.useProto3Json?(X(y===void 0||typeof y=="string",58123),pt.fromBase64String(y||"")):(X(y===void 0||y instanceof Buffer||y instanceof Uint8Array,16193),pt.fromUint8Array(y||new Uint8Array))})(n,t.targetChange.resumeToken),a=t.targetChange.cause,u=a&&(function(d){const y=d.code===void 0?b.UNKNOWN:bl(d.code);return new O(y,d.message||"")})(a);e=new Vl(r,s,o,u||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const s=Ws(n,r.document.name),o=Ut(r.document.updateTime),a=r.document.createTime?Ut(r.document.createTime):B.min(),u=new Pt({mapValue:{fields:r.document.fields}}),h=Tt.newFoundDocument(s,o,a,u),d=r.targetIds||[],y=r.removedTargetIds||[];e=new Or(d,y,h.key,h)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const s=Ws(n,r.document),o=r.readTime?Ut(r.readTime):B.min(),a=Tt.newNoDocument(s,o),u=r.removedTargetIds||[];e=new Or([],u,a.key,a)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const s=Ws(n,r.document),o=r.removedTargetIds||[];e=new Or([],o,s,null)}else{if(!("filter"in t))return F(11601,{Rt:t});{t.filter;const r=t.filter;r.targetId;const{count:s=0,unchangedNames:o}=r,a=new em(s,o),u=r.targetId;e=new Pl(u,a)}}return e}function fm(n,t){let e;if(t instanceof tr)e={update:ic(n,t.key,t.value)};else if(t instanceof $i)e={delete:fi(n,t.key)};else if(t instanceof De)e={update:ic(n,t.key,t.data),updateMask:Im(t.fieldMask)};else{if(!(t instanceof Yf))return F(16599,{Vt:t.type});e={verify:fi(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map((r=>(function(o,a){const u=a.transform;if(u instanceof zn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(u instanceof Gn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:u.elements}};if(u instanceof Hn)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:u.elements}};if(u instanceof Qr)return{fieldPath:a.field.canonicalString(),increment:u.Ae};throw F(20930,{transform:a.transform})})(0,r)))),t.precondition.isNone||(e.currentDocument=(function(s,o){return o.updateTime!==void 0?{updateTime:um(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:F(27497)})(n,t.precondition)),e}function mm(n,t){return n&&n.length>0?(X(t!==void 0,14353),n.map((e=>(function(s,o){let a=s.updateTime?Ut(s.updateTime):Ut(o);return a.isEqual(B.min())&&(a=Ut(o)),new Qf(a,s.transformResults||[])})(e,t)))):[]}function gm(n,t){return{documents:[Nl(n,t.path)]}}function pm(n,t){const e={structuredQuery:{}},r=t.path;let s;t.collectionGroup!==null?(s=r,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=r.popLast(),e.structuredQuery.from=[{collectionId:r.lastSegment()}]),e.parent=Nl(n,s);const o=(function(d){if(d.length!==0)return xl(zt.create(d,"and"))})(t.filters);o&&(e.structuredQuery.where=o);const a=(function(d){if(d.length!==0)return d.map((y=>(function(R){return{field:Fe(R.field),direction:Em(R.dir)}})(y)))})(t.orderBy);a&&(e.structuredQuery.orderBy=a);const u=hi(n,t.limit);return u!==null&&(e.structuredQuery.limit=u),t.startAt&&(e.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(t.startAt)),t.endAt&&(e.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(t.endAt)),{ft:e,parent:s}}function _m(n){let t=hm(n.parent);const e=n.structuredQuery,r=e.from?e.from.length:0;let s=null;if(r>0){X(r===1,65062);const y=e.from[0];y.allDescendants?s=y.collectionId:t=t.child(y.collectionId)}let o=[];e.where&&(o=(function(I){const R=Ml(I);return R instanceof zt&&dl(R)?R.getFilters():[R]})(e.where));let a=[];e.orderBy&&(a=(function(I){return I.map((R=>(function(M){return new Wr(Be(M.field),(function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(M.direction))})(R)))})(e.orderBy));let u=null;e.limit&&(u=(function(I){let R;return R=typeof I=="object"?I.value:I,as(R)?null:R})(e.limit));let h=null;e.startAt&&(h=(function(I){const R=!!I.before,P=I.values||[];return new Kr(P,R)})(e.startAt));let d=null;return e.endAt&&(d=(function(I){const R=!I.before,P=I.values||[];return new Kr(P,R)})(e.endAt)),Of(t,s,a,o,u,"F",h,d)}function ym(n,t){const e=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return F(28987,{purpose:s})}})(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Ml(n){return n.unaryFilter!==void 0?(function(e){switch(e.unaryFilter.op){case"IS_NAN":const r=Be(e.unaryFilter.field);return ct.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Be(e.unaryFilter.field);return ct.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Be(e.unaryFilter.field);return ct.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Be(e.unaryFilter.field);return ct.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return F(61313);default:return F(60726)}})(n):n.fieldFilter!==void 0?(function(e){return ct.create(Be(e.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return F(58110);default:return F(50506)}})(e.fieldFilter.op),e.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(e){return zt.create(e.compositeFilter.filters.map((r=>Ml(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return F(1026)}})(e.compositeFilter.op))})(n):F(30097,{filter:n})}function Em(n){return om[n]}function Tm(n){return am[n]}function vm(n){return cm[n]}function Fe(n){return{fieldPath:n.canonicalString()}}function Be(n){return gt.fromServerFormat(n.fieldPath)}function xl(n){return n instanceof ct?(function(e){if(e.op==="=="){if(Ha(e.value))return{unaryFilter:{field:Fe(e.field),op:"IS_NAN"}};if(Ga(e.value))return{unaryFilter:{field:Fe(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(Ha(e.value))return{unaryFilter:{field:Fe(e.field),op:"IS_NOT_NAN"}};if(Ga(e.value))return{unaryFilter:{field:Fe(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Fe(e.field),op:Tm(e.op),value:e.value}}})(n):n instanceof zt?(function(e){const r=e.getFilters().map((s=>xl(s)));return r.length===1?r[0]:{compositeFilter:{op:vm(e.op),filters:r}}})(n):F(54877,{filter:n})}function Im(n){const t=[];return n.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function Ll(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class ee{constructor(t,e,r,s,o=B.min(),a=B.min(),u=pt.EMPTY_BYTE_STRING,h=null){this.target=t,this.targetId=e,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=u,this.expectedCount=h}withSequenceNumber(t){return new ee(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new ee(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new ee(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new ee(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class wm{constructor(t){this.yt=t}}function Am(n){const t=_m({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?ui(t,t.limit,"L"):t}class Sm{constructor(){this.Cn=new Rm}addToCollectionParentIndex(t,e){return this.Cn.add(e),C.resolve()}getCollectionParents(t,e){return C.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return C.resolve()}deleteFieldIndex(t,e){return C.resolve()}deleteAllFieldIndexes(t){return C.resolve()}createTargetIndexes(t,e){return C.resolve()}getDocumentsMatchingTarget(t,e){return C.resolve(null)}getIndexType(t,e){return C.resolve(0)}getFieldIndexes(t,e){return C.resolve([])}getNextCollectionGroupToUpdate(t){return C.resolve(null)}getMinOffset(t,e){return C.resolve(ce.min())}getMinOffsetFromCollectionGroup(t,e){return C.resolve(ce.min())}updateCollectionGroup(t,e,r){return C.resolve()}updateIndexEntries(t,e){return C.resolve()}}class Rm{constructor(){this.index={}}add(t){const e=t.lastSegment(),r=t.popLast(),s=this.index[e]||new ut(Z.comparator),o=!s.has(r);return this.index[e]=s.add(r),o}has(t){const e=t.lastSegment(),r=t.popLast(),s=this.index[e];return s&&s.has(r)}getEntries(t){return(this.index[t]||new ut(Z.comparator)).toArray()}}const oc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Fl=41943040;class Ct{static withCacheSize(t){return new Ct(t,Ct.DEFAULT_COLLECTION_PERCENTILE,Ct.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=r}}Ct.DEFAULT_COLLECTION_PERCENTILE=10,Ct.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ct.DEFAULT=new Ct(Fl,Ct.DEFAULT_COLLECTION_PERCENTILE,Ct.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ct.DISABLED=new Ct(-1,0,0);class en{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new en(0)}static cr(){return new en(-1)}}const ac="LruGarbageCollector",Cm=1048576;function cc([n,t],[e,r]){const s=$(n,e);return s===0?$(t,r):s}class bm{constructor(t){this.Ir=t,this.buffer=new ut(cc),this.Er=0}dr(){return++this.Er}Ar(t){const e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{const r=this.buffer.last();cc(e,r)<0&&(this.buffer=this.buffer.delete(r).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Pm{constructor(t,e,r){this.garbageCollector=t,this.asyncQueue=e,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(t){k(ac,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){cn(e)?k(ac,"Ignoring IndexedDB error during garbage collection: ",e):await an(e)}await this.Vr(3e5)}))}}class Vm{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next((r=>Math.floor(e/100*r)))}nthSequenceNumber(t,e){if(e===0)return C.resolve(os.ce);const r=new bm(e);return this.mr.forEachTarget(t,(s=>r.Ar(s.sequenceNumber))).next((()=>this.mr.pr(t,(s=>r.Ar(s))))).next((()=>r.maxValue))}removeTargets(t,e,r){return this.mr.removeTargets(t,e,r)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(k("LruGarbageCollector","Garbage collection skipped; disabled"),C.resolve(oc)):this.getCacheSize(t).next((r=>r<this.params.cacheSizeCollectionThreshold?(k("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),oc):this.yr(t,e)))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let r,s,o,a,u,h,d;const y=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((I=>(I>this.params.maximumSequenceNumbersToCollect?(k("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${I}`),s=this.params.maximumSequenceNumbersToCollect):s=I,a=Date.now(),this.nthSequenceNumber(t,s)))).next((I=>(r=I,u=Date.now(),this.removeTargets(t,r,e)))).next((I=>(o=I,h=Date.now(),this.removeOrphanedDocuments(t,r)))).next((I=>(d=Date.now(),xe()<=H.DEBUG&&k("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-y}ms
	Determined least recently used ${s} in `+(u-a)+`ms
	Removed ${o} targets in `+(h-u)+`ms
	Removed ${I} documents in `+(d-h)+`ms
Total Duration: ${d-y}ms`),C.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:I}))))}}function Dm(n,t){return new Vm(n,t)}class km{constructor(){this.changes=new Ve((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,Tt.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const r=this.changes.get(e);return r!==void 0?C.resolve(r):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Nm{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Om{constructor(t,e,r,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=r,this.indexManager=s}getDocument(t,e){let r=null;return this.documentOverlayCache.getOverlay(t,e).next((s=>(r=s,this.remoteDocumentCache.getEntry(t,e)))).next((s=>(r!==null&&On(r.mutation,s,Nt.empty(),tt.now()),s)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((r=>this.getLocalViewOfDocuments(t,r,z()).next((()=>r))))}getLocalViewOfDocuments(t,e,r=z()){const s=ve();return this.populateOverlays(t,s,e).next((()=>this.computeViews(t,e,s,r).next((o=>{let a=Cn();return o.forEach(((u,h)=>{a=a.insert(u,h.overlayedDocument)})),a}))))}getOverlayedDocuments(t,e){const r=ve();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,z())))}populateOverlays(t,e,r){const s=[];return r.forEach((o=>{e.has(o)||s.push(o)})),this.documentOverlayCache.getOverlays(t,s).next((o=>{o.forEach(((a,u)=>{e.set(a,u)}))}))}computeViews(t,e,r,s){let o=Wt();const a=Nn(),u=(function(){return Nn()})();return e.forEach(((h,d)=>{const y=r.get(d.key);s.has(d.key)&&(y===void 0||y.mutation instanceof De)?o=o.insert(d.key,d):y!==void 0?(a.set(d.key,y.mutation.getFieldMask()),On(y.mutation,d,y.mutation.getFieldMask(),tt.now())):a.set(d.key,Nt.empty())})),this.recalculateAndSaveOverlays(t,o).next((h=>(h.forEach(((d,y)=>a.set(d,y))),e.forEach(((d,y)=>u.set(d,new Nm(y,a.get(d)??null)))),u)))}recalculateAndSaveOverlays(t,e){const r=Nn();let s=new et(((a,u)=>a-u)),o=z();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((a=>{for(const u of a)u.keys().forEach((h=>{const d=e.get(h);if(d===null)return;let y=r.get(h)||Nt.empty();y=u.applyToLocalView(d,y),r.set(h,y);const I=(s.get(u.batchId)||z()).add(h);s=s.insert(u.batchId,I)}))})).next((()=>{const a=[],u=s.getReverseIterator();for(;u.hasNext();){const h=u.getNext(),d=h.key,y=h.value,I=Tl();y.forEach((R=>{if(!o.has(R)){const P=Rl(e.get(R),r.get(R));P!==null&&I.set(R,P),o=o.add(R)}})),a.push(this.documentOverlayCache.saveOverlays(t,d,I))}return C.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((r=>this.recalculateAndSaveOverlays(t,r)))}getDocumentsMatchingQuery(t,e,r,s){return(function(a){return x.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):Mf(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,s):this.getDocumentsMatchingCollectionQuery(t,e,r,s)}getNextDocuments(t,e,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,s).next((o=>{const a=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,s-o.size):C.resolve(ve());let u=Un,h=o;return a.next((d=>C.forEach(d,((y,I)=>(u<I.largestBatchId&&(u=I.largestBatchId),o.get(y)?C.resolve():this.remoteDocumentCache.getEntry(t,y).next((R=>{h=h.insert(y,R)}))))).next((()=>this.populateOverlays(t,d,o))).next((()=>this.computeViews(t,h,d,z()))).next((y=>({batchId:u,changes:El(y)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new x(e)).next((r=>{let s=Cn();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(t,e,r,s){const o=e.collectionGroup;let a=Cn();return this.indexManager.getCollectionParents(t,o).next((u=>C.forEach(u,(h=>{const d=(function(I,R){return new ls(R,null,I.explicitOrderBy.slice(),I.filters.slice(),I.limit,I.limitType,I.startAt,I.endAt)})(e,h.child(o));return this.getDocumentsMatchingCollectionQuery(t,d,r,s).next((y=>{y.forEach(((I,R)=>{a=a.insert(I,R)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(t,e,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next((a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,o,s)))).next((a=>{o.forEach(((h,d)=>{const y=d.getKey();a.get(y)===null&&(a=a.insert(y,Tt.newInvalidDocument(y)))}));let u=Cn();return a.forEach(((h,d)=>{const y=o.get(h);y!==void 0&&On(y.mutation,d,Nt.empty(),tt.now()),hs(e,d)&&(u=u.insert(h,d))})),u}))}}class Mm{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return C.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,(function(s){return{id:s.id,version:s.version,createTime:Ut(s.createTime)}})(e)),C.resolve()}getNamedQuery(t,e){return C.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,(function(s){return{name:s.name,query:Am(s.bundledQuery),readTime:Ut(s.readTime)}})(e)),C.resolve()}}class xm{constructor(){this.overlays=new et(x.comparator),this.qr=new Map}getOverlay(t,e){return C.resolve(this.overlays.get(e))}getOverlays(t,e){const r=ve();return C.forEach(e,(s=>this.getOverlay(t,s).next((o=>{o!==null&&r.set(s,o)})))).next((()=>r))}saveOverlays(t,e,r){return r.forEach(((s,o)=>{this.St(t,e,o)})),C.resolve()}removeOverlaysForBatchId(t,e,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),C.resolve()}getOverlaysForCollection(t,e,r){const s=ve(),o=e.length+1,a=new x(e.child("")),u=this.overlays.getIteratorFrom(a);for(;u.hasNext();){const h=u.getNext().value,d=h.getKey();if(!e.isPrefixOf(d.path))break;d.path.length===o&&h.largestBatchId>r&&s.set(h.getKey(),h)}return C.resolve(s)}getOverlaysForCollectionGroup(t,e,r,s){let o=new et(((d,y)=>d-y));const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===e&&d.largestBatchId>r){let y=o.get(d.largestBatchId);y===null&&(y=ve(),o=o.insert(d.largestBatchId,y)),y.set(d.getKey(),d)}}const u=ve(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((d,y)=>u.set(d,y))),!(u.size()>=s)););return C.resolve(u)}St(t,e,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new tm(e,r));let o=this.qr.get(e);o===void 0&&(o=z(),this.qr.set(e,o)),this.qr.set(e,o.add(r.key))}}class Lm{constructor(){this.sessionToken=pt.EMPTY_BYTE_STRING}getSessionToken(t){return C.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,C.resolve()}}class Ki{constructor(){this.Qr=new ut(ft.$r),this.Ur=new ut(ft.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){const r=new ft(t,e);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(t,e){t.forEach((r=>this.addReference(r,e)))}removeReference(t,e){this.Gr(new ft(t,e))}zr(t,e){t.forEach((r=>this.removeReference(r,e)))}jr(t){const e=new x(new Z([])),r=new ft(e,t),s=new ft(e,t+1),o=[];return this.Ur.forEachInRange([r,s],(a=>{this.Gr(a),o.push(a.key)})),o}Jr(){this.Qr.forEach((t=>this.Gr(t)))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){const e=new x(new Z([])),r=new ft(e,t),s=new ft(e,t+1);let o=z();return this.Ur.forEachInRange([r,s],(a=>{o=o.add(a.key)})),o}containsKey(t){const e=new ft(t,0),r=this.Qr.firstAfterOrEqual(e);return r!==null&&t.isEqual(r.key)}}class ft{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return x.comparator(t.key,e.key)||$(t.Yr,e.Yr)}static Kr(t,e){return $(t.Yr,e.Yr)||x.comparator(t.key,e.key)}}class Fm{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new ut(ft.$r)}checkEmpty(t){return C.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,r,s){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new Zf(o,e,r,s);this.mutationQueue.push(a);for(const u of s)this.Zr=this.Zr.add(new ft(u.key,o)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast());return C.resolve(a)}lookupMutationBatch(t,e){return C.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){const r=e+1,s=this.ei(r),o=s<0?0:s;return C.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return C.resolve(this.mutationQueue.length===0?xi:this.tr-1)}getAllMutationBatches(t){return C.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const r=new ft(e,0),s=new ft(e,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,s],(a=>{const u=this.Xr(a.Yr);o.push(u)})),C.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new ut($);return e.forEach((s=>{const o=new ft(s,0),a=new ft(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,a],(u=>{r=r.add(u.Yr)}))})),C.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(t,e){const r=e.path,s=r.length+1;let o=r;x.isDocumentKey(o)||(o=o.child(""));const a=new ft(new x(o),0);let u=new ut($);return this.Zr.forEachWhile((h=>{const d=h.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(u=u.add(h.Yr)),!0)}),a),C.resolve(this.ti(u))}ti(t){const e=[];return t.forEach((r=>{const s=this.Xr(r);s!==null&&e.push(s)})),e}removeMutationBatch(t,e){X(this.ni(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return C.forEach(e.mutations,(s=>{const o=new ft(s.key,e.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.Zr=r}))}ir(t){}containsKey(t,e){const r=new ft(e,0),s=this.Zr.firstAfterOrEqual(r);return C.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,C.resolve()}ni(t,e){return this.ei(t)}ei(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Xr(t){const e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Bm{constructor(t){this.ri=t,this.docs=(function(){return new et(x.comparator)})(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const r=e.key,s=this.docs.get(r),o=s?s.size:0,a=this.ri(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const r=this.docs.get(e);return C.resolve(r?r.document.mutableCopy():Tt.newInvalidDocument(e))}getEntries(t,e){let r=Wt();return e.forEach((s=>{const o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():Tt.newInvalidDocument(s))})),C.resolve(r)}getDocumentsMatchingQuery(t,e,r,s){let o=Wt();const a=e.path,u=new x(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(u);for(;h.hasNext();){const{key:d,value:{document:y}}=h.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||df(hf(y),r)<=0||(s.has(y.key)||hs(e,y))&&(o=o.insert(y.key,y.mutableCopy()))}return C.resolve(o)}getAllFromCollectionGroup(t,e,r,s){F(9500)}ii(t,e){return C.forEach(this.docs,(r=>e(r)))}newChangeBuffer(t){return new Um(this)}getSize(t){return C.resolve(this.size)}}class Um extends km{constructor(t){super(),this.Nr=t}applyChanges(t){const e=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?e.push(this.Nr.addEntry(t,s)):this.Nr.removeEntry(r)})),C.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}}class jm{constructor(t){this.persistence=t,this.si=new Ve((e=>Bi(e)),Ui),this.lastRemoteSnapshotVersion=B.min(),this.highestTargetId=0,this.oi=0,this._i=new Ki,this.targetCount=0,this.ai=en.ur()}forEachTarget(t,e){return this.si.forEach(((r,s)=>e(s))),C.resolve()}getLastRemoteSnapshotVersion(t){return C.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return C.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),C.resolve(this.highestTargetId)}setTargetsMetadata(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this.oi&&(this.oi=e),C.resolve()}Pr(t){this.si.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.ai=new en(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,C.resolve()}updateTargetData(t,e){return this.Pr(e),C.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,C.resolve()}removeTargets(t,e,r){let s=0;const o=[];return this.si.forEach(((a,u)=>{u.sequenceNumber<=e&&r.get(u.targetId)===null&&(this.si.delete(a),o.push(this.removeMatchingKeysForTargetId(t,u.targetId)),s++)})),C.waitFor(o).next((()=>s))}getTargetCount(t){return C.resolve(this.targetCount)}getTargetData(t,e){const r=this.si.get(e)||null;return C.resolve(r)}addMatchingKeys(t,e,r){return this._i.Wr(e,r),C.resolve()}removeMatchingKeys(t,e,r){this._i.zr(e,r);const s=this.persistence.referenceDelegate,o=[];return s&&e.forEach((a=>{o.push(s.markPotentiallyOrphaned(t,a))})),C.waitFor(o)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),C.resolve()}getMatchingKeysForTargetId(t,e){const r=this._i.Hr(e);return C.resolve(r)}containsKey(t,e){return C.resolve(this._i.containsKey(e))}}class Bl{constructor(t,e){this.ui={},this.overlays={},this.ci=new os(0),this.li=!1,this.li=!0,this.hi=new Lm,this.referenceDelegate=t(this),this.Pi=new jm(this),this.indexManager=new Sm,this.remoteDocumentCache=(function(s){return new Bm(s)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new wm(e),this.Ii=new Mm(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new xm,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let r=this.ui[t.toKey()];return r||(r=new Fm(e,this.referenceDelegate),this.ui[t.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,r){k("MemoryPersistence","Starting transaction:",t);const s=new qm(this.ci.next());return this.referenceDelegate.Ei(),r(s).next((o=>this.referenceDelegate.di(s).next((()=>o)))).toPromise().then((o=>(s.raiseOnCommittedEvent(),o)))}Ai(t,e){return C.or(Object.values(this.ui).map((r=>()=>r.containsKey(t,e))))}}class qm extends mf{constructor(t){super(),this.currentSequenceNumber=t}}class Wi{constructor(t){this.persistence=t,this.Ri=new Ki,this.Vi=null}static mi(t){return new Wi(t)}get fi(){if(this.Vi)return this.Vi;throw F(60996)}addReference(t,e,r){return this.Ri.addReference(r,e),this.fi.delete(r.toString()),C.resolve()}removeReference(t,e,r){return this.Ri.removeReference(r,e),this.fi.add(r.toString()),C.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),C.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach((s=>this.fi.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((s=>{s.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(t,e)))}Ei(){this.Vi=new Set}di(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return C.forEach(this.fi,(r=>{const s=x.fromPath(r);return this.gi(t,s).next((o=>{o||e.removeEntry(s,B.min())}))})).next((()=>(this.Vi=null,e.apply(t))))}updateLimboDocument(t,e){return this.gi(t,e).next((r=>{r?this.fi.delete(e.toString()):this.fi.add(e.toString())}))}Ti(t){return 0}gi(t,e){return C.or([()=>C.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}}class Jr{constructor(t,e){this.persistence=t,this.pi=new Ve((r=>_f(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=Dm(this,e)}static mi(t,e){return new Jr(t,e)}Ei(){}di(t){return C.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){const e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next((r=>e.next((s=>r+s))))}wr(t){let e=0;return this.pr(t,(r=>{e++})).next((()=>e))}pr(t,e){return C.forEach(this.pi,((r,s)=>this.br(t,r,s).next((o=>o?C.resolve():e(s)))))}removeTargets(t,e,r){return this.persistence.getTargetCache().removeTargets(t,e,r)}removeOrphanedDocuments(t,e){let r=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ii(t,(a=>this.br(t,a,e).next((u=>{u||(r++,o.removeEntry(a,B.min()))})))).next((()=>o.apply(t))).next((()=>r))}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),C.resolve()}removeTarget(t,e){const r=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,r)}addReference(t,e,r){return this.pi.set(r,t.currentSequenceNumber),C.resolve()}removeReference(t,e,r){return this.pi.set(r,t.currentSequenceNumber),C.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),C.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Dr(t.data.value)),e}br(t,e,r){return C.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const s=this.pi.get(e);return C.resolve(s!==void 0&&s>r)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class Qi{constructor(t,e,r,s){this.targetId=t,this.fromCache=e,this.Es=r,this.ds=s}static As(t,e){let r=z(),s=z();for(const o of e.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new Qi(t,e.fromCache,r,s)}}class $m{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class zm{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return kh()?8:gf(Vh())>0?6:4})()}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,r,s){const o={result:null};return this.ys(t,e).next((a=>{o.result=a})).next((()=>{if(!o.result)return this.ws(t,e,s,r).next((a=>{o.result=a}))})).next((()=>{if(o.result)return;const a=new $m;return this.Ss(t,e,a).next((u=>{if(o.result=u,this.Vs)return this.bs(t,e,a,u.size)}))})).next((()=>o.result))}bs(t,e,r,s){return r.documentReadCount<this.fs?(xe()<=H.DEBUG&&k("QueryEngine","SDK will not create cache indexes for query:",Le(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),C.resolve()):(xe()<=H.DEBUG&&k("QueryEngine","Query:",Le(e),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?(xe()<=H.DEBUG&&k("QueryEngine","The SDK decides to create cache indexes for query:",Le(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Bt(e))):C.resolve())}ys(t,e){if(Xa(e))return C.resolve(null);let r=Bt(e);return this.indexManager.getIndexType(t,r).next((s=>s===0?null:(e.limit!==null&&s===1&&(e=ui(e,null,"F"),r=Bt(e)),this.indexManager.getDocumentsMatchingTarget(t,r).next((o=>{const a=z(...o);return this.ps.getDocuments(t,a).next((u=>this.indexManager.getMinOffset(t,r).next((h=>{const d=this.Ds(e,u);return this.Cs(e,d,a,h.readTime)?this.ys(t,ui(e,null,"F")):this.vs(t,d,e,h)}))))})))))}ws(t,e,r,s){return Xa(e)||s.isEqual(B.min())?C.resolve(null):this.ps.getDocuments(t,r).next((o=>{const a=this.Ds(e,o);return this.Cs(e,a,r,s)?C.resolve(null):(xe()<=H.DEBUG&&k("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),Le(e)),this.vs(t,a,e,uf(s,Un)).next((u=>u)))}))}Ds(t,e){let r=new ut(_l(t));return e.forEach(((s,o)=>{hs(t,o)&&(r=r.add(o))})),r}Cs(t,e,r,s){if(t.limit===null)return!1;if(r.size!==e.size)return!0;const o=t.limitType==="F"?e.last():e.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}Ss(t,e,r){return xe()<=H.DEBUG&&k("QueryEngine","Using full collection scan to execute query:",Le(e)),this.ps.getDocumentsMatchingQuery(t,e,ce.min(),r)}vs(t,e,r,s){return this.ps.getDocumentsMatchingQuery(t,r,s).next((o=>(e.forEach((a=>{o=o.insert(a.key,a)})),o)))}}const Xi="LocalStore",Gm=3e8;class Hm{constructor(t,e,r,s){this.persistence=t,this.Fs=e,this.serializer=s,this.Ms=new et($),this.xs=new Ve((o=>Bi(o)),Ui),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(r)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Om(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ms)))}}function Km(n,t,e,r){return new Hm(n,t,e,r)}async function Ul(n,t){const e=U(n);return await e.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return e.mutationQueue.getAllMutationBatches(r).next((o=>(s=o,e.Bs(t),e.mutationQueue.getAllMutationBatches(r)))).next((o=>{const a=[],u=[];let h=z();for(const d of s){a.push(d.batchId);for(const y of d.mutations)h=h.add(y.key)}for(const d of o){u.push(d.batchId);for(const y of d.mutations)h=h.add(y.key)}return e.localDocuments.getDocuments(r,h).next((d=>({Ls:d,removedBatchIds:a,addedBatchIds:u})))}))}))}function Wm(n,t){const e=U(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=t.batch.keys(),o=e.Ns.newChangeBuffer({trackRemovals:!0});return(function(u,h,d,y){const I=d.batch,R=I.keys();let P=C.resolve();return R.forEach((M=>{P=P.next((()=>y.getEntry(h,M))).next((L=>{const D=d.docVersions.get(M);X(D!==null,48541),L.version.compareTo(D)<0&&(I.applyToRemoteDocument(L,d),L.isValidDocument()&&(L.setReadTime(d.commitVersion),y.addEntry(L)))}))})),P.next((()=>u.mutationQueue.removeMutationBatch(h,I)))})(e,r,t,o).next((()=>o.apply(r))).next((()=>e.mutationQueue.performConsistencyCheck(r))).next((()=>e.documentOverlayCache.removeOverlaysForBatchId(r,s,t.batch.batchId))).next((()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(u){let h=z();for(let d=0;d<u.mutationResults.length;++d)u.mutationResults[d].transformResults.length>0&&(h=h.add(u.batch.mutations[d].key));return h})(t)))).next((()=>e.localDocuments.getDocuments(r,s)))}))}function jl(n){const t=U(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Pi.getLastRemoteSnapshotVersion(e)))}function Qm(n,t){const e=U(n),r=t.snapshotVersion;let s=e.Ms;return e.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const a=e.Ns.newChangeBuffer({trackRemovals:!0});s=e.Ms;const u=[];t.targetChanges.forEach(((y,I)=>{const R=s.get(I);if(!R)return;u.push(e.Pi.removeMatchingKeys(o,y.removedDocuments,I).next((()=>e.Pi.addMatchingKeys(o,y.addedDocuments,I))));let P=R.withSequenceNumber(o.currentSequenceNumber);t.targetMismatches.get(I)!==null?P=P.withResumeToken(pt.EMPTY_BYTE_STRING,B.min()).withLastLimboFreeSnapshotVersion(B.min()):y.resumeToken.approximateByteSize()>0&&(P=P.withResumeToken(y.resumeToken,r)),s=s.insert(I,P),(function(L,D,K){return L.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-L.snapshotVersion.toMicroseconds()>=Gm?!0:K.addedDocuments.size+K.modifiedDocuments.size+K.removedDocuments.size>0})(R,P,y)&&u.push(e.Pi.updateTargetData(o,P))}));let h=Wt(),d=z();if(t.documentUpdates.forEach((y=>{t.resolvedLimboDocuments.has(y)&&u.push(e.persistence.referenceDelegate.updateLimboDocument(o,y))})),u.push(Xm(o,a,t.documentUpdates).next((y=>{h=y.ks,d=y.qs}))),!r.isEqual(B.min())){const y=e.Pi.getLastRemoteSnapshotVersion(o).next((I=>e.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));u.push(y)}return C.waitFor(u).next((()=>a.apply(o))).next((()=>e.localDocuments.getLocalViewOfDocuments(o,h,d))).next((()=>h))})).then((o=>(e.Ms=s,o)))}function Xm(n,t,e){let r=z(),s=z();return e.forEach((o=>r=r.add(o))),t.getEntries(n,r).next((o=>{let a=Wt();return e.forEach(((u,h)=>{const d=o.get(u);h.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(u)),h.isNoDocument()&&h.version.isEqual(B.min())?(t.removeEntry(u,h.readTime),a=a.insert(u,h)):!d.isValidDocument()||h.version.compareTo(d.version)>0||h.version.compareTo(d.version)===0&&d.hasPendingWrites?(t.addEntry(h),a=a.insert(u,h)):k(Xi,"Ignoring outdated watch update for ",u,". Current version:",d.version," Watch version:",h.version)})),{ks:a,qs:s}}))}function Jm(n,t){const e=U(n);return e.persistence.runTransaction("Get next mutation batch","readonly",(r=>(t===void 0&&(t=xi),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t))))}function Ym(n,t){const e=U(n);return e.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return e.Pi.getTargetData(r,t).next((o=>o?(s=o,C.resolve(s)):e.Pi.allocateTargetId(r).next((a=>(s=new ee(t,a,"TargetPurposeListen",r.currentSequenceNumber),e.Pi.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=e.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.Ms=e.Ms.insert(r.targetId,r),e.xs.set(t,r.targetId)),r}))}async function gi(n,t,e){const r=U(n),s=r.Ms.get(t),o=e?"readwrite":"readwrite-primary";try{e||await r.persistence.runTransaction("Release target",o,(a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!cn(a))throw a;k(Xi,`Failed to update sequence numbers for target ${t}: ${a}`)}r.Ms=r.Ms.remove(t),r.xs.delete(s.target)}function lc(n,t,e){const r=U(n);let s=B.min(),o=z();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(h,d,y){const I=U(h),R=I.xs.get(y);return R!==void 0?C.resolve(I.Ms.get(R)):I.Pi.getTargetData(d,y)})(r,a,Bt(t)).next((u=>{if(u)return s=u.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,u.targetId).next((h=>{o=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(a,t,e?s:B.min(),e?o:z()))).next((u=>(Zm(r,Lf(t),u),{documents:u,Qs:o})))))}function Zm(n,t,e){let r=n.Os.get(t)||B.min();e.forEach(((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),n.Os.set(t,r)}class uc{constructor(){this.activeTargetIds=$f()}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class tg{constructor(){this.Mo=new uc,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,r){}addLocalQueryTarget(t,e=!0){return e&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,r){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new uc,Promise.resolve()}handleUserChange(t,e,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class eg{Oo(t){}shutdown(){}}const hc="ConnectivityMonitor";class dc{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){k(hc,"Network connectivity changed: AVAILABLE");for(const t of this.qo)t(0)}ko(){k(hc,"Network connectivity changed: UNAVAILABLE");for(const t of this.qo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Rr=null;function pi(){return Rr===null?Rr=(function(){return 268435456+Math.round(2147483648*Math.random())})():Rr++,"0x"+Rr.toString(16)}const Qs="RestConnection",ng={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class rg{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===Gr?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(t,e,r,s,o){const a=pi(),u=this.zo(t,e.toUriEncodedString());k(Qs,`Sending RPC '${t}' ${a}:`,u,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,s,o);const{host:d}=new URL(u),y=Di(d);return this.Jo(t,u,h,r,y).then((I=>(k(Qs,`Received RPC '${t}' ${a}: `,I),I)),(I=>{throw Je(Qs,`RPC '${t}' ${a} failed with error: `,I,"url: ",u,"request:",r),I}))}Ho(t,e,r,s,o,a){return this.Go(t,e,r,s,o)}jo(t,e,r){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+on})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((s,o)=>t[o]=s)),r&&r.headers.forEach(((s,o)=>t[o]=s))}zo(t,e){const r=ng[t];return`${this.Uo}/v1/${e}:${r}`}terminate(){}}class sg{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}}const yt="WebChannelConnection";class ig extends rg{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,r,s,o){const a=pi();return new Promise(((u,h)=>{const d=new Gc;d.setWithCredentials(!0),d.listenOnce(Hc.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case Vr.NO_ERROR:const I=d.getResponseJson();k(yt,`XHR for RPC '${t}' ${a} received:`,JSON.stringify(I)),u(I);break;case Vr.TIMEOUT:k(yt,`RPC '${t}' ${a} timed out`),h(new O(b.DEADLINE_EXCEEDED,"Request time out"));break;case Vr.HTTP_ERROR:const R=d.getStatus();if(k(yt,`RPC '${t}' ${a} failed with status:`,R,"response text:",d.getResponseText()),R>0){let P=d.getResponseJson();Array.isArray(P)&&(P=P[0]);const M=P?.error;if(M&&M.status&&M.message){const L=(function(K){const W=K.toLowerCase().replace(/_/g,"-");return Object.values(b).indexOf(W)>=0?W:b.UNKNOWN})(M.status);h(new O(L,M.message))}else h(new O(b.UNKNOWN,"Server responded with status "+d.getStatus()))}else h(new O(b.UNAVAILABLE,"Connection failed."));break;default:F(9055,{l_:t,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{k(yt,`RPC '${t}' ${a} completed.`)}}));const y=JSON.stringify(s);k(yt,`RPC '${t}' ${a} sending request:`,s),d.send(e,"POST",y,r,15)}))}T_(t,e,r){const s=pi(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=Qc(),u=Wc(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(h.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,e,r),h.encodeInitMessageHeaders=!0;const y=o.join("");k(yt,`Creating RPC '${t}' stream ${s}: ${y}`,h);const I=a.createWebChannel(y,h);this.I_(I);let R=!1,P=!1;const M=new sg({Yo:D=>{P?k(yt,`Not sending because RPC '${t}' stream ${s} is closed:`,D):(R||(k(yt,`Opening RPC '${t}' stream ${s} transport.`),I.open(),R=!0),k(yt,`RPC '${t}' stream ${s} sending:`,D),I.send(D))},Zo:()=>I.close()}),L=(D,K,W)=>{D.listen(K,(Q=>{try{W(Q)}catch(vt){setTimeout((()=>{throw vt}),0)}}))};return L(I,Rn.EventType.OPEN,(()=>{P||(k(yt,`RPC '${t}' stream ${s} transport opened.`),M.o_())})),L(I,Rn.EventType.CLOSE,(()=>{P||(P=!0,k(yt,`RPC '${t}' stream ${s} transport closed`),M.a_(),this.E_(I))})),L(I,Rn.EventType.ERROR,(D=>{P||(P=!0,Je(yt,`RPC '${t}' stream ${s} transport errored. Name:`,D.name,"Message:",D.message),M.a_(new O(b.UNAVAILABLE,"The operation could not be completed")))})),L(I,Rn.EventType.MESSAGE,(D=>{if(!P){const K=D.data[0];X(!!K,16349);const W=K,Q=W?.error||W[0]?.error;if(Q){k(yt,`RPC '${t}' stream ${s} received error:`,Q);const vt=Q.status;let St=(function(m){const _=it[m];if(_!==void 0)return bl(_)})(vt),ht=Q.message;St===void 0&&(St=b.INTERNAL,ht="Unknown error status: "+vt+" with message "+Q.message),P=!0,M.a_(new O(St,ht)),I.close()}else k(yt,`RPC '${t}' stream ${s} received:`,K),M.u_(K)}})),L(u,Kc.STAT_EVENT,(D=>{D.stat===si.PROXY?k(yt,`RPC '${t}' stream ${s} detected buffering proxy`):D.stat===si.NOPROXY&&k(yt,`RPC '${t}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{M.__()}),0),M}terminate(){this.c_.forEach((t=>t.close())),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter((e=>e===t))}}function Xs(){return typeof document<"u"?document:null}function gs(n){return new lm(n,!0)}class ql{constructor(t,e,r=1e3,s=1.5,o=6e4){this.Mi=t,this.timerId=e,this.d_=r,this.A_=s,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();const e=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,e-r);s>0&&k("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${e} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),t()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const fc="PersistentStream";class $l{constructor(t,e,r,s,o,a,u,h){this.Mi=t,this.S_=r,this.b_=s,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=u,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new ql(t,e)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(t){this.Q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():e&&e.code===b.RESOURCE_EXHAUSTED?(Kt(e.toString()),Kt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===b.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.r_(e)}K_(){}auth(){this.state=1;const t=this.W_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===e&&this.G_(r,s)}),(r=>{t((()=>{const s=new O(b.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(t,e){const r=this.W_(this.D_);this.stream=this.j_(t,e),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(t){return k(fc,`close with error: ${t}`),this.stream=null,this.close(4,t)}W_(t){return e=>{this.Mi.enqueueAndForget((()=>this.D_===t?e():(k(fc,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class og extends $l{constructor(t,e,r,s,o,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,r,s,a),this.serializer=o}j_(t,e){return this.connection.T_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();const e=dm(this.serializer,t),r=(function(o){if(!("targetChange"in o))return B.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?B.min():a.readTime?Ut(a.readTime):B.min()})(t);return this.listener.H_(e,r)}Y_(t){const e={};e.database=mi(this.serializer),e.addTarget=(function(o,a){let u;const h=a.target;if(u=li(h)?{documents:gm(o,h)}:{query:pm(o,h).ft},u.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){u.resumeToken=Dl(o,a.resumeToken);const d=hi(o,a.expectedCount);d!==null&&(u.expectedCount=d)}else if(a.snapshotVersion.compareTo(B.min())>0){u.readTime=Xr(o,a.snapshotVersion.toTimestamp());const d=hi(o,a.expectedCount);d!==null&&(u.expectedCount=d)}return u})(this.serializer,t);const r=ym(this.serializer,t);r&&(e.labels=r),this.q_(e)}Z_(t){const e={};e.database=mi(this.serializer),e.removeTarget=t,this.q_(e)}}class ag extends $l{constructor(t,e,r,s,o,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,r,s,a),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}J_(t){return X(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,X(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){X(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const e=mm(t.writeResults,t.commitTime),r=Ut(t.commitTime);return this.listener.na(r,e)}ra(){const t={};t.database=mi(this.serializer),this.q_(t)}ea(t){const e={streamToken:this.lastStreamToken,writes:t.map((r=>fm(this.serializer,r)))};this.q_(e)}}class cg{}class lg extends cg{constructor(t,e,r,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new O(b.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Go(t,di(e,r),s,o,a))).catch((o=>{throw o.name==="FirebaseError"?(o.code===b.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new O(b.UNKNOWN,o.toString())}))}Ho(t,e,r,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,u])=>this.connection.Ho(t,di(e,r),s,a,u,o))).catch((a=>{throw a.name==="FirebaseError"?(a.code===b.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new O(b.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class ug{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Kt(e),this.aa=!1):k("OnlineStateTracker",e)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Ce="RemoteStore";class hg{constructor(t,e,r,s,o){this.localStore=t,this.datastore=e,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((a=>{r.enqueueAndForget((async()=>{ke(this)&&(k(Ce,"Restarting streams for network reachability change."),await(async function(h){const d=U(h);d.Ea.add(4),await nr(d),d.Ra.set("Unknown"),d.Ea.delete(4),await ps(d)})(this))}))})),this.Ra=new ug(r,s)}}async function ps(n){if(ke(n))for(const t of n.da)await t(!0)}async function nr(n){for(const t of n.da)await t(!1)}function zl(n,t){const e=U(n);e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),to(e)?Zi(e):ln(e).O_()&&Yi(e,t))}function Ji(n,t){const e=U(n),r=ln(e);e.Ia.delete(t),r.O_()&&Gl(e,t),e.Ia.size===0&&(r.O_()?r.L_():ke(e)&&e.Ra.set("Unknown"))}function Yi(n,t){if(n.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(B.min())>0){const e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}ln(n).Y_(t)}function Gl(n,t){n.Va.Ue(t),ln(n).Z_(t)}function Zi(n){n.Va=new im({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),At:t=>n.Ia.get(t)||null,ht:()=>n.datastore.serializer.databaseId}),ln(n).start(),n.Ra.ua()}function to(n){return ke(n)&&!ln(n).x_()&&n.Ia.size>0}function ke(n){return U(n).Ea.size===0}function Hl(n){n.Va=void 0}async function dg(n){n.Ra.set("Online")}async function fg(n){n.Ia.forEach(((t,e)=>{Yi(n,t)}))}async function mg(n,t){Hl(n),to(n)?(n.Ra.ha(t),Zi(n)):n.Ra.set("Unknown")}async function gg(n,t,e){if(n.Ra.set("Online"),t instanceof Vl&&t.state===2&&t.cause)try{await(async function(s,o){const a=o.cause;for(const u of o.targetIds)s.Ia.has(u)&&(await s.remoteSyncer.rejectListen(u,a),s.Ia.delete(u),s.Va.removeTarget(u))})(n,t)}catch(r){k(Ce,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await Yr(n,r)}else if(t instanceof Or?n.Va.Ze(t):t instanceof Pl?n.Va.st(t):n.Va.tt(t),!e.isEqual(B.min()))try{const r=await jl(n.localStore);e.compareTo(r)>=0&&await(function(o,a){const u=o.Va.Tt(a);return u.targetChanges.forEach(((h,d)=>{if(h.resumeToken.approximateByteSize()>0){const y=o.Ia.get(d);y&&o.Ia.set(d,y.withResumeToken(h.resumeToken,a))}})),u.targetMismatches.forEach(((h,d)=>{const y=o.Ia.get(h);if(!y)return;o.Ia.set(h,y.withResumeToken(pt.EMPTY_BYTE_STRING,y.snapshotVersion)),Gl(o,h);const I=new ee(y.target,h,d,y.sequenceNumber);Yi(o,I)})),o.remoteSyncer.applyRemoteEvent(u)})(n,e)}catch(r){k(Ce,"Failed to raise snapshot:",r),await Yr(n,r)}}async function Yr(n,t,e){if(!cn(t))throw t;n.Ea.add(1),await nr(n),n.Ra.set("Offline"),e||(e=()=>jl(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{k(Ce,"Retrying IndexedDB access"),await e(),n.Ea.delete(1),await ps(n)}))}function Kl(n,t){return t().catch((e=>Yr(n,e,t)))}async function _s(n){const t=U(n),e=de(t);let r=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:xi;for(;pg(t);)try{const s=await Jm(t.localStore,r);if(s===null){t.Ta.length===0&&e.L_();break}r=s.batchId,_g(t,s)}catch(s){await Yr(t,s)}Wl(t)&&Ql(t)}function pg(n){return ke(n)&&n.Ta.length<10}function _g(n,t){n.Ta.push(t);const e=de(n);e.O_()&&e.X_&&e.ea(t.mutations)}function Wl(n){return ke(n)&&!de(n).x_()&&n.Ta.length>0}function Ql(n){de(n).start()}async function yg(n){de(n).ra()}async function Eg(n){const t=de(n);for(const e of n.Ta)t.ea(e.mutations)}async function Tg(n,t,e){const r=n.Ta.shift(),s=zi.from(r,t,e);await Kl(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await _s(n)}async function vg(n,t){t&&de(n).X_&&await(async function(r,s){if((function(a){return nm(a)&&a!==b.ABORTED})(s.code)){const o=r.Ta.shift();de(r).B_(),await Kl(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s))),await _s(r)}})(n,t),Wl(n)&&Ql(n)}async function mc(n,t){const e=U(n);e.asyncQueue.verifyOperationInProgress(),k(Ce,"RemoteStore received new credentials");const r=ke(e);e.Ea.add(3),await nr(e),r&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await ps(e)}async function Ig(n,t){const e=U(n);t?(e.Ea.delete(2),await ps(e)):t||(e.Ea.add(2),await nr(e),e.Ra.set("Unknown"))}function ln(n){return n.ma||(n.ma=(function(e,r,s){const o=U(e);return o.sa(),new og(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:dg.bind(null,n),t_:fg.bind(null,n),r_:mg.bind(null,n),H_:gg.bind(null,n)}),n.da.push((async t=>{t?(n.ma.B_(),to(n)?Zi(n):n.Ra.set("Unknown")):(await n.ma.stop(),Hl(n))}))),n.ma}function de(n){return n.fa||(n.fa=(function(e,r,s){const o=U(e);return o.sa(),new ag(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:yg.bind(null,n),r_:vg.bind(null,n),ta:Eg.bind(null,n),na:Tg.bind(null,n)}),n.da.push((async t=>{t?(n.fa.B_(),await _s(n)):(await n.fa.stop(),n.Ta.length>0&&(k(Ce,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class eo{constructor(t,e,r,s,o){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new ie,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,r,s,o){const a=Date.now()+r,u=new eo(t,e,a,s,o);return u.start(r),u}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new O(b.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function no(n,t){if(Kt("AsyncQueue",`${t}: ${n}`),cn(n))return new O(b.UNAVAILABLE,`${t}: ${n}`);throw n}class ze{static emptySet(t){return new ze(t.comparator)}constructor(t){this.comparator=t?(e,r)=>t(e,r)||x.comparator(e.key,r.key):(e,r)=>x.comparator(e.key,r.key),this.keyedMap=Cn(),this.sortedSet=new et(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,r)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof ze)||this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;e.hasNext();){const s=e.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){const r=new ze;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=e,r}}class gc{constructor(){this.ga=new et(x.comparator)}track(t){const e=t.doc.key,r=this.ga.get(e);r?t.type!==0&&r.type===3?this.ga=this.ga.insert(e,t):t.type===3&&r.type!==1?this.ga=this.ga.insert(e,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.ga=this.ga.remove(e):t.type===1&&r.type===2?this.ga=this.ga.insert(e,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):F(63341,{Rt:t,pa:r}):this.ga=this.ga.insert(e,t)}ya(){const t=[];return this.ga.inorderTraversal(((e,r)=>{t.push(r)})),t}}class nn{constructor(t,e,r,s,o,a,u,h,d){this.query=t,this.docs=e,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=u,this.excludesMetadataChanges=h,this.hasCachedResults=d}static fromInitialDocuments(t,e,r,s,o){const a=[];return e.forEach((u=>{a.push({type:0,doc:u})})),new nn(t,e,ze.emptySet(e),a,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&us(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,r=t.docChanges;if(e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==r[s].type||!e[s].doc.isEqual(r[s].doc))return!1;return!0}}class wg{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((t=>t.Da()))}}class Ag{constructor(){this.queries=pc(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(e,r){const s=U(e),o=s.queries;s.queries=pc(),o.forEach(((a,u)=>{for(const h of u.Sa)h.onError(r)}))})(this,new O(b.ABORTED,"Firestore shutting down"))}}function pc(){return new Ve((n=>pl(n)),us)}async function Xl(n,t){const e=U(n);let r=3;const s=t.query;let o=e.queries.get(s);o?!o.ba()&&t.Da()&&(r=2):(o=new wg,r=t.Da()?0:1);try{switch(r){case 0:o.wa=await e.onListen(s,!0);break;case 1:o.wa=await e.onListen(s,!1);break;case 2:await e.onFirstRemoteStoreListen(s)}}catch(a){const u=no(a,`Initialization of query '${Le(t.query)}' failed`);return void t.onError(u)}e.queries.set(s,o),o.Sa.push(t),t.va(e.onlineState),o.wa&&t.Fa(o.wa)&&ro(e)}async function Jl(n,t){const e=U(n),r=t.query;let s=3;const o=e.queries.get(r);if(o){const a=o.Sa.indexOf(t);a>=0&&(o.Sa.splice(a,1),o.Sa.length===0?s=t.Da()?0:1:!o.ba()&&t.Da()&&(s=2))}switch(s){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function Sg(n,t){const e=U(n);let r=!1;for(const s of t){const o=s.query,a=e.queries.get(o);if(a){for(const u of a.Sa)u.Fa(s)&&(r=!0);a.wa=s}}r&&ro(e)}function Rg(n,t,e){const r=U(n),s=r.queries.get(t);if(s)for(const o of s.Sa)o.onError(e);r.queries.delete(t)}function ro(n){n.Ca.forEach((t=>{t.next()}))}var _i,_c;(_c=_i||(_i={})).Ma="default",_c.Cache="cache";class Yl{constructor(t,e,r){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(t){if(!this.options.includeMetadataChanges){const r=[];for(const s of t.docChanges)s.type!==3&&r.push(s);t=new nn(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache||!this.Da())return!0;const r=e!=="Offline";return(!this.options.qa||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Ba(t){if(t.docChanges.length>0)return!0;const e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}ka(t){t=nn.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==_i.Cache}}class Zl{constructor(t){this.key=t}}class tu{constructor(t){this.key=t}}class Cg{constructor(t,e){this.query=t,this.Ya=e,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=z(),this.mutatedKeys=z(),this.eu=_l(t),this.tu=new ze(this.eu)}get nu(){return this.Ya}ru(t,e){const r=e?e.iu:new gc,s=e?e.tu:this.tu;let o=e?e.mutatedKeys:this.mutatedKeys,a=s,u=!1;const h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((y,I)=>{const R=s.get(y),P=hs(this.query,I)?I:null,M=!!R&&this.mutatedKeys.has(R.key),L=!!P&&(P.hasLocalMutations||this.mutatedKeys.has(P.key)&&P.hasCommittedMutations);let D=!1;R&&P?R.data.isEqual(P.data)?M!==L&&(r.track({type:3,doc:P}),D=!0):this.su(R,P)||(r.track({type:2,doc:P}),D=!0,(h&&this.eu(P,h)>0||d&&this.eu(P,d)<0)&&(u=!0)):!R&&P?(r.track({type:0,doc:P}),D=!0):R&&!P&&(r.track({type:1,doc:R}),D=!0,(h||d)&&(u=!0)),D&&(P?(a=a.add(P),o=L?o.add(y):o.delete(y)):(a=a.delete(y),o=o.delete(y)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const y=this.query.limitType==="F"?a.last():a.first();a=a.delete(y.key),o=o.delete(y.key),r.track({type:1,doc:y})}return{tu:a,iu:r,Cs:u,mutatedKeys:o}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,r,s){const o=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const a=t.iu.ya();a.sort(((y,I)=>(function(P,M){const L=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return F(20277,{Rt:D})}};return L(P)-L(M)})(y.type,I.type)||this.eu(y.doc,I.doc))),this.ou(r),s=s??!1;const u=e&&!s?this._u():[],h=this.Xa.size===0&&this.current&&!s?1:0,d=h!==this.Za;return this.Za=h,a.length!==0||d?{snapshot:new nn(this.query,t.tu,o,a,t.mutatedKeys,h===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:u}:{au:u}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new gc,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach((e=>this.Ya=this.Ya.add(e))),t.modifiedDocuments.forEach((e=>{})),t.removedDocuments.forEach((e=>this.Ya=this.Ya.delete(e))),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Xa;this.Xa=z(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const e=[];return t.forEach((r=>{this.Xa.has(r)||e.push(new tu(r))})),this.Xa.forEach((r=>{t.has(r)||e.push(new Zl(r))})),e}cu(t){this.Ya=t.Qs,this.Xa=z();const e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return nn.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const so="SyncEngine";class bg{constructor(t,e,r){this.query=t,this.targetId=e,this.view=r}}class Pg{constructor(t){this.key=t,this.hu=!1}}class Vg{constructor(t,e,r,s,o,a){this.localStore=t,this.remoteStore=e,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new Ve((u=>pl(u)),us),this.Iu=new Map,this.Eu=new Set,this.du=new et(x.comparator),this.Au=new Map,this.Ru=new Ki,this.Vu={},this.mu=new Map,this.fu=en.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function Dg(n,t,e=!0){const r=ou(n);let s;const o=r.Tu.get(t);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.lu()):s=await eu(r,t,e,!0),s}async function kg(n,t){const e=ou(n);await eu(e,t,!0,!1)}async function eu(n,t,e,r){const s=await Ym(n.localStore,Bt(t)),o=s.targetId,a=n.sharedClientState.addLocalQueryTarget(o,e);let u;return r&&(u=await Ng(n,t,o,a==="current",s.resumeToken)),n.isPrimaryClient&&e&&zl(n.remoteStore,s),u}async function Ng(n,t,e,r,s){n.pu=(I,R,P)=>(async function(L,D,K,W){let Q=D.view.ru(K);Q.Cs&&(Q=await lc(L.localStore,D.query,!1).then((({documents:T})=>D.view.ru(T,Q))));const vt=W&&W.targetChanges.get(D.targetId),St=W&&W.targetMismatches.get(D.targetId)!=null,ht=D.view.applyChanges(Q,L.isPrimaryClient,vt,St);return Ec(L,D.targetId,ht.au),ht.snapshot})(n,I,R,P);const o=await lc(n.localStore,t,!0),a=new Cg(t,o.Qs),u=a.ru(o.documents),h=er.createSynthesizedTargetChangeForCurrentChange(e,r&&n.onlineState!=="Offline",s),d=a.applyChanges(u,n.isPrimaryClient,h);Ec(n,e,d.au);const y=new bg(t,e,a);return n.Tu.set(t,y),n.Iu.has(e)?n.Iu.get(e).push(t):n.Iu.set(e,[t]),d.snapshot}async function Og(n,t,e){const r=U(n),s=r.Tu.get(t),o=r.Iu.get(s.targetId);if(o.length>1)return r.Iu.set(s.targetId,o.filter((a=>!us(a,t)))),void r.Tu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await gi(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),e&&Ji(r.remoteStore,s.targetId),yi(r,s.targetId)})).catch(an)):(yi(r,s.targetId),await gi(r.localStore,s.targetId,!0))}async function Mg(n,t){const e=U(n),r=e.Tu.get(t),s=e.Iu.get(r.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),Ji(e.remoteStore,r.targetId))}async function xg(n,t,e){const r=$g(n);try{const s=await(function(a,u){const h=U(a),d=tt.now(),y=u.reduce(((P,M)=>P.add(M.key)),z());let I,R;return h.persistence.runTransaction("Locally write mutations","readwrite",(P=>{let M=Wt(),L=z();return h.Ns.getEntries(P,y).next((D=>{M=D,M.forEach(((K,W)=>{W.isValidDocument()||(L=L.add(K))}))})).next((()=>h.localDocuments.getOverlayedDocuments(P,M))).next((D=>{I=D;const K=[];for(const W of u){const Q=Jf(W,I.get(W.key).overlayedDocument);Q!=null&&K.push(new De(W.key,Q,ll(Q.value.mapValue),Ot.exists(!0)))}return h.mutationQueue.addMutationBatch(P,d,K,u)})).next((D=>{R=D;const K=D.applyToLocalDocumentSet(I,L);return h.documentOverlayCache.saveOverlays(P,D.batchId,K)}))})).then((()=>({batchId:R.batchId,changes:El(I)})))})(r.localStore,t);r.sharedClientState.addPendingMutation(s.batchId),(function(a,u,h){let d=a.Vu[a.currentUser.toKey()];d||(d=new et($)),d=d.insert(u,h),a.Vu[a.currentUser.toKey()]=d})(r,s.batchId,e),await rr(r,s.changes),await _s(r.remoteStore)}catch(s){const o=no(s,"Failed to persist write");e.reject(o)}}async function nu(n,t){const e=U(n);try{const r=await Qm(e.localStore,t);t.targetChanges.forEach(((s,o)=>{const a=e.Au.get(o);a&&(X(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?X(a.hu,14607):s.removedDocuments.size>0&&(X(a.hu,42227),a.hu=!1))})),await rr(e,r,t)}catch(r){await an(r)}}function yc(n,t,e){const r=U(n);if(r.isPrimaryClient&&e===0||!r.isPrimaryClient&&e===1){const s=[];r.Tu.forEach(((o,a)=>{const u=a.view.va(t);u.snapshot&&s.push(u.snapshot)})),(function(a,u){const h=U(a);h.onlineState=u;let d=!1;h.queries.forEach(((y,I)=>{for(const R of I.Sa)R.va(u)&&(d=!0)})),d&&ro(h)})(r.eventManager,t),s.length&&r.Pu.H_(s),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function Lg(n,t,e){const r=U(n);r.sharedClientState.updateQueryState(t,"rejected",e);const s=r.Au.get(t),o=s&&s.key;if(o){let a=new et(x.comparator);a=a.insert(o,Tt.newNoDocument(o,B.min()));const u=z().add(o),h=new ms(B.min(),new Map,new et($),a,u);await nu(r,h),r.du=r.du.remove(o),r.Au.delete(t),io(r)}else await gi(r.localStore,t,!1).then((()=>yi(r,t,e))).catch(an)}async function Fg(n,t){const e=U(n),r=t.batch.batchId;try{const s=await Wm(e.localStore,t);su(e,r,null),ru(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await rr(e,s)}catch(s){await an(s)}}async function Bg(n,t,e){const r=U(n);try{const s=await(function(a,u){const h=U(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let y;return h.mutationQueue.lookupMutationBatch(d,u).next((I=>(X(I!==null,37113),y=I.keys(),h.mutationQueue.removeMutationBatch(d,I)))).next((()=>h.mutationQueue.performConsistencyCheck(d))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(d,y,u))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,y))).next((()=>h.localDocuments.getDocuments(d,y)))}))})(r.localStore,t);su(r,t,e),ru(r,t),r.sharedClientState.updateMutationState(t,"rejected",e),await rr(r,s)}catch(s){await an(s)}}function ru(n,t){(n.mu.get(t)||[]).forEach((e=>{e.resolve()})),n.mu.delete(t)}function su(n,t,e){const r=U(n);let s=r.Vu[r.currentUser.toKey()];if(s){const o=s.get(t);o&&(e?o.reject(e):o.resolve(),s=s.remove(t)),r.Vu[r.currentUser.toKey()]=s}}function yi(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(const r of n.Iu.get(t))n.Tu.delete(r),e&&n.Pu.yu(r,e);n.Iu.delete(t),n.isPrimaryClient&&n.Ru.jr(t).forEach((r=>{n.Ru.containsKey(r)||iu(n,r)}))}function iu(n,t){n.Eu.delete(t.path.canonicalString());const e=n.du.get(t);e!==null&&(Ji(n.remoteStore,e),n.du=n.du.remove(t),n.Au.delete(e),io(n))}function Ec(n,t,e){for(const r of e)r instanceof Zl?(n.Ru.addReference(r.key,t),Ug(n,r)):r instanceof tu?(k(so,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,t),n.Ru.containsKey(r.key)||iu(n,r.key)):F(19791,{wu:r})}function Ug(n,t){const e=t.key,r=e.path.canonicalString();n.du.get(e)||n.Eu.has(r)||(k(so,"New document in limbo: "+e),n.Eu.add(r),io(n))}function io(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const t=n.Eu.values().next().value;n.Eu.delete(t);const e=new x(Z.fromString(t)),r=n.fu.next();n.Au.set(r,new Pg(e)),n.du=n.du.insert(e,r),zl(n.remoteStore,new ee(Bt(ji(e.path)),r,"TargetPurposeLimboResolution",os.ce))}}async function rr(n,t,e){const r=U(n),s=[],o=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((u,h)=>{a.push(r.pu(h,t,e).then((d=>{if((d||e)&&r.isPrimaryClient){const y=d?!d.fromCache:e?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,y?"current":"not-current")}if(d){s.push(d);const y=Qi.As(h.targetId,d);o.push(y)}})))})),await Promise.all(a),r.Pu.H_(s),await(async function(h,d){const y=U(h);try{await y.persistence.runTransaction("notifyLocalViewChanges","readwrite",(I=>C.forEach(d,(R=>C.forEach(R.Es,(P=>y.persistence.referenceDelegate.addReference(I,R.targetId,P))).next((()=>C.forEach(R.ds,(P=>y.persistence.referenceDelegate.removeReference(I,R.targetId,P)))))))))}catch(I){if(!cn(I))throw I;k(Xi,"Failed to update sequence numbers: "+I)}for(const I of d){const R=I.targetId;if(!I.fromCache){const P=y.Ms.get(R),M=P.snapshotVersion,L=P.withLastLimboFreeSnapshotVersion(M);y.Ms=y.Ms.insert(R,L)}}})(r.localStore,o))}async function jg(n,t){const e=U(n);if(!e.currentUser.isEqual(t)){k(so,"User change. New user:",t.toKey());const r=await Ul(e.localStore,t);e.currentUser=t,(function(o,a){o.mu.forEach((u=>{u.forEach((h=>{h.reject(new O(b.CANCELLED,a))}))})),o.mu.clear()})(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await rr(e,r.Ls)}}function qg(n,t){const e=U(n),r=e.Au.get(t);if(r&&r.hu)return z().add(r.key);{let s=z();const o=e.Iu.get(t);if(!o)return s;for(const a of o){const u=e.Tu.get(a);s=s.unionWith(u.view.nu)}return s}}function ou(n){const t=U(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=nu.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=qg.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Lg.bind(null,t),t.Pu.H_=Sg.bind(null,t.eventManager),t.Pu.yu=Rg.bind(null,t.eventManager),t}function $g(n){const t=U(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Fg.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Bg.bind(null,t),t}class Zr{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=gs(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,e){return null}Mu(t,e){return null}vu(t){return Km(this.persistence,new zm,t.initialUser,this.serializer)}Cu(t){return new Bl(Wi.mi,this.serializer)}Du(t){return new tg}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Zr.provider={build:()=>new Zr};class zg extends Zr{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){X(this.persistence.referenceDelegate instanceof Jr,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new Pm(r,t.asyncQueue,e)}Cu(t){const e=this.cacheSizeBytes!==void 0?Ct.withCacheSize(this.cacheSizeBytes):Ct.DEFAULT;return new Bl((r=>Jr.mi(r,e)),this.serializer)}}class Ei{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>yc(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=jg.bind(null,this.syncEngine),await Ig(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return(function(){return new Ag})()}createDatastore(t){const e=gs(t.databaseInfo.databaseId),r=(function(o){return new ig(o)})(t.databaseInfo);return(function(o,a,u,h){return new lg(o,a,u,h)})(t.authCredentials,t.appCheckCredentials,r,e)}createRemoteStore(t){return(function(r,s,o,a,u){return new hg(r,s,o,a,u)})(this.localStore,this.datastore,t.asyncQueue,(e=>yc(this.syncEngine,e,0)),(function(){return dc.v()?new dc:new eg})())}createSyncEngine(t,e){return(function(s,o,a,u,h,d,y){const I=new Vg(s,o,a,u,h,d);return y&&(I.gu=!0),I})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){await(async function(e){const r=U(e);k(Ce,"RemoteStore shutting down."),r.Ea.add(5),await nr(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Ei.provider={build:()=>new Ei};class au{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):Kt("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout((()=>{this.muted||t(e)}),0)}}const fe="FirestoreClient";class Gg{constructor(t,e,r,s,o){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=r,this.databaseInfo=s,this.user=Et.UNAUTHENTICATED,this.clientId=Oi.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async a=>{k(fe,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(k(fe,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new ie;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const r=no(e,"Failed to shutdown persistence");t.reject(r)}})),t.promise}}async function Js(n,t){n.asyncQueue.verifyOperationInProgress(),k(fe,"Initializing OfflineComponentProvider");const e=n.configuration;await t.initialize(e);let r=e.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await Ul(t.localStore,s),r=s)})),t.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=t}async function Tc(n,t){n.asyncQueue.verifyOperationInProgress();const e=await Hg(n);k(fe,"Initializing OnlineComponentProvider"),await t.initialize(e,n.configuration),n.setCredentialChangeListener((r=>mc(t.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>mc(t.remoteStore,s))),n._onlineComponents=t}async function Hg(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){k(fe,"Using user provided OfflineComponentProvider");try{await Js(n,n._uninitializedComponentsProvider._offline)}catch(t){const e=t;if(!(function(s){return s.name==="FirebaseError"?s.code===b.FAILED_PRECONDITION||s.code===b.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(e))throw e;Je("Error using user provided cache. Falling back to memory cache: "+e),await Js(n,new Zr)}}else k(fe,"Using default OfflineComponentProvider"),await Js(n,new zg(void 0));return n._offlineComponents}async function cu(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(k(fe,"Using user provided OnlineComponentProvider"),await Tc(n,n._uninitializedComponentsProvider._online)):(k(fe,"Using default OnlineComponentProvider"),await Tc(n,new Ei))),n._onlineComponents}function Kg(n){return cu(n).then((t=>t.syncEngine))}async function Ti(n){const t=await cu(n),e=t.eventManager;return e.onListen=Dg.bind(null,t.syncEngine),e.onUnlisten=Og.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=kg.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=Mg.bind(null,t.syncEngine),e}function Wg(n,t,e={}){const r=new ie;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,u,h,d){const y=new au({next:R=>{y.Nu(),a.enqueueAndForget((()=>Jl(o,I))),R.fromCache&&h.source==="server"?d.reject(new O(b.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(R)},error:R=>d.reject(R)}),I=new Yl(u,y,{includeMetadataChanges:!0,qa:!0});return Xl(o,I)})(await Ti(n),n.asyncQueue,t,e,r))),r.promise}function lu(n){const t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}const vc=new Map;const uu="firestore.googleapis.com",Ic=!0;class wc{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new O(b.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=uu,this.ssl=Ic}else this.host=t.host,this.ssl=t.ssl??Ic;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=Fl;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<Cm)throw new O(b.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}lf("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=lu(t.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new O(b.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new O(b.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new O(b.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class ys{constructor(t,e,r,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new wc({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new O(b.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new O(b.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new wc(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new Yd;switch(r.type){case"firstParty":return new nf(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new O(b.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(e){const r=vc.get(e);r&&(k("ComponentProvider","Removing Datastore"),vc.delete(e),r.terminate())})(this),Promise.resolve()}}function Qg(n,t,e,r={}){n=Ft(n,ys);const s=Di(t),o=n._getSettings(),a={...o,emulatorOptions:n._getEmulatorOptions()},u=`${t}:${e}`;s&&(Sh(`https://${u}`),Ph("Firestore",!0)),o.host!==uu&&o.host!==u&&Je("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:u,ssl:s,emulatorOptions:r};if(!jr(h,a)&&(n._setSettings(h),r.mockUserToken)){let d,y;if(typeof r.mockUserToken=="string")d=r.mockUserToken,y=Et.MOCK_USER;else{d=Rh(r.mockUserToken,n._app?.options.projectId);const I=r.mockUserToken.sub||r.mockUserToken.user_id;if(!I)throw new O(b.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");y=new Et(I)}n._authCredentials=new Zd(new Jc(d,y))}}class sr{constructor(t,e,r){this.converter=e,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new sr(this.firestore,t,this._query)}}class lt{constructor(t,e,r){this.converter=e,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new oe(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new lt(this.firestore,t,this._key)}toJSON(){return{type:lt._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,r){if(Zn(e,lt._jsonSchema))return new lt(t,r||null,new x(Z.fromString(e.referencePath)))}}lt._jsonSchemaVersion="firestore/documentReference/1.0",lt._jsonSchema={type:ot("string",lt._jsonSchemaVersion),referencePath:ot("string")};class oe extends sr{constructor(t,e,r){super(t,e,ji(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new lt(this.firestore,null,new x(t))}withConverter(t){return new oe(this.firestore,t,this._path)}}function Mn(n,t,...e){if(n=Xe(n),Yc("collection","path",t),n instanceof ys){const r=Z.fromString(t,...e);return La(r),new oe(n,null,r)}{if(!(n instanceof lt||n instanceof oe))throw new O(b.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Z.fromString(t,...e));return La(r),new oe(n.firestore,null,r)}}function rn(n,t,...e){if(n=Xe(n),arguments.length===1&&(t=Oi.newId()),Yc("doc","path",t),n instanceof ys){const r=Z.fromString(t,...e);return xa(r),new lt(n,null,new x(r))}{if(!(n instanceof lt||n instanceof oe))throw new O(b.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Z.fromString(t,...e));return xa(r),new lt(n.firestore,n instanceof oe?n.converter:null,new x(r))}}const Ac="AsyncQueue";class Sc{constructor(t=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new ql(this,"async_queue_retry"),this._c=()=>{const r=Xs();r&&k(Ac,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=t;const e=Xs();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const e=Xs();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise((()=>{}));const e=new ie;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Xu.push(t),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!cn(t))throw t;k(Ac,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(t){const e=this.ac.then((()=>(this.rc=!0,t().catch((r=>{throw this.nc=r,this.rc=!1,Kt("INTERNAL UNHANDLED ERROR: ",Rc(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=e,e}enqueueAfterDelay(t,e,r){this.uc(),this.oc.indexOf(t)>-1&&(e=0);const s=eo.createAndSchedule(this,t,e,r,(o=>this.hc(o)));return this.tc.push(s),s}uc(){this.nc&&F(47125,{Pc:Rc(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do t=this.ac,await t;while(t!==this.ac)}Ic(t){for(const e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then((()=>{this.tc.sort(((e,r)=>e.targetTimeMs-r.targetTimeMs));for(const e of this.tc)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Tc()}))}dc(t){this.oc.push(t)}hc(t){const e=this.tc.indexOf(t);this.tc.splice(e,1)}}function Rc(n){let t=n.message||"";return n.stack&&(t=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),t}function Cc(n){return(function(e,r){if(typeof e!="object"||e===null)return!1;const s=e;for(const o of r)if(o in s&&typeof s[o]=="function")return!0;return!1})(n,["next","error","complete"])}class be extends ys{constructor(t,e,r,s){super(t,e,r,s),this.type="firestore",this._queue=new Sc,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new Sc(t),this._firestoreClient=void 0,await t}}}function Xg(n,t){const e=typeof n=="object"?n:Bd(),r=typeof n=="string"?n:Gr,s=Od(e,"firestore").getImmediate({identifier:r});if(!s._initialized){const o=wh("firestore");o&&Qg(s,...o)}return s}function oo(n){if(n._terminated)throw new O(b.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||Jg(n),n._firestoreClient}function Jg(n){const t=n._freezeSettings(),e=(function(s,o,a,u){return new Tf(s,o,a,u.host,u.ssl,u.experimentalForceLongPolling,u.experimentalAutoDetectLongPolling,lu(u.experimentalLongPollingOptions),u.useFetchStreams,u.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,t);n._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),n._firestoreClient=new Gg(n._authCredentials,n._appCheckCredentials,n._queue,e,n._componentsProvider&&(function(s){const o=s?._online.build();return{_offline:s?._offline.build(o),_online:o}})(n._componentsProvider))}class Vt{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Vt(pt.fromBase64String(t))}catch(e){throw new O(b.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new Vt(pt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:Vt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(Zn(t,Vt._jsonSchema))return Vt.fromBase64String(t.bytes)}}Vt._jsonSchemaVersion="firestore/bytes/1.0",Vt._jsonSchema={type:ot("string",Vt._jsonSchemaVersion),bytes:ot("string")};class ao{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new O(b.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new gt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class co{constructor(t){this._methodName=t}}class jt{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new O(b.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new O(b.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return $(this._lat,t._lat)||$(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:jt._jsonSchemaVersion}}static fromJSON(t){if(Zn(t,jt._jsonSchema))return new jt(t.latitude,t.longitude)}}jt._jsonSchemaVersion="firestore/geoPoint/1.0",jt._jsonSchema={type:ot("string",jt._jsonSchemaVersion),latitude:ot("number"),longitude:ot("number")};class qt{constructor(t){this._values=(t||[]).map((e=>e))}toArray(){return this._values.map((t=>t))}isEqual(t){return(function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0})(this._values,t._values)}toJSON(){return{type:qt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(Zn(t,qt._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every((e=>typeof e=="number")))return new qt(t.vectorValues);throw new O(b.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}qt._jsonSchemaVersion="firestore/vectorValue/1.0",qt._jsonSchema={type:ot("string",qt._jsonSchemaVersion),vectorValues:ot("object")};const Yg=/^__.*__$/;class Zg{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return this.fieldMask!==null?new De(t,this.data,this.fieldMask,e,this.fieldTransforms):new tr(t,this.data,e,this.fieldTransforms)}}function hu(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw F(40011,{Ac:n})}}class lo{constructor(t,e,r,s,o,a){this.settings=t,this.databaseId=e,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new lo({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(t){const e=this.path?.child(t),r=this.Vc({path:e,fc:!1});return r.gc(t),r}yc(t){const e=this.path?.child(t),r=this.Vc({path:e,fc:!1});return r.Rc(),r}wc(t){return this.Vc({path:void 0,fc:!0})}Sc(t){return ts(t,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return this.fieldMask.find((e=>t.isPrefixOf(e)))!==void 0||this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))!==void 0}Rc(){if(this.path)for(let t=0;t<this.path.length;t++)this.gc(this.path.get(t))}gc(t){if(t.length===0)throw this.Sc("Document fields must not be empty");if(hu(this.Ac)&&Yg.test(t))throw this.Sc('Document fields cannot begin and end with "__"')}}class tp{constructor(t,e,r){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=r||gs(t)}Cc(t,e,r,s=!1){return new lo({Ac:t,methodName:e,Dc:r,path:gt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function du(n){const t=n._freezeSettings(),e=gs(n._databaseId);return new tp(n._databaseId,!!t.ignoreUndefinedProperties,e)}function fu(n,t,e,r,s,o={}){const a=n.Cc(o.merge||o.mergeFields?2:0,t,e,s);_u("Data must be an object, but it was:",a,r);const u=gu(r,a);let h,d;if(o.merge)h=new Nt(a.fieldMask),d=a.fieldTransforms;else if(o.mergeFields){const y=[];for(const I of o.mergeFields){const R=ep(t,I,e);if(!a.contains(R))throw new O(b.INVALID_ARGUMENT,`Field '${R}' is specified in your field mask but missing from your input data.`);rp(y,R)||y.push(R)}h=new Nt(y),d=a.fieldTransforms.filter((I=>h.covers(I.field)))}else h=null,d=a.fieldTransforms;return new Zg(new Pt(u),h,d)}class uo extends co{_toFieldTransform(t){return new Kf(t.path,new zn)}isEqual(t){return t instanceof uo}}function mu(n,t){if(pu(n=Xe(n)))return _u("Unsupported field value:",t,n),gu(n,t);if(n instanceof co)return(function(r,s){if(!hu(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)})(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.fc&&t.Ac!==4)throw t.Sc("Nested arrays are not supported");return(function(r,s){const o=[];let a=0;for(const u of r){let h=mu(u,s.wc(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}})(n,t)}return(function(r,s){if((r=Xe(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return zf(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=tt.fromDate(r);return{timestampValue:Xr(s.serializer,o)}}if(r instanceof tt){const o=new tt(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:Xr(s.serializer,o)}}if(r instanceof jt)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Vt)return{bytesValue:Dl(s.serializer,r._byteString)};if(r instanceof lt){const o=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Hi(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof qt)return(function(a,u){return{mapValue:{fields:{[al]:{stringValue:cl},[Hr]:{arrayValue:{values:a.toArray().map((d=>{if(typeof d!="number")throw u.Sc("VectorValues must only contain numeric values.");return qi(u.serializer,d)}))}}}}}})(r,s);throw s.Sc(`Unsupported field value: ${Mi(r)}`)})(n,t)}function gu(n,t){const e={};return el(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Pe(n,((r,s)=>{const o=mu(s,t.mc(r));o!=null&&(e[r]=o)})),{mapValue:{fields:e}}}function pu(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof tt||n instanceof jt||n instanceof Vt||n instanceof lt||n instanceof co||n instanceof qt)}function _u(n,t,e){if(!pu(e)||!Zc(e)){const r=Mi(e);throw r==="an object"?t.Sc(n+" a custom object"):t.Sc(n+" "+r)}}function ep(n,t,e){if((t=Xe(t))instanceof ao)return t._internalPath;if(typeof t=="string")return yu(n,t);throw ts("Field path arguments must be of type string or ",n,!1,void 0,e)}const np=new RegExp("[~\\*/\\[\\]]");function yu(n,t,e){if(t.search(np)>=0)throw ts(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new ao(...t.split("."))._internalPath}catch{throw ts(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function ts(n,t,e,r,s){const o=r&&!r.isEmpty(),a=s!==void 0;let u=`Function ${t}() called with invalid data`;e&&(u+=" (via `toFirestore()`)"),u+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${s}`),h+=")"),new O(b.INVALID_ARGUMENT,u+n+h)}function rp(n,t){return n.some((e=>e.isEqual(t)))}class Eu{constructor(t,e,r,s,o){this._firestore=t,this._userDataWriter=e,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new lt(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new sp(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Tu("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}}class sp extends Eu{data(){return super.data()}}function Tu(n,t){return typeof t=="string"?yu(n,t):t instanceof ao?t._internalPath:t._delegate._internalPath}function vu(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new O(b.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class ip{convertValue(t,e="none"){switch(he(t)){case 0:return null;case 1:return t.booleanValue;case 2:return st(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(ue(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw F(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const r={};return Pe(t,((s,o)=>{r[s]=this.convertValue(o,e)})),r}convertVectorValue(t){const e=t.fields?.[Hr].arrayValue?.values?.map((r=>st(r.doubleValue)));return new qt(e)}convertGeoPoint(t){return new jt(st(t.latitude),st(t.longitude))}convertArray(t,e){return(t.values||[]).map((r=>this.convertValue(r,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const r=cs(t);return r==null?null:this.convertValue(r,e);case"estimate":return this.convertTimestamp(jn(t));default:return null}}convertTimestamp(t){const e=le(t);return new tt(e.seconds,e.nanos)}convertDocumentKey(t,e){const r=Z.fromString(t);X(Ll(r),9688,{name:t});const s=new qn(r.get(1),r.get(3)),o=new x(r.popFirst(5));return s.isEqual(e)||Kt(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),o}}function Iu(n,t,e){let r;return r=n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t,r}class Pn{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class we extends Eu{constructor(t,e,r,s,o,a){super(t,e,r,s,a),this._firestore=t,this._firestoreImpl=t,this.metadata=o}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Mr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const r=this._document.data.field(Tu("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new O(b.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,e={};return e.type=we._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}}we._jsonSchemaVersion="firestore/documentSnapshot/1.0",we._jsonSchema={type:ot("string",we._jsonSchemaVersion),bundleSource:ot("string","DocumentSnapshot"),bundleName:ot("string"),bundle:ot("string")};class Mr extends we{data(t={}){return super.data(t)}}class Ae{constructor(t,e,r,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new Pn(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach((r=>{t.call(e,new Mr(this._firestore,this._userDataWriter,r.key,r,new Pn(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new O(b.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=(function(s,o){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((u=>{const h=new Mr(s._firestore,s._userDataWriter,u.doc.key,u.doc,new Pn(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);return u.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((u=>o||u.type!==3)).map((u=>{const h=new Mr(s._firestore,s._userDataWriter,u.doc.key,u.doc,new Pn(s._snapshot.mutatedKeys.has(u.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,y=-1;return u.type!==0&&(d=a.indexOf(u.doc.key),a=a.delete(u.doc.key)),u.type!==1&&(a=a.add(u.doc),y=a.indexOf(u.doc.key)),{type:op(u.type),doc:h,oldIndex:d,newIndex:y}}))}})(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new O(b.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=Ae._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=Oi.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const e=[],r=[],s=[];return this.docs.forEach((o=>{o._document!==null&&(e.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))})),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function op(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return F(61501,{type:n})}}Ae._jsonSchemaVersion="firestore/querySnapshot/1.0",Ae._jsonSchema={type:ot("string",Ae._jsonSchemaVersion),bundleSource:ot("string","QuerySnapshot"),bundleName:ot("string"),bundle:ot("string")};class ho extends ip{constructor(t){super(),this.firestore=t}convertBytes(t){return new Vt(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new lt(this.firestore,null,e)}}function ap(n){n=Ft(n,sr);const t=Ft(n.firestore,be),e=oo(t),r=new ho(t);return vu(n._query),Wg(e,n._query).then((s=>new Ae(t,r,n,s)))}function es(n,t,e){n=Ft(n,lt);const r=Ft(n.firestore,be),s=Iu(n.converter,t,e);return fo(r,[fu(du(r),"setDoc",n._key,s,n.converter!==null,e).toMutation(n._key,Ot.none())])}function cp(n){return fo(Ft(n.firestore,be),[new $i(n._key,Ot.none())])}function wu(n,t){const e=Ft(n.firestore,be),r=rn(n),s=Iu(n.converter,t);return fo(e,[fu(du(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Ot.exists(!1))]).then((()=>r))}function bc(n,...t){n=Xe(n);let e={includeMetadataChanges:!1,source:"default"},r=0;typeof t[r]!="object"||Cc(t[r])||(e=t[r++]);const s={includeMetadataChanges:e.includeMetadataChanges,source:e.source};if(Cc(t[r])){const h=t[r];t[r]=h.next?.bind(h),t[r+1]=h.error?.bind(h),t[r+2]=h.complete?.bind(h)}let o,a,u;if(n instanceof lt)a=Ft(n.firestore,be),u=ji(n._key.path),o={next:h=>{t[r]&&t[r](lp(a,n,h))},error:t[r+1],complete:t[r+2]};else{const h=Ft(n,sr);a=Ft(h.firestore,be),u=h._query;const d=new ho(a);o={next:y=>{t[r]&&t[r](new Ae(a,d,h,y))},error:t[r+1],complete:t[r+2]},vu(n._query)}return(function(d,y,I,R){const P=new au(R),M=new Yl(y,P,I);return d.asyncQueue.enqueueAndForget((async()=>Xl(await Ti(d),M))),()=>{P.Nu(),d.asyncQueue.enqueueAndForget((async()=>Jl(await Ti(d),M)))}})(oo(a),u,s,o)}function fo(n,t){return(function(r,s){const o=new ie;return r.asyncQueue.enqueueAndForget((async()=>xg(await Kg(r),s,o))),o.promise})(oo(n),t)}function lp(n,t,e){const r=e.docs.get(t._key),s=new ho(n);return new we(n,s,t._key,r,new Pn(e.hasPendingWrites,e.fromCache),t.converter)}function Kn(){return new uo("serverTimestamp")}(function(t,e=!0){(function(s){on=s})(Fd),$r(new Fn("firestore",((r,{instanceIdentifier:s,options:o})=>{const a=r.getProvider("app").getImmediate(),u=new be(new tf(r.getProvider("auth-internal")),new rf(a,r.getProvider("app-check-internal")),(function(d,y){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new O(b.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new qn(d.options.projectId,y)})(a,s),a);return o={useFetchStreams:e,...o},u._setSettings(o),u}),"PUBLIC").setMultipleInstances(!0)),$e(ka,Na,t),$e(ka,Na,"esm2020")})();const up={apiKey:"AIzaSyC5fjkXd_lirXDEY5wyH-upF9yU_nzLAJw",authDomain:"web-rtc-server-50d56.firebaseapp.com",projectId:"web-rtc-server-50d56",storageBucket:"web-rtc-server-50d56.firebasestorage.app",messagingSenderId:"1017642181996",appId:"1:1017642181996:web:e325acd4ee82baa9087f49",measurementId:"G-KVDMZRQKBP"},hp=jc(up),Au=Xg(hp),dp={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10};let j=null;const Pc=document.getElementById("webcamButton"),Su=document.getElementById("webcamVideo"),mo=document.getElementById("callButton"),Ru=document.getElementById("answerButton"),ae=document.getElementById("remoteVideo"),Wn=document.getElementById("hangupButton"),Cu=document.getElementById("settingsButton"),xn=document.getElementById("settingsModal"),fp=document.getElementById("closeSettings"),Ge=document.getElementById("videoSelect"),Qn=document.getElementById("audioSelect"),ns=document.getElementById("audioOutputSelect"),He=document.getElementById("createCallModal"),mp=document.getElementById("closeCreateCall"),ir=document.getElementById("callIdDisplay"),Cr=document.getElementById("copyCallId"),gp=document.getElementById("shareGmail"),pp=document.getElementById("shareOutlook"),Se=document.getElementById("joinCallModal"),vi=document.getElementById("joinCallInput"),_p=document.getElementById("confirmJoinCall"),yp=document.getElementById("closeJoinCall"),xr=document.getElementById("toggleMute"),Lr=document.getElementById("toggleCamera"),bu=document.getElementById("toggleFullscreen"),Pu=document.getElementById("callTimer"),Ep=document.getElementById("videoContainer"),Tp=document.getElementById("slot-0-camera-off"),vp=document.getElementById("remoteCameraOff"),Ip=document.getElementById("slot-0-muted"),wp=document.getElementById("remoteMuted"),Gt=document.getElementById("connectionIndicator"),rs=document.getElementById("networkStats"),Ap=document.getElementById("videoStat"),Sp=document.getElementById("audioStat"),Rp=document.getElementById("latencyStat"),Cp=document.getElementById("packetLossStat"),go=document.getElementById("chatPanel"),br=document.getElementById("chatMessages"),Vc=document.getElementById("chatInput"),bp=document.getElementById("sendMessage"),Xn=document.getElementById("openChat"),Pp=document.getElementById("toggleChat"),Dc=document.getElementById("showStatsToggle"),Ii=document.getElementById("usernameInput"),po=document.getElementById("localNameTag"),Ke=document.getElementById("remoteNameTag");let Ue=!1,Pr=!1,wi=null,Fr=null,Ln=null,Ai=!1,kt="Guest",Jn=null,Yn=null;const Dt=localStorage.getItem("clientId")||Math.random().toString(36).substring(2,10);localStorage.setItem("clientId",Dt);const N={},Si=10;let rt=null;function or(n){Object.values(N).forEach(t=>{const e=t.dataChannel;if(e&&e.readyState==="open")try{e.send(JSON.stringify(n))}catch{}})}let Ie=null,je=null,qe=0,We=null,Qe=null,Ri=0,kc=0;const Vp=1e3,ss=.03,Dp=.06;function Vu(){if(j&&j.getAudioTracks().length)try{Ie||(Ie=new(window.AudioContext||window.webkitAudioContext));const n=Ie.createMediaStreamSource(j);je=Ie.createAnalyser(),je.fftSize=2048,n.connect(je);const t=new Uint8Array(je.fftSize);We&&clearInterval(We),We=setInterval(()=>{je.getByteTimeDomainData(t);let e=0;for(let s=0;s<t.length;s++){const o=(t[s]-128)/128;e+=o*o}const r=Math.sqrt(e/t.length);qe=Math.min(1,r),or({type:"audio-level",level:qe});try{const s=document.getElementById("slot-0");if(s){const o=s.querySelector(".audio-meter"),a=o&&o.querySelector(".level");o&&a&&(o.style.display="block",a.style.width=Math.min(100,Math.round(qe*100))+"%"),s.classList.toggle("speaking",qe>ss+.03)}}catch{}},200)}catch(n){console.warn("Failed to start local audio meter",n)}}function kp(){if(We&&(clearInterval(We),We=null),Ie){try{Ie.close()}catch{}Ie=null,je=null,qe=0}}function Np(){Qe&&clearInterval(Qe),Qe=setInterval(()=>{if(Date.now()<Ri)return;let n=null,t=-1;const e=Date.now();for(const[s,o]of Object.entries(N)){if(!o)continue;const a=typeof o.lastAudioLevel=="number"?o.lastAudioLevel:0,u=o&&o.levelTs?o.levelTs:0;e-u>2e3||a>t&&(t=a,n=s)}if(!n||t<ss||rt===n||Date.now()<Ri||e-kc<Vp)return;let r=0;if(rt&&N[rt]){const s=N[rt];r=typeof s.lastAudioLevel=="number"?s.lastAudioLevel:0}if(t>Math.max(r+Dp,ss)){rt=n;const s=N[n];s&&s.remoteStream&&(ae.srcObject=s.remoteStream),Ke.textContent=s&&s.username||"Guest",_o(),kc=Date.now()}},250)}function Op(){Qe&&(clearInterval(Qe),Qe=null)}function _o(){if(document.querySelectorAll(".thumb-slot").forEach(n=>n.classList.remove("active")),rt){const n=N[rt];if(n&&n.slotIndex){const t=document.getElementById(`slot-${n.slotIndex}`);t&&t.classList.add("active")}}else{const n=document.getElementById("slot-0");n&&n.classList.add("active")}}function Mp(n){for(const[t,e]of Object.entries(N))if(t===n&&e.slotIndex)return e.slotIndex;for(let t=1;t<Si;t++){if(!document.getElementById(`slot-${t}`))continue;if(!Object.values(N).some(s=>s.slotIndex===t))return t}return null}function is(n){const t=N[n];return!t||!t.slotIndex?null:document.getElementById(`slot-${t.slotIndex}`)}function Du(n){const t=N[n].slotIndex||Mp(n);if(!t)return null;N[n].slotIndex=t;const e=document.getElementById(`slot-${t}`);e.classList.remove("empty");let r=e.querySelector("video");r||(r=document.createElement("video"),r.className="thumb-video",r.autoplay=!0,r.playsInline=!0,r.id=`slot-${t}-video`,e.appendChild(r));let s=e.querySelector(".slot-name");if(s||(s=document.createElement("div"),s.className="video-name-tag slot-name",s.id=`slot-${t}-name`,s.textContent=N[n].username||"Guest",e.appendChild(s)),!e.querySelector(".camera-off-overlay")){const u=document.createElement("div");u.className="camera-off-overlay small",u.id=`slot-${t}-camera-off`,u.innerHTML='<div class="camera-off-icon"></div>',e.appendChild(u)}if(!e.querySelector(".muted-indicator")){const u=document.createElement("div");u.className="muted-indicator small",u.id=`slot-${t}-muted`,u.textContent="",e.appendChild(u)}if(!e.querySelector(".audio-meter")){const u=document.createElement("div");u.className="audio-meter",u.innerHTML='<div class="level"></div>',e.appendChild(u)}const o=e.querySelector(".camera-off-overlay"),a=e.querySelector(".muted-indicator");return o&&o.classList.remove("active"),a&&a.classList.remove("active"),r}let At=null,Ci=null,bi=null;async function Br(n){if(!At)return;const t=Mn(At,"signals"),e=document.getElementById("signalWarning"),r=async(s=1)=>{try{return await wu(t,{...n,createdAt:Kn()}),e&&(e.style.display="none"),!0}catch(o){return console.error("sendSignal failed (attempt",s,"):",o),e&&(e.style.display="block",e.innerHTML=`Signaling error: ${o.message||o}. Check adblocker/firewall and allowlist this site.<small>Retrying...</small>`),s<3?(await new Promise(a=>setTimeout(a,1e3*s)),await r(s+1)):!1}};return await r(1)}async function ku(){if(!At)return;const n=rn(At,"participants",Dt);try{await es(n,{username:kt},{merge:!0})}catch(t){console.error("Failed to update participant record:",t)}}async function yo(n,t=!1){if(At=rn(Au,"calls",n),t)try{await es(At,{createdAt:Kn()})}catch(s){console.error("Error creating call doc:",s)}try{const s=Mn(At,"participants"),o=await ap(s);if(!t&&o.size>=Si){alert("Call is full (maximum "+Si+" participants)");return}await es(rn(At,"participants",Dt),{username:kt,joinedAt:Kn()},{merge:!0})}catch(s){console.error("Failed to join call participants collection:",s)}const e=Mn(At,"participants");Ci=bc(e,s=>{s.docChanges().forEach(async o=>{const a=o.doc.id,u=o.doc.data();if(o.type==="added"){if(a===Dt)return;N[a]=N[a]||{},N[a].username=u.username||"Guest",Du(a),Dt<a?await Ys(a,!0):await Ys(a,!1),rt||(rt=a,ae.srcObject=N[a].remoteStream,Ke.textContent=N[a].username||"Guest",_o())}else if(o.type==="removed")Pi(a);else if(o.type==="modified"&&N[a]){N[a].username=u.username||"Guest";const h=is(a);if(h){const d=h.querySelector(".slot-name");d&&(d.textContent=N[a].username)}}})});const r=Mn(At,"signals");bi=bc(r,s=>{s.docChanges().forEach(async o=>{if(o.type!=="added")return;const a=o.doc.data();if(!a||a.to!==Dt)return;const u=a.from;if(a.type==="offer"){N[u]=N[u]||{},N[u].username=N[u].username||"Guest";const h=await Ys(u,!1),d={type:"offer",sdp:a.sdp};await h.setRemoteDescription(new RTCSessionDescription(d));const y=await h.createAnswer();await h.setLocalDescription(y),await Br({type:"answer",from:Dt,to:u,sdp:y.sdp})}else if(a.type==="answer"){const h=N[u]&&N[u].pc;if(h){const d={type:"answer",sdp:a.sdp};await h.setRemoteDescription(new RTCSessionDescription(d))}}else if(a.type==="ice"){const h=N[u]&&N[u].pc;if(h&&a.candidate)try{await h.addIceCandidate(new RTCIceCandidate(a.candidate))}catch(d){console.warn("Failed to add remote ICE candidate",d)}else a.type==="left"&&(console.log("Peer left:",u),Pi(u))}})}),await ku(),Up(),qp(),Xn.classList.add("active"),Np()}async function xp(){if(At){try{await wu(Mn(At,"signals"),{type:"left",from:Dt,createdAt:Kn()}),await cp(rn(At,"participants",Dt))}catch{}Ci&&Ci(),bi&&bi()}Object.keys(N).forEach(n=>Pi(n)),Op(),kp(),At=null,jp(),$p(),Xn.classList.remove("active")}async function Ys(n,t=!1){if(!At)throw new Error("Not in a call");if(N[n]&&N[n].pc)return N[n].pc;const e=new RTCPeerConnection(dp),r=new MediaStream;N[n]=N[n]||{},N[n].pc=e,N[n].remoteStream=r;const s=Du(n);s&&(s.srcObject=r,_o());try{const o=e.addTransceiver("audio",{direction:"sendrecv"}),a=e.addTransceiver("video",{direction:"sendrecv"});if(N[n].transceivers={audio:o,video:a},j){const u=j.getAudioTracks()[0],h=j.getVideoTracks()[0];try{u&&o.sender.replaceTrack(u)}catch{}try{h&&a.sender.replaceTrack(h)}catch{}}}catch{if(j){const a=j.getAudioTracks()[0],u=j.getVideoTracks()[0];if(a)try{e.addTrack(a,j)}catch{}if(u)try{e.addTrack(u,j)}catch{}}}if(t){const o=e.createDataChannel("data");N[n].dataChannel=o,Nc(o,n)}else e.ondatachannel=o=>{N[n].dataChannel=o.channel,Nc(o.channel,n)};if(e.ontrack=o=>{try{console.log("pc.ontrack",n,o.streams),o.streams&&o.streams.length?o.streams[0].getTracks().forEach(u=>r.addTrack(u)):o.track?r.addTrack(o.track):console.warn("ontrack: no streams or track present for",n,o);const a=is(n);if(a){const u=a.querySelector(".camera-off-overlay");u&&u.classList.remove("active"),p&&(p.cameraEnabled=!0);const h=a.querySelector(".audio-meter");h&&(h.style.display="block")}}catch(a){console.error("ontrack handler error for",n,a)}},e.onicecandidate=({candidate:o})=>{if(o){const a=o&&typeof o.toJSON=="function"?o.toJSON():o;console.log("pc.onicecandidate -> sending ICE to",n,a),Br({type:"ice",from:Dt,to:n,candidate:a})}},e.onnegotiationneeded=async()=>{try{if(e.signalingState!=="stable"||N[n].makingOffer)return;N[n].makingOffer=!0;const o=await e.createOffer();await e.setLocalDescription(o),await Br({type:"offer",from:Dt,to:n,sdp:o.sdp})}catch(o){console.warn("Negotiation failure for",n,o),setTimeout(()=>{N[n]&&(N[n].makingOffer=!1)},500)}finally{N[n]&&(N[n].makingOffer=!1)}},e.onconnectionstatechange=()=>{console.log("pc.onconnectionstatechange",n,e.connectionState)},e.oniceconnectionstatechange=()=>{console.log("pc.oniceconnectionstatechange",n,e.iceConnectionState)},t){const o=await e.createOffer();await e.setLocalDescription(o),await Br({type:"offer",from:Dt,to:n,sdp:o.sdp})}return e}function Pi(n){const t=N[n];if(t){if(t.pc)try{t.pc.close()}catch{}if(t.dataChannel)try{t.dataChannel.close()}catch{}if(t.slotIndex){const e=document.getElementById(`slot-${t.slotIndex}`);e&&(e.innerHTML="",e.classList.add("empty"))}delete N[n]}}async function Lp(){const n=await navigator.mediaDevices.enumerateDevices();Ge.innerHTML="",Qn.innerHTML="",ns.innerHTML="",n.forEach(t=>{const e=document.createElement("option");e.value=t.deviceId,e.text=t.label||`${t.kind} ${Ge.length+1}`,t.kind==="videoinput"?Ge.appendChild(e):t.kind==="audioinput"?Qn.appendChild(e):t.kind==="audiooutput"&&ns.appendChild(e)})}Ge.onchange=async()=>{Jn=Ge.value,j&&await Nu()};Qn.onchange=async()=>{Yn=Qn.value,j&&await Nu()};ns.onchange=async()=>{if(typeof ae.setSinkId<"u")try{await ae.setSinkId(ns.value)}catch(n){console.error("Error setting audio output:",n)}};async function Nu(){const n={video:Jn?{deviceId:{exact:Jn}}:!0,audio:Yn?{deviceId:{exact:Yn}}:!0},t=j;j=await navigator.mediaDevices.getUserMedia(n),Su.srcObject=j,Vu(),Object.values(N).forEach(e=>{if(!e.pc)return;const r=e.pc.getSenders?e.pc.getSenders():[],s=j.getVideoTracks()[0],o=j.getAudioTracks()[0];if(e.transceivers){try{e.transceivers.audio&&o&&e.transceivers.audio.sender.replaceTrack(o)}catch{}try{e.transceivers.video&&s&&e.transceivers.video.sender.replaceTrack(s)}catch{}}if(r.forEach(a=>{a.track&&(a.track.kind==="video"&&s?a.replaceTrack(s):a.track.kind==="audio"&&o&&a.replaceTrack(o))}),r.length===0&&!e.transceivers&&j.getTracks().length>0)try{const a=j.getAudioTracks()[0],u=j.getVideoTracks()[0];a&&e.pc.addTrack(a,j),u&&e.pc.addTrack(u,j)}catch(a){console.warn("Error adding initial tracks after updateStream",a)}}),t&&t.getTracks().forEach(e=>e.stop())}Cu.onclick=()=>{xn.classList.add("active")};fp.onclick=()=>{xn.classList.remove("active")};xn.onclick=n=>{n.target===xn&&xn.classList.remove("active")};Dc.onchange=()=>{Ai=Dc.checked,Ai&&Ln?(Gt.classList.add("active"),rs.classList.add("active")):(Gt.classList.remove("active"),rs.classList.remove("active"))};localStorage.getItem("username")&&(kt=localStorage.getItem("username"),Ii.value=kt,po.textContent=kt);Ii.oninput=()=>{kt=Ii.value.trim()||"Guest",localStorage.setItem("username",kt),po.textContent=kt,ku(),or({type:"username",username:kt})};mp.onclick=()=>{He.classList.remove("active")};He.onclick=n=>{n.target===He&&He.classList.remove("active")};Cr.onclick=async()=>{try{const n=`${window.location.origin}${window.location.pathname}${window.location.pathname.endsWith("/"),""}?join=${ir.value}`;await navigator.clipboard.writeText(n);const t=Cr.textContent;Cr.textContent="Copied!",setTimeout(()=>{Cr.textContent=t},2e3)}catch(n){console.error("Failed to copy:",n)}};gp.onclick=()=>{const n=ir.value,t=`${window.location.origin}${window.location.pathname}${window.location.pathname.endsWith("/"),""}?join=${n}`,e=encodeURIComponent("Join my video call"),r=encodeURIComponent(`Hi,

Join my video call using this link: ${t}

Click the link and the join dialog will be pre-filled for you  no copy/paste needed.

See you soon!`);window.open(`https://mail.google.com/mail/?view=cm&fs=1&su=${e}&body=${r}`,"_blank")};pp.onclick=()=>{const n=ir.value,t=`${window.location.origin}${window.location.pathname}${window.location.pathname.endsWith("/"),""}?join=${n}`,e=encodeURIComponent("Join my video call"),r=encodeURIComponent(`Hi,

Join my video call using this link: ${t}

Click the link and the join dialog will be pre-filled for you  no copy/paste needed.

See you soon!`);window.open(`https://outlook.office.com/mail/deeplink/compose?subject=${e}&body=${r}`,"_blank")};Ru.onclick=()=>{Se.classList.add("active")};yp.onclick=()=>{Se.classList.remove("active")};Se.onclick=n=>{n.target===Se&&Se.classList.remove("active")};function Fp(){try{const n=new URL(window.location.href).searchParams;let t=n.get("join")||n.get("call");if(!t&&window.location.hash){const e=window.location.hash.substring(1),r=new URLSearchParams(e);t=r.get("join")||r.get("call")}if(t){vi.value=t,Se.classList.add("active"),vi.focus();try{window.history.replaceState({},document.title,window.location.pathname)}catch{}}}catch(n){console.warn("Failed to parse incoming join param",n)}}Fp();Xn.onclick=()=>{go.classList.add("open"),Xn.classList.remove("has-new")};Pp.onclick=()=>{go.classList.remove("open")};bp.onclick=()=>{Bp()};function Bp(){const n=Vc.value.trim();n&&(Ou(n,"sent",kt),or({type:"chat",message:n,username:kt,timestamp:Date.now()}),Vc.value="")}function Ou(n,t="received",e="Guest"){if(!br)return;const r=document.createElement("div");r.className=`chat-message ${t}`;const s=document.createElement("div");s.className="chat-meta",s.textContent=`${e}  ${new Date().toLocaleTimeString()}`;const o=document.createElement("div");o.className="chat-body",o.textContent=n,r.appendChild(s),r.appendChild(o),br.appendChild(r),br.scrollTop=br.scrollHeight}mo.onclick=async()=>{const n=Math.random().toString(36).substring(2,12);ir.value=n,He.classList.add("active");const t=rn(Au,"calls",n);await es(t,{createdAt:Kn()}),await yo(n,!0),Wn.disabled=!1};xr.onclick=()=>{if(j){const n=j.getAudioTracks()[0];n&&(n.enabled=!n.enabled,Ue=!n.enabled,xr.classList.toggle("muted",Ue),xr.textContent=Ue?"":"",Ip.classList.toggle("active",Ue),or({type:"mute",muted:Ue}))}};Lr.onclick=()=>{if(j){const n=j.getVideoTracks()[0];n&&(n.enabled=!n.enabled,Pr=!n.enabled,Lr.classList.toggle("camera-off",Pr),Lr.textContent=Pr?"":"",Tp.classList.toggle("active",Pr),or({type:"camera",enabled:n.enabled}))}};bu.onclick=()=>{document.fullscreenElement?document.exitFullscreen():Ep.requestFullscreen().catch(n=>{console.error("Error attempting to enable fullscreen:",n)})};function Up(){wi=Date.now(),Fr=setInterval(()=>{const n=Math.floor((Date.now()-wi)/1e3),t=Math.floor(n/60),e=n%60;Pu.textContent=`${String(t).padStart(2,"0")}:${String(e).padStart(2,"0")}`},1e3)}function jp(){Fr&&(clearInterval(Fr),Fr=null),Pu.textContent="00:00",wi=null}async function qp(){Ai&&(Gt.classList.add("active"),rs.classList.add("active")),Ln=setInterval(async()=>{if(!rt)return;const n=N[rt];if(!n||!n.pc)return;const t=await n.pc.getStats();let e=0,r=0,s=0,o=0,a=0,u=0;t.forEach(d=>{d.type==="inbound-rtp"&&(d.kind==="video"&&d.bytesReceived?e=Math.round(d.bytesReceived*8/1e3):d.kind==="audio"&&d.bytesReceived&&(r=Math.round(d.bytesReceived*8/1e3)),d.packetsLost!==void 0&&(a+=d.packetsLost),d.packetsReceived!==void 0&&(u+=d.packetsReceived)),d.type==="candidate-pair"&&d.state==="succeeded"&&d.currentRoundTripTime!==void 0&&(s=Math.round(d.currentRoundTripTime*1e3))}),u>0&&(o=Math.round(a/(a+u)*100)),Ap.textContent=`${e} kbps`,Sp.textContent=`${r} kbps`,Rp.textContent=`${s} ms`,Cp.textContent=`${o}%`;const h=Gt.querySelector(".connection-text");Gt.classList.remove("good","fair","poor"),s<150&&o<2?(Gt.classList.add("good"),h.textContent="Good"):s<300&&o<5?(Gt.classList.add("fair"),h.textContent="Fair"):(Gt.classList.add("poor"),h.textContent="Poor")},1e3)}function $p(){Ln&&(clearInterval(Ln),Ln=null),Gt.classList.remove("active"),rs.classList.remove("active")}function Nc(n,t){n.onopen=()=>{console.log("Data channel opened for",t);try{n.send(JSON.stringify({type:"username",username:kt}));const e=j&&j.getVideoTracks().length?j.getVideoTracks()[0].enabled:!1;n.send(JSON.stringify({type:"camera",enabled:!!e})),n.send(JSON.stringify({type:"mute",muted:!!Ue})),n.send(JSON.stringify({type:"audio-level",level:qe||0}))}catch{}},n.onmessage=e=>{const r=JSON.parse(e.data),s=N[t];if(r.type==="audio-level"){const a=typeof r.level=="number"?r.level:0;s&&(s.lastAudioLevel=a,s.levelTs=Date.now());const u=is(t);if(u){const h=u.querySelector(".audio-meter"),d=h&&h.querySelector(".level");h&&d&&(h.style.display="block",d.style.width=Math.min(100,Math.round(a*100))+"%");const y=a>ss+.02;u.classList.toggle("speaking",y)}return}const o=is(t);if(r.type==="camera"){if(typeof r.enabled=="boolean"){if(o){const a=o.querySelector(".camera-off-overlay");a&&a.classList.toggle("active",!r.enabled)}s&&(s.cameraEnabled=!!r.enabled),t===rt&&vp.classList.toggle("active",!r.enabled)}}else if(r.type==="mute"){if(typeof r.muted=="boolean"){if(o){const a=o.querySelector(".muted-indicator");a&&a.classList.toggle("active",r.muted)}s&&(s.muted=!!r.muted),t===rt&&wp.classList.toggle("active",r.muted)}}else if(r.type==="chat")Ou(r.message,"received",r.username||s&&s.username||"Guest"),go.classList.contains("open")||Xn.classList.add("has-new");else if(r.type==="username"){if(s&&(s.username=r.username||"Guest"),o){const a=o.querySelector(".slot-name");a&&(a.textContent=r.username||"Guest")}t===rt&&(Ke.textContent=r.username||"Guest")}},n.onerror=e=>{console.error("Data channel error:",e)}}const zp=document.getElementById("topThumbnails");zp?.addEventListener("click",n=>{const t=n.target.closest(".thumb-slot");if(!t)return;const e=t.querySelector("video");if(e&&e.srcObject){const r=parseInt(t.dataset.index);if(r===0)Object.keys(N).length>0?(rt=Object.keys(N)[0]||null,rt&&N[rt]&&N[rt].remoteStream&&(ae.srcObject=N[rt].remoteStream,Ke.textContent=N[rt].username||"Guest")):(rt=null,ae.srcObject=j,Ke.textContent=po.textContent||"Guest");else{const s=Object.entries(N).find(([o,a])=>a.slotIndex===r);rt=s?s[0]:null}if(!(r===0&&Object.keys(N).length>0)){ae.srcObject=e.srcObject;const s=t.querySelector(".slot-name");Ke.textContent=s?s.textContent:"Guest"}}Ri=Date.now()+3e3});Pc.onclick=async()=>{console.log("Webcam button clicked");try{console.log("Requesting media devices..."),j=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),console.log("Media devices granted:",j)}catch(e){console.error("Error accessing media devices:",e),alert("Error accessing webcam: "+e.message);return}Object.keys(N).forEach(e=>{const r=N[e];if(!r.pc)return;const s=r.pc.getSenders?r.pc.getSenders():[],o=s.some(d=>d.track&&d.track.kind==="audio"),a=s.some(d=>d.track&&d.track.kind==="video"),u=j.getAudioTracks()[0],h=j.getVideoTracks()[0];if(r.transceivers){try{r.transceivers.audio&&u&&r.transceivers.audio.sender.replaceTrack(u)}catch{}try{r.transceivers.video&&h&&r.transceivers.video.sender.replaceTrack(h)}catch{}if(!r.transceivers.audio&&!o&&u)try{r.pc.addTrack(u,j)}catch{}if(!r.transceivers.video&&!a&&h)try{r.pc.addTrack(h,j)}catch{}}else{if(!o&&u)try{r.pc.addTrack(u,j)}catch{}if(!a&&h)try{r.pc.addTrack(h,j)}catch{}}}),Su.srcObject=j,Object.keys(N).length===0&&(ae.srcObject=j),Vu(),await Lp();const n=j.getVideoTracks()[0],t=j.getAudioTracks()[0];n&&(Jn=n.getSettings().deviceId,Ge.value=Jn),t&&(Yn=t.getSettings().deviceId,Qn.value=Yn),mo.disabled=!1,Ru.disabled=!1,Pc.disabled=!0,Wn.disabled=!1,Cu.disabled=!1,xr.disabled=!1,Lr.disabled=!1,bu.disabled=!1};mo.onclick=async()=>{const n=Math.random().toString(36).substring(2,12);ir.value=n,He.classList.add("active"),await yo(n,!0),Wn.disabled=!1};_p.onclick=async()=>{const n=vi.value.trim();if(!n){alert("Please enter a call ID");return}Se.classList.remove("active"),await yo(n,!1)};Wn.onclick=async()=>{await xp(),Wn.disabled=!0};
