(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();const Eh=()=>{};var Ra={};const Uc=function(n){const t=[];let e=0;for(let r=0;r<n.length;r++){let s=n.charCodeAt(r);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&r+1<n.length&&(n.charCodeAt(r+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++r)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},Th=function(n){const t=[];let e=0,r=0;for(;e<n.length;){const s=n[e++];if(s<128)t[r++]=String.fromCharCode(s);else if(s>191&&s<224){const o=n[e++];t[r++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=n[e++],a=n[e++],l=n[e++],h=((s&7)<<18|(o&63)<<12|(a&63)<<6|l&63)-65536;t[r++]=String.fromCharCode(55296+(h>>10)),t[r++]=String.fromCharCode(56320+(h&1023))}else{const o=n[e++],a=n[e++];t[r++]=String.fromCharCode((s&15)<<12|(o&63)<<6|a&63)}}return t.join("")},jc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let s=0;s<n.length;s+=3){const o=n[s],a=s+1<n.length,l=a?n[s+1]:0,h=s+2<n.length,d=h?n[s+2]:0,p=o>>2,E=(o&3)<<4|l>>4;let A=(l&15)<<2|d>>6,P=d&63;h||(P=64,a||(A=64)),r.push(e[p],e[E],e[A],e[P])}return r.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(Uc(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):Th(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let s=0;s<n.length;){const o=e[n.charAt(s++)],l=s<n.length?e[n.charAt(s)]:0;++s;const d=s<n.length?e[n.charAt(s)]:64;++s;const E=s<n.length?e[n.charAt(s)]:64;if(++s,o==null||l==null||d==null||E==null)throw new vh;const A=o<<2|l>>4;if(r.push(A),d!==64){const P=l<<4&240|d>>2;if(r.push(P),E!==64){const N=d<<6&192|E;r.push(N)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class vh extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Ih=function(n){const t=Uc(n);return jc.encodeByteArray(t,!0)},Hr=function(n){return Ih(n).replace(/\./g,"")},wh=function(n){try{return jc.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function Ah(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Sh=()=>Ah().__FIREBASE_DEFAULTS__,Rh=()=>{if(typeof process>"u"||typeof Ra>"u")return;const n=Ra.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Ch=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=n&&wh(n[1]);return t&&JSON.parse(t)},Li=()=>{try{return Eh()||Sh()||Rh()||Ch()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},bh=n=>Li()?.emulatorHosts?.[n],Ph=n=>{const t=bh(n);if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),r]:[t.substring(0,e),r]},qc=()=>Li()?.config;class Vh{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,r)=>{e?this.reject(e):this.resolve(r),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,r))}}}function Mi(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Dh(n){return(await fetch(n,{credentials:"include"})).ok}function kh(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e={alg:"none",type:"JWT"},r=t||"demo-project",s=n.iat||0,o=n.sub||n.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a={iss:`https://securetoken.google.com/${r}`,aud:r,iat:s,exp:s+3600,auth_time:s,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Hr(JSON.stringify(e)),Hr(JSON.stringify(a)),""].join(".")}const Mn={};function Nh(){const n={prod:[],emulator:[]};for(const t of Object.keys(Mn))Mn[t]?n.emulator.push(t):n.prod.push(t);return n}function Oh(n){let t=document.getElementById(n),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",n),e=!0),{created:e,element:t}}let Ca=!1;function Lh(n,t){if(typeof window>"u"||typeof document>"u"||!Mi(window.location.host)||Mn[n]===t||Mn[n]||Ca)return;Mn[n]=t;function e(A){return`__firebase__banner__${A}`}const r="__firebase__banner",o=Nh().prod.length>0;function a(){const A=document.getElementById(r);A&&A.remove()}function l(A){A.style.display="flex",A.style.background="#7faaf0",A.style.position="fixed",A.style.bottom="5px",A.style.left="5px",A.style.padding=".5em",A.style.borderRadius="5px",A.style.alignItems="center"}function h(A,P){A.setAttribute("width","24"),A.setAttribute("id",P),A.setAttribute("height","24"),A.setAttribute("viewBox","0 0 24 24"),A.setAttribute("fill","none"),A.style.marginLeft="-6px"}function d(){const A=document.createElement("span");return A.style.cursor="pointer",A.style.marginLeft="16px",A.style.fontSize="24px",A.innerHTML=" &times;",A.onclick=()=>{Ca=!0,a()},A}function p(A,P){A.setAttribute("id",P),A.innerText="Learn more",A.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",A.setAttribute("target","__blank"),A.style.paddingLeft="5px",A.style.textDecoration="underline"}function E(){const A=Oh(r),P=e("text"),N=document.getElementById(P)||document.createElement("span"),M=e("learnmore"),D=document.getElementById(M)||document.createElement("a"),G=e("preprendIcon"),K=document.getElementById(G)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(A.created){const W=A.element;l(W),p(D,M);const It=d();h(K,G),W.append(K,N,D,It),document.body.appendChild(W)}o?(N.innerText="Preview backend disconnected.",K.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(K.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,N.innerText="Preview backend running in this workspace."),N.setAttribute("id",P)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",E):E()}function Mh(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function xh(){const n=Li()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function Fh(){return!xh()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function Bh(){try{return typeof indexedDB=="object"}catch{return!1}}function Uh(){return new Promise((n,t)=>{try{let e=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(r),n(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{t(s.error?.message||"")}}catch(e){t(e)}})}const jh="FirebaseError";class hn extends Error{constructor(t,e,r){super(e),this.code=t,this.customData=r,this.name=jh,Object.setPrototypeOf(this,hn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,$c.prototype.create)}}class $c{constructor(t,e,r){this.service=t,this.serviceName=e,this.errors=r}create(t,...e){const r=e[0]||{},s=`${this.service}/${t}`,o=this.errors[t],a=o?qh(o,r):"Error",l=`${this.serviceName}: ${a} (${s}).`;return new hn(s,l,r)}}function qh(n,t){return n.replace($h,(e,r)=>{const s=t[r];return s!=null?String(s):`<${r}?>`})}const $h=/\{\$([^}]+)}/g;function Gr(n,t){if(n===t)return!0;const e=Object.keys(n),r=Object.keys(t);for(const s of e){if(!r.includes(s))return!1;const o=n[s],a=t[s];if(ba(o)&&ba(a)){if(!Gr(o,a))return!1}else if(o!==a)return!1}for(const s of r)if(!e.includes(s))return!1;return!0}function ba(n){return n!==null&&typeof n=="object"}function nn(n){return n&&n._delegate?n._delegate:n}class zn{constructor(t,e,r){this.name=t,this.instanceFactory=e,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const Ce="[DEFAULT]";class zh{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const r=new Vh;if(this.instancesDeferred.set(e,r),this.isInitialized(e)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:e});s&&r.resolve(s)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){const e=this.normalizeInstanceIdentifier(t?.identifier),r=t?.optional??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(Gh(t))try{this.getOrInitializeService({instanceIdentifier:Ce})}catch{}for(const[e,r]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(e);try{const o=this.getOrInitializeService({instanceIdentifier:s});r.resolve(o)}catch{}}}}clearInstance(t=Ce){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=Ce){return this.instances.has(t)}getOptions(t=Ce){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,r=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:r,options:e});for(const[o,a]of this.instancesDeferred.entries()){const l=this.normalizeInstanceIdentifier(o);r===l&&a.resolve(s)}return s}onInit(t,e){const r=this.normalizeInstanceIdentifier(e),s=this.onInitCallbacks.get(r)??new Set;s.add(t),this.onInitCallbacks.set(r,s);const o=this.instances.get(r);return o&&t(o,r),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const r=this.onInitCallbacks.get(e);if(r)for(const s of r)try{s(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let r=this.instances.get(t);if(!r&&this.component&&(r=this.component.instanceFactory(this.container,{instanceIdentifier:Hh(t),options:e}),this.instances.set(t,r),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(r,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,r)}catch{}return r||null}normalizeInstanceIdentifier(t=Ce){return this.component?this.component.multipleInstances?t:Ce:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function Hh(n){return n===Ce?void 0:n}function Gh(n){return n.instantiationMode==="EAGER"}class Kh{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new zh(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}var H;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(H||(H={}));const Wh={debug:H.DEBUG,verbose:H.VERBOSE,info:H.INFO,warn:H.WARN,error:H.ERROR,silent:H.SILENT},Qh=H.INFO,Xh={[H.DEBUG]:"log",[H.VERBOSE]:"log",[H.INFO]:"info",[H.WARN]:"warn",[H.ERROR]:"error"},Jh=(n,t,...e)=>{if(t<n.logLevel)return;const r=new Date().toISOString(),s=Xh[t];if(s)console[s](`[${r}]  ${n.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class zc{constructor(t){this.name=t,this._logLevel=Qh,this._logHandler=Jh,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in H))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Wh[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,H.DEBUG,...t),this._logHandler(this,H.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,H.VERBOSE,...t),this._logHandler(this,H.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,H.INFO,...t),this._logHandler(this,H.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,H.WARN,...t),this._logHandler(this,H.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,H.ERROR,...t),this._logHandler(this,H.ERROR,...t)}}const Yh=(n,t)=>t.some(e=>n instanceof e);let Pa,Va;function Zh(){return Pa||(Pa=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function td(){return Va||(Va=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Hc=new WeakMap,si=new WeakMap,Gc=new WeakMap,Ws=new WeakMap,xi=new WeakMap;function ed(n){const t=new Promise((e,r)=>{const s=()=>{n.removeEventListener("success",o),n.removeEventListener("error",a)},o=()=>{e(ae(n.result)),s()},a=()=>{r(n.error),s()};n.addEventListener("success",o),n.addEventListener("error",a)});return t.then(e=>{e instanceof IDBCursor&&Hc.set(e,n)}).catch(()=>{}),xi.set(t,n),t}function nd(n){if(si.has(n))return;const t=new Promise((e,r)=>{const s=()=>{n.removeEventListener("complete",o),n.removeEventListener("error",a),n.removeEventListener("abort",a)},o=()=>{e(),s()},a=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",o),n.addEventListener("error",a),n.addEventListener("abort",a)});si.set(n,t)}let ii={get(n,t,e){if(n instanceof IDBTransaction){if(t==="done")return si.get(n);if(t==="objectStoreNames")return n.objectStoreNames||Gc.get(n);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return ae(n[t])},set(n,t,e){return n[t]=e,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function rd(n){ii=n(ii)}function sd(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const r=n.call(Qs(this),t,...e);return Gc.set(r,t.sort?t.sort():[t]),ae(r)}:td().includes(n)?function(...t){return n.apply(Qs(this),t),ae(Hc.get(this))}:function(...t){return ae(n.apply(Qs(this),t))}}function id(n){return typeof n=="function"?sd(n):(n instanceof IDBTransaction&&nd(n),Yh(n,Zh())?new Proxy(n,ii):n)}function ae(n){if(n instanceof IDBRequest)return ed(n);if(Ws.has(n))return Ws.get(n);const t=id(n);return t!==n&&(Ws.set(n,t),xi.set(t,n)),t}const Qs=n=>xi.get(n);function od(n,t,{blocked:e,upgrade:r,blocking:s,terminated:o}={}){const a=indexedDB.open(n,t),l=ae(a);return r&&a.addEventListener("upgradeneeded",h=>{r(ae(a.result),h.oldVersion,h.newVersion,ae(a.transaction),h)}),e&&a.addEventListener("blocked",h=>e(h.oldVersion,h.newVersion,h)),l.then(h=>{o&&h.addEventListener("close",()=>o()),s&&h.addEventListener("versionchange",d=>s(d.oldVersion,d.newVersion,d))}).catch(()=>{}),l}const ad=["get","getKey","getAll","getAllKeys","count"],cd=["put","add","delete","clear"],Xs=new Map;function Da(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(Xs.get(t))return Xs.get(t);const e=t.replace(/FromIndex$/,""),r=t!==e,s=cd.includes(e);if(!(e in(r?IDBIndex:IDBObjectStore).prototype)||!(s||ad.includes(e)))return;const o=async function(a,...l){const h=this.transaction(a,s?"readwrite":"readonly");let d=h.store;return r&&(d=d.index(l.shift())),(await Promise.all([d[e](...l),s&&h.done]))[0]};return Xs.set(t,o),o}rd(n=>({...n,get:(t,e,r)=>Da(t,e)||n.get(t,e,r),has:(t,e)=>!!Da(t,e)||n.has(t,e)}));class ld{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(ud(e)){const r=e.getImmediate();return`${r.library}/${r.version}`}else return null}).filter(e=>e).join(" ")}}function ud(n){return n.getComponent()?.type==="VERSION"}const oi="@firebase/app",ka="0.14.6";const Jt=new zc("@firebase/app"),hd="@firebase/app-compat",dd="@firebase/analytics-compat",fd="@firebase/analytics",md="@firebase/app-check-compat",gd="@firebase/app-check",pd="@firebase/auth",_d="@firebase/auth-compat",yd="@firebase/database",Ed="@firebase/data-connect",Td="@firebase/database-compat",vd="@firebase/functions",Id="@firebase/functions-compat",wd="@firebase/installations",Ad="@firebase/installations-compat",Sd="@firebase/messaging",Rd="@firebase/messaging-compat",Cd="@firebase/performance",bd="@firebase/performance-compat",Pd="@firebase/remote-config",Vd="@firebase/remote-config-compat",Dd="@firebase/storage",kd="@firebase/storage-compat",Nd="@firebase/firestore",Od="@firebase/ai",Ld="@firebase/firestore-compat",Md="firebase",xd="12.6.0";const ai="[DEFAULT]",Fd={[oi]:"fire-core",[hd]:"fire-core-compat",[fd]:"fire-analytics",[dd]:"fire-analytics-compat",[gd]:"fire-app-check",[md]:"fire-app-check-compat",[pd]:"fire-auth",[_d]:"fire-auth-compat",[yd]:"fire-rtdb",[Ed]:"fire-data-connect",[Td]:"fire-rtdb-compat",[vd]:"fire-fn",[Id]:"fire-fn-compat",[wd]:"fire-iid",[Ad]:"fire-iid-compat",[Sd]:"fire-fcm",[Rd]:"fire-fcm-compat",[Cd]:"fire-perf",[bd]:"fire-perf-compat",[Pd]:"fire-rc",[Vd]:"fire-rc-compat",[Dd]:"fire-gcs",[kd]:"fire-gcs-compat",[Nd]:"fire-fst",[Ld]:"fire-fst-compat",[Od]:"fire-vertex","fire-js":"fire-js",[Md]:"fire-js-all"};const Kr=new Map,Bd=new Map,ci=new Map;function Na(n,t){try{n.container.addComponent(t)}catch(e){Jt.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,e)}}function Wr(n){const t=n.name;if(ci.has(t))return Jt.debug(`There were multiple attempts to register component ${t}.`),!1;ci.set(t,n);for(const e of Kr.values())Na(e,n);for(const e of Bd.values())Na(e,n);return!0}function Ud(n,t){const e=n.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),n.container.getProvider(t)}function jd(n){return n==null?!1:n.settings!==void 0}const qd={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ce=new $c("app","Firebase",qd);class $d{constructor(t,e,r){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new zn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw ce.create("app-deleted",{appName:this._name})}}const zd=xd;function Kc(n,t={}){let e=n;typeof t!="object"&&(t={name:t});const r={name:ai,automaticDataCollectionEnabled:!0,...t},s=r.name;if(typeof s!="string"||!s)throw ce.create("bad-app-name",{appName:String(s)});if(e||(e=qc()),!e)throw ce.create("no-options");const o=Kr.get(s);if(o){if(Gr(e,o.options)&&Gr(r,o.config))return o;throw ce.create("duplicate-app",{appName:s})}const a=new Kh(s);for(const h of ci.values())a.addComponent(h);const l=new $d(e,r,a);return Kr.set(s,l),l}function Hd(n=ai){const t=Kr.get(n);if(!t&&n===ai&&qc())return Kc();if(!t)throw ce.create("no-app",{appName:n});return t}function Qe(n,t,e){let r=Fd[n]??n;e&&(r+=`-${e}`);const s=r.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const a=[`Unable to register library "${r}" with version "${t}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Jt.warn(a.join(" "));return}Wr(new zn(`${r}-version`,()=>({library:r,version:t}),"VERSION"))}const Gd="firebase-heartbeat-database",Kd=1,Hn="firebase-heartbeat-store";let Js=null;function Wc(){return Js||(Js=od(Gd,Kd,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(Hn)}catch(e){console.warn(e)}}}}).catch(n=>{throw ce.create("idb-open",{originalErrorMessage:n.message})})),Js}async function Wd(n){try{const e=(await Wc()).transaction(Hn),r=await e.objectStore(Hn).get(Qc(n));return await e.done,r}catch(t){if(t instanceof hn)Jt.warn(t.message);else{const e=ce.create("idb-get",{originalErrorMessage:t?.message});Jt.warn(e.message)}}}async function Oa(n,t){try{const r=(await Wc()).transaction(Hn,"readwrite");await r.objectStore(Hn).put(t,Qc(n)),await r.done}catch(e){if(e instanceof hn)Jt.warn(e.message);else{const r=ce.create("idb-set",{originalErrorMessage:e?.message});Jt.warn(r.message)}}}function Qc(n){return`${n.name}!${n.options.appId}`}const Qd=1024,Xd=30;class Jd{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Zd(e),this._heartbeatsCachePromise=this._storage.read().then(r=>(this._heartbeatsCache=r,r))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=La();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(s=>s.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:e}),this._heartbeatsCache.heartbeats.length>Xd){const s=tf(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){Jt.warn(t)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=La(),{heartbeatsToSend:e,unsentEntries:r}=Yd(this._heartbeatsCache.heartbeats),s=Hr(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return Jt.warn(t),""}}}function La(){return new Date().toISOString().substring(0,10)}function Yd(n,t=Qd){const e=[];let r=n.slice();for(const s of n){const o=e.find(a=>a.agent===s.agent);if(o){if(o.dates.push(s.date),Ma(e)>t){o.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),Ma(e)>t){e.pop();break}r=r.slice(1)}return{heartbeatsToSend:e,unsentEntries:r}}class Zd{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Bh()?Uh().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await Wd(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const r=await this.read();return Oa(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const r=await this.read();return Oa(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...t.heartbeats]})}else return}}function Ma(n){return Hr(JSON.stringify({version:2,heartbeats:n})).length}function tf(n){if(n.length===0)return-1;let t=0,e=n[0].date;for(let r=1;r<n.length;r++)n[r].date<e&&(e=n[r].date,t=r);return t}function ef(n){Wr(new zn("platform-logger",t=>new ld(t),"PRIVATE")),Wr(new zn("heartbeat",t=>new Jd(t),"PRIVATE")),Qe(oi,ka,n),Qe(oi,ka,"esm2020"),Qe("fire-js","")}ef("");var nf="firebase",rf="12.6.0";Qe(nf,rf,"app");var xa=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var le,Xc;(function(){var n;function t(T,m){function _(){}_.prototype=m.prototype,T.F=m.prototype,T.prototype=new _,T.prototype.constructor=T,T.D=function(v,y,w){for(var g=Array(arguments.length-2),Ct=2;Ct<arguments.length;Ct++)g[Ct-2]=arguments[Ct];return m.prototype[y].apply(v,g)}}function e(){this.blockSize=-1}function r(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}t(r,e),r.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(T,m,_){_||(_=0);const v=Array(16);if(typeof m=="string")for(var y=0;y<16;++y)v[y]=m.charCodeAt(_++)|m.charCodeAt(_++)<<8|m.charCodeAt(_++)<<16|m.charCodeAt(_++)<<24;else for(y=0;y<16;++y)v[y]=m[_++]|m[_++]<<8|m[_++]<<16|m[_++]<<24;m=T.g[0],_=T.g[1],y=T.g[2];let w=T.g[3],g;g=m+(w^_&(y^w))+v[0]+3614090360&4294967295,m=_+(g<<7&4294967295|g>>>25),g=w+(y^m&(_^y))+v[1]+3905402710&4294967295,w=m+(g<<12&4294967295|g>>>20),g=y+(_^w&(m^_))+v[2]+606105819&4294967295,y=w+(g<<17&4294967295|g>>>15),g=_+(m^y&(w^m))+v[3]+3250441966&4294967295,_=y+(g<<22&4294967295|g>>>10),g=m+(w^_&(y^w))+v[4]+4118548399&4294967295,m=_+(g<<7&4294967295|g>>>25),g=w+(y^m&(_^y))+v[5]+1200080426&4294967295,w=m+(g<<12&4294967295|g>>>20),g=y+(_^w&(m^_))+v[6]+2821735955&4294967295,y=w+(g<<17&4294967295|g>>>15),g=_+(m^y&(w^m))+v[7]+4249261313&4294967295,_=y+(g<<22&4294967295|g>>>10),g=m+(w^_&(y^w))+v[8]+1770035416&4294967295,m=_+(g<<7&4294967295|g>>>25),g=w+(y^m&(_^y))+v[9]+2336552879&4294967295,w=m+(g<<12&4294967295|g>>>20),g=y+(_^w&(m^_))+v[10]+4294925233&4294967295,y=w+(g<<17&4294967295|g>>>15),g=_+(m^y&(w^m))+v[11]+2304563134&4294967295,_=y+(g<<22&4294967295|g>>>10),g=m+(w^_&(y^w))+v[12]+1804603682&4294967295,m=_+(g<<7&4294967295|g>>>25),g=w+(y^m&(_^y))+v[13]+4254626195&4294967295,w=m+(g<<12&4294967295|g>>>20),g=y+(_^w&(m^_))+v[14]+2792965006&4294967295,y=w+(g<<17&4294967295|g>>>15),g=_+(m^y&(w^m))+v[15]+1236535329&4294967295,_=y+(g<<22&4294967295|g>>>10),g=m+(y^w&(_^y))+v[1]+4129170786&4294967295,m=_+(g<<5&4294967295|g>>>27),g=w+(_^y&(m^_))+v[6]+3225465664&4294967295,w=m+(g<<9&4294967295|g>>>23),g=y+(m^_&(w^m))+v[11]+643717713&4294967295,y=w+(g<<14&4294967295|g>>>18),g=_+(w^m&(y^w))+v[0]+3921069994&4294967295,_=y+(g<<20&4294967295|g>>>12),g=m+(y^w&(_^y))+v[5]+3593408605&4294967295,m=_+(g<<5&4294967295|g>>>27),g=w+(_^y&(m^_))+v[10]+38016083&4294967295,w=m+(g<<9&4294967295|g>>>23),g=y+(m^_&(w^m))+v[15]+3634488961&4294967295,y=w+(g<<14&4294967295|g>>>18),g=_+(w^m&(y^w))+v[4]+3889429448&4294967295,_=y+(g<<20&4294967295|g>>>12),g=m+(y^w&(_^y))+v[9]+568446438&4294967295,m=_+(g<<5&4294967295|g>>>27),g=w+(_^y&(m^_))+v[14]+3275163606&4294967295,w=m+(g<<9&4294967295|g>>>23),g=y+(m^_&(w^m))+v[3]+4107603335&4294967295,y=w+(g<<14&4294967295|g>>>18),g=_+(w^m&(y^w))+v[8]+1163531501&4294967295,_=y+(g<<20&4294967295|g>>>12),g=m+(y^w&(_^y))+v[13]+2850285829&4294967295,m=_+(g<<5&4294967295|g>>>27),g=w+(_^y&(m^_))+v[2]+4243563512&4294967295,w=m+(g<<9&4294967295|g>>>23),g=y+(m^_&(w^m))+v[7]+1735328473&4294967295,y=w+(g<<14&4294967295|g>>>18),g=_+(w^m&(y^w))+v[12]+2368359562&4294967295,_=y+(g<<20&4294967295|g>>>12),g=m+(_^y^w)+v[5]+4294588738&4294967295,m=_+(g<<4&4294967295|g>>>28),g=w+(m^_^y)+v[8]+2272392833&4294967295,w=m+(g<<11&4294967295|g>>>21),g=y+(w^m^_)+v[11]+1839030562&4294967295,y=w+(g<<16&4294967295|g>>>16),g=_+(y^w^m)+v[14]+4259657740&4294967295,_=y+(g<<23&4294967295|g>>>9),g=m+(_^y^w)+v[1]+2763975236&4294967295,m=_+(g<<4&4294967295|g>>>28),g=w+(m^_^y)+v[4]+1272893353&4294967295,w=m+(g<<11&4294967295|g>>>21),g=y+(w^m^_)+v[7]+4139469664&4294967295,y=w+(g<<16&4294967295|g>>>16),g=_+(y^w^m)+v[10]+3200236656&4294967295,_=y+(g<<23&4294967295|g>>>9),g=m+(_^y^w)+v[13]+681279174&4294967295,m=_+(g<<4&4294967295|g>>>28),g=w+(m^_^y)+v[0]+3936430074&4294967295,w=m+(g<<11&4294967295|g>>>21),g=y+(w^m^_)+v[3]+3572445317&4294967295,y=w+(g<<16&4294967295|g>>>16),g=_+(y^w^m)+v[6]+76029189&4294967295,_=y+(g<<23&4294967295|g>>>9),g=m+(_^y^w)+v[9]+3654602809&4294967295,m=_+(g<<4&4294967295|g>>>28),g=w+(m^_^y)+v[12]+3873151461&4294967295,w=m+(g<<11&4294967295|g>>>21),g=y+(w^m^_)+v[15]+530742520&4294967295,y=w+(g<<16&4294967295|g>>>16),g=_+(y^w^m)+v[2]+3299628645&4294967295,_=y+(g<<23&4294967295|g>>>9),g=m+(y^(_|~w))+v[0]+4096336452&4294967295,m=_+(g<<6&4294967295|g>>>26),g=w+(_^(m|~y))+v[7]+1126891415&4294967295,w=m+(g<<10&4294967295|g>>>22),g=y+(m^(w|~_))+v[14]+2878612391&4294967295,y=w+(g<<15&4294967295|g>>>17),g=_+(w^(y|~m))+v[5]+4237533241&4294967295,_=y+(g<<21&4294967295|g>>>11),g=m+(y^(_|~w))+v[12]+1700485571&4294967295,m=_+(g<<6&4294967295|g>>>26),g=w+(_^(m|~y))+v[3]+2399980690&4294967295,w=m+(g<<10&4294967295|g>>>22),g=y+(m^(w|~_))+v[10]+4293915773&4294967295,y=w+(g<<15&4294967295|g>>>17),g=_+(w^(y|~m))+v[1]+2240044497&4294967295,_=y+(g<<21&4294967295|g>>>11),g=m+(y^(_|~w))+v[8]+1873313359&4294967295,m=_+(g<<6&4294967295|g>>>26),g=w+(_^(m|~y))+v[15]+4264355552&4294967295,w=m+(g<<10&4294967295|g>>>22),g=y+(m^(w|~_))+v[6]+2734768916&4294967295,y=w+(g<<15&4294967295|g>>>17),g=_+(w^(y|~m))+v[13]+1309151649&4294967295,_=y+(g<<21&4294967295|g>>>11),g=m+(y^(_|~w))+v[4]+4149444226&4294967295,m=_+(g<<6&4294967295|g>>>26),g=w+(_^(m|~y))+v[11]+3174756917&4294967295,w=m+(g<<10&4294967295|g>>>22),g=y+(m^(w|~_))+v[2]+718787259&4294967295,y=w+(g<<15&4294967295|g>>>17),g=_+(w^(y|~m))+v[9]+3951481745&4294967295,T.g[0]=T.g[0]+m&4294967295,T.g[1]=T.g[1]+(y+(g<<21&4294967295|g>>>11))&4294967295,T.g[2]=T.g[2]+y&4294967295,T.g[3]=T.g[3]+w&4294967295}r.prototype.v=function(T,m){m===void 0&&(m=T.length);const _=m-this.blockSize,v=this.C;let y=this.h,w=0;for(;w<m;){if(y==0)for(;w<=_;)s(this,T,w),w+=this.blockSize;if(typeof T=="string"){for(;w<m;)if(v[y++]=T.charCodeAt(w++),y==this.blockSize){s(this,v),y=0;break}}else for(;w<m;)if(v[y++]=T[w++],y==this.blockSize){s(this,v),y=0;break}}this.h=y,this.o+=m},r.prototype.A=function(){var T=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);T[0]=128;for(var m=1;m<T.length-8;++m)T[m]=0;m=this.o*8;for(var _=T.length-8;_<T.length;++_)T[_]=m&255,m/=256;for(this.v(T),T=Array(16),m=0,_=0;_<4;++_)for(let v=0;v<32;v+=8)T[m++]=this.g[_]>>>v&255;return T};function o(T,m){var _=l;return Object.prototype.hasOwnProperty.call(_,T)?_[T]:_[T]=m(T)}function a(T,m){this.h=m;const _=[];let v=!0;for(let y=T.length-1;y>=0;y--){const w=T[y]|0;v&&w==m||(_[y]=w,v=!1)}this.g=_}var l={};function h(T){return-128<=T&&T<128?o(T,function(m){return new a([m|0],m<0?-1:0)}):new a([T|0],T<0?-1:0)}function d(T){if(isNaN(T)||!isFinite(T))return E;if(T<0)return D(d(-T));const m=[];let _=1;for(let v=0;T>=_;v++)m[v]=T/_|0,_*=4294967296;return new a(m,0)}function p(T,m){if(T.length==0)throw Error("number format error: empty string");if(m=m||10,m<2||36<m)throw Error("radix out of range: "+m);if(T.charAt(0)=="-")return D(p(T.substring(1),m));if(T.indexOf("-")>=0)throw Error('number format error: interior "-" character');const _=d(Math.pow(m,8));let v=E;for(let w=0;w<T.length;w+=8){var y=Math.min(8,T.length-w);const g=parseInt(T.substring(w,w+y),m);y<8?(y=d(Math.pow(m,y)),v=v.j(y).add(d(g))):(v=v.j(_),v=v.add(d(g)))}return v}var E=h(0),A=h(1),P=h(16777216);n=a.prototype,n.m=function(){if(M(this))return-D(this).m();let T=0,m=1;for(let _=0;_<this.g.length;_++){const v=this.i(_);T+=(v>=0?v:4294967296+v)*m,m*=4294967296}return T},n.toString=function(T){if(T=T||10,T<2||36<T)throw Error("radix out of range: "+T);if(N(this))return"0";if(M(this))return"-"+D(this).toString(T);const m=d(Math.pow(T,6));var _=this;let v="";for(;;){const y=It(_,m).g;_=G(_,y.j(m));let w=((_.g.length>0?_.g[0]:_.h)>>>0).toString(T);if(_=y,N(_))return w+v;for(;w.length<6;)w="0"+w;v=w+v}},n.i=function(T){return T<0?0:T<this.g.length?this.g[T]:this.h};function N(T){if(T.h!=0)return!1;for(let m=0;m<T.g.length;m++)if(T.g[m]!=0)return!1;return!0}function M(T){return T.h==-1}n.l=function(T){return T=G(this,T),M(T)?-1:N(T)?0:1};function D(T){const m=T.g.length,_=[];for(let v=0;v<m;v++)_[v]=~T.g[v];return new a(_,~T.h).add(A)}n.abs=function(){return M(this)?D(this):this},n.add=function(T){const m=Math.max(this.g.length,T.g.length),_=[];let v=0;for(let y=0;y<=m;y++){let w=v+(this.i(y)&65535)+(T.i(y)&65535),g=(w>>>16)+(this.i(y)>>>16)+(T.i(y)>>>16);v=g>>>16,w&=65535,g&=65535,_[y]=g<<16|w}return new a(_,_[_.length-1]&-2147483648?-1:0)};function G(T,m){return T.add(D(m))}n.j=function(T){if(N(this)||N(T))return E;if(M(this))return M(T)?D(this).j(D(T)):D(D(this).j(T));if(M(T))return D(this.j(D(T)));if(this.l(P)<0&&T.l(P)<0)return d(this.m()*T.m());const m=this.g.length+T.g.length,_=[];for(var v=0;v<2*m;v++)_[v]=0;for(v=0;v<this.g.length;v++)for(let y=0;y<T.g.length;y++){const w=this.i(v)>>>16,g=this.i(v)&65535,Ct=T.i(y)>>>16,ve=T.i(y)&65535;_[2*v+2*y]+=g*ve,K(_,2*v+2*y),_[2*v+2*y+1]+=w*ve,K(_,2*v+2*y+1),_[2*v+2*y+1]+=g*Ct,K(_,2*v+2*y+1),_[2*v+2*y+2]+=w*Ct,K(_,2*v+2*y+2)}for(T=0;T<m;T++)_[T]=_[2*T+1]<<16|_[2*T];for(T=m;T<2*m;T++)_[T]=0;return new a(_,0)};function K(T,m){for(;(T[m]&65535)!=T[m];)T[m+1]+=T[m]>>>16,T[m]&=65535,m++}function W(T,m){this.g=T,this.h=m}function It(T,m){if(N(m))throw Error("division by zero");if(N(T))return new W(E,E);if(M(T))return m=It(D(T),m),new W(D(m.g),D(m.h));if(M(m))return m=It(T,D(m)),new W(D(m.g),m.h);if(T.g.length>30){if(M(T)||M(m))throw Error("slowDivide_ only works with positive integers.");for(var _=A,v=m;v.l(T)<=0;)_=Rt(_),v=Rt(v);var y=ut(_,1),w=ut(v,1);for(v=ut(v,2),_=ut(_,2);!N(v);){var g=w.add(v);g.l(T)<=0&&(y=y.add(_),w=g),v=ut(v,1),_=ut(_,1)}return m=G(T,y.j(m)),new W(y,m)}for(y=E;T.l(m)>=0;){for(_=Math.max(1,Math.floor(T.m()/m.m())),v=Math.ceil(Math.log(_)/Math.LN2),v=v<=48?1:Math.pow(2,v-48),w=d(_),g=w.j(m);M(g)||g.l(T)>0;)_-=v,w=d(_),g=w.j(m);N(w)&&(w=A),y=y.add(w),T=G(T,g)}return new W(y,T)}n.B=function(T){return It(this,T).h},n.and=function(T){const m=Math.max(this.g.length,T.g.length),_=[];for(let v=0;v<m;v++)_[v]=this.i(v)&T.i(v);return new a(_,this.h&T.h)},n.or=function(T){const m=Math.max(this.g.length,T.g.length),_=[];for(let v=0;v<m;v++)_[v]=this.i(v)|T.i(v);return new a(_,this.h|T.h)},n.xor=function(T){const m=Math.max(this.g.length,T.g.length),_=[];for(let v=0;v<m;v++)_[v]=this.i(v)^T.i(v);return new a(_,this.h^T.h)};function Rt(T){const m=T.g.length+1,_=[];for(let v=0;v<m;v++)_[v]=T.i(v)<<1|T.i(v-1)>>>31;return new a(_,T.h)}function ut(T,m){const _=m>>5;m%=32;const v=T.g.length-_,y=[];for(let w=0;w<v;w++)y[w]=m>0?T.i(w+_)>>>m|T.i(w+_+1)<<32-m:T.i(w+_);return new a(y,T.h)}r.prototype.digest=r.prototype.A,r.prototype.reset=r.prototype.u,r.prototype.update=r.prototype.v,Xc=r,a.prototype.add=a.prototype.add,a.prototype.multiply=a.prototype.j,a.prototype.modulo=a.prototype.B,a.prototype.compare=a.prototype.l,a.prototype.toNumber=a.prototype.m,a.prototype.toString=a.prototype.toString,a.prototype.getBits=a.prototype.i,a.fromNumber=d,a.fromString=p,le=a}).apply(typeof xa<"u"?xa:typeof self<"u"?self:typeof window<"u"?window:{});var Vr=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Jc,kn,Yc,xr,li,Zc,tl,el;(function(){var n,t=Object.defineProperty;function e(i){i=[typeof globalThis=="object"&&globalThis,i,typeof window=="object"&&window,typeof self=="object"&&self,typeof Vr=="object"&&Vr];for(var c=0;c<i.length;++c){var u=i[c];if(u&&u.Math==Math)return u}throw Error("Cannot find global object")}var r=e(this);function s(i,c){if(c)t:{var u=r;i=i.split(".");for(var f=0;f<i.length-1;f++){var I=i[f];if(!(I in u))break t;u=u[I]}i=i[i.length-1],f=u[i],c=c(f),c!=f&&c!=null&&t(u,i,{configurable:!0,writable:!0,value:c})}}s("Symbol.dispose",function(i){return i||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(i){return i||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(i){return i||function(c){var u=[],f;for(f in c)Object.prototype.hasOwnProperty.call(c,f)&&u.push([f,c[f]]);return u}});var o=o||{},a=this||self;function l(i){var c=typeof i;return c=="object"&&i!=null||c=="function"}function h(i,c,u){return i.call.apply(i.bind,arguments)}function d(i,c,u){return d=h,d.apply(null,arguments)}function p(i,c){var u=Array.prototype.slice.call(arguments,1);return function(){var f=u.slice();return f.push.apply(f,arguments),i.apply(this,f)}}function E(i,c){function u(){}u.prototype=c.prototype,i.Z=c.prototype,i.prototype=new u,i.prototype.constructor=i,i.Ob=function(f,I,S){for(var V=Array(arguments.length-2),j=2;j<arguments.length;j++)V[j-2]=arguments[j];return c.prototype[I].apply(f,V)}}var A=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?i=>i&&AsyncContext.Snapshot.wrap(i):i=>i;function P(i){const c=i.length;if(c>0){const u=Array(c);for(let f=0;f<c;f++)u[f]=i[f];return u}return[]}function N(i,c){for(let f=1;f<arguments.length;f++){const I=arguments[f];var u=typeof I;if(u=u!="object"?u:I?Array.isArray(I)?"array":u:"null",u=="array"||u=="object"&&typeof I.length=="number"){u=i.length||0;const S=I.length||0;i.length=u+S;for(let V=0;V<S;V++)i[u+V]=I[V]}else i.push(I)}}class M{constructor(c,u){this.i=c,this.j=u,this.h=0,this.g=null}get(){let c;return this.h>0?(this.h--,c=this.g,this.g=c.next,c.next=null):c=this.i(),c}}function D(i){a.setTimeout(()=>{throw i},0)}function G(){var i=T;let c=null;return i.g&&(c=i.g,i.g=i.g.next,i.g||(i.h=null),c.next=null),c}class K{constructor(){this.h=this.g=null}add(c,u){const f=W.get();f.set(c,u),this.h?this.h.next=f:this.g=f,this.h=f}}var W=new M(()=>new It,i=>i.reset());class It{constructor(){this.next=this.g=this.h=null}set(c,u){this.h=c,this.g=u,this.next=null}reset(){this.next=this.g=this.h=null}}let Rt,ut=!1,T=new K,m=()=>{const i=Promise.resolve(void 0);Rt=()=>{i.then(_)}};function _(){for(var i;i=G();){try{i.h.call(i.g)}catch(u){D(u)}var c=W;c.j(i),c.h<100&&(c.h++,i.next=c.g,c.g=i)}ut=!1}function v(){this.u=this.u,this.C=this.C}v.prototype.u=!1,v.prototype.dispose=function(){this.u||(this.u=!0,this.N())},v.prototype[Symbol.dispose]=function(){this.dispose()},v.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function y(i,c){this.type=i,this.g=this.target=c,this.defaultPrevented=!1}y.prototype.h=function(){this.defaultPrevented=!0};var w=(function(){if(!a.addEventListener||!Object.defineProperty)return!1;var i=!1,c=Object.defineProperty({},"passive",{get:function(){i=!0}});try{const u=()=>{};a.addEventListener("test",u,c),a.removeEventListener("test",u,c)}catch{}return i})();function g(i){return/^[\s\xa0]*$/.test(i)}function Ct(i,c){y.call(this,i?i.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,i&&this.init(i,c)}E(Ct,y),Ct.prototype.init=function(i,c){const u=this.type=i.type,f=i.changedTouches&&i.changedTouches.length?i.changedTouches[0]:null;this.target=i.target||i.srcElement,this.g=c,c=i.relatedTarget,c||(u=="mouseover"?c=i.fromElement:u=="mouseout"&&(c=i.toElement)),this.relatedTarget=c,f?(this.clientX=f.clientX!==void 0?f.clientX:f.pageX,this.clientY=f.clientY!==void 0?f.clientY:f.pageY,this.screenX=f.screenX||0,this.screenY=f.screenY||0):(this.clientX=i.clientX!==void 0?i.clientX:i.pageX,this.clientY=i.clientY!==void 0?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0),this.button=i.button,this.key=i.key||"",this.ctrlKey=i.ctrlKey,this.altKey=i.altKey,this.shiftKey=i.shiftKey,this.metaKey=i.metaKey,this.pointerId=i.pointerId||0,this.pointerType=i.pointerType,this.state=i.state,this.i=i,i.defaultPrevented&&Ct.Z.h.call(this)},Ct.prototype.h=function(){Ct.Z.h.call(this);const i=this.i;i.preventDefault?i.preventDefault():i.returnValue=!1};var ve="closure_listenable_"+(Math.random()*1e6|0),ju=0;function qu(i,c,u,f,I){this.listener=i,this.proxy=null,this.src=c,this.type=u,this.capture=!!f,this.ha=I,this.key=++ju,this.da=this.fa=!1}function gr(i){i.da=!0,i.listener=null,i.proxy=null,i.src=null,i.ha=null}function pr(i,c,u){for(const f in i)c.call(u,i[f],f,i)}function $u(i,c){for(const u in i)c.call(void 0,i[u],u,i)}function So(i){const c={};for(const u in i)c[u]=i[u];return c}const Ro="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Co(i,c){let u,f;for(let I=1;I<arguments.length;I++){f=arguments[I];for(u in f)i[u]=f[u];for(let S=0;S<Ro.length;S++)u=Ro[S],Object.prototype.hasOwnProperty.call(f,u)&&(i[u]=f[u])}}function _r(i){this.src=i,this.g={},this.h=0}_r.prototype.add=function(i,c,u,f,I){const S=i.toString();i=this.g[S],i||(i=this.g[S]=[],this.h++);const V=Ss(i,c,f,I);return V>-1?(c=i[V],u||(c.fa=!1)):(c=new qu(c,this.src,S,!!f,I),c.fa=u,i.push(c)),c};function As(i,c){const u=c.type;if(u in i.g){var f=i.g[u],I=Array.prototype.indexOf.call(f,c,void 0),S;(S=I>=0)&&Array.prototype.splice.call(f,I,1),S&&(gr(c),i.g[u].length==0&&(delete i.g[u],i.h--))}}function Ss(i,c,u,f){for(let I=0;I<i.length;++I){const S=i[I];if(!S.da&&S.listener==c&&S.capture==!!u&&S.ha==f)return I}return-1}var Rs="closure_lm_"+(Math.random()*1e6|0),Cs={};function bo(i,c,u,f,I){if(Array.isArray(c)){for(let S=0;S<c.length;S++)bo(i,c[S],u,f,I);return null}return u=Do(u),i&&i[ve]?i.J(c,u,l(f)?!!f.capture:!1,I):zu(i,c,u,!1,f,I)}function zu(i,c,u,f,I,S){if(!c)throw Error("Invalid event type");const V=l(I)?!!I.capture:!!I;let j=Ps(i);if(j||(i[Rs]=j=new _r(i)),u=j.add(c,u,f,V,S),u.proxy)return u;if(f=Hu(),u.proxy=f,f.src=i,f.listener=u,i.addEventListener)w||(I=V),I===void 0&&(I=!1),i.addEventListener(c.toString(),f,I);else if(i.attachEvent)i.attachEvent(Vo(c.toString()),f);else if(i.addListener&&i.removeListener)i.addListener(f);else throw Error("addEventListener and attachEvent are unavailable.");return u}function Hu(){function i(u){return c.call(i.src,i.listener,u)}const c=Gu;return i}function Po(i,c,u,f,I){if(Array.isArray(c))for(var S=0;S<c.length;S++)Po(i,c[S],u,f,I);else f=l(f)?!!f.capture:!!f,u=Do(u),i&&i[ve]?(i=i.i,S=String(c).toString(),S in i.g&&(c=i.g[S],u=Ss(c,u,f,I),u>-1&&(gr(c[u]),Array.prototype.splice.call(c,u,1),c.length==0&&(delete i.g[S],i.h--)))):i&&(i=Ps(i))&&(c=i.g[c.toString()],i=-1,c&&(i=Ss(c,u,f,I)),(u=i>-1?c[i]:null)&&bs(u))}function bs(i){if(typeof i!="number"&&i&&!i.da){var c=i.src;if(c&&c[ve])As(c.i,i);else{var u=i.type,f=i.proxy;c.removeEventListener?c.removeEventListener(u,f,i.capture):c.detachEvent?c.detachEvent(Vo(u),f):c.addListener&&c.removeListener&&c.removeListener(f),(u=Ps(c))?(As(u,i),u.h==0&&(u.src=null,c[Rs]=null)):gr(i)}}}function Vo(i){return i in Cs?Cs[i]:Cs[i]="on"+i}function Gu(i,c){if(i.da)i=!0;else{c=new Ct(c,this);const u=i.listener,f=i.ha||i.src;i.fa&&bs(i),i=u.call(f,c)}return i}function Ps(i){return i=i[Rs],i instanceof _r?i:null}var Vs="__closure_events_fn_"+(Math.random()*1e9>>>0);function Do(i){return typeof i=="function"?i:(i[Vs]||(i[Vs]=function(c){return i.handleEvent(c)}),i[Vs])}function yt(){v.call(this),this.i=new _r(this),this.M=this,this.G=null}E(yt,v),yt.prototype[ve]=!0,yt.prototype.removeEventListener=function(i,c,u,f){Po(this,i,c,u,f)};function wt(i,c){var u,f=i.G;if(f)for(u=[];f;f=f.G)u.push(f);if(i=i.M,f=c.type||c,typeof c=="string")c=new y(c,i);else if(c instanceof y)c.target=c.target||i;else{var I=c;c=new y(f,i),Co(c,I)}I=!0;let S,V;if(u)for(V=u.length-1;V>=0;V--)S=c.g=u[V],I=yr(S,f,!0,c)&&I;if(S=c.g=i,I=yr(S,f,!0,c)&&I,I=yr(S,f,!1,c)&&I,u)for(V=0;V<u.length;V++)S=c.g=u[V],I=yr(S,f,!1,c)&&I}yt.prototype.N=function(){if(yt.Z.N.call(this),this.i){var i=this.i;for(const c in i.g){const u=i.g[c];for(let f=0;f<u.length;f++)gr(u[f]);delete i.g[c],i.h--}}this.G=null},yt.prototype.J=function(i,c,u,f){return this.i.add(String(i),c,!1,u,f)},yt.prototype.K=function(i,c,u,f){return this.i.add(String(i),c,!0,u,f)};function yr(i,c,u,f){if(c=i.i.g[String(c)],!c)return!0;c=c.concat();let I=!0;for(let S=0;S<c.length;++S){const V=c[S];if(V&&!V.da&&V.capture==u){const j=V.listener,ot=V.ha||V.src;V.fa&&As(i.i,V),I=j.call(ot,f)!==!1&&I}}return I&&!f.defaultPrevented}function Ku(i,c){if(typeof i!="function")if(i&&typeof i.handleEvent=="function")i=d(i.handleEvent,i);else throw Error("Invalid listener argument");return Number(c)>2147483647?-1:a.setTimeout(i,c||0)}function ko(i){i.g=Ku(()=>{i.g=null,i.i&&(i.i=!1,ko(i))},i.l);const c=i.h;i.h=null,i.m.apply(null,c)}class Wu extends v{constructor(c,u){super(),this.m=c,this.l=u,this.h=null,this.i=!1,this.g=null}j(c){this.h=arguments,this.g?this.i=!0:ko(this)}N(){super.N(),this.g&&(a.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function pn(i){v.call(this),this.h=i,this.g={}}E(pn,v);var No=[];function Oo(i){pr(i.g,function(c,u){this.g.hasOwnProperty(u)&&bs(c)},i),i.g={}}pn.prototype.N=function(){pn.Z.N.call(this),Oo(this)},pn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var Ds=a.JSON.stringify,Qu=a.JSON.parse,Xu=class{stringify(i){return a.JSON.stringify(i,void 0)}parse(i){return a.JSON.parse(i,void 0)}};function Lo(){}function Mo(){}var _n={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ks(){y.call(this,"d")}E(ks,y);function Ns(){y.call(this,"c")}E(Ns,y);var Ie={},xo=null;function Er(){return xo=xo||new yt}Ie.Ia="serverreachability";function Fo(i){y.call(this,Ie.Ia,i)}E(Fo,y);function yn(i){const c=Er();wt(c,new Fo(c))}Ie.STAT_EVENT="statevent";function Bo(i,c){y.call(this,Ie.STAT_EVENT,i),this.stat=c}E(Bo,y);function At(i){const c=Er();wt(c,new Bo(c,i))}Ie.Ja="timingevent";function Uo(i,c){y.call(this,Ie.Ja,i),this.size=c}E(Uo,y);function En(i,c){if(typeof i!="function")throw Error("Fn must not be null and must be a function");return a.setTimeout(function(){i()},c)}function Tn(){this.g=!0}Tn.prototype.ua=function(){this.g=!1};function Ju(i,c,u,f,I,S){i.info(function(){if(i.g)if(S){var V="",j=S.split("&");for(let X=0;X<j.length;X++){var ot=j[X].split("=");if(ot.length>1){const ht=ot[0];ot=ot[1];const Ut=ht.split("_");V=Ut.length>=2&&Ut[1]=="type"?V+(ht+"="+ot+"&"):V+(ht+"=redacted&")}}}else V=null;else V=S;return"XMLHTTP REQ ("+f+") [attempt "+I+"]: "+c+`
`+u+`
`+V})}function Yu(i,c,u,f,I,S,V){i.info(function(){return"XMLHTTP RESP ("+f+") [ attempt "+I+"]: "+c+`
`+u+`
`+S+" "+V})}function Ue(i,c,u,f){i.info(function(){return"XMLHTTP TEXT ("+c+"): "+th(i,u)+(f?" "+f:"")})}function Zu(i,c){i.info(function(){return"TIMEOUT: "+c})}Tn.prototype.info=function(){};function th(i,c){if(!i.g)return c;if(!c)return null;try{const S=JSON.parse(c);if(S){for(i=0;i<S.length;i++)if(Array.isArray(S[i])){var u=S[i];if(!(u.length<2)){var f=u[1];if(Array.isArray(f)&&!(f.length<1)){var I=f[0];if(I!="noop"&&I!="stop"&&I!="close")for(let V=1;V<f.length;V++)f[V]=""}}}}return Ds(S)}catch{return c}}var Tr={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},jo={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},qo;function Os(){}E(Os,Lo),Os.prototype.g=function(){return new XMLHttpRequest},qo=new Os;function vn(i){return encodeURIComponent(String(i))}function eh(i){var c=1;i=i.split(":");const u=[];for(;c>0&&i.length;)u.push(i.shift()),c--;return i.length&&u.push(i.join(":")),u}function te(i,c,u,f){this.j=i,this.i=c,this.l=u,this.S=f||1,this.V=new pn(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new $o}function $o(){this.i=null,this.g="",this.h=!1}var zo={},Ls={};function Ms(i,c,u){i.M=1,i.A=Ir(Bt(c)),i.u=u,i.R=!0,Ho(i,null)}function Ho(i,c){i.F=Date.now(),vr(i),i.B=Bt(i.A);var u=i.B,f=i.S;Array.isArray(f)||(f=[String(f)]),sa(u.i,"t",f),i.C=0,u=i.j.L,i.h=new $o,i.g=Ia(i.j,u?c:null,!i.u),i.P>0&&(i.O=new Wu(d(i.Y,i,i.g),i.P)),c=i.V,u=i.g,f=i.ba;var I="readystatechange";Array.isArray(I)||(I&&(No[0]=I.toString()),I=No);for(let S=0;S<I.length;S++){const V=bo(u,I[S],f||c.handleEvent,!1,c.h||c);if(!V)break;c.g[V.key]=V}c=i.J?So(i.J):{},i.u?(i.v||(i.v="POST"),c["Content-Type"]="application/x-www-form-urlencoded",i.g.ea(i.B,i.v,i.u,c)):(i.v="GET",i.g.ea(i.B,i.v,null,c)),yn(),Ju(i.i,i.v,i.B,i.l,i.S,i.u)}te.prototype.ba=function(i){i=i.target;const c=this.O;c&&re(i)==3?c.j():this.Y(i)},te.prototype.Y=function(i){try{if(i==this.g)t:{const j=re(this.g),ot=this.g.ya(),X=this.g.ca();if(!(j<3)&&(j!=3||this.g&&(this.h.h||this.g.la()||ha(this.g)))){this.K||j!=4||ot==7||(ot==8||X<=0?yn(3):yn(2)),xs(this);var c=this.g.ca();this.X=c;var u=nh(this);if(this.o=c==200,Yu(this.i,this.v,this.B,this.l,this.S,j,c),this.o){if(this.U&&!this.L){e:{if(this.g){var f,I=this.g;if((f=I.g?I.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!g(f)){var S=f;break e}}S=null}if(i=S)Ue(this.i,this.l,i,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,Fs(this,i);else{this.o=!1,this.m=3,At(12),we(this),In(this);break t}}if(this.R){i=!0;let ht;for(;!this.K&&this.C<u.length;)if(ht=rh(this,u),ht==Ls){j==4&&(this.m=4,At(14),i=!1),Ue(this.i,this.l,null,"[Incomplete Response]");break}else if(ht==zo){this.m=4,At(15),Ue(this.i,this.l,u,"[Invalid Chunk]"),i=!1;break}else Ue(this.i,this.l,ht,null),Fs(this,ht);if(Go(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),j!=4||u.length!=0||this.h.h||(this.m=1,At(16),i=!1),this.o=this.o&&i,!i)Ue(this.i,this.l,u,"[Invalid Chunked Response]"),we(this),In(this);else if(u.length>0&&!this.W){this.W=!0;var V=this.j;V.g==this&&V.aa&&!V.P&&(V.j.info("Great, no buffering proxy detected. Bytes received: "+u.length),Gs(V),V.P=!0,At(11))}}else Ue(this.i,this.l,u,null),Fs(this,u);j==4&&we(this),this.o&&!this.K&&(j==4?ya(this.j,this):(this.o=!1,vr(this)))}else _h(this.g),c==400&&u.indexOf("Unknown SID")>0?(this.m=3,At(12)):(this.m=0,At(13)),we(this),In(this)}}}catch{}finally{}};function nh(i){if(!Go(i))return i.g.la();const c=ha(i.g);if(c==="")return"";let u="";const f=c.length,I=re(i.g)==4;if(!i.h.i){if(typeof TextDecoder>"u")return we(i),In(i),"";i.h.i=new a.TextDecoder}for(let S=0;S<f;S++)i.h.h=!0,u+=i.h.i.decode(c[S],{stream:!(I&&S==f-1)});return c.length=0,i.h.g+=u,i.C=0,i.h.g}function Go(i){return i.g?i.v=="GET"&&i.M!=2&&i.j.Aa:!1}function rh(i,c){var u=i.C,f=c.indexOf(`
`,u);return f==-1?Ls:(u=Number(c.substring(u,f)),isNaN(u)?zo:(f+=1,f+u>c.length?Ls:(c=c.slice(f,f+u),i.C=f+u,c)))}te.prototype.cancel=function(){this.K=!0,we(this)};function vr(i){i.T=Date.now()+i.H,Ko(i,i.H)}function Ko(i,c){if(i.D!=null)throw Error("WatchDog timer not null");i.D=En(d(i.aa,i),c)}function xs(i){i.D&&(a.clearTimeout(i.D),i.D=null)}te.prototype.aa=function(){this.D=null;const i=Date.now();i-this.T>=0?(Zu(this.i,this.B),this.M!=2&&(yn(),At(17)),we(this),this.m=2,In(this)):Ko(this,this.T-i)};function In(i){i.j.I==0||i.K||ya(i.j,i)}function we(i){xs(i);var c=i.O;c&&typeof c.dispose=="function"&&c.dispose(),i.O=null,Oo(i.V),i.g&&(c=i.g,i.g=null,c.abort(),c.dispose())}function Fs(i,c){try{var u=i.j;if(u.I!=0&&(u.g==i||Bs(u.h,i))){if(!i.L&&Bs(u.h,i)&&u.I==3){try{var f=u.Ba.g.parse(c)}catch{f=null}if(Array.isArray(f)&&f.length==3){var I=f;if(I[0]==0){t:if(!u.v){if(u.g)if(u.g.F+3e3<i.F)Cr(u),Sr(u);else break t;Hs(u),At(18)}}else u.xa=I[1],0<u.xa-u.K&&I[2]<37500&&u.F&&u.A==0&&!u.C&&(u.C=En(d(u.Va,u),6e3));Xo(u.h)<=1&&u.ta&&(u.ta=void 0)}else Se(u,11)}else if((i.L||u.g==i)&&Cr(u),!g(c))for(I=u.Ba.g.parse(c),c=0;c<I.length;c++){let X=I[c];const ht=X[0];if(!(ht<=u.K))if(u.K=ht,X=X[1],u.I==2)if(X[0]=="c"){u.M=X[1],u.ba=X[2];const Ut=X[3];Ut!=null&&(u.ka=Ut,u.j.info("VER="+u.ka));const Re=X[4];Re!=null&&(u.za=Re,u.j.info("SVER="+u.za));const se=X[5];se!=null&&typeof se=="number"&&se>0&&(f=1.5*se,u.O=f,u.j.info("backChannelRequestTimeoutMs_="+f)),f=u;const ie=i.g;if(ie){const Pr=ie.g?ie.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(Pr){var S=f.h;S.g||Pr.indexOf("spdy")==-1&&Pr.indexOf("quic")==-1&&Pr.indexOf("h2")==-1||(S.j=S.l,S.g=new Set,S.h&&(Us(S,S.h),S.h=null))}if(f.G){const Ks=ie.g?ie.g.getResponseHeader("X-HTTP-Session-Id"):null;Ks&&(f.wa=Ks,J(f.J,f.G,Ks))}}u.I=3,u.l&&u.l.ra(),u.aa&&(u.T=Date.now()-i.F,u.j.info("Handshake RTT: "+u.T+"ms")),f=u;var V=i;if(f.na=va(f,f.L?f.ba:null,f.W),V.L){Jo(f.h,V);var j=V,ot=f.O;ot&&(j.H=ot),j.D&&(xs(j),vr(j)),f.g=V}else pa(f);u.i.length>0&&Rr(u)}else X[0]!="stop"&&X[0]!="close"||Se(u,7);else u.I==3&&(X[0]=="stop"||X[0]=="close"?X[0]=="stop"?Se(u,7):zs(u):X[0]!="noop"&&u.l&&u.l.qa(X),u.A=0)}}yn(4)}catch{}}var sh=class{constructor(i,c){this.g=i,this.map=c}};function Wo(i){this.l=i||10,a.PerformanceNavigationTiming?(i=a.performance.getEntriesByType("navigation"),i=i.length>0&&(i[0].nextHopProtocol=="hq"||i[0].nextHopProtocol=="h2")):i=!!(a.chrome&&a.chrome.loadTimes&&a.chrome.loadTimes()&&a.chrome.loadTimes().wasFetchedViaSpdy),this.j=i?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Qo(i){return i.h?!0:i.g?i.g.size>=i.j:!1}function Xo(i){return i.h?1:i.g?i.g.size:0}function Bs(i,c){return i.h?i.h==c:i.g?i.g.has(c):!1}function Us(i,c){i.g?i.g.add(c):i.h=c}function Jo(i,c){i.h&&i.h==c?i.h=null:i.g&&i.g.has(c)&&i.g.delete(c)}Wo.prototype.cancel=function(){if(this.i=Yo(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const i of this.g.values())i.cancel();this.g.clear()}};function Yo(i){if(i.h!=null)return i.i.concat(i.h.G);if(i.g!=null&&i.g.size!==0){let c=i.i;for(const u of i.g.values())c=c.concat(u.G);return c}return P(i.i)}var Zo=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ih(i,c){if(i){i=i.split("&");for(let u=0;u<i.length;u++){const f=i[u].indexOf("=");let I,S=null;f>=0?(I=i[u].substring(0,f),S=i[u].substring(f+1)):I=i[u],c(I,S?decodeURIComponent(S.replace(/\+/g," ")):"")}}}function ee(i){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let c;i instanceof ee?(this.l=i.l,wn(this,i.j),this.o=i.o,this.g=i.g,An(this,i.u),this.h=i.h,js(this,ia(i.i)),this.m=i.m):i&&(c=String(i).match(Zo))?(this.l=!1,wn(this,c[1]||"",!0),this.o=Sn(c[2]||""),this.g=Sn(c[3]||"",!0),An(this,c[4]),this.h=Sn(c[5]||"",!0),js(this,c[6]||"",!0),this.m=Sn(c[7]||"")):(this.l=!1,this.i=new Cn(null,this.l))}ee.prototype.toString=function(){const i=[];var c=this.j;c&&i.push(Rn(c,ta,!0),":");var u=this.g;return(u||c=="file")&&(i.push("//"),(c=this.o)&&i.push(Rn(c,ta,!0),"@"),i.push(vn(u).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),u=this.u,u!=null&&i.push(":",String(u))),(u=this.h)&&(this.g&&u.charAt(0)!="/"&&i.push("/"),i.push(Rn(u,u.charAt(0)=="/"?ch:ah,!0))),(u=this.i.toString())&&i.push("?",u),(u=this.m)&&i.push("#",Rn(u,uh)),i.join("")},ee.prototype.resolve=function(i){const c=Bt(this);let u=!!i.j;u?wn(c,i.j):u=!!i.o,u?c.o=i.o:u=!!i.g,u?c.g=i.g:u=i.u!=null;var f=i.h;if(u)An(c,i.u);else if(u=!!i.h){if(f.charAt(0)!="/")if(this.g&&!this.h)f="/"+f;else{var I=c.h.lastIndexOf("/");I!=-1&&(f=c.h.slice(0,I+1)+f)}if(I=f,I==".."||I==".")f="";else if(I.indexOf("./")!=-1||I.indexOf("/.")!=-1){f=I.lastIndexOf("/",0)==0,I=I.split("/");const S=[];for(let V=0;V<I.length;){const j=I[V++];j=="."?f&&V==I.length&&S.push(""):j==".."?((S.length>1||S.length==1&&S[0]!="")&&S.pop(),f&&V==I.length&&S.push("")):(S.push(j),f=!0)}f=S.join("/")}else f=I}return u?c.h=f:u=i.i.toString()!=="",u?js(c,ia(i.i)):u=!!i.m,u&&(c.m=i.m),c};function Bt(i){return new ee(i)}function wn(i,c,u){i.j=u?Sn(c,!0):c,i.j&&(i.j=i.j.replace(/:$/,""))}function An(i,c){if(c){if(c=Number(c),isNaN(c)||c<0)throw Error("Bad port number "+c);i.u=c}else i.u=null}function js(i,c,u){c instanceof Cn?(i.i=c,hh(i.i,i.l)):(u||(c=Rn(c,lh)),i.i=new Cn(c,i.l))}function J(i,c,u){i.i.set(c,u)}function Ir(i){return J(i,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),i}function Sn(i,c){return i?c?decodeURI(i.replace(/%25/g,"%2525")):decodeURIComponent(i):""}function Rn(i,c,u){return typeof i=="string"?(i=encodeURI(i).replace(c,oh),u&&(i=i.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),i):null}function oh(i){return i=i.charCodeAt(0),"%"+(i>>4&15).toString(16)+(i&15).toString(16)}var ta=/[#\/\?@]/g,ah=/[#\?:]/g,ch=/[#\?]/g,lh=/[#\?@]/g,uh=/#/g;function Cn(i,c){this.h=this.g=null,this.i=i||null,this.j=!!c}function Ae(i){i.g||(i.g=new Map,i.h=0,i.i&&ih(i.i,function(c,u){i.add(decodeURIComponent(c.replace(/\+/g," ")),u)}))}n=Cn.prototype,n.add=function(i,c){Ae(this),this.i=null,i=je(this,i);let u=this.g.get(i);return u||this.g.set(i,u=[]),u.push(c),this.h+=1,this};function ea(i,c){Ae(i),c=je(i,c),i.g.has(c)&&(i.i=null,i.h-=i.g.get(c).length,i.g.delete(c))}function na(i,c){return Ae(i),c=je(i,c),i.g.has(c)}n.forEach=function(i,c){Ae(this),this.g.forEach(function(u,f){u.forEach(function(I){i.call(c,I,f,this)},this)},this)};function ra(i,c){Ae(i);let u=[];if(typeof c=="string")na(i,c)&&(u=u.concat(i.g.get(je(i,c))));else for(i=Array.from(i.g.values()),c=0;c<i.length;c++)u=u.concat(i[c]);return u}n.set=function(i,c){return Ae(this),this.i=null,i=je(this,i),na(this,i)&&(this.h-=this.g.get(i).length),this.g.set(i,[c]),this.h+=1,this},n.get=function(i,c){return i?(i=ra(this,i),i.length>0?String(i[0]):c):c};function sa(i,c,u){ea(i,c),u.length>0&&(i.i=null,i.g.set(je(i,c),P(u)),i.h+=u.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const i=[],c=Array.from(this.g.keys());for(let f=0;f<c.length;f++){var u=c[f];const I=vn(u);u=ra(this,u);for(let S=0;S<u.length;S++){let V=I;u[S]!==""&&(V+="="+vn(u[S])),i.push(V)}}return this.i=i.join("&")};function ia(i){const c=new Cn;return c.i=i.i,i.g&&(c.g=new Map(i.g),c.h=i.h),c}function je(i,c){return c=String(c),i.j&&(c=c.toLowerCase()),c}function hh(i,c){c&&!i.j&&(Ae(i),i.i=null,i.g.forEach(function(u,f){const I=f.toLowerCase();f!=I&&(ea(this,f),sa(this,I,u))},i)),i.j=c}function dh(i,c){const u=new Tn;if(a.Image){const f=new Image;f.onload=p(ne,u,"TestLoadImage: loaded",!0,c,f),f.onerror=p(ne,u,"TestLoadImage: error",!1,c,f),f.onabort=p(ne,u,"TestLoadImage: abort",!1,c,f),f.ontimeout=p(ne,u,"TestLoadImage: timeout",!1,c,f),a.setTimeout(function(){f.ontimeout&&f.ontimeout()},1e4),f.src=i}else c(!1)}function fh(i,c){const u=new Tn,f=new AbortController,I=setTimeout(()=>{f.abort(),ne(u,"TestPingServer: timeout",!1,c)},1e4);fetch(i,{signal:f.signal}).then(S=>{clearTimeout(I),S.ok?ne(u,"TestPingServer: ok",!0,c):ne(u,"TestPingServer: server error",!1,c)}).catch(()=>{clearTimeout(I),ne(u,"TestPingServer: error",!1,c)})}function ne(i,c,u,f,I){try{I&&(I.onload=null,I.onerror=null,I.onabort=null,I.ontimeout=null),f(u)}catch{}}function mh(){this.g=new Xu}function qs(i){this.i=i.Sb||null,this.h=i.ab||!1}E(qs,Lo),qs.prototype.g=function(){return new wr(this.i,this.h)};function wr(i,c){yt.call(this),this.H=i,this.o=c,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}E(wr,yt),n=wr.prototype,n.open=function(i,c){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=i,this.D=c,this.readyState=1,Pn(this)},n.send=function(i){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const c={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};i&&(c.body=i),(this.H||a).fetch(new Request(this.D,c)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,bn(this)),this.readyState=0},n.Pa=function(i){if(this.g&&(this.l=i,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=i.headers,this.readyState=2,Pn(this)),this.g&&(this.readyState=3,Pn(this),this.g)))if(this.responseType==="arraybuffer")i.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof a.ReadableStream<"u"&&"body"in i){if(this.j=i.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;oa(this)}else i.text().then(this.Oa.bind(this),this.ga.bind(this))};function oa(i){i.j.read().then(i.Ma.bind(i)).catch(i.ga.bind(i))}n.Ma=function(i){if(this.g){if(this.o&&i.value)this.response.push(i.value);else if(!this.o){var c=i.value?i.value:new Uint8Array(0);(c=this.B.decode(c,{stream:!i.done}))&&(this.response=this.responseText+=c)}i.done?bn(this):Pn(this),this.readyState==3&&oa(this)}},n.Oa=function(i){this.g&&(this.response=this.responseText=i,bn(this))},n.Na=function(i){this.g&&(this.response=i,bn(this))},n.ga=function(){this.g&&bn(this)};function bn(i){i.readyState=4,i.l=null,i.j=null,i.B=null,Pn(i)}n.setRequestHeader=function(i,c){this.A.append(i,c)},n.getResponseHeader=function(i){return this.h&&this.h.get(i.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const i=[],c=this.h.entries();for(var u=c.next();!u.done;)u=u.value,i.push(u[0]+": "+u[1]),u=c.next();return i.join(`\r
`)};function Pn(i){i.onreadystatechange&&i.onreadystatechange.call(i)}Object.defineProperty(wr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(i){this.m=i?"include":"same-origin"}});function aa(i){let c="";return pr(i,function(u,f){c+=f,c+=":",c+=u,c+=`\r
`}),c}function $s(i,c,u){t:{for(f in u){var f=!1;break t}f=!0}f||(u=aa(u),typeof i=="string"?u!=null&&vn(u):J(i,c,u))}function nt(i){yt.call(this),this.headers=new Map,this.L=i||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}E(nt,yt);var gh=/^https?$/i,ph=["POST","PUT"];n=nt.prototype,n.Fa=function(i){this.H=i},n.ea=function(i,c,u,f){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+i);c=c?c.toUpperCase():"GET",this.D=i,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():qo.g(),this.g.onreadystatechange=A(d(this.Ca,this));try{this.B=!0,this.g.open(c,String(i),!0),this.B=!1}catch(S){ca(this,S);return}if(i=u||"",u=new Map(this.headers),f)if(Object.getPrototypeOf(f)===Object.prototype)for(var I in f)u.set(I,f[I]);else if(typeof f.keys=="function"&&typeof f.get=="function")for(const S of f.keys())u.set(S,f.get(S));else throw Error("Unknown input type for opt_headers: "+String(f));f=Array.from(u.keys()).find(S=>S.toLowerCase()=="content-type"),I=a.FormData&&i instanceof a.FormData,!(Array.prototype.indexOf.call(ph,c,void 0)>=0)||f||I||u.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[S,V]of u)this.g.setRequestHeader(S,V);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(i),this.v=!1}catch(S){ca(this,S)}};function ca(i,c){i.h=!1,i.g&&(i.j=!0,i.g.abort(),i.j=!1),i.l=c,i.o=5,la(i),Ar(i)}function la(i){i.A||(i.A=!0,wt(i,"complete"),wt(i,"error"))}n.abort=function(i){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=i||7,wt(this,"complete"),wt(this,"abort"),Ar(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ar(this,!0)),nt.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?ua(this):this.Xa())},n.Xa=function(){ua(this)};function ua(i){if(i.h&&typeof o<"u"){if(i.v&&re(i)==4)setTimeout(i.Ca.bind(i),0);else if(wt(i,"readystatechange"),re(i)==4){i.h=!1;try{const S=i.ca();t:switch(S){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var c=!0;break t;default:c=!1}var u;if(!(u=c)){var f;if(f=S===0){let V=String(i.D).match(Zo)[1]||null;!V&&a.self&&a.self.location&&(V=a.self.location.protocol.slice(0,-1)),f=!gh.test(V?V.toLowerCase():"")}u=f}if(u)wt(i,"complete"),wt(i,"success");else{i.o=6;try{var I=re(i)>2?i.g.statusText:""}catch{I=""}i.l=I+" ["+i.ca()+"]",la(i)}}finally{Ar(i)}}}}function Ar(i,c){if(i.g){i.m&&(clearTimeout(i.m),i.m=null);const u=i.g;i.g=null,c||wt(i,"ready");try{u.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function re(i){return i.g?i.g.readyState:0}n.ca=function(){try{return re(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(i){if(this.g){var c=this.g.responseText;return i&&c.indexOf(i)==0&&(c=c.substring(i.length)),Qu(c)}};function ha(i){try{if(!i.g)return null;if("response"in i.g)return i.g.response;switch(i.F){case"":case"text":return i.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in i.g)return i.g.mozResponseArrayBuffer}return null}catch{return null}}function _h(i){const c={};i=(i.g&&re(i)>=2&&i.g.getAllResponseHeaders()||"").split(`\r
`);for(let f=0;f<i.length;f++){if(g(i[f]))continue;var u=eh(i[f]);const I=u[0];if(u=u[1],typeof u!="string")continue;u=u.trim();const S=c[I]||[];c[I]=S,S.push(u)}$u(c,function(f){return f.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function Vn(i,c,u){return u&&u.internalChannelParams&&u.internalChannelParams[i]||c}function da(i){this.za=0,this.i=[],this.j=new Tn,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Vn("failFast",!1,i),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Vn("baseRetryDelayMs",5e3,i),this.Za=Vn("retryDelaySeedMs",1e4,i),this.Ta=Vn("forwardChannelMaxRetries",2,i),this.va=Vn("forwardChannelRequestTimeoutMs",2e4,i),this.ma=i&&i.xmlHttpFactory||void 0,this.Ua=i&&i.Rb||void 0,this.Aa=i&&i.useFetchStreams||!1,this.O=void 0,this.L=i&&i.supportsCrossDomainXhr||!1,this.M="",this.h=new Wo(i&&i.concurrentRequestLimit),this.Ba=new mh,this.S=i&&i.fastHandshake||!1,this.R=i&&i.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=i&&i.Pb||!1,i&&i.ua&&this.j.ua(),i&&i.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&i&&i.detectBufferingProxy||!1,this.ia=void 0,i&&i.longPollingTimeout&&i.longPollingTimeout>0&&(this.ia=i.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=da.prototype,n.ka=8,n.I=1,n.connect=function(i,c,u,f){At(0),this.W=i,this.H=c||{},u&&f!==void 0&&(this.H.OSID=u,this.H.OAID=f),this.F=this.X,this.J=va(this,null,this.W),Rr(this)};function zs(i){if(fa(i),i.I==3){var c=i.V++,u=Bt(i.J);if(J(u,"SID",i.M),J(u,"RID",c),J(u,"TYPE","terminate"),Dn(i,u),c=new te(i,i.j,c),c.M=2,c.A=Ir(Bt(u)),u=!1,a.navigator&&a.navigator.sendBeacon)try{u=a.navigator.sendBeacon(c.A.toString(),"")}catch{}!u&&a.Image&&(new Image().src=c.A,u=!0),u||(c.g=Ia(c.j,null),c.g.ea(c.A)),c.F=Date.now(),vr(c)}Ta(i)}function Sr(i){i.g&&(Gs(i),i.g.cancel(),i.g=null)}function fa(i){Sr(i),i.v&&(a.clearTimeout(i.v),i.v=null),Cr(i),i.h.cancel(),i.m&&(typeof i.m=="number"&&a.clearTimeout(i.m),i.m=null)}function Rr(i){if(!Qo(i.h)&&!i.m){i.m=!0;var c=i.Ea;Rt||m(),ut||(Rt(),ut=!0),T.add(c,i),i.D=0}}function yh(i,c){return Xo(i.h)>=i.h.j-(i.m?1:0)?!1:i.m?(i.i=c.G.concat(i.i),!0):i.I==1||i.I==2||i.D>=(i.Sa?0:i.Ta)?!1:(i.m=En(d(i.Ea,i,c),Ea(i,i.D)),i.D++,!0)}n.Ea=function(i){if(this.m)if(this.m=null,this.I==1){if(!i){this.V=Math.floor(Math.random()*1e5),i=this.V++;const I=new te(this,this.j,i);let S=this.o;if(this.U&&(S?(S=So(S),Co(S,this.U)):S=this.U),this.u!==null||this.R||(I.J=S,S=null),this.S)t:{for(var c=0,u=0;u<this.i.length;u++){e:{var f=this.i[u];if("__data__"in f.map&&(f=f.map.__data__,typeof f=="string")){f=f.length;break e}f=void 0}if(f===void 0)break;if(c+=f,c>4096){c=u;break t}if(c===4096||u===this.i.length-1){c=u+1;break t}}c=1e3}else c=1e3;c=ga(this,I,c),u=Bt(this.J),J(u,"RID",i),J(u,"CVER",22),this.G&&J(u,"X-HTTP-Session-Id",this.G),Dn(this,u),S&&(this.R?c="headers="+vn(aa(S))+"&"+c:this.u&&$s(u,this.u,S)),Us(this.h,I),this.Ra&&J(u,"TYPE","init"),this.S?(J(u,"$req",c),J(u,"SID","null"),I.U=!0,Ms(I,u,null)):Ms(I,u,c),this.I=2}}else this.I==3&&(i?ma(this,i):this.i.length==0||Qo(this.h)||ma(this))};function ma(i,c){var u;c?u=c.l:u=i.V++;const f=Bt(i.J);J(f,"SID",i.M),J(f,"RID",u),J(f,"AID",i.K),Dn(i,f),i.u&&i.o&&$s(f,i.u,i.o),u=new te(i,i.j,u,i.D+1),i.u===null&&(u.J=i.o),c&&(i.i=c.G.concat(i.i)),c=ga(i,u,1e3),u.H=Math.round(i.va*.5)+Math.round(i.va*.5*Math.random()),Us(i.h,u),Ms(u,f,c)}function Dn(i,c){i.H&&pr(i.H,function(u,f){J(c,f,u)}),i.l&&pr({},function(u,f){J(c,f,u)})}function ga(i,c,u){u=Math.min(i.i.length,u);const f=i.l?d(i.l.Ka,i.l,i):null;t:{var I=i.i;let j=-1;for(;;){const ot=["count="+u];j==-1?u>0?(j=I[0].g,ot.push("ofs="+j)):j=0:ot.push("ofs="+j);let X=!0;for(let ht=0;ht<u;ht++){var S=I[ht].g;const Ut=I[ht].map;if(S-=j,S<0)j=Math.max(0,I[ht].g-100),X=!1;else try{S="req"+S+"_"||"";try{var V=Ut instanceof Map?Ut:Object.entries(Ut);for(const[Re,se]of V){let ie=se;l(se)&&(ie=Ds(se)),ot.push(S+Re+"="+encodeURIComponent(ie))}}catch(Re){throw ot.push(S+"type="+encodeURIComponent("_badmap")),Re}}catch{f&&f(Ut)}}if(X){V=ot.join("&");break t}}V=void 0}return i=i.i.splice(0,u),c.G=i,V}function pa(i){if(!i.g&&!i.v){i.Y=1;var c=i.Da;Rt||m(),ut||(Rt(),ut=!0),T.add(c,i),i.A=0}}function Hs(i){return i.g||i.v||i.A>=3?!1:(i.Y++,i.v=En(d(i.Da,i),Ea(i,i.A)),i.A++,!0)}n.Da=function(){if(this.v=null,_a(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var i=4*this.T;this.j.info("BP detection timer enabled: "+i),this.B=En(d(this.Wa,this),i)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,At(10),Sr(this),_a(this))};function Gs(i){i.B!=null&&(a.clearTimeout(i.B),i.B=null)}function _a(i){i.g=new te(i,i.j,"rpc",i.Y),i.u===null&&(i.g.J=i.o),i.g.P=0;var c=Bt(i.na);J(c,"RID","rpc"),J(c,"SID",i.M),J(c,"AID",i.K),J(c,"CI",i.F?"0":"1"),!i.F&&i.ia&&J(c,"TO",i.ia),J(c,"TYPE","xmlhttp"),Dn(i,c),i.u&&i.o&&$s(c,i.u,i.o),i.O&&(i.g.H=i.O);var u=i.g;i=i.ba,u.M=1,u.A=Ir(Bt(c)),u.u=null,u.R=!0,Ho(u,i)}n.Va=function(){this.C!=null&&(this.C=null,Sr(this),Hs(this),At(19))};function Cr(i){i.C!=null&&(a.clearTimeout(i.C),i.C=null)}function ya(i,c){var u=null;if(i.g==c){Cr(i),Gs(i),i.g=null;var f=2}else if(Bs(i.h,c))u=c.G,Jo(i.h,c),f=1;else return;if(i.I!=0){if(c.o)if(f==1){u=c.u?c.u.length:0,c=Date.now()-c.F;var I=i.D;f=Er(),wt(f,new Uo(f,u)),Rr(i)}else pa(i);else if(I=c.m,I==3||I==0&&c.X>0||!(f==1&&yh(i,c)||f==2&&Hs(i)))switch(u&&u.length>0&&(c=i.h,c.i=c.i.concat(u)),I){case 1:Se(i,5);break;case 4:Se(i,10);break;case 3:Se(i,6);break;default:Se(i,2)}}}function Ea(i,c){let u=i.Qa+Math.floor(Math.random()*i.Za);return i.isActive()||(u*=2),u*c}function Se(i,c){if(i.j.info("Error code "+c),c==2){var u=d(i.bb,i),f=i.Ua;const I=!f;f=new ee(f||"//www.google.com/images/cleardot.gif"),a.location&&a.location.protocol=="http"||wn(f,"https"),Ir(f),I?dh(f.toString(),u):fh(f.toString(),u)}else At(2);i.I=0,i.l&&i.l.pa(c),Ta(i),fa(i)}n.bb=function(i){i?(this.j.info("Successfully pinged google.com"),At(2)):(this.j.info("Failed to ping google.com"),At(1))};function Ta(i){if(i.I=0,i.ja=[],i.l){const c=Yo(i.h);(c.length!=0||i.i.length!=0)&&(N(i.ja,c),N(i.ja,i.i),i.h.i.length=0,P(i.i),i.i.length=0),i.l.oa()}}function va(i,c,u){var f=u instanceof ee?Bt(u):new ee(u);if(f.g!="")c&&(f.g=c+"."+f.g),An(f,f.u);else{var I=a.location;f=I.protocol,c=c?c+"."+I.hostname:I.hostname,I=+I.port;const S=new ee(null);f&&wn(S,f),c&&(S.g=c),I&&An(S,I),u&&(S.h=u),f=S}return u=i.G,c=i.wa,u&&c&&J(f,u,c),J(f,"VER",i.ka),Dn(i,f),f}function Ia(i,c,u){if(c&&!i.L)throw Error("Can't create secondary domain capable XhrIo object.");return c=i.Aa&&!i.ma?new nt(new qs({ab:u})):new nt(i.ma),c.Fa(i.L),c}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function wa(){}n=wa.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function br(){}br.prototype.g=function(i,c){return new Vt(i,c)};function Vt(i,c){yt.call(this),this.g=new da(c),this.l=i,this.h=c&&c.messageUrlParams||null,i=c&&c.messageHeaders||null,c&&c.clientProtocolHeaderRequired&&(i?i["X-Client-Protocol"]="webchannel":i={"X-Client-Protocol":"webchannel"}),this.g.o=i,i=c&&c.initMessageHeaders||null,c&&c.messageContentType&&(i?i["X-WebChannel-Content-Type"]=c.messageContentType:i={"X-WebChannel-Content-Type":c.messageContentType}),c&&c.sa&&(i?i["X-WebChannel-Client-Profile"]=c.sa:i={"X-WebChannel-Client-Profile":c.sa}),this.g.U=i,(i=c&&c.Qb)&&!g(i)&&(this.g.u=i),this.A=c&&c.supportsCrossDomainXhr||!1,this.v=c&&c.sendRawJson||!1,(c=c&&c.httpSessionIdParam)&&!g(c)&&(this.g.G=c,i=this.h,i!==null&&c in i&&(i=this.h,c in i&&delete i[c])),this.j=new qe(this)}E(Vt,yt),Vt.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Vt.prototype.close=function(){zs(this.g)},Vt.prototype.o=function(i){var c=this.g;if(typeof i=="string"){var u={};u.__data__=i,i=u}else this.v&&(u={},u.__data__=Ds(i),i=u);c.i.push(new sh(c.Ya++,i)),c.I==3&&Rr(c)},Vt.prototype.N=function(){this.g.l=null,delete this.j,zs(this.g),delete this.g,Vt.Z.N.call(this)};function Aa(i){ks.call(this),i.__headers__&&(this.headers=i.__headers__,this.statusCode=i.__status__,delete i.__headers__,delete i.__status__);var c=i.__sm__;if(c){t:{for(const u in c){i=u;break t}i=void 0}(this.i=i)&&(i=this.i,c=c!==null&&i in c?c[i]:void 0),this.data=c}else this.data=i}E(Aa,ks);function Sa(){Ns.call(this),this.status=1}E(Sa,Ns);function qe(i){this.g=i}E(qe,wa),qe.prototype.ra=function(){wt(this.g,"a")},qe.prototype.qa=function(i){wt(this.g,new Aa(i))},qe.prototype.pa=function(i){wt(this.g,new Sa)},qe.prototype.oa=function(){wt(this.g,"b")},br.prototype.createWebChannel=br.prototype.g,Vt.prototype.send=Vt.prototype.o,Vt.prototype.open=Vt.prototype.m,Vt.prototype.close=Vt.prototype.close,el=function(){return new br},tl=function(){return Er()},Zc=Ie,li={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Tr.NO_ERROR=0,Tr.TIMEOUT=8,Tr.HTTP_ERROR=6,xr=Tr,jo.COMPLETE="complete",Yc=jo,Mo.EventType=_n,_n.OPEN="a",_n.CLOSE="b",_n.ERROR="c",_n.MESSAGE="d",yt.prototype.listen=yt.prototype.J,kn=Mo,nt.prototype.listenOnce=nt.prototype.K,nt.prototype.getLastError=nt.prototype.Ha,nt.prototype.getLastErrorCode=nt.prototype.ya,nt.prototype.getStatus=nt.prototype.ca,nt.prototype.getResponseJson=nt.prototype.La,nt.prototype.getResponseText=nt.prototype.la,nt.prototype.send=nt.prototype.ea,nt.prototype.setWithCredentials=nt.prototype.Fa,Jc=nt}).apply(typeof Vr<"u"?Vr:typeof self<"u"?self:typeof window<"u"?window:{});const Fa="@firebase/firestore",Ba="4.9.2";class Tt{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Tt.UNAUTHENTICATED=new Tt(null),Tt.GOOGLE_CREDENTIALS=new Tt("google-credentials-uid"),Tt.FIRST_PARTY=new Tt("first-party-uid"),Tt.MOCK_USER=new Tt("mock-user");let dn="12.3.0";const Ne=new zc("@firebase/firestore");function $e(){return Ne.logLevel}function k(n,...t){if(Ne.logLevel<=H.DEBUG){const e=t.map(Fi);Ne.debug(`Firestore (${dn}): ${n}`,...e)}}function Yt(n,...t){if(Ne.logLevel<=H.ERROR){const e=t.map(Fi);Ne.error(`Firestore (${dn}): ${n}`,...e)}}function rn(n,...t){if(Ne.logLevel<=H.WARN){const e=t.map(Fi);Ne.warn(`Firestore (${dn}): ${n}`,...e)}}function Fi(n){if(typeof n=="string")return n;try{return(function(e){return JSON.stringify(e)})(n)}catch{return n}}function F(n,t,e){let r="Unexpected state";typeof t=="string"?r=t:e=t,nl(n,r,e)}function nl(n,t,e){let r=`FIRESTORE (${dn}) INTERNAL ASSERTION FAILED: ${t} (ID: ${n.toString(16)})`;if(e!==void 0)try{r+=" CONTEXT: "+JSON.stringify(e)}catch{r+=" CONTEXT: "+e}throw Yt(r),new Error(r)}function Q(n,t,e,r){let s="Unexpected state";typeof e=="string"?s=e:r=e,n||nl(t,s,r)}function U(n,t){return n}const C={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class O extends hn{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ue{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class rl{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class sf{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Tt.UNAUTHENTICATED)))}shutdown(){}}class of{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class af{constructor(t){this.t=t,this.currentUser=Tt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){Q(this.o===void 0,42304);let r=this.i;const s=h=>this.i!==r?(r=this.i,e(h)):Promise.resolve();let o=new ue;this.o=()=>{this.i++,this.currentUser=this.u(),o.resolve(),o=new ue,t.enqueueRetryable((()=>s(this.currentUser)))};const a=()=>{const h=o;t.enqueueRetryable((async()=>{await h.promise,await s(this.currentUser)}))},l=h=>{k("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=h,this.o&&(this.auth.addAuthTokenListener(this.o),a())};this.t.onInit((h=>l(h))),setTimeout((()=>{if(!this.auth){const h=this.t.getImmediate({optional:!0});h?l(h):(k("FirebaseAuthCredentialsProvider","Auth not yet detected"),o.resolve(),o=new ue)}}),0),a()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((r=>this.i!==t?(k("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(Q(typeof r.accessToken=="string",31837,{l:r}),new rl(r.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return Q(t===null||typeof t=="string",2055,{h:t}),new Tt(t)}}class cf{constructor(t,e,r){this.P=t,this.T=e,this.I=r,this.type="FirstParty",this.user=Tt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class lf{constructor(t,e,r){this.P=t,this.T=e,this.I=r}getToken(){return Promise.resolve(new cf(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable((()=>e(Tt.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Ua{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class uf{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,jd(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){Q(this.o===void 0,3512);const r=o=>{o.error!=null&&k("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${o.error.message}`);const a=o.token!==this.m;return this.m=o.token,k("FirebaseAppCheckTokenProvider",`Received ${a?"new":"existing"} token.`),a?e(o.token):Promise.resolve()};this.o=o=>{t.enqueueRetryable((()=>r(o)))};const s=o=>{k("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=o,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((o=>s(o))),setTimeout((()=>{if(!this.appCheck){const o=this.V.getImmediate({optional:!0});o?s(o):k("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Ua(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((e=>e?(Q(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new Ua(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function hf(n){const t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let r=0;r<n;r++)e[r]=Math.floor(256*Math.random());return e}class Bi{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516);let r="";for(;r.length<20;){const s=hf(40);for(let o=0;o<s.length;++o)r.length<20&&s[o]<e&&(r+=t.charAt(s[o]%62))}return r}}function q(n,t){return n<t?-1:n>t?1:0}function ui(n,t){const e=Math.min(n.length,t.length);for(let r=0;r<e;r++){const s=n.charAt(r),o=t.charAt(r);if(s!==o)return Ys(s)===Ys(o)?q(s,o):Ys(s)?1:-1}return q(n.length,t.length)}const df=55296,ff=57343;function Ys(n){const t=n.charCodeAt(0);return t>=df&&t<=ff}function sn(n,t,e){return n.length===t.length&&n.every(((r,s)=>e(r,t[s])))}const ja="__name__";class jt{constructor(t,e,r){e===void 0?e=0:e>t.length&&F(637,{offset:e,range:t.length}),r===void 0?r=t.length-e:r>t.length-e&&F(1746,{length:r,range:t.length-e}),this.segments=t,this.offset=e,this.len=r}get length(){return this.len}isEqual(t){return jt.comparator(this,t)===0}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof jt?t.forEach((r=>{e.push(r)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,r=this.limit();e<r;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const r=Math.min(t.length,e.length);for(let s=0;s<r;s++){const o=jt.compareSegments(t.get(s),e.get(s));if(o!==0)return o}return q(t.length,e.length)}static compareSegments(t,e){const r=jt.isNumericId(t),s=jt.isNumericId(e);return r&&!s?-1:!r&&s?1:r&&s?jt.extractNumericId(t).compare(jt.extractNumericId(e)):ui(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return le.fromString(t.substring(4,t.length-2))}}class Y extends jt{construct(t,e,r){return new Y(t,e,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const r of t){if(r.indexOf("//")>=0)throw new O(C.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);e.push(...r.split("/").filter((s=>s.length>0)))}return new Y(e)}static emptyPath(){return new Y([])}}const mf=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class pt extends jt{construct(t,e,r){return new pt(t,e,r)}static isValidIdentifier(t){return mf.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),pt.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===ja}static keyField(){return new pt([ja])}static fromServerFormat(t){const e=[];let r="",s=0;const o=()=>{if(r.length===0)throw new O(C.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(r),r=""};let a=!1;for(;s<t.length;){const l=t[s];if(l==="\\"){if(s+1===t.length)throw new O(C.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const h=t[s+1];if(h!=="\\"&&h!=="."&&h!=="`")throw new O(C.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=h,s+=2}else l==="`"?(a=!a,s++):l!=="."||a?(r+=l,s++):(o(),s++)}if(o(),a)throw new O(C.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new pt(e)}static emptyPath(){return new pt([])}}class L{constructor(t){this.path=t}static fromPath(t){return new L(Y.fromString(t))}static fromName(t){return new L(Y.fromString(t).popFirst(5))}static empty(){return new L(Y.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&Y.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return Y.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new L(new Y(t.slice()))}}function sl(n,t,e){if(!e)throw new O(C.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function gf(n,t,e,r){if(t===!0&&r===!0)throw new O(C.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function qa(n){if(!L.isDocumentKey(n))throw new O(C.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function $a(n){if(L.isDocumentKey(n))throw new O(C.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function il(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Ui(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const t=(function(r){return r.constructor?r.constructor.name:null})(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":F(12329,{type:typeof n})}function qt(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new O(C.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=Ui(n);throw new O(C.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}function it(n,t){const e={typeString:n};return t&&(e.value=t),e}function ar(n,t){if(!il(n))throw new O(C.INVALID_ARGUMENT,"JSON must be an object");let e;for(const r in t)if(t[r]){const s=t[r].typeString,o="value"in t[r]?{value:t[r].value}:void 0;if(!(r in n)){e=`JSON missing required field: '${r}'`;break}const a=n[r];if(s&&typeof a!==s){e=`JSON field '${r}' must be a ${s}.`;break}if(o!==void 0&&a!==o.value){e=`Expected '${r}' field to equal '${o.value}'`;break}}if(e)throw new O(C.INVALID_ARGUMENT,e);return!0}const za=-62135596800,Ha=1e6;class Z{static now(){return Z.fromMillis(Date.now())}static fromDate(t){return Z.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),r=Math.floor((t-1e3*e)*Ha);return new Z(e,r)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new O(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new O(C.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<za)throw new O(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new O(C.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Ha}_compareTo(t){return this.seconds===t.seconds?q(this.nanoseconds,t.nanoseconds):q(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:Z._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(ar(t,Z._jsonSchema))return new Z(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-za;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}Z._jsonSchemaVersion="firestore/timestamp/1.0",Z._jsonSchema={type:it("string",Z._jsonSchemaVersion),seconds:it("number"),nanoseconds:it("number")};class B{static fromTimestamp(t){return new B(t)}static min(){return new B(new Z(0,0))}static max(){return new B(new Z(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Gn=-1;function pf(n,t){const e=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,s=B.fromTimestamp(r===1e9?new Z(e+1,0):new Z(e,r));return new me(s,L.empty(),t)}function _f(n){return new me(n.readTime,n.key,Gn)}class me{constructor(t,e,r){this.readTime=t,this.documentKey=e,this.largestBatchId=r}static min(){return new me(B.min(),L.empty(),Gn)}static max(){return new me(B.max(),L.empty(),Gn)}}function yf(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=L.comparator(n.documentKey,t.documentKey),e!==0?e:q(n.largestBatchId,t.largestBatchId))}const Ef="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Tf{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function fn(n){if(n.code!==C.FAILED_PRECONDITION||n.message!==Ef)throw n;k("LocalStore","Unexpectedly lost primary lease")}class R{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&F(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new R(((r,s)=>{this.nextCallback=o=>{this.wrapSuccess(t,o).next(r,s)},this.catchCallback=o=>{this.wrapFailure(e,o).next(r,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof R?e:R.resolve(e)}catch(e){return R.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):R.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):R.reject(e)}static resolve(t){return new R(((e,r)=>{e(t)}))}static reject(t){return new R(((e,r)=>{r(t)}))}static waitFor(t){return new R(((e,r)=>{let s=0,o=0,a=!1;t.forEach((l=>{++s,l.next((()=>{++o,a&&o===s&&e()}),(h=>r(h)))})),a=!0,o===s&&e()}))}static or(t){let e=R.resolve(!1);for(const r of t)e=e.next((s=>s?R.resolve(s):r()));return e}static forEach(t,e){const r=[];return t.forEach(((s,o)=>{r.push(e.call(this,s,o))})),this.waitFor(r)}static mapArray(t,e){return new R(((r,s)=>{const o=t.length,a=new Array(o);let l=0;for(let h=0;h<o;h++){const d=h;e(t[d]).next((p=>{a[d]=p,++l,l===o&&r(a)}),(p=>s(p)))}}))}static doWhile(t,e){return new R(((r,s)=>{const o=()=>{t()===!0?e().next((()=>{o()}),s):r()};o()}))}}function vf(n){const t=n.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function mn(n){return n.name==="IndexedDbTransactionError"}class hs{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=r=>this.ae(r),this.ue=r=>e.writeSequenceNumber(r))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}hs.ce=-1;const ji=-1;function ds(n){return n==null}function Qr(n){return n===0&&1/n==-1/0}function If(n){return typeof n=="number"&&Number.isInteger(n)&&!Qr(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const ol="";function wf(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=Ga(t)),t=Af(n.get(e),t);return Ga(t)}function Af(n,t){let e=t;const r=n.length;for(let s=0;s<r;s++){const o=n.charAt(s);switch(o){case"\0":e+="";break;case ol:e+="";break;default:e+=o}}return e}function Ga(n){return n+ol+""}function Ka(n){let t=0;for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function Me(n,t){for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function al(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}class et{constructor(t,e){this.comparator=t,this.root=e||gt.EMPTY}insert(t,e){return new et(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,gt.BLACK,null,null))}remove(t){return new et(this.comparator,this.root.remove(t,this.comparator).copy(null,null,gt.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const r=this.comparator(t,e.key);if(r===0)return e.value;r<0?e=e.left:r>0&&(e=e.right)}return null}indexOf(t){let e=0,r=this.root;for(;!r.isEmpty();){const s=this.comparator(t,r.key);if(s===0)return e+r.left.size;s<0?r=r.left:(e+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,r)=>(t(e,r),!1)))}toString(){const t=[];return this.inorderTraversal(((e,r)=>(t.push(`${e}:${r}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Dr(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Dr(this.root,t,this.comparator,!1)}getReverseIterator(){return new Dr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Dr(this.root,t,this.comparator,!0)}}class Dr{constructor(t,e,r,s){this.isReverse=s,this.nodeStack=[];let o=1;for(;!t.isEmpty();)if(o=e?r(t.key,e):1,e&&s&&(o*=-1),o<0)t=this.isReverse?t.left:t.right;else{if(o===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class gt{constructor(t,e,r,s,o){this.key=t,this.value=e,this.color=r??gt.RED,this.left=s??gt.EMPTY,this.right=o??gt.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,r,s,o){return new gt(t??this.key,e??this.value,r??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,r){let s=this;const o=r(t,s.key);return s=o<0?s.copy(null,null,null,s.left.insert(t,e,r),null):o===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,r)),s.fixUp()}removeMin(){if(this.left.isEmpty())return gt.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let r,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return gt.EMPTY;r=s.right.min(),s=s.copy(r.key,r.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,gt.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,gt.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw F(43730,{key:this.key,value:this.value});if(this.right.isRed())throw F(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw F(27949);return t+(this.isRed()?0:1)}}gt.EMPTY=null,gt.RED=!0,gt.BLACK=!1;gt.EMPTY=new class{constructor(){this.size=0}get key(){throw F(57766)}get value(){throw F(16141)}get color(){throw F(16727)}get left(){throw F(29726)}get right(){throw F(36894)}copy(t,e,r,s,o){return this}insert(t,e,r){return new gt(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class lt{constructor(t){this.comparator=t,this.data=new et(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,r)=>(t(e),!1)))}forEachInRange(t,e){const r=this.data.getIteratorFrom(t[0]);for(;r.hasNext();){const s=r.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let r;for(r=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();r.hasNext();)if(!t(r.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new Wa(this.data.getIterator())}getIteratorFrom(t){return new Wa(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((r=>{e=e.add(r)})),e}isEqual(t){if(!(t instanceof lt)||this.size!==t.size)return!1;const e=this.data.getIterator(),r=t.data.getIterator();for(;e.hasNext();){const s=e.getNext().key,o=r.getNext().key;if(this.comparator(s,o)!==0)return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new lt(this.comparator);return e.data=t,e}}class Wa{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class xt{constructor(t){this.fields=t,t.sort(pt.comparator)}static empty(){return new xt([])}unionWith(t){let e=new lt(pt.comparator);for(const r of this.fields)e=e.add(r);for(const r of t)e=e.add(r);return new xt(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return sn(this.fields,t.fields,((e,r)=>e.isEqual(r)))}}class cl extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class _t{constructor(t){this.binaryString=t}static fromBase64String(t){const e=(function(s){try{return atob(s)}catch(o){throw typeof DOMException<"u"&&o instanceof DOMException?new cl("Invalid base64 string: "+o):o}})(t);return new _t(e)}static fromUint8Array(t){const e=(function(s){let o="";for(let a=0;a<s.length;++a)o+=String.fromCharCode(s[a]);return o})(t);return new _t(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(e){return btoa(e)})(this.binaryString)}toUint8Array(){return(function(e){const r=new Uint8Array(e.length);for(let s=0;s<e.length;s++)r[s]=e.charCodeAt(s);return r})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return q(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}_t.EMPTY_BYTE_STRING=new _t("");const Sf=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ge(n){if(Q(!!n,39018),typeof n=="string"){let t=0;const e=Sf.exec(n);if(Q(!!e,46558,{timestamp:n}),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}const r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:t}}return{seconds:rt(n.seconds),nanos:rt(n.nanos)}}function rt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function pe(n){return typeof n=="string"?_t.fromBase64String(n):_t.fromUint8Array(n)}const ll="server_timestamp",ul="__type__",hl="__previous_value__",dl="__local_write_time__";function qi(n){return(n?.mapValue?.fields||{})[ul]?.stringValue===ll}function fs(n){const t=n.mapValue.fields[hl];return qi(t)?fs(t):t}function Kn(n){const t=ge(n.mapValue.fields[dl].timestampValue);return new Z(t.seconds,t.nanos)}class Rf{constructor(t,e,r,s,o,a,l,h,d,p){this.databaseId=t,this.appId=e,this.persistenceKey=r,this.host=s,this.ssl=o,this.forceLongPolling=a,this.autoDetectLongPolling=l,this.longPollingOptions=h,this.useFetchStreams=d,this.isUsingEmulator=p}}const Xr="(default)";class Wn{constructor(t,e){this.projectId=t,this.database=e||Xr}static empty(){return new Wn("","")}get isDefaultDatabase(){return this.database===Xr}isEqual(t){return t instanceof Wn&&t.projectId===this.projectId&&t.database===this.database}}const fl="__type__",Cf="__max__",kr={mapValue:{}},ml="__vector__",Jr="value";function _e(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?qi(n)?4:Pf(n)?9007199254740991:bf(n)?10:11:F(28295,{value:n})}function Wt(n,t){if(n===t)return!0;const e=_e(n);if(e!==_e(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return Kn(n).isEqual(Kn(t));case 3:return(function(s,o){if(typeof s.timestampValue=="string"&&typeof o.timestampValue=="string"&&s.timestampValue.length===o.timestampValue.length)return s.timestampValue===o.timestampValue;const a=ge(s.timestampValue),l=ge(o.timestampValue);return a.seconds===l.seconds&&a.nanos===l.nanos})(n,t);case 5:return n.stringValue===t.stringValue;case 6:return(function(s,o){return pe(s.bytesValue).isEqual(pe(o.bytesValue))})(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return(function(s,o){return rt(s.geoPointValue.latitude)===rt(o.geoPointValue.latitude)&&rt(s.geoPointValue.longitude)===rt(o.geoPointValue.longitude)})(n,t);case 2:return(function(s,o){if("integerValue"in s&&"integerValue"in o)return rt(s.integerValue)===rt(o.integerValue);if("doubleValue"in s&&"doubleValue"in o){const a=rt(s.doubleValue),l=rt(o.doubleValue);return a===l?Qr(a)===Qr(l):isNaN(a)&&isNaN(l)}return!1})(n,t);case 9:return sn(n.arrayValue.values||[],t.arrayValue.values||[],Wt);case 10:case 11:return(function(s,o){const a=s.mapValue.fields||{},l=o.mapValue.fields||{};if(Ka(a)!==Ka(l))return!1;for(const h in a)if(a.hasOwnProperty(h)&&(l[h]===void 0||!Wt(a[h],l[h])))return!1;return!0})(n,t);default:return F(52216,{left:n})}}function Qn(n,t){return(n.values||[]).find((e=>Wt(e,t)))!==void 0}function on(n,t){if(n===t)return 0;const e=_e(n),r=_e(t);if(e!==r)return q(e,r);switch(e){case 0:case 9007199254740991:return 0;case 1:return q(n.booleanValue,t.booleanValue);case 2:return(function(o,a){const l=rt(o.integerValue||o.doubleValue),h=rt(a.integerValue||a.doubleValue);return l<h?-1:l>h?1:l===h?0:isNaN(l)?isNaN(h)?0:-1:1})(n,t);case 3:return Qa(n.timestampValue,t.timestampValue);case 4:return Qa(Kn(n),Kn(t));case 5:return ui(n.stringValue,t.stringValue);case 6:return(function(o,a){const l=pe(o),h=pe(a);return l.compareTo(h)})(n.bytesValue,t.bytesValue);case 7:return(function(o,a){const l=o.split("/"),h=a.split("/");for(let d=0;d<l.length&&d<h.length;d++){const p=q(l[d],h[d]);if(p!==0)return p}return q(l.length,h.length)})(n.referenceValue,t.referenceValue);case 8:return(function(o,a){const l=q(rt(o.latitude),rt(a.latitude));return l!==0?l:q(rt(o.longitude),rt(a.longitude))})(n.geoPointValue,t.geoPointValue);case 9:return Xa(n.arrayValue,t.arrayValue);case 10:return(function(o,a){const l=o.fields||{},h=a.fields||{},d=l[Jr]?.arrayValue,p=h[Jr]?.arrayValue,E=q(d?.values?.length||0,p?.values?.length||0);return E!==0?E:Xa(d,p)})(n.mapValue,t.mapValue);case 11:return(function(o,a){if(o===kr.mapValue&&a===kr.mapValue)return 0;if(o===kr.mapValue)return 1;if(a===kr.mapValue)return-1;const l=o.fields||{},h=Object.keys(l),d=a.fields||{},p=Object.keys(d);h.sort(),p.sort();for(let E=0;E<h.length&&E<p.length;++E){const A=ui(h[E],p[E]);if(A!==0)return A;const P=on(l[h[E]],d[p[E]]);if(P!==0)return P}return q(h.length,p.length)})(n.mapValue,t.mapValue);default:throw F(23264,{he:e})}}function Qa(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return q(n,t);const e=ge(n),r=ge(t),s=q(e.seconds,r.seconds);return s!==0?s:q(e.nanos,r.nanos)}function Xa(n,t){const e=n.values||[],r=t.values||[];for(let s=0;s<e.length&&s<r.length;++s){const o=on(e[s],r[s]);if(o)return o}return q(e.length,r.length)}function an(n){return hi(n)}function hi(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(e){const r=ge(e);return`time(${r.seconds},${r.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(e){return pe(e).toBase64()})(n.bytesValue):"referenceValue"in n?(function(e){return L.fromName(e).toString()})(n.referenceValue):"geoPointValue"in n?(function(e){return`geo(${e.latitude},${e.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(e){let r="[",s=!0;for(const o of e.values||[])s?s=!1:r+=",",r+=hi(o);return r+"]"})(n.arrayValue):"mapValue"in n?(function(e){const r=Object.keys(e.fields||{}).sort();let s="{",o=!0;for(const a of r)o?o=!1:s+=",",s+=`${a}:${hi(e.fields[a])}`;return s+"}"})(n.mapValue):F(61005,{value:n})}function Fr(n){switch(_e(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=fs(n);return t?16+Fr(t):16;case 5:return 2*n.stringValue.length;case 6:return pe(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(r){return(r.values||[]).reduce(((s,o)=>s+Fr(o)),0)})(n.arrayValue);case 10:case 11:return(function(r){let s=0;return Me(r.fields,((o,a)=>{s+=o.length+Fr(a)})),s})(n.mapValue);default:throw F(13486,{value:n})}}function di(n){return!!n&&"integerValue"in n}function $i(n){return!!n&&"arrayValue"in n}function Ja(n){return!!n&&"nullValue"in n}function Ya(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function Br(n){return!!n&&"mapValue"in n}function bf(n){return(n?.mapValue?.fields||{})[fl]?.stringValue===ml}function xn(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const t={mapValue:{fields:{}}};return Me(n.mapValue.fields,((e,r)=>t.mapValue.fields[e]=xn(r))),t}if(n.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=xn(n.arrayValue.values[e]);return t}return{...n}}function Pf(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===Cf}class kt{constructor(t){this.value=t}static empty(){return new kt({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let r=0;r<t.length-1;++r)if(e=(e.mapValue.fields||{})[t.get(r)],!Br(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=xn(e)}setAll(t){let e=pt.emptyPath(),r={},s=[];t.forEach(((a,l)=>{if(!e.isImmediateParentOf(l)){const h=this.getFieldsMap(e);this.applyChanges(h,r,s),r={},s=[],e=l.popLast()}a?r[l.lastSegment()]=xn(a):s.push(l.lastSegment())}));const o=this.getFieldsMap(e);this.applyChanges(o,r,s)}delete(t){const e=this.field(t.popLast());Br(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Wt(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let r=0;r<t.length;++r){let s=e.mapValue.fields[t.get(r)];Br(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(r)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,r){Me(e,((s,o)=>t[s]=o));for(const s of r)delete t[s]}clone(){return new kt(xn(this.value))}}function gl(n){const t=[];return Me(n.fields,((e,r)=>{const s=new pt([e]);if(Br(r)){const o=gl(r.mapValue).fields;if(o.length===0)t.push(s);else for(const a of o)t.push(s.child(a))}else t.push(s)})),new xt(t)}class vt{constructor(t,e,r,s,o,a,l){this.key=t,this.documentType=e,this.version=r,this.readTime=s,this.createTime=o,this.data=a,this.documentState=l}static newInvalidDocument(t){return new vt(t,0,B.min(),B.min(),B.min(),kt.empty(),0)}static newFoundDocument(t,e,r,s){return new vt(t,1,e,B.min(),r,s,0)}static newNoDocument(t,e){return new vt(t,2,e,B.min(),B.min(),kt.empty(),0)}static newUnknownDocument(t,e){return new vt(t,3,e,B.min(),B.min(),kt.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(B.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=kt.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=kt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=B.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof vt&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new vt(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class Yr{constructor(t,e){this.position=t,this.inclusive=e}}function Za(n,t,e){let r=0;for(let s=0;s<n.position.length;s++){const o=t[s],a=n.position[s];if(o.field.isKeyField()?r=L.comparator(L.fromName(a.referenceValue),e.key):r=on(a,e.data.field(o.field)),o.dir==="desc"&&(r*=-1),r!==0)break}return r}function tc(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!Wt(n.position[e],t.position[e]))return!1;return!0}class Zr{constructor(t,e="asc"){this.field=t,this.dir=e}}function Vf(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}class pl{}class at extends pl{constructor(t,e,r){super(),this.field=t,this.op=e,this.value=r}static create(t,e,r){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,r):new kf(t,e,r):e==="array-contains"?new Lf(t,r):e==="in"?new Mf(t,r):e==="not-in"?new xf(t,r):e==="array-contains-any"?new Ff(t,r):new at(t,e,r)}static createKeyFieldInFilter(t,e,r){return e==="in"?new Nf(t,r):new Of(t,r)}matches(t){const e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(on(e,this.value)):e!==null&&_e(this.value)===_e(e)&&this.matchesComparison(on(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return F(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Qt extends pl{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new Qt(t,e)}matches(t){return _l(this)?this.filters.find((e=>!e.matches(t)))===void 0:this.filters.find((e=>e.matches(t)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function _l(n){return n.op==="and"}function yl(n){return Df(n)&&_l(n)}function Df(n){for(const t of n.filters)if(t instanceof Qt)return!1;return!0}function fi(n){if(n instanceof at)return n.field.canonicalString()+n.op.toString()+an(n.value);if(yl(n))return n.filters.map((t=>fi(t))).join(",");{const t=n.filters.map((e=>fi(e))).join(",");return`${n.op}(${t})`}}function El(n,t){return n instanceof at?(function(r,s){return s instanceof at&&r.op===s.op&&r.field.isEqual(s.field)&&Wt(r.value,s.value)})(n,t):n instanceof Qt?(function(r,s){return s instanceof Qt&&r.op===s.op&&r.filters.length===s.filters.length?r.filters.reduce(((o,a,l)=>o&&El(a,s.filters[l])),!0):!1})(n,t):void F(19439)}function Tl(n){return n instanceof at?(function(e){return`${e.field.canonicalString()} ${e.op} ${an(e.value)}`})(n):n instanceof Qt?(function(e){return e.op.toString()+" {"+e.getFilters().map(Tl).join(" ,")+"}"})(n):"Filter"}class kf extends at{constructor(t,e,r){super(t,e,r),this.key=L.fromName(r.referenceValue)}matches(t){const e=L.comparator(t.key,this.key);return this.matchesComparison(e)}}class Nf extends at{constructor(t,e){super(t,"in",e),this.keys=vl("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Of extends at{constructor(t,e){super(t,"not-in",e),this.keys=vl("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function vl(n,t){return(t.arrayValue?.values||[]).map((e=>L.fromName(e.referenceValue)))}class Lf extends at{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return $i(e)&&Qn(e.arrayValue,this.value)}}class Mf extends at{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return e!==null&&Qn(this.value.arrayValue,e)}}class xf extends at{constructor(t,e){super(t,"not-in",e)}matches(t){if(Qn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!Qn(this.value.arrayValue,e)}}class Ff extends at{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!$i(e)||!e.arrayValue.values)&&e.arrayValue.values.some((r=>Qn(this.value.arrayValue,r)))}}class Bf{constructor(t,e=null,r=[],s=[],o=null,a=null,l=null){this.path=t,this.collectionGroup=e,this.orderBy=r,this.filters=s,this.limit=o,this.startAt=a,this.endAt=l,this.Te=null}}function ec(n,t=null,e=[],r=[],s=null,o=null,a=null){return new Bf(n,t,e,r,s,o,a)}function zi(n){const t=U(n);if(t.Te===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((r=>fi(r))).join(","),e+="|ob:",e+=t.orderBy.map((r=>(function(o){return o.field.canonicalString()+o.dir})(r))).join(","),ds(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((r=>an(r))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((r=>an(r))).join(",")),t.Te=e}return t.Te}function Hi(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!Vf(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!El(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!tc(n.startAt,t.startAt)&&tc(n.endAt,t.endAt)}function mi(n){return L.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class ms{constructor(t,e=null,r=[],s=[],o=null,a="F",l=null,h=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=r,this.filters=s,this.limit=o,this.limitType=a,this.startAt=l,this.endAt=h,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Uf(n,t,e,r,s,o,a,l){return new ms(n,t,e,r,s,o,a,l)}function Gi(n){return new ms(n)}function nc(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function jf(n){return n.collectionGroup!==null}function Fn(n){const t=U(n);if(t.Ie===null){t.Ie=[];const e=new Set;for(const o of t.explicitOrderBy)t.Ie.push(o),e.add(o.field.canonicalString());const r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(a){let l=new lt(pt.comparator);return a.filters.forEach((h=>{h.getFlattenedFilters().forEach((d=>{d.isInequality()&&(l=l.add(d.field))}))})),l})(t).forEach((o=>{e.has(o.canonicalString())||o.isKeyField()||t.Ie.push(new Zr(o,r))})),e.has(pt.keyField().canonicalString())||t.Ie.push(new Zr(pt.keyField(),r))}return t.Ie}function $t(n){const t=U(n);return t.Ee||(t.Ee=qf(t,Fn(n))),t.Ee}function qf(n,t){if(n.limitType==="F")return ec(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map((s=>{const o=s.dir==="desc"?"asc":"desc";return new Zr(s.field,o)}));const e=n.endAt?new Yr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new Yr(n.startAt.position,n.startAt.inclusive):null;return ec(n.path,n.collectionGroup,t,n.filters,n.limit,e,r)}}function gi(n,t,e){return new ms(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function gs(n,t){return Hi($t(n),$t(t))&&n.limitType===t.limitType}function Il(n){return`${zi($t(n))}|lt:${n.limitType}`}function ze(n){return`Query(target=${(function(e){let r=e.path.canonicalString();return e.collectionGroup!==null&&(r+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(r+=`, filters: [${e.filters.map((s=>Tl(s))).join(", ")}]`),ds(e.limit)||(r+=", limit: "+e.limit),e.orderBy.length>0&&(r+=`, orderBy: [${e.orderBy.map((s=>(function(a){return`${a.field.canonicalString()} (${a.dir})`})(s))).join(", ")}]`),e.startAt&&(r+=", startAt: ",r+=e.startAt.inclusive?"b:":"a:",r+=e.startAt.position.map((s=>an(s))).join(",")),e.endAt&&(r+=", endAt: ",r+=e.endAt.inclusive?"a:":"b:",r+=e.endAt.position.map((s=>an(s))).join(",")),`Target(${r})`})($t(n))}; limitType=${n.limitType})`}function ps(n,t){return t.isFoundDocument()&&(function(r,s){const o=s.key.path;return r.collectionGroup!==null?s.key.hasCollectionId(r.collectionGroup)&&r.path.isPrefixOf(o):L.isDocumentKey(r.path)?r.path.isEqual(o):r.path.isImmediateParentOf(o)})(n,t)&&(function(r,s){for(const o of Fn(r))if(!o.field.isKeyField()&&s.data.field(o.field)===null)return!1;return!0})(n,t)&&(function(r,s){for(const o of r.filters)if(!o.matches(s))return!1;return!0})(n,t)&&(function(r,s){return!(r.startAt&&!(function(a,l,h){const d=Za(a,l,h);return a.inclusive?d<=0:d<0})(r.startAt,Fn(r),s)||r.endAt&&!(function(a,l,h){const d=Za(a,l,h);return a.inclusive?d>=0:d>0})(r.endAt,Fn(r),s))})(n,t)}function $f(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function wl(n){return(t,e)=>{let r=!1;for(const s of Fn(n)){const o=zf(s,t,e);if(o!==0)return o;r=r||s.field.isKeyField()}return 0}}function zf(n,t,e){const r=n.field.isKeyField()?L.comparator(t.key,e.key):(function(o,a,l){const h=a.data.field(o),d=l.data.field(o);return h!==null&&d!==null?on(h,d):F(42886)})(n.field,t,e);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return F(19790,{direction:n.dir})}}class xe{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),r=this.inner[e];if(r!==void 0){for(const[s,o]of r)if(this.equalsFn(s,t))return o}}has(t){return this.get(t)!==void 0}set(t,e){const r=this.mapKeyFn(t),s=this.inner[r];if(s===void 0)return this.inner[r]=[[t,e]],void this.innerSize++;for(let o=0;o<s.length;o++)if(this.equalsFn(s[o][0],t))return void(s[o]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),r=this.inner[e];if(r===void 0)return!1;for(let s=0;s<r.length;s++)if(this.equalsFn(r[s][0],t))return r.length===1?delete this.inner[e]:r.splice(s,1),this.innerSize--,!0;return!1}forEach(t){Me(this.inner,((e,r)=>{for(const[s,o]of r)t(s,o)}))}isEmpty(){return al(this.inner)}size(){return this.innerSize}}const Hf=new et(L.comparator);function Zt(){return Hf}const Al=new et(L.comparator);function Nn(...n){let t=Al;for(const e of n)t=t.insert(e.key,e);return t}function Sl(n){let t=Al;return n.forEach(((e,r)=>t=t.insert(e,r.overlayedDocument))),t}function be(){return Bn()}function Rl(){return Bn()}function Bn(){return new xe((n=>n.toString()),((n,t)=>n.isEqual(t)))}const Gf=new et(L.comparator),Kf=new lt(L.comparator);function $(...n){let t=Kf;for(const e of n)t=t.add(e);return t}const Wf=new lt(q);function Qf(){return Wf}function Ki(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Qr(t)?"-0":t}}function Cl(n){return{integerValue:""+n}}function Xf(n,t){return If(t)?Cl(t):Ki(n,t)}class _s{constructor(){this._=void 0}}function Jf(n,t,e){return n instanceof Xn?(function(s,o){const a={fields:{[ul]:{stringValue:ll},[dl]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return o&&qi(o)&&(o=fs(o)),o&&(a.fields[hl]=o),{mapValue:a}})(e,t):n instanceof Jn?Pl(n,t):n instanceof Yn?Vl(n,t):(function(s,o){const a=bl(s,o),l=rc(a)+rc(s.Ae);return di(a)&&di(s.Ae)?Cl(l):Ki(s.serializer,l)})(n,t)}function Yf(n,t,e){return n instanceof Jn?Pl(n,t):n instanceof Yn?Vl(n,t):e}function bl(n,t){return n instanceof ts?(function(r){return di(r)||(function(o){return!!o&&"doubleValue"in o})(r)})(t)?t:{integerValue:0}:null}class Xn extends _s{}class Jn extends _s{constructor(t){super(),this.elements=t}}function Pl(n,t){const e=Dl(t);for(const r of n.elements)e.some((s=>Wt(s,r)))||e.push(r);return{arrayValue:{values:e}}}class Yn extends _s{constructor(t){super(),this.elements=t}}function Vl(n,t){let e=Dl(t);for(const r of n.elements)e=e.filter((s=>!Wt(s,r)));return{arrayValue:{values:e}}}class ts extends _s{constructor(t,e){super(),this.serializer=t,this.Ae=e}}function rc(n){return rt(n.integerValue||n.doubleValue)}function Dl(n){return $i(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}class Zf{constructor(t,e){this.field=t,this.transform=e}}function tm(n,t){return n.field.isEqual(t.field)&&(function(r,s){return r instanceof Jn&&s instanceof Jn||r instanceof Yn&&s instanceof Yn?sn(r.elements,s.elements,Wt):r instanceof ts&&s instanceof ts?Wt(r.Ae,s.Ae):r instanceof Xn&&s instanceof Xn})(n.transform,t.transform)}class em{constructor(t,e){this.version=t,this.transformResults=e}}class Ft{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Ft}static exists(t){return new Ft(void 0,t)}static updateTime(t){return new Ft(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Ur(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}class ys{}function kl(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new Wi(n.key,Ft.none()):new cr(n.key,n.data,Ft.none());{const e=n.data,r=kt.empty();let s=new lt(pt.comparator);for(let o of t.fields)if(!s.has(o)){let a=e.field(o);a===null&&o.length>1&&(o=o.popLast(),a=e.field(o)),a===null?r.delete(o):r.set(o,a),s=s.add(o)}return new Fe(n.key,r,new xt(s.toArray()),Ft.none())}}function nm(n,t,e){n instanceof cr?(function(s,o,a){const l=s.value.clone(),h=ic(s.fieldTransforms,o,a.transformResults);l.setAll(h),o.convertToFoundDocument(a.version,l).setHasCommittedMutations()})(n,t,e):n instanceof Fe?(function(s,o,a){if(!Ur(s.precondition,o))return void o.convertToUnknownDocument(a.version);const l=ic(s.fieldTransforms,o,a.transformResults),h=o.data;h.setAll(Nl(s)),h.setAll(l),o.convertToFoundDocument(a.version,h).setHasCommittedMutations()})(n,t,e):(function(s,o,a){o.convertToNoDocument(a.version).setHasCommittedMutations()})(0,t,e)}function Un(n,t,e,r){return n instanceof cr?(function(o,a,l,h){if(!Ur(o.precondition,a))return l;const d=o.value.clone(),p=oc(o.fieldTransforms,h,a);return d.setAll(p),a.convertToFoundDocument(a.version,d).setHasLocalMutations(),null})(n,t,e,r):n instanceof Fe?(function(o,a,l,h){if(!Ur(o.precondition,a))return l;const d=oc(o.fieldTransforms,h,a),p=a.data;return p.setAll(Nl(o)),p.setAll(d),a.convertToFoundDocument(a.version,p).setHasLocalMutations(),l===null?null:l.unionWith(o.fieldMask.fields).unionWith(o.fieldTransforms.map((E=>E.field)))})(n,t,e,r):(function(o,a,l){return Ur(o.precondition,a)?(a.convertToNoDocument(a.version).setHasLocalMutations(),null):l})(n,t,e)}function rm(n,t){let e=null;for(const r of n.fieldTransforms){const s=t.data.field(r.field),o=bl(r.transform,s||null);o!=null&&(e===null&&(e=kt.empty()),e.set(r.field,o))}return e||null}function sc(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!(function(r,s){return r===void 0&&s===void 0||!(!r||!s)&&sn(r,s,((o,a)=>tm(o,a)))})(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}class cr extends ys{constructor(t,e,r,s=[]){super(),this.key=t,this.value=e,this.precondition=r,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class Fe extends ys{constructor(t,e,r,s,o=[]){super(),this.key=t,this.data=e,this.fieldMask=r,this.precondition=s,this.fieldTransforms=o,this.type=1}getFieldMask(){return this.fieldMask}}function Nl(n){const t=new Map;return n.fieldMask.fields.forEach((e=>{if(!e.isEmpty()){const r=n.data.field(e);t.set(e,r)}})),t}function ic(n,t,e){const r=new Map;Q(n.length===e.length,32656,{Re:e.length,Ve:n.length});for(let s=0;s<e.length;s++){const o=n[s],a=o.transform,l=t.data.field(o.field);r.set(o.field,Yf(a,l,e[s]))}return r}function oc(n,t,e){const r=new Map;for(const s of n){const o=s.transform,a=e.data.field(s.field);r.set(s.field,Jf(o,a,t))}return r}class Wi extends ys{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class sm extends ys{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class im{constructor(t,e,r,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=r,this.mutations=s}applyToRemoteDocument(t,e){const r=e.mutationResults;for(let s=0;s<this.mutations.length;s++){const o=this.mutations[s];o.key.isEqual(t.key)&&nm(o,t,r[s])}}applyToLocalView(t,e){for(const r of this.baseMutations)r.key.isEqual(t.key)&&(e=Un(r,t,e,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(t.key)&&(e=Un(r,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const r=Rl();return this.mutations.forEach((s=>{const o=t.get(s.key),a=o.overlayedDocument;let l=this.applyToLocalView(a,o.mutatedFields);l=e.has(s.key)?null:l;const h=kl(a,l);h!==null&&r.set(s.key,h),a.isValidDocument()||a.convertToNoDocument(B.min())})),r}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),$())}isEqual(t){return this.batchId===t.batchId&&sn(this.mutations,t.mutations,((e,r)=>sc(e,r)))&&sn(this.baseMutations,t.baseMutations,((e,r)=>sc(e,r)))}}class Qi{constructor(t,e,r,s){this.batch=t,this.commitVersion=e,this.mutationResults=r,this.docVersions=s}static from(t,e,r){Q(t.mutations.length===r.length,58842,{me:t.mutations.length,fe:r.length});let s=(function(){return Gf})();const o=t.mutations;for(let a=0;a<o.length;a++)s=s.insert(o[a].key,r[a].version);return new Qi(t,e,r,s)}}class om{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class am{constructor(t,e){this.count=t,this.unchangedNames=e}}var st,z;function cm(n){switch(n){case C.OK:return F(64938);case C.CANCELLED:case C.UNKNOWN:case C.DEADLINE_EXCEEDED:case C.RESOURCE_EXHAUSTED:case C.INTERNAL:case C.UNAVAILABLE:case C.UNAUTHENTICATED:return!1;case C.INVALID_ARGUMENT:case C.NOT_FOUND:case C.ALREADY_EXISTS:case C.PERMISSION_DENIED:case C.FAILED_PRECONDITION:case C.ABORTED:case C.OUT_OF_RANGE:case C.UNIMPLEMENTED:case C.DATA_LOSS:return!0;default:return F(15467,{code:n})}}function Ol(n){if(n===void 0)return Yt("GRPC error has no .code"),C.UNKNOWN;switch(n){case st.OK:return C.OK;case st.CANCELLED:return C.CANCELLED;case st.UNKNOWN:return C.UNKNOWN;case st.DEADLINE_EXCEEDED:return C.DEADLINE_EXCEEDED;case st.RESOURCE_EXHAUSTED:return C.RESOURCE_EXHAUSTED;case st.INTERNAL:return C.INTERNAL;case st.UNAVAILABLE:return C.UNAVAILABLE;case st.UNAUTHENTICATED:return C.UNAUTHENTICATED;case st.INVALID_ARGUMENT:return C.INVALID_ARGUMENT;case st.NOT_FOUND:return C.NOT_FOUND;case st.ALREADY_EXISTS:return C.ALREADY_EXISTS;case st.PERMISSION_DENIED:return C.PERMISSION_DENIED;case st.FAILED_PRECONDITION:return C.FAILED_PRECONDITION;case st.ABORTED:return C.ABORTED;case st.OUT_OF_RANGE:return C.OUT_OF_RANGE;case st.UNIMPLEMENTED:return C.UNIMPLEMENTED;case st.DATA_LOSS:return C.DATA_LOSS;default:return F(39323,{code:n})}}(z=st||(st={}))[z.OK=0]="OK",z[z.CANCELLED=1]="CANCELLED",z[z.UNKNOWN=2]="UNKNOWN",z[z.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",z[z.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",z[z.NOT_FOUND=5]="NOT_FOUND",z[z.ALREADY_EXISTS=6]="ALREADY_EXISTS",z[z.PERMISSION_DENIED=7]="PERMISSION_DENIED",z[z.UNAUTHENTICATED=16]="UNAUTHENTICATED",z[z.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",z[z.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",z[z.ABORTED=10]="ABORTED",z[z.OUT_OF_RANGE=11]="OUT_OF_RANGE",z[z.UNIMPLEMENTED=12]="UNIMPLEMENTED",z[z.INTERNAL=13]="INTERNAL",z[z.UNAVAILABLE=14]="UNAVAILABLE",z[z.DATA_LOSS=15]="DATA_LOSS";function lm(){return new TextEncoder}const um=new le([4294967295,4294967295],0);function ac(n){const t=lm().encode(n),e=new Xc;return e.update(t),new Uint8Array(e.digest())}function cc(n){const t=new DataView(n.buffer),e=t.getUint32(0,!0),r=t.getUint32(4,!0),s=t.getUint32(8,!0),o=t.getUint32(12,!0);return[new le([e,r],0),new le([s,o],0)]}class Xi{constructor(t,e,r){if(this.bitmap=t,this.padding=e,this.hashCount=r,e<0||e>=8)throw new On(`Invalid padding: ${e}`);if(r<0)throw new On(`Invalid hash count: ${r}`);if(t.length>0&&this.hashCount===0)throw new On(`Invalid hash count: ${r}`);if(t.length===0&&e!==0)throw new On(`Invalid padding when bitmap length is 0: ${e}`);this.ge=8*t.length-e,this.pe=le.fromNumber(this.ge)}ye(t,e,r){let s=t.add(e.multiply(le.fromNumber(r)));return s.compare(um)===1&&(s=new le([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.ge===0)return!1;const e=ac(t),[r,s]=cc(e);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);if(!this.we(a))return!1}return!0}static create(t,e,r){const s=t%8==0?0:8-t%8,o=new Uint8Array(Math.ceil(t/8)),a=new Xi(o,s,e);return r.forEach((l=>a.insert(l))),a}insert(t){if(this.ge===0)return;const e=ac(t),[r,s]=cc(e);for(let o=0;o<this.hashCount;o++){const a=this.ye(r,s,o);this.Se(a)}}Se(t){const e=Math.floor(t/8),r=t%8;this.bitmap[e]|=1<<r}}class On extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Es{constructor(t,e,r,s,o){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=r,this.documentUpdates=s,this.resolvedLimboDocuments=o}static createSynthesizedRemoteEventForCurrentChange(t,e,r){const s=new Map;return s.set(t,lr.createSynthesizedTargetChangeForCurrentChange(t,e,r)),new Es(B.min(),s,new et(q),Zt(),$())}}class lr{constructor(t,e,r,s,o){this.resumeToken=t,this.current=e,this.addedDocuments=r,this.modifiedDocuments=s,this.removedDocuments=o}static createSynthesizedTargetChangeForCurrentChange(t,e,r){return new lr(r,e,$(),$(),$())}}class jr{constructor(t,e,r,s){this.be=t,this.removedTargetIds=e,this.key=r,this.De=s}}class Ll{constructor(t,e){this.targetId=t,this.Ce=e}}class Ml{constructor(t,e,r=_t.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=r,this.cause=s}}class lc{constructor(){this.ve=0,this.Fe=uc(),this.Me=_t.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=$(),e=$(),r=$();return this.Fe.forEach(((s,o)=>{switch(o){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:r=r.add(s);break;default:F(38017,{changeType:o})}})),new lr(this.Me,this.xe,t,e,r)}qe(){this.Oe=!1,this.Fe=uc()}Qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,Q(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class hm{constructor(t){this.Ge=t,this.ze=new Map,this.je=Zt(),this.Je=Nr(),this.He=Nr(),this.Ye=new et(q)}Ze(t){for(const e of t.be)t.De&&t.De.isFoundDocument()?this.Xe(e,t.De):this.et(e,t.key,t.De);for(const e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,(e=>{const r=this.nt(e);switch(t.state){case 0:this.rt(e)&&r.Le(t.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(t.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(r.We(),r.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),r.Le(t.resumeToken));break;default:F(56790,{state:t.state})}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach(((r,s)=>{this.rt(s)&&e(s)}))}st(t){const e=t.targetId,r=t.Ce.count,s=this.ot(e);if(s){const o=s.target;if(mi(o))if(r===0){const a=new L(o.path);this.et(e,a,vt.newNoDocument(a,B.min()))}else Q(r===1,20013,{expectedCount:r});else{const a=this._t(e);if(a!==r){const l=this.ut(t),h=l?this.ct(l,t,a):1;if(h!==0){this.it(e);const d=h===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(e,d)}}}}}ut(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:r="",padding:s=0},hashCount:o=0}=e;let a,l;try{a=pe(r).toUint8Array()}catch(h){if(h instanceof cl)return rn("Decoding the base64 bloom filter in existence filter failed ("+h.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw h}try{l=new Xi(a,s,o)}catch(h){return rn(h instanceof On?"BloomFilter error: ":"Applying bloom filter failed: ",h),null}return l.ge===0?null:l}ct(t,e,r){return e.Ce.count===r-this.Pt(t,e.targetId)?0:2}Pt(t,e){const r=this.Ge.getRemoteKeysForTarget(e);let s=0;return r.forEach((o=>{const a=this.Ge.ht(),l=`projects/${a.projectId}/databases/${a.database}/documents/${o.path.canonicalString()}`;t.mightContain(l)||(this.et(e,o,null),s++)})),s}Tt(t){const e=new Map;this.ze.forEach(((o,a)=>{const l=this.ot(a);if(l){if(o.current&&mi(l.target)){const h=new L(l.target.path);this.It(h).has(a)||this.Et(a,h)||this.et(a,h,vt.newNoDocument(h,t))}o.Be&&(e.set(a,o.ke()),o.qe())}}));let r=$();this.He.forEach(((o,a)=>{let l=!0;a.forEachWhile((h=>{const d=this.ot(h);return!d||d.purpose==="TargetPurposeLimboResolution"||(l=!1,!1)})),l&&(r=r.add(o))})),this.je.forEach(((o,a)=>a.setReadTime(t)));const s=new Es(t,e,this.Ye,this.je,r);return this.je=Zt(),this.Je=Nr(),this.He=Nr(),this.Ye=new et(q),s}Xe(t,e){if(!this.rt(t))return;const r=this.Et(t,e.key)?2:0;this.nt(t).Qe(e.key,r),this.je=this.je.insert(e.key,e),this.Je=this.Je.insert(e.key,this.It(e.key).add(t)),this.He=this.He.insert(e.key,this.dt(e.key).add(t))}et(t,e,r){if(!this.rt(t))return;const s=this.nt(t);this.Et(t,e)?s.Qe(e,1):s.$e(e),this.He=this.He.insert(e,this.dt(e).delete(t)),this.He=this.He.insert(e,this.dt(e).add(t)),r&&(this.je=this.je.insert(e,r))}removeTarget(t){this.ze.delete(t)}_t(t){const e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let e=this.ze.get(t);return e||(e=new lc,this.ze.set(t,e)),e}dt(t){let e=this.He.get(t);return e||(e=new lt(q),this.He=this.He.insert(t,e)),e}It(t){let e=this.Je.get(t);return e||(e=new lt(q),this.Je=this.Je.insert(t,e)),e}rt(t){const e=this.ot(t)!==null;return e||k("WatchChangeAggregator","Detected inactive target",t),e}ot(t){const e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new lc),this.Ge.getRemoteKeysForTarget(t).forEach((e=>{this.et(t,e,null)}))}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}}function Nr(){return new et(L.comparator)}function uc(){return new et(L.comparator)}const dm={asc:"ASCENDING",desc:"DESCENDING"},fm={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},mm={and:"AND",or:"OR"};class gm{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function pi(n,t){return n.useProto3Json||ds(t)?t:{value:t}}function es(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function xl(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function pm(n,t){return es(n,t.toTimestamp())}function zt(n){return Q(!!n,49232),B.fromTimestamp((function(e){const r=ge(e);return new Z(r.seconds,r.nanos)})(n))}function Ji(n,t){return _i(n,t).canonicalString()}function _i(n,t){const e=(function(s){return new Y(["projects",s.projectId,"databases",s.database])})(n).child("documents");return t===void 0?e:e.child(t)}function Fl(n){const t=Y.fromString(n);return Q($l(t),10190,{key:t.toString()}),t}function yi(n,t){return Ji(n.databaseId,t.path)}function Zs(n,t){const e=Fl(t);if(e.get(1)!==n.databaseId.projectId)throw new O(C.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new O(C.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new L(Ul(e))}function Bl(n,t){return Ji(n.databaseId,t)}function _m(n){const t=Fl(n);return t.length===4?Y.emptyPath():Ul(t)}function Ei(n){return new Y(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Ul(n){return Q(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function hc(n,t,e){return{name:yi(n,t),fields:e.value.mapValue.fields}}function ym(n,t){let e;if("targetChange"in t){t.targetChange;const r=(function(d){return d==="NO_CHANGE"?0:d==="ADD"?1:d==="REMOVE"?2:d==="CURRENT"?3:d==="RESET"?4:F(39313,{state:d})})(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],o=(function(d,p){return d.useProto3Json?(Q(p===void 0||typeof p=="string",58123),_t.fromBase64String(p||"")):(Q(p===void 0||p instanceof Buffer||p instanceof Uint8Array,16193),_t.fromUint8Array(p||new Uint8Array))})(n,t.targetChange.resumeToken),a=t.targetChange.cause,l=a&&(function(d){const p=d.code===void 0?C.UNKNOWN:Ol(d.code);return new O(p,d.message||"")})(a);e=new Ml(r,s,o,l||null)}else if("documentChange"in t){t.documentChange;const r=t.documentChange;r.document,r.document.name,r.document.updateTime;const s=Zs(n,r.document.name),o=zt(r.document.updateTime),a=r.document.createTime?zt(r.document.createTime):B.min(),l=new kt({mapValue:{fields:r.document.fields}}),h=vt.newFoundDocument(s,o,a,l),d=r.targetIds||[],p=r.removedTargetIds||[];e=new jr(d,p,h.key,h)}else if("documentDelete"in t){t.documentDelete;const r=t.documentDelete;r.document;const s=Zs(n,r.document),o=r.readTime?zt(r.readTime):B.min(),a=vt.newNoDocument(s,o),l=r.removedTargetIds||[];e=new jr([],l,a.key,a)}else if("documentRemove"in t){t.documentRemove;const r=t.documentRemove;r.document;const s=Zs(n,r.document),o=r.removedTargetIds||[];e=new jr([],o,s,null)}else{if(!("filter"in t))return F(11601,{Rt:t});{t.filter;const r=t.filter;r.targetId;const{count:s=0,unchangedNames:o}=r,a=new am(s,o),l=r.targetId;e=new Ll(l,a)}}return e}function Em(n,t){let e;if(t instanceof cr)e={update:hc(n,t.key,t.value)};else if(t instanceof Wi)e={delete:yi(n,t.key)};else if(t instanceof Fe)e={update:hc(n,t.key,t.data),updateMask:bm(t.fieldMask)};else{if(!(t instanceof sm))return F(16599,{Vt:t.type});e={verify:yi(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map((r=>(function(o,a){const l=a.transform;if(l instanceof Xn)return{fieldPath:a.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(l instanceof Jn)return{fieldPath:a.field.canonicalString(),appendMissingElements:{values:l.elements}};if(l instanceof Yn)return{fieldPath:a.field.canonicalString(),removeAllFromArray:{values:l.elements}};if(l instanceof ts)return{fieldPath:a.field.canonicalString(),increment:l.Ae};throw F(20930,{transform:a.transform})})(0,r)))),t.precondition.isNone||(e.currentDocument=(function(s,o){return o.updateTime!==void 0?{updateTime:pm(s,o.updateTime)}:o.exists!==void 0?{exists:o.exists}:F(27497)})(n,t.precondition)),e}function Tm(n,t){return n&&n.length>0?(Q(t!==void 0,14353),n.map((e=>(function(s,o){let a=s.updateTime?zt(s.updateTime):zt(o);return a.isEqual(B.min())&&(a=zt(o)),new em(a,s.transformResults||[])})(e,t)))):[]}function vm(n,t){return{documents:[Bl(n,t.path)]}}function Im(n,t){const e={structuredQuery:{}},r=t.path;let s;t.collectionGroup!==null?(s=r,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=r.popLast(),e.structuredQuery.from=[{collectionId:r.lastSegment()}]),e.parent=Bl(n,s);const o=(function(d){if(d.length!==0)return ql(Qt.create(d,"and"))})(t.filters);o&&(e.structuredQuery.where=o);const a=(function(d){if(d.length!==0)return d.map((p=>(function(A){return{field:He(A.field),direction:Sm(A.dir)}})(p)))})(t.orderBy);a&&(e.structuredQuery.orderBy=a);const l=pi(n,t.limit);return l!==null&&(e.structuredQuery.limit=l),t.startAt&&(e.structuredQuery.startAt=(function(d){return{before:d.inclusive,values:d.position}})(t.startAt)),t.endAt&&(e.structuredQuery.endAt=(function(d){return{before:!d.inclusive,values:d.position}})(t.endAt)),{ft:e,parent:s}}function wm(n){let t=_m(n.parent);const e=n.structuredQuery,r=e.from?e.from.length:0;let s=null;if(r>0){Q(r===1,65062);const p=e.from[0];p.allDescendants?s=p.collectionId:t=t.child(p.collectionId)}let o=[];e.where&&(o=(function(E){const A=jl(E);return A instanceof Qt&&yl(A)?A.getFilters():[A]})(e.where));let a=[];e.orderBy&&(a=(function(E){return E.map((A=>(function(N){return new Zr(Ge(N.field),(function(D){switch(D){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(N.direction))})(A)))})(e.orderBy));let l=null;e.limit&&(l=(function(E){let A;return A=typeof E=="object"?E.value:E,ds(A)?null:A})(e.limit));let h=null;e.startAt&&(h=(function(E){const A=!!E.before,P=E.values||[];return new Yr(P,A)})(e.startAt));let d=null;return e.endAt&&(d=(function(E){const A=!E.before,P=E.values||[];return new Yr(P,A)})(e.endAt)),Uf(t,s,a,o,l,"F",h,d)}function Am(n,t){const e=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return F(28987,{purpose:s})}})(t.purpose);return e==null?null:{"goog-listen-tags":e}}function jl(n){return n.unaryFilter!==void 0?(function(e){switch(e.unaryFilter.op){case"IS_NAN":const r=Ge(e.unaryFilter.field);return at.create(r,"==",{doubleValue:NaN});case"IS_NULL":const s=Ge(e.unaryFilter.field);return at.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const o=Ge(e.unaryFilter.field);return at.create(o,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const a=Ge(e.unaryFilter.field);return at.create(a,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return F(61313);default:return F(60726)}})(n):n.fieldFilter!==void 0?(function(e){return at.create(Ge(e.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return F(58110);default:return F(50506)}})(e.fieldFilter.op),e.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(e){return Qt.create(e.compositeFilter.filters.map((r=>jl(r))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return F(1026)}})(e.compositeFilter.op))})(n):F(30097,{filter:n})}function Sm(n){return dm[n]}function Rm(n){return fm[n]}function Cm(n){return mm[n]}function He(n){return{fieldPath:n.canonicalString()}}function Ge(n){return pt.fromServerFormat(n.fieldPath)}function ql(n){return n instanceof at?(function(e){if(e.op==="=="){if(Ya(e.value))return{unaryFilter:{field:He(e.field),op:"IS_NAN"}};if(Ja(e.value))return{unaryFilter:{field:He(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(Ya(e.value))return{unaryFilter:{field:He(e.field),op:"IS_NOT_NAN"}};if(Ja(e.value))return{unaryFilter:{field:He(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:He(e.field),op:Rm(e.op),value:e.value}}})(n):n instanceof Qt?(function(e){const r=e.getFilters().map((s=>ql(s)));return r.length===1?r[0]:{compositeFilter:{op:Cm(e.op),filters:r}}})(n):F(54877,{filter:n})}function bm(n){const t=[];return n.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function $l(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class oe{constructor(t,e,r,s,o=B.min(),a=B.min(),l=_t.EMPTY_BYTE_STRING,h=null){this.target=t,this.targetId=e,this.purpose=r,this.sequenceNumber=s,this.snapshotVersion=o,this.lastLimboFreeSnapshotVersion=a,this.resumeToken=l,this.expectedCount=h}withSequenceNumber(t){return new oe(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new oe(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new oe(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new oe(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Pm{constructor(t){this.yt=t}}function Vm(n){const t=wm({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?gi(t,t.limit,"L"):t}class Dm{constructor(){this.Cn=new km}addToCollectionParentIndex(t,e){return this.Cn.add(e),R.resolve()}getCollectionParents(t,e){return R.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return R.resolve()}deleteFieldIndex(t,e){return R.resolve()}deleteAllFieldIndexes(t){return R.resolve()}createTargetIndexes(t,e){return R.resolve()}getDocumentsMatchingTarget(t,e){return R.resolve(null)}getIndexType(t,e){return R.resolve(0)}getFieldIndexes(t,e){return R.resolve([])}getNextCollectionGroupToUpdate(t){return R.resolve(null)}getMinOffset(t,e){return R.resolve(me.min())}getMinOffsetFromCollectionGroup(t,e){return R.resolve(me.min())}updateCollectionGroup(t,e,r){return R.resolve()}updateIndexEntries(t,e){return R.resolve()}}class km{constructor(){this.index={}}add(t){const e=t.lastSegment(),r=t.popLast(),s=this.index[e]||new lt(Y.comparator),o=!s.has(r);return this.index[e]=s.add(r),o}has(t){const e=t.lastSegment(),r=t.popLast(),s=this.index[e];return s&&s.has(r)}getEntries(t){return(this.index[t]||new lt(Y.comparator)).toArray()}}const dc={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},zl=41943040;class bt{static withCacheSize(t){return new bt(t,bt.DEFAULT_COLLECTION_PERCENTILE,bt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,r){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=r}}bt.DEFAULT_COLLECTION_PERCENTILE=10,bt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,bt.DEFAULT=new bt(zl,bt.DEFAULT_COLLECTION_PERCENTILE,bt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),bt.DISABLED=new bt(-1,0,0);class cn{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new cn(0)}static cr(){return new cn(-1)}}const fc="LruGarbageCollector",Nm=1048576;function mc([n,t],[e,r]){const s=q(n,e);return s===0?q(t,r):s}class Om{constructor(t){this.Ir=t,this.buffer=new lt(mc),this.Er=0}dr(){return++this.Er}Ar(t){const e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{const r=this.buffer.last();mc(e,r)<0&&(this.buffer=this.buffer.delete(r).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Lm{constructor(t,e,r){this.garbageCollector=t,this.asyncQueue=e,this.localStore=r,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(t){k(fc,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){mn(e)?k(fc,"Ignoring IndexedDB error during garbage collection: ",e):await fn(e)}await this.Vr(3e5)}))}}class Mm{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next((r=>Math.floor(e/100*r)))}nthSequenceNumber(t,e){if(e===0)return R.resolve(hs.ce);const r=new Om(e);return this.mr.forEachTarget(t,(s=>r.Ar(s.sequenceNumber))).next((()=>this.mr.pr(t,(s=>r.Ar(s))))).next((()=>r.maxValue))}removeTargets(t,e,r){return this.mr.removeTargets(t,e,r)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(k("LruGarbageCollector","Garbage collection skipped; disabled"),R.resolve(dc)):this.getCacheSize(t).next((r=>r<this.params.cacheSizeCollectionThreshold?(k("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),dc):this.yr(t,e)))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let r,s,o,a,l,h,d;const p=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((E=>(E>this.params.maximumSequenceNumbersToCollect?(k("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${E}`),s=this.params.maximumSequenceNumbersToCollect):s=E,a=Date.now(),this.nthSequenceNumber(t,s)))).next((E=>(r=E,l=Date.now(),this.removeTargets(t,r,e)))).next((E=>(o=E,h=Date.now(),this.removeOrphanedDocuments(t,r)))).next((E=>(d=Date.now(),$e()<=H.DEBUG&&k("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${a-p}ms
	Determined least recently used ${s} in `+(l-a)+`ms
	Removed ${o} targets in `+(h-l)+`ms
	Removed ${E} documents in `+(d-h)+`ms
Total Duration: ${d-p}ms`),R.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:o,documentsRemoved:E}))))}}function xm(n,t){return new Mm(n,t)}class Fm{constructor(){this.changes=new xe((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,vt.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const r=this.changes.get(e);return r!==void 0?R.resolve(r):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Bm{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Um{constructor(t,e,r,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=r,this.indexManager=s}getDocument(t,e){let r=null;return this.documentOverlayCache.getOverlay(t,e).next((s=>(r=s,this.remoteDocumentCache.getEntry(t,e)))).next((s=>(r!==null&&Un(r.mutation,s,xt.empty(),Z.now()),s)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((r=>this.getLocalViewOfDocuments(t,r,$()).next((()=>r))))}getLocalViewOfDocuments(t,e,r=$()){const s=be();return this.populateOverlays(t,s,e).next((()=>this.computeViews(t,e,s,r).next((o=>{let a=Nn();return o.forEach(((l,h)=>{a=a.insert(l,h.overlayedDocument)})),a}))))}getOverlayedDocuments(t,e){const r=be();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,$())))}populateOverlays(t,e,r){const s=[];return r.forEach((o=>{e.has(o)||s.push(o)})),this.documentOverlayCache.getOverlays(t,s).next((o=>{o.forEach(((a,l)=>{e.set(a,l)}))}))}computeViews(t,e,r,s){let o=Zt();const a=Bn(),l=(function(){return Bn()})();return e.forEach(((h,d)=>{const p=r.get(d.key);s.has(d.key)&&(p===void 0||p.mutation instanceof Fe)?o=o.insert(d.key,d):p!==void 0?(a.set(d.key,p.mutation.getFieldMask()),Un(p.mutation,d,p.mutation.getFieldMask(),Z.now())):a.set(d.key,xt.empty())})),this.recalculateAndSaveOverlays(t,o).next((h=>(h.forEach(((d,p)=>a.set(d,p))),e.forEach(((d,p)=>l.set(d,new Bm(p,a.get(d)??null)))),l)))}recalculateAndSaveOverlays(t,e){const r=Bn();let s=new et(((a,l)=>a-l)),o=$();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((a=>{for(const l of a)l.keys().forEach((h=>{const d=e.get(h);if(d===null)return;let p=r.get(h)||xt.empty();p=l.applyToLocalView(d,p),r.set(h,p);const E=(s.get(l.batchId)||$()).add(h);s=s.insert(l.batchId,E)}))})).next((()=>{const a=[],l=s.getReverseIterator();for(;l.hasNext();){const h=l.getNext(),d=h.key,p=h.value,E=Rl();p.forEach((A=>{if(!o.has(A)){const P=kl(e.get(A),r.get(A));P!==null&&E.set(A,P),o=o.add(A)}})),a.push(this.documentOverlayCache.saveOverlays(t,d,E))}return R.waitFor(a)})).next((()=>r))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((r=>this.recalculateAndSaveOverlays(t,r)))}getDocumentsMatchingQuery(t,e,r,s){return(function(a){return L.isDocumentKey(a.path)&&a.collectionGroup===null&&a.filters.length===0})(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):jf(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,r,s):this.getDocumentsMatchingCollectionQuery(t,e,r,s)}getNextDocuments(t,e,r,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,r,s).next((o=>{const a=s-o.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,r.largestBatchId,s-o.size):R.resolve(be());let l=Gn,h=o;return a.next((d=>R.forEach(d,((p,E)=>(l<E.largestBatchId&&(l=E.largestBatchId),o.get(p)?R.resolve():this.remoteDocumentCache.getEntry(t,p).next((A=>{h=h.insert(p,A)}))))).next((()=>this.populateOverlays(t,d,o))).next((()=>this.computeViews(t,h,d,$()))).next((p=>({batchId:l,changes:Sl(p)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new L(e)).next((r=>{let s=Nn();return r.isFoundDocument()&&(s=s.insert(r.key,r)),s}))}getDocumentsMatchingCollectionGroupQuery(t,e,r,s){const o=e.collectionGroup;let a=Nn();return this.indexManager.getCollectionParents(t,o).next((l=>R.forEach(l,(h=>{const d=(function(E,A){return new ms(A,null,E.explicitOrderBy.slice(),E.filters.slice(),E.limit,E.limitType,E.startAt,E.endAt)})(e,h.child(o));return this.getDocumentsMatchingCollectionQuery(t,d,r,s).next((p=>{p.forEach(((E,A)=>{a=a.insert(E,A)}))}))})).next((()=>a))))}getDocumentsMatchingCollectionQuery(t,e,r,s){let o;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,r.largestBatchId).next((a=>(o=a,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,r,o,s)))).next((a=>{o.forEach(((h,d)=>{const p=d.getKey();a.get(p)===null&&(a=a.insert(p,vt.newInvalidDocument(p)))}));let l=Nn();return a.forEach(((h,d)=>{const p=o.get(h);p!==void 0&&Un(p.mutation,d,xt.empty(),Z.now()),ps(e,d)&&(l=l.insert(h,d))})),l}))}}class jm{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return R.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,(function(s){return{id:s.id,version:s.version,createTime:zt(s.createTime)}})(e)),R.resolve()}getNamedQuery(t,e){return R.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,(function(s){return{name:s.name,query:Vm(s.bundledQuery),readTime:zt(s.readTime)}})(e)),R.resolve()}}class qm{constructor(){this.overlays=new et(L.comparator),this.qr=new Map}getOverlay(t,e){return R.resolve(this.overlays.get(e))}getOverlays(t,e){const r=be();return R.forEach(e,(s=>this.getOverlay(t,s).next((o=>{o!==null&&r.set(s,o)})))).next((()=>r))}saveOverlays(t,e,r){return r.forEach(((s,o)=>{this.St(t,e,o)})),R.resolve()}removeOverlaysForBatchId(t,e,r){const s=this.qr.get(r);return s!==void 0&&(s.forEach((o=>this.overlays=this.overlays.remove(o))),this.qr.delete(r)),R.resolve()}getOverlaysForCollection(t,e,r){const s=be(),o=e.length+1,a=new L(e.child("")),l=this.overlays.getIteratorFrom(a);for(;l.hasNext();){const h=l.getNext().value,d=h.getKey();if(!e.isPrefixOf(d.path))break;d.path.length===o&&h.largestBatchId>r&&s.set(h.getKey(),h)}return R.resolve(s)}getOverlaysForCollectionGroup(t,e,r,s){let o=new et(((d,p)=>d-p));const a=this.overlays.getIterator();for(;a.hasNext();){const d=a.getNext().value;if(d.getKey().getCollectionGroup()===e&&d.largestBatchId>r){let p=o.get(d.largestBatchId);p===null&&(p=be(),o=o.insert(d.largestBatchId,p)),p.set(d.getKey(),d)}}const l=be(),h=o.getIterator();for(;h.hasNext()&&(h.getNext().value.forEach(((d,p)=>l.set(d,p))),!(l.size()>=s)););return R.resolve(l)}St(t,e,r){const s=this.overlays.get(r.key);if(s!==null){const a=this.qr.get(s.largestBatchId).delete(r.key);this.qr.set(s.largestBatchId,a)}this.overlays=this.overlays.insert(r.key,new om(e,r));let o=this.qr.get(e);o===void 0&&(o=$(),this.qr.set(e,o)),this.qr.set(e,o.add(r.key))}}class $m{constructor(){this.sessionToken=_t.EMPTY_BYTE_STRING}getSessionToken(t){return R.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,R.resolve()}}class Yi{constructor(){this.Qr=new lt(ft.$r),this.Ur=new lt(ft.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){const r=new ft(t,e);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(t,e){t.forEach((r=>this.addReference(r,e)))}removeReference(t,e){this.Gr(new ft(t,e))}zr(t,e){t.forEach((r=>this.removeReference(r,e)))}jr(t){const e=new L(new Y([])),r=new ft(e,t),s=new ft(e,t+1),o=[];return this.Ur.forEachInRange([r,s],(a=>{this.Gr(a),o.push(a.key)})),o}Jr(){this.Qr.forEach((t=>this.Gr(t)))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){const e=new L(new Y([])),r=new ft(e,t),s=new ft(e,t+1);let o=$();return this.Ur.forEachInRange([r,s],(a=>{o=o.add(a.key)})),o}containsKey(t){const e=new ft(t,0),r=this.Qr.firstAfterOrEqual(e);return r!==null&&t.isEqual(r.key)}}class ft{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return L.comparator(t.key,e.key)||q(t.Yr,e.Yr)}static Kr(t,e){return q(t.Yr,e.Yr)||L.comparator(t.key,e.key)}}class zm{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new lt(ft.$r)}checkEmpty(t){return R.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,r,s){const o=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const a=new im(o,e,r,s);this.mutationQueue.push(a);for(const l of s)this.Zr=this.Zr.add(new ft(l.key,o)),this.indexManager.addToCollectionParentIndex(t,l.key.path.popLast());return R.resolve(a)}lookupMutationBatch(t,e){return R.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){const r=e+1,s=this.ei(r),o=s<0?0:s;return R.resolve(this.mutationQueue.length>o?this.mutationQueue[o]:null)}getHighestUnacknowledgedBatchId(){return R.resolve(this.mutationQueue.length===0?ji:this.tr-1)}getAllMutationBatches(t){return R.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const r=new ft(e,0),s=new ft(e,Number.POSITIVE_INFINITY),o=[];return this.Zr.forEachInRange([r,s],(a=>{const l=this.Xr(a.Yr);o.push(l)})),R.resolve(o)}getAllMutationBatchesAffectingDocumentKeys(t,e){let r=new lt(q);return e.forEach((s=>{const o=new ft(s,0),a=new ft(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([o,a],(l=>{r=r.add(l.Yr)}))})),R.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(t,e){const r=e.path,s=r.length+1;let o=r;L.isDocumentKey(o)||(o=o.child(""));const a=new ft(new L(o),0);let l=new lt(q);return this.Zr.forEachWhile((h=>{const d=h.key.path;return!!r.isPrefixOf(d)&&(d.length===s&&(l=l.add(h.Yr)),!0)}),a),R.resolve(this.ti(l))}ti(t){const e=[];return t.forEach((r=>{const s=this.Xr(r);s!==null&&e.push(s)})),e}removeMutationBatch(t,e){Q(this.ni(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let r=this.Zr;return R.forEach(e.mutations,(s=>{const o=new ft(s.key,e.batchId);return r=r.delete(o),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.Zr=r}))}ir(t){}containsKey(t,e){const r=new ft(e,0),s=this.Zr.firstAfterOrEqual(r);return R.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,R.resolve()}ni(t,e){return this.ei(t)}ei(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Xr(t){const e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class Hm{constructor(t){this.ri=t,this.docs=(function(){return new et(L.comparator)})(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const r=e.key,s=this.docs.get(r),o=s?s.size:0,a=this.ri(e);return this.docs=this.docs.insert(r,{document:e.mutableCopy(),size:a}),this.size+=a-o,this.indexManager.addToCollectionParentIndex(t,r.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const r=this.docs.get(e);return R.resolve(r?r.document.mutableCopy():vt.newInvalidDocument(e))}getEntries(t,e){let r=Zt();return e.forEach((s=>{const o=this.docs.get(s);r=r.insert(s,o?o.document.mutableCopy():vt.newInvalidDocument(s))})),R.resolve(r)}getDocumentsMatchingQuery(t,e,r,s){let o=Zt();const a=e.path,l=new L(a.child("__id-9223372036854775808__")),h=this.docs.getIteratorFrom(l);for(;h.hasNext();){const{key:d,value:{document:p}}=h.getNext();if(!a.isPrefixOf(d.path))break;d.path.length>a.length+1||yf(_f(p),r)<=0||(s.has(p.key)||ps(e,p))&&(o=o.insert(p.key,p.mutableCopy()))}return R.resolve(o)}getAllFromCollectionGroup(t,e,r,s){F(9500)}ii(t,e){return R.forEach(this.docs,(r=>e(r)))}newChangeBuffer(t){return new Gm(this)}getSize(t){return R.resolve(this.size)}}class Gm extends Fm{constructor(t){super(),this.Nr=t}applyChanges(t){const e=[];return this.changes.forEach(((r,s)=>{s.isValidDocument()?e.push(this.Nr.addEntry(t,s)):this.Nr.removeEntry(r)})),R.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}}class Km{constructor(t){this.persistence=t,this.si=new xe((e=>zi(e)),Hi),this.lastRemoteSnapshotVersion=B.min(),this.highestTargetId=0,this.oi=0,this._i=new Yi,this.targetCount=0,this.ai=cn.ur()}forEachTarget(t,e){return this.si.forEach(((r,s)=>e(s))),R.resolve()}getLastRemoteSnapshotVersion(t){return R.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return R.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),R.resolve(this.highestTargetId)}setTargetsMetadata(t,e,r){return r&&(this.lastRemoteSnapshotVersion=r),e>this.oi&&(this.oi=e),R.resolve()}Pr(t){this.si.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.ai=new cn(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,R.resolve()}updateTargetData(t,e){return this.Pr(e),R.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,R.resolve()}removeTargets(t,e,r){let s=0;const o=[];return this.si.forEach(((a,l)=>{l.sequenceNumber<=e&&r.get(l.targetId)===null&&(this.si.delete(a),o.push(this.removeMatchingKeysForTargetId(t,l.targetId)),s++)})),R.waitFor(o).next((()=>s))}getTargetCount(t){return R.resolve(this.targetCount)}getTargetData(t,e){const r=this.si.get(e)||null;return R.resolve(r)}addMatchingKeys(t,e,r){return this._i.Wr(e,r),R.resolve()}removeMatchingKeys(t,e,r){this._i.zr(e,r);const s=this.persistence.referenceDelegate,o=[];return s&&e.forEach((a=>{o.push(s.markPotentiallyOrphaned(t,a))})),R.waitFor(o)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),R.resolve()}getMatchingKeysForTargetId(t,e){const r=this._i.Hr(e);return R.resolve(r)}containsKey(t,e){return R.resolve(this._i.containsKey(e))}}class Hl{constructor(t,e){this.ui={},this.overlays={},this.ci=new hs(0),this.li=!1,this.li=!0,this.hi=new $m,this.referenceDelegate=t(this),this.Pi=new Km(this),this.indexManager=new Dm,this.remoteDocumentCache=(function(s){return new Hm(s)})((r=>this.referenceDelegate.Ti(r))),this.serializer=new Pm(e),this.Ii=new jm(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new qm,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let r=this.ui[t.toKey()];return r||(r=new zm(e,this.referenceDelegate),this.ui[t.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,r){k("MemoryPersistence","Starting transaction:",t);const s=new Wm(this.ci.next());return this.referenceDelegate.Ei(),r(s).next((o=>this.referenceDelegate.di(s).next((()=>o)))).toPromise().then((o=>(s.raiseOnCommittedEvent(),o)))}Ai(t,e){return R.or(Object.values(this.ui).map((r=>()=>r.containsKey(t,e))))}}class Wm extends Tf{constructor(t){super(),this.currentSequenceNumber=t}}class Zi{constructor(t){this.persistence=t,this.Ri=new Yi,this.Vi=null}static mi(t){return new Zi(t)}get fi(){if(this.Vi)return this.Vi;throw F(60996)}addReference(t,e,r){return this.Ri.addReference(r,e),this.fi.delete(r.toString()),R.resolve()}removeReference(t,e,r){return this.Ri.removeReference(r,e),this.fi.add(r.toString()),R.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),R.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach((s=>this.fi.add(s.toString())));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next((s=>{s.forEach((o=>this.fi.add(o.toString())))})).next((()=>r.removeTargetData(t,e)))}Ei(){this.Vi=new Set}di(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return R.forEach(this.fi,(r=>{const s=L.fromPath(r);return this.gi(t,s).next((o=>{o||e.removeEntry(s,B.min())}))})).next((()=>(this.Vi=null,e.apply(t))))}updateLimboDocument(t,e){return this.gi(t,e).next((r=>{r?this.fi.delete(e.toString()):this.fi.add(e.toString())}))}Ti(t){return 0}gi(t,e){return R.or([()=>R.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}}class ns{constructor(t,e){this.persistence=t,this.pi=new xe((r=>wf(r.path)),((r,s)=>r.isEqual(s))),this.garbageCollector=xm(this,e)}static mi(t,e){return new ns(t,e)}Ei(){}di(t){return R.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){const e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next((r=>e.next((s=>r+s))))}wr(t){let e=0;return this.pr(t,(r=>{e++})).next((()=>e))}pr(t,e){return R.forEach(this.pi,((r,s)=>this.br(t,r,s).next((o=>o?R.resolve():e(s)))))}removeTargets(t,e,r){return this.persistence.getTargetCache().removeTargets(t,e,r)}removeOrphanedDocuments(t,e){let r=0;const s=this.persistence.getRemoteDocumentCache(),o=s.newChangeBuffer();return s.ii(t,(a=>this.br(t,a,e).next((l=>{l||(r++,o.removeEntry(a,B.min()))})))).next((()=>o.apply(t))).next((()=>r))}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),R.resolve()}removeTarget(t,e){const r=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,r)}addReference(t,e,r){return this.pi.set(r,t.currentSequenceNumber),R.resolve()}removeReference(t,e,r){return this.pi.set(r,t.currentSequenceNumber),R.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),R.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Fr(t.data.value)),e}br(t,e,r){return R.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const s=this.pi.get(e);return R.resolve(s!==void 0&&s>r)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class to{constructor(t,e,r,s){this.targetId=t,this.fromCache=e,this.Es=r,this.ds=s}static As(t,e){let r=$(),s=$();for(const o of e.docChanges)switch(o.type){case 0:r=r.add(o.doc.key);break;case 1:s=s.add(o.doc.key)}return new to(t,e.fromCache,r,s)}}class Qm{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class Xm{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return Fh()?8:vf(Mh())>0?6:4})()}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,r,s){const o={result:null};return this.ys(t,e).next((a=>{o.result=a})).next((()=>{if(!o.result)return this.ws(t,e,s,r).next((a=>{o.result=a}))})).next((()=>{if(o.result)return;const a=new Qm;return this.Ss(t,e,a).next((l=>{if(o.result=l,this.Vs)return this.bs(t,e,a,l.size)}))})).next((()=>o.result))}bs(t,e,r,s){return r.documentReadCount<this.fs?($e()<=H.DEBUG&&k("QueryEngine","SDK will not create cache indexes for query:",ze(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),R.resolve()):($e()<=H.DEBUG&&k("QueryEngine","Query:",ze(e),"scans",r.documentReadCount,"local documents and returns",s,"documents as results."),r.documentReadCount>this.gs*s?($e()<=H.DEBUG&&k("QueryEngine","The SDK decides to create cache indexes for query:",ze(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,$t(e))):R.resolve())}ys(t,e){if(nc(e))return R.resolve(null);let r=$t(e);return this.indexManager.getIndexType(t,r).next((s=>s===0?null:(e.limit!==null&&s===1&&(e=gi(e,null,"F"),r=$t(e)),this.indexManager.getDocumentsMatchingTarget(t,r).next((o=>{const a=$(...o);return this.ps.getDocuments(t,a).next((l=>this.indexManager.getMinOffset(t,r).next((h=>{const d=this.Ds(e,l);return this.Cs(e,d,a,h.readTime)?this.ys(t,gi(e,null,"F")):this.vs(t,d,e,h)}))))})))))}ws(t,e,r,s){return nc(e)||s.isEqual(B.min())?R.resolve(null):this.ps.getDocuments(t,r).next((o=>{const a=this.Ds(e,o);return this.Cs(e,a,r,s)?R.resolve(null):($e()<=H.DEBUG&&k("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),ze(e)),this.vs(t,a,e,pf(s,Gn)).next((l=>l)))}))}Ds(t,e){let r=new lt(wl(t));return e.forEach(((s,o)=>{ps(t,o)&&(r=r.add(o))})),r}Cs(t,e,r,s){if(t.limit===null)return!1;if(r.size!==e.size)return!0;const o=t.limitType==="F"?e.last():e.first();return!!o&&(o.hasPendingWrites||o.version.compareTo(s)>0)}Ss(t,e,r){return $e()<=H.DEBUG&&k("QueryEngine","Using full collection scan to execute query:",ze(e)),this.ps.getDocumentsMatchingQuery(t,e,me.min(),r)}vs(t,e,r,s){return this.ps.getDocumentsMatchingQuery(t,r,s).next((o=>(e.forEach((a=>{o=o.insert(a.key,a)})),o)))}}const eo="LocalStore",Jm=3e8;class Ym{constructor(t,e,r,s){this.persistence=t,this.Fs=e,this.serializer=s,this.Ms=new et(q),this.xs=new xe((o=>zi(o)),Hi),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(r)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Um(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ms)))}}function Zm(n,t,e,r){return new Ym(n,t,e,r)}async function Gl(n,t){const e=U(n);return await e.persistence.runTransaction("Handle user change","readonly",(r=>{let s;return e.mutationQueue.getAllMutationBatches(r).next((o=>(s=o,e.Bs(t),e.mutationQueue.getAllMutationBatches(r)))).next((o=>{const a=[],l=[];let h=$();for(const d of s){a.push(d.batchId);for(const p of d.mutations)h=h.add(p.key)}for(const d of o){l.push(d.batchId);for(const p of d.mutations)h=h.add(p.key)}return e.localDocuments.getDocuments(r,h).next((d=>({Ls:d,removedBatchIds:a,addedBatchIds:l})))}))}))}function tg(n,t){const e=U(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",(r=>{const s=t.batch.keys(),o=e.Ns.newChangeBuffer({trackRemovals:!0});return(function(l,h,d,p){const E=d.batch,A=E.keys();let P=R.resolve();return A.forEach((N=>{P=P.next((()=>p.getEntry(h,N))).next((M=>{const D=d.docVersions.get(N);Q(D!==null,48541),M.version.compareTo(D)<0&&(E.applyToRemoteDocument(M,d),M.isValidDocument()&&(M.setReadTime(d.commitVersion),p.addEntry(M)))}))})),P.next((()=>l.mutationQueue.removeMutationBatch(h,E)))})(e,r,t,o).next((()=>o.apply(r))).next((()=>e.mutationQueue.performConsistencyCheck(r))).next((()=>e.documentOverlayCache.removeOverlaysForBatchId(r,s,t.batch.batchId))).next((()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,(function(l){let h=$();for(let d=0;d<l.mutationResults.length;++d)l.mutationResults[d].transformResults.length>0&&(h=h.add(l.batch.mutations[d].key));return h})(t)))).next((()=>e.localDocuments.getDocuments(r,s)))}))}function Kl(n){const t=U(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Pi.getLastRemoteSnapshotVersion(e)))}function eg(n,t){const e=U(n),r=t.snapshotVersion;let s=e.Ms;return e.persistence.runTransaction("Apply remote event","readwrite-primary",(o=>{const a=e.Ns.newChangeBuffer({trackRemovals:!0});s=e.Ms;const l=[];t.targetChanges.forEach(((p,E)=>{const A=s.get(E);if(!A)return;l.push(e.Pi.removeMatchingKeys(o,p.removedDocuments,E).next((()=>e.Pi.addMatchingKeys(o,p.addedDocuments,E))));let P=A.withSequenceNumber(o.currentSequenceNumber);t.targetMismatches.get(E)!==null?P=P.withResumeToken(_t.EMPTY_BYTE_STRING,B.min()).withLastLimboFreeSnapshotVersion(B.min()):p.resumeToken.approximateByteSize()>0&&(P=P.withResumeToken(p.resumeToken,r)),s=s.insert(E,P),(function(M,D,G){return M.resumeToken.approximateByteSize()===0||D.snapshotVersion.toMicroseconds()-M.snapshotVersion.toMicroseconds()>=Jm?!0:G.addedDocuments.size+G.modifiedDocuments.size+G.removedDocuments.size>0})(A,P,p)&&l.push(e.Pi.updateTargetData(o,P))}));let h=Zt(),d=$();if(t.documentUpdates.forEach((p=>{t.resolvedLimboDocuments.has(p)&&l.push(e.persistence.referenceDelegate.updateLimboDocument(o,p))})),l.push(ng(o,a,t.documentUpdates).next((p=>{h=p.ks,d=p.qs}))),!r.isEqual(B.min())){const p=e.Pi.getLastRemoteSnapshotVersion(o).next((E=>e.Pi.setTargetsMetadata(o,o.currentSequenceNumber,r)));l.push(p)}return R.waitFor(l).next((()=>a.apply(o))).next((()=>e.localDocuments.getLocalViewOfDocuments(o,h,d))).next((()=>h))})).then((o=>(e.Ms=s,o)))}function ng(n,t,e){let r=$(),s=$();return e.forEach((o=>r=r.add(o))),t.getEntries(n,r).next((o=>{let a=Zt();return e.forEach(((l,h)=>{const d=o.get(l);h.isFoundDocument()!==d.isFoundDocument()&&(s=s.add(l)),h.isNoDocument()&&h.version.isEqual(B.min())?(t.removeEntry(l,h.readTime),a=a.insert(l,h)):!d.isValidDocument()||h.version.compareTo(d.version)>0||h.version.compareTo(d.version)===0&&d.hasPendingWrites?(t.addEntry(h),a=a.insert(l,h)):k(eo,"Ignoring outdated watch update for ",l,". Current version:",d.version," Watch version:",h.version)})),{ks:a,qs:s}}))}function rg(n,t){const e=U(n);return e.persistence.runTransaction("Get next mutation batch","readonly",(r=>(t===void 0&&(t=ji),e.mutationQueue.getNextMutationBatchAfterBatchId(r,t))))}function sg(n,t){const e=U(n);return e.persistence.runTransaction("Allocate target","readwrite",(r=>{let s;return e.Pi.getTargetData(r,t).next((o=>o?(s=o,R.resolve(s)):e.Pi.allocateTargetId(r).next((a=>(s=new oe(t,a,"TargetPurposeListen",r.currentSequenceNumber),e.Pi.addTargetData(r,s).next((()=>s)))))))})).then((r=>{const s=e.Ms.get(r.targetId);return(s===null||r.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.Ms=e.Ms.insert(r.targetId,r),e.xs.set(t,r.targetId)),r}))}async function Ti(n,t,e){const r=U(n),s=r.Ms.get(t),o=e?"readwrite":"readwrite-primary";try{e||await r.persistence.runTransaction("Release target",o,(a=>r.persistence.referenceDelegate.removeTarget(a,s)))}catch(a){if(!mn(a))throw a;k(eo,`Failed to update sequence numbers for target ${t}: ${a}`)}r.Ms=r.Ms.remove(t),r.xs.delete(s.target)}function gc(n,t,e){const r=U(n);let s=B.min(),o=$();return r.persistence.runTransaction("Execute query","readwrite",(a=>(function(h,d,p){const E=U(h),A=E.xs.get(p);return A!==void 0?R.resolve(E.Ms.get(A)):E.Pi.getTargetData(d,p)})(r,a,$t(t)).next((l=>{if(l)return s=l.lastLimboFreeSnapshotVersion,r.Pi.getMatchingKeysForTargetId(a,l.targetId).next((h=>{o=h}))})).next((()=>r.Fs.getDocumentsMatchingQuery(a,t,e?s:B.min(),e?o:$()))).next((l=>(ig(r,$f(t),l),{documents:l,Qs:o})))))}function ig(n,t,e){let r=n.Os.get(t)||B.min();e.forEach(((s,o)=>{o.readTime.compareTo(r)>0&&(r=o.readTime)})),n.Os.set(t,r)}class pc{constructor(){this.activeTargetIds=Qf()}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class og{constructor(){this.Mo=new pc,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,r){}addLocalQueryTarget(t,e=!0){return e&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,r){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new pc,Promise.resolve()}handleUserChange(t,e,r){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class ag{Oo(t){}shutdown(){}}const _c="ConnectivityMonitor";class yc{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){k(_c,"Network connectivity changed: AVAILABLE");for(const t of this.qo)t(0)}ko(){k(_c,"Network connectivity changed: UNAVAILABLE");for(const t of this.qo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Or=null;function vi(){return Or===null?Or=(function(){return 268435456+Math.round(2147483648*Math.random())})():Or++,"0x"+Or.toString(16)}const ti="RestConnection",cg={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class lg{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko=`projects/${r}/databases/${s}`,this.Wo=this.databaseId.database===Xr?`project_id=${r}`:`project_id=${r}&database_id=${s}`}Go(t,e,r,s,o){const a=vi(),l=this.zo(t,e.toUriEncodedString());k(ti,`Sending RPC '${t}' ${a}:`,l,r);const h={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(h,s,o);const{host:d}=new URL(l),p=Mi(d);return this.Jo(t,l,h,r,p).then((E=>(k(ti,`Received RPC '${t}' ${a}: `,E),E)),(E=>{throw rn(ti,`RPC '${t}' ${a} failed with error: `,E,"url: ",l,"request:",r),E}))}Ho(t,e,r,s,o,a){return this.Go(t,e,r,s,o)}jo(t,e,r){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+dn})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((s,o)=>t[o]=s)),r&&r.headers.forEach(((s,o)=>t[o]=s))}zo(t,e){const r=cg[t];return`${this.Uo}/v1/${e}:${r}`}terminate(){}}class ug{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}}const Et="WebChannelConnection";class hg extends lg{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,r,s,o){const a=vi();return new Promise(((l,h)=>{const d=new Jc;d.setWithCredentials(!0),d.listenOnce(Yc.COMPLETE,(()=>{try{switch(d.getLastErrorCode()){case xr.NO_ERROR:const E=d.getResponseJson();k(Et,`XHR for RPC '${t}' ${a} received:`,JSON.stringify(E)),l(E);break;case xr.TIMEOUT:k(Et,`RPC '${t}' ${a} timed out`),h(new O(C.DEADLINE_EXCEEDED,"Request time out"));break;case xr.HTTP_ERROR:const A=d.getStatus();if(k(Et,`RPC '${t}' ${a} failed with status:`,A,"response text:",d.getResponseText()),A>0){let P=d.getResponseJson();Array.isArray(P)&&(P=P[0]);const N=P?.error;if(N&&N.status&&N.message){const M=(function(G){const K=G.toLowerCase().replace(/_/g,"-");return Object.values(C).indexOf(K)>=0?K:C.UNKNOWN})(N.status);h(new O(M,N.message))}else h(new O(C.UNKNOWN,"Server responded with status "+d.getStatus()))}else h(new O(C.UNAVAILABLE,"Connection failed."));break;default:F(9055,{l_:t,streamId:a,h_:d.getLastErrorCode(),P_:d.getLastError()})}}finally{k(Et,`RPC '${t}' ${a} completed.`)}}));const p=JSON.stringify(s);k(Et,`RPC '${t}' ${a} sending request:`,s),d.send(e,"POST",p,r,15)}))}T_(t,e,r){const s=vi(),o=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],a=el(),l=tl(),h={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},d=this.longPollingOptions.timeoutSeconds;d!==void 0&&(h.longPollingTimeout=Math.round(1e3*d)),this.useFetchStreams&&(h.useFetchStreams=!0),this.jo(h.initMessageHeaders,e,r),h.encodeInitMessageHeaders=!0;const p=o.join("");k(Et,`Creating RPC '${t}' stream ${s}: ${p}`,h);const E=a.createWebChannel(p,h);this.I_(E);let A=!1,P=!1;const N=new ug({Yo:D=>{P?k(Et,`Not sending because RPC '${t}' stream ${s} is closed:`,D):(A||(k(Et,`Opening RPC '${t}' stream ${s} transport.`),E.open(),A=!0),k(Et,`RPC '${t}' stream ${s} sending:`,D),E.send(D))},Zo:()=>E.close()}),M=(D,G,K)=>{D.listen(G,(W=>{try{K(W)}catch(It){setTimeout((()=>{throw It}),0)}}))};return M(E,kn.EventType.OPEN,(()=>{P||(k(Et,`RPC '${t}' stream ${s} transport opened.`),N.o_())})),M(E,kn.EventType.CLOSE,(()=>{P||(P=!0,k(Et,`RPC '${t}' stream ${s} transport closed`),N.a_(),this.E_(E))})),M(E,kn.EventType.ERROR,(D=>{P||(P=!0,rn(Et,`RPC '${t}' stream ${s} transport errored. Name:`,D.name,"Message:",D.message),N.a_(new O(C.UNAVAILABLE,"The operation could not be completed")))})),M(E,kn.EventType.MESSAGE,(D=>{if(!P){const G=D.data[0];Q(!!G,16349);const K=G,W=K?.error||K[0]?.error;if(W){k(Et,`RPC '${t}' stream ${s} received error:`,W);const It=W.status;let Rt=(function(m){const _=st[m];if(_!==void 0)return Ol(_)})(It),ut=W.message;Rt===void 0&&(Rt=C.INTERNAL,ut="Unknown error status: "+It+" with message "+W.message),P=!0,N.a_(new O(Rt,ut)),E.close()}else k(Et,`RPC '${t}' stream ${s} received:`,G),N.u_(G)}})),M(l,Zc.STAT_EVENT,(D=>{D.stat===li.PROXY?k(Et,`RPC '${t}' stream ${s} detected buffering proxy`):D.stat===li.NOPROXY&&k(Et,`RPC '${t}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{N.__()}),0),N}terminate(){this.c_.forEach((t=>t.close())),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter((e=>e===t))}}function ei(){return typeof document<"u"?document:null}function Ts(n){return new gm(n,!0)}class Wl{constructor(t,e,r=1e3,s=1.5,o=6e4){this.Mi=t,this.timerId=e,this.d_=r,this.A_=s,this.R_=o,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();const e=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),s=Math.max(0,e-r);s>0&&k("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${e} ms, last attempt: ${r} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),t()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const Ec="PersistentStream";class Ql{constructor(t,e,r,s,o,a,l,h){this.Mi=t,this.S_=r,this.b_=s,this.connection=o,this.authCredentialsProvider=a,this.appCheckCredentialsProvider=l,this.listener=h,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Wl(t,e)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(t){this.Q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():e&&e.code===C.RESOURCE_EXHAUSTED?(Yt(e.toString()),Yt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===C.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.r_(e)}K_(){}auth(){this.state=1;const t=this.W_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([r,s])=>{this.D_===e&&this.G_(r,s)}),(r=>{t((()=>{const s=new O(C.UNKNOWN,"Fetching auth token failed: "+r.message);return this.z_(s)}))}))}G_(t,e){const r=this.W_(this.D_);this.stream=this.j_(t,e),this.stream.Xo((()=>{r((()=>this.listener.Xo()))})),this.stream.t_((()=>{r((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{r((()=>this.z_(s)))})),this.stream.onMessage((s=>{r((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(t){return k(Ec,`close with error: ${t}`),this.stream=null,this.close(4,t)}W_(t){return e=>{this.Mi.enqueueAndForget((()=>this.D_===t?e():(k(Ec,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class dg extends Ql{constructor(t,e,r,s,o,a){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,r,s,a),this.serializer=o}j_(t,e){return this.connection.T_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();const e=ym(this.serializer,t),r=(function(o){if(!("targetChange"in o))return B.min();const a=o.targetChange;return a.targetIds&&a.targetIds.length?B.min():a.readTime?zt(a.readTime):B.min()})(t);return this.listener.H_(e,r)}Y_(t){const e={};e.database=Ei(this.serializer),e.addTarget=(function(o,a){let l;const h=a.target;if(l=mi(h)?{documents:vm(o,h)}:{query:Im(o,h).ft},l.targetId=a.targetId,a.resumeToken.approximateByteSize()>0){l.resumeToken=xl(o,a.resumeToken);const d=pi(o,a.expectedCount);d!==null&&(l.expectedCount=d)}else if(a.snapshotVersion.compareTo(B.min())>0){l.readTime=es(o,a.snapshotVersion.toTimestamp());const d=pi(o,a.expectedCount);d!==null&&(l.expectedCount=d)}return l})(this.serializer,t);const r=Am(this.serializer,t);r&&(e.labels=r),this.q_(e)}Z_(t){const e={};e.database=Ei(this.serializer),e.removeTarget=t,this.q_(e)}}class fg extends Ql{constructor(t,e,r,s,o,a){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,r,s,a),this.serializer=o}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}J_(t){return Q(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,Q(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){Q(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const e=Tm(t.writeResults,t.commitTime),r=zt(t.commitTime);return this.listener.na(r,e)}ra(){const t={};t.database=Ei(this.serializer),this.q_(t)}ea(t){const e={streamToken:this.lastStreamToken,writes:t.map((r=>Em(this.serializer,r)))};this.q_(e)}}class mg{}class gg extends mg{constructor(t,e,r,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=r,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new O(C.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,r,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Go(t,_i(e,r),s,o,a))).catch((o=>{throw o.name==="FirebaseError"?(o.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new O(C.UNKNOWN,o.toString())}))}Ho(t,e,r,s,o){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([a,l])=>this.connection.Ho(t,_i(e,r),s,a,l,o))).catch((a=>{throw a.name==="FirebaseError"?(a.code===C.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),a):new O(C.UNKNOWN,a.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class pg{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(Yt(e),this.aa=!1):k("OnlineStateTracker",e)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Oe="RemoteStore";class _g{constructor(t,e,r,s,o){this.localStore=t,this.datastore=e,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=o,this.Aa.Oo((a=>{r.enqueueAndForget((async()=>{Be(this)&&(k(Oe,"Restarting streams for network reachability change."),await(async function(h){const d=U(h);d.Ea.add(4),await ur(d),d.Ra.set("Unknown"),d.Ea.delete(4),await vs(d)})(this))}))})),this.Ra=new pg(r,s)}}async function vs(n){if(Be(n))for(const t of n.da)await t(!0)}async function ur(n){for(const t of n.da)await t(!1)}function Xl(n,t){const e=U(n);e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),io(e)?so(e):gn(e).O_()&&ro(e,t))}function no(n,t){const e=U(n),r=gn(e);e.Ia.delete(t),r.O_()&&Jl(e,t),e.Ia.size===0&&(r.O_()?r.L_():Be(e)&&e.Ra.set("Unknown"))}function ro(n,t){if(n.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(B.min())>0){const e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}gn(n).Y_(t)}function Jl(n,t){n.Va.Ue(t),gn(n).Z_(t)}function so(n){n.Va=new hm({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),At:t=>n.Ia.get(t)||null,ht:()=>n.datastore.serializer.databaseId}),gn(n).start(),n.Ra.ua()}function io(n){return Be(n)&&!gn(n).x_()&&n.Ia.size>0}function Be(n){return U(n).Ea.size===0}function Yl(n){n.Va=void 0}async function yg(n){n.Ra.set("Online")}async function Eg(n){n.Ia.forEach(((t,e)=>{ro(n,t)}))}async function Tg(n,t){Yl(n),io(n)?(n.Ra.ha(t),so(n)):n.Ra.set("Unknown")}async function vg(n,t,e){if(n.Ra.set("Online"),t instanceof Ml&&t.state===2&&t.cause)try{await(async function(s,o){const a=o.cause;for(const l of o.targetIds)s.Ia.has(l)&&(await s.remoteSyncer.rejectListen(l,a),s.Ia.delete(l),s.Va.removeTarget(l))})(n,t)}catch(r){k(Oe,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await rs(n,r)}else if(t instanceof jr?n.Va.Ze(t):t instanceof Ll?n.Va.st(t):n.Va.tt(t),!e.isEqual(B.min()))try{const r=await Kl(n.localStore);e.compareTo(r)>=0&&await(function(o,a){const l=o.Va.Tt(a);return l.targetChanges.forEach(((h,d)=>{if(h.resumeToken.approximateByteSize()>0){const p=o.Ia.get(d);p&&o.Ia.set(d,p.withResumeToken(h.resumeToken,a))}})),l.targetMismatches.forEach(((h,d)=>{const p=o.Ia.get(h);if(!p)return;o.Ia.set(h,p.withResumeToken(_t.EMPTY_BYTE_STRING,p.snapshotVersion)),Jl(o,h);const E=new oe(p.target,h,d,p.sequenceNumber);ro(o,E)})),o.remoteSyncer.applyRemoteEvent(l)})(n,e)}catch(r){k(Oe,"Failed to raise snapshot:",r),await rs(n,r)}}async function rs(n,t,e){if(!mn(t))throw t;n.Ea.add(1),await ur(n),n.Ra.set("Offline"),e||(e=()=>Kl(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{k(Oe,"Retrying IndexedDB access"),await e(),n.Ea.delete(1),await vs(n)}))}function Zl(n,t){return t().catch((e=>rs(n,e,t)))}async function Is(n){const t=U(n),e=ye(t);let r=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:ji;for(;Ig(t);)try{const s=await rg(t.localStore,r);if(s===null){t.Ta.length===0&&e.L_();break}r=s.batchId,wg(t,s)}catch(s){await rs(t,s)}tu(t)&&eu(t)}function Ig(n){return Be(n)&&n.Ta.length<10}function wg(n,t){n.Ta.push(t);const e=ye(n);e.O_()&&e.X_&&e.ea(t.mutations)}function tu(n){return Be(n)&&!ye(n).x_()&&n.Ta.length>0}function eu(n){ye(n).start()}async function Ag(n){ye(n).ra()}async function Sg(n){const t=ye(n);for(const e of n.Ta)t.ea(e.mutations)}async function Rg(n,t,e){const r=n.Ta.shift(),s=Qi.from(r,t,e);await Zl(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await Is(n)}async function Cg(n,t){t&&ye(n).X_&&await(async function(r,s){if((function(a){return cm(a)&&a!==C.ABORTED})(s.code)){const o=r.Ta.shift();ye(r).B_(),await Zl(r,(()=>r.remoteSyncer.rejectFailedWrite(o.batchId,s))),await Is(r)}})(n,t),tu(n)&&eu(n)}async function Tc(n,t){const e=U(n);e.asyncQueue.verifyOperationInProgress(),k(Oe,"RemoteStore received new credentials");const r=Be(e);e.Ea.add(3),await ur(e),r&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await vs(e)}async function bg(n,t){const e=U(n);t?(e.Ea.delete(2),await vs(e)):t||(e.Ea.add(2),await ur(e),e.Ra.set("Unknown"))}function gn(n){return n.ma||(n.ma=(function(e,r,s){const o=U(e);return o.sa(),new dg(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:yg.bind(null,n),t_:Eg.bind(null,n),r_:Tg.bind(null,n),H_:vg.bind(null,n)}),n.da.push((async t=>{t?(n.ma.B_(),io(n)?so(n):n.Ra.set("Unknown")):(await n.ma.stop(),Yl(n))}))),n.ma}function ye(n){return n.fa||(n.fa=(function(e,r,s){const o=U(e);return o.sa(),new fg(r,o.connection,o.authCredentials,o.appCheckCredentials,o.serializer,s)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:Ag.bind(null,n),r_:Cg.bind(null,n),ta:Sg.bind(null,n),na:Rg.bind(null,n)}),n.da.push((async t=>{t?(n.fa.B_(),await Is(n)):(await n.fa.stop(),n.Ta.length>0&&(k(Oe,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class oo{constructor(t,e,r,s,o){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=r,this.op=s,this.removalCallback=o,this.deferred=new ue,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((a=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,r,s,o){const a=Date.now()+r,l=new oo(t,e,a,s,o);return l.start(r),l}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new O(C.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function ao(n,t){if(Yt("AsyncQueue",`${t}: ${n}`),mn(n))return new O(C.UNAVAILABLE,`${t}: ${n}`);throw n}class Xe{static emptySet(t){return new Xe(t.comparator)}constructor(t){this.comparator=t?(e,r)=>t(e,r)||L.comparator(e.key,r.key):(e,r)=>L.comparator(e.key,r.key),this.keyedMap=Nn(),this.sortedSet=new et(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,r)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Xe)||this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();for(;e.hasNext();){const s=e.getNext().key,o=r.getNext().key;if(!s.isEqual(o))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){const r=new Xe;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=e,r}}class vc{constructor(){this.ga=new et(L.comparator)}track(t){const e=t.doc.key,r=this.ga.get(e);r?t.type!==0&&r.type===3?this.ga=this.ga.insert(e,t):t.type===3&&r.type!==1?this.ga=this.ga.insert(e,{type:r.type,doc:t.doc}):t.type===2&&r.type===2?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):t.type===2&&r.type===0?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):t.type===1&&r.type===0?this.ga=this.ga.remove(e):t.type===1&&r.type===2?this.ga=this.ga.insert(e,{type:1,doc:r.doc}):t.type===0&&r.type===1?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):F(63341,{Rt:t,pa:r}):this.ga=this.ga.insert(e,t)}ya(){const t=[];return this.ga.inorderTraversal(((e,r)=>{t.push(r)})),t}}class ln{constructor(t,e,r,s,o,a,l,h,d){this.query=t,this.docs=e,this.oldDocs=r,this.docChanges=s,this.mutatedKeys=o,this.fromCache=a,this.syncStateChanged=l,this.excludesMetadataChanges=h,this.hasCachedResults=d}static fromInitialDocuments(t,e,r,s,o){const a=[];return e.forEach((l=>{a.push({type:0,doc:l})})),new ln(t,e,Xe.emptySet(e),a,r,s,!0,!1,o)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&gs(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,r=t.docChanges;if(e.length!==r.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==r[s].type||!e[s].doc.isEqual(r[s].doc))return!1;return!0}}class Pg{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((t=>t.Da()))}}class Vg{constructor(){this.queries=Ic(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(e,r){const s=U(e),o=s.queries;s.queries=Ic(),o.forEach(((a,l)=>{for(const h of l.Sa)h.onError(r)}))})(this,new O(C.ABORTED,"Firestore shutting down"))}}function Ic(){return new xe((n=>Il(n)),gs)}async function nu(n,t){const e=U(n);let r=3;const s=t.query;let o=e.queries.get(s);o?!o.ba()&&t.Da()&&(r=2):(o=new Pg,r=t.Da()?0:1);try{switch(r){case 0:o.wa=await e.onListen(s,!0);break;case 1:o.wa=await e.onListen(s,!1);break;case 2:await e.onFirstRemoteStoreListen(s)}}catch(a){const l=ao(a,`Initialization of query '${ze(t.query)}' failed`);return void t.onError(l)}e.queries.set(s,o),o.Sa.push(t),t.va(e.onlineState),o.wa&&t.Fa(o.wa)&&co(e)}async function ru(n,t){const e=U(n),r=t.query;let s=3;const o=e.queries.get(r);if(o){const a=o.Sa.indexOf(t);a>=0&&(o.Sa.splice(a,1),o.Sa.length===0?s=t.Da()?0:1:!o.ba()&&t.Da()&&(s=2))}switch(s){case 0:return e.queries.delete(r),e.onUnlisten(r,!0);case 1:return e.queries.delete(r),e.onUnlisten(r,!1);case 2:return e.onLastRemoteStoreUnlisten(r);default:return}}function Dg(n,t){const e=U(n);let r=!1;for(const s of t){const o=s.query,a=e.queries.get(o);if(a){for(const l of a.Sa)l.Fa(s)&&(r=!0);a.wa=s}}r&&co(e)}function kg(n,t,e){const r=U(n),s=r.queries.get(t);if(s)for(const o of s.Sa)o.onError(e);r.queries.delete(t)}function co(n){n.Ca.forEach((t=>{t.next()}))}var Ii,wc;(wc=Ii||(Ii={})).Ma="default",wc.Cache="cache";class su{constructor(t,e,r){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(t){if(!this.options.includeMetadataChanges){const r=[];for(const s of t.docChanges)s.type!==3&&r.push(s);t=new ln(t.query,t.docs,t.oldDocs,r,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache||!this.Da())return!0;const r=e!=="Offline";return(!this.options.qa||!r)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Ba(t){if(t.docChanges.length>0)return!0;const e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}ka(t){t=ln.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==Ii.Cache}}class iu{constructor(t){this.key=t}}class ou{constructor(t){this.key=t}}class Ng{constructor(t,e){this.query=t,this.Ya=e,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=$(),this.mutatedKeys=$(),this.eu=wl(t),this.tu=new Xe(this.eu)}get nu(){return this.Ya}ru(t,e){const r=e?e.iu:new vc,s=e?e.tu:this.tu;let o=e?e.mutatedKeys:this.mutatedKeys,a=s,l=!1;const h=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,d=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((p,E)=>{const A=s.get(p),P=ps(this.query,E)?E:null,N=!!A&&this.mutatedKeys.has(A.key),M=!!P&&(P.hasLocalMutations||this.mutatedKeys.has(P.key)&&P.hasCommittedMutations);let D=!1;A&&P?A.data.isEqual(P.data)?N!==M&&(r.track({type:3,doc:P}),D=!0):this.su(A,P)||(r.track({type:2,doc:P}),D=!0,(h&&this.eu(P,h)>0||d&&this.eu(P,d)<0)&&(l=!0)):!A&&P?(r.track({type:0,doc:P}),D=!0):A&&!P&&(r.track({type:1,doc:A}),D=!0,(h||d)&&(l=!0)),D&&(P?(a=a.add(P),o=M?o.add(p):o.delete(p)):(a=a.delete(p),o=o.delete(p)))})),this.query.limit!==null)for(;a.size>this.query.limit;){const p=this.query.limitType==="F"?a.last():a.first();a=a.delete(p.key),o=o.delete(p.key),r.track({type:1,doc:p})}return{tu:a,iu:r,Cs:l,mutatedKeys:o}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,r,s){const o=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const a=t.iu.ya();a.sort(((p,E)=>(function(P,N){const M=D=>{switch(D){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return F(20277,{Rt:D})}};return M(P)-M(N)})(p.type,E.type)||this.eu(p.doc,E.doc))),this.ou(r),s=s??!1;const l=e&&!s?this._u():[],h=this.Xa.size===0&&this.current&&!s?1:0,d=h!==this.Za;return this.Za=h,a.length!==0||d?{snapshot:new ln(this.query,t.tu,o,a,t.mutatedKeys,h===0,d,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:l}:{au:l}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new vc,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach((e=>this.Ya=this.Ya.add(e))),t.modifiedDocuments.forEach((e=>{})),t.removedDocuments.forEach((e=>this.Ya=this.Ya.delete(e))),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Xa;this.Xa=$(),this.tu.forEach((r=>{this.uu(r.key)&&(this.Xa=this.Xa.add(r.key))}));const e=[];return t.forEach((r=>{this.Xa.has(r)||e.push(new ou(r))})),this.Xa.forEach((r=>{t.has(r)||e.push(new iu(r))})),e}cu(t){this.Ya=t.Qs,this.Xa=$();const e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return ln.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const lo="SyncEngine";class Og{constructor(t,e,r){this.query=t,this.targetId=e,this.view=r}}class Lg{constructor(t){this.key=t,this.hu=!1}}class Mg{constructor(t,e,r,s,o,a){this.localStore=t,this.remoteStore=e,this.eventManager=r,this.sharedClientState=s,this.currentUser=o,this.maxConcurrentLimboResolutions=a,this.Pu={},this.Tu=new xe((l=>Il(l)),gs),this.Iu=new Map,this.Eu=new Set,this.du=new et(L.comparator),this.Au=new Map,this.Ru=new Yi,this.Vu={},this.mu=new Map,this.fu=cn.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function xg(n,t,e=!0){const r=du(n);let s;const o=r.Tu.get(t);return o?(r.sharedClientState.addLocalQueryTarget(o.targetId),s=o.view.lu()):s=await au(r,t,e,!0),s}async function Fg(n,t){const e=du(n);await au(e,t,!0,!1)}async function au(n,t,e,r){const s=await sg(n.localStore,$t(t)),o=s.targetId,a=n.sharedClientState.addLocalQueryTarget(o,e);let l;return r&&(l=await Bg(n,t,o,a==="current",s.resumeToken)),n.isPrimaryClient&&e&&Xl(n.remoteStore,s),l}async function Bg(n,t,e,r,s){n.pu=(E,A,P)=>(async function(M,D,G,K){let W=D.view.ru(G);W.Cs&&(W=await gc(M.localStore,D.query,!1).then((({documents:T})=>D.view.ru(T,W))));const It=K&&K.targetChanges.get(D.targetId),Rt=K&&K.targetMismatches.get(D.targetId)!=null,ut=D.view.applyChanges(W,M.isPrimaryClient,It,Rt);return Sc(M,D.targetId,ut.au),ut.snapshot})(n,E,A,P);const o=await gc(n.localStore,t,!0),a=new Ng(t,o.Qs),l=a.ru(o.documents),h=lr.createSynthesizedTargetChangeForCurrentChange(e,r&&n.onlineState!=="Offline",s),d=a.applyChanges(l,n.isPrimaryClient,h);Sc(n,e,d.au);const p=new Og(t,e,a);return n.Tu.set(t,p),n.Iu.has(e)?n.Iu.get(e).push(t):n.Iu.set(e,[t]),d.snapshot}async function Ug(n,t,e){const r=U(n),s=r.Tu.get(t),o=r.Iu.get(s.targetId);if(o.length>1)return r.Iu.set(s.targetId,o.filter((a=>!gs(a,t)))),void r.Tu.delete(t);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(s.targetId),r.sharedClientState.isActiveQueryTarget(s.targetId)||await Ti(r.localStore,s.targetId,!1).then((()=>{r.sharedClientState.clearQueryState(s.targetId),e&&no(r.remoteStore,s.targetId),wi(r,s.targetId)})).catch(fn)):(wi(r,s.targetId),await Ti(r.localStore,s.targetId,!0))}async function jg(n,t){const e=U(n),r=e.Tu.get(t),s=e.Iu.get(r.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(r.targetId),no(e.remoteStore,r.targetId))}async function qg(n,t,e){const r=Qg(n);try{const s=await(function(a,l){const h=U(a),d=Z.now(),p=l.reduce(((P,N)=>P.add(N.key)),$());let E,A;return h.persistence.runTransaction("Locally write mutations","readwrite",(P=>{let N=Zt(),M=$();return h.Ns.getEntries(P,p).next((D=>{N=D,N.forEach(((G,K)=>{K.isValidDocument()||(M=M.add(G))}))})).next((()=>h.localDocuments.getOverlayedDocuments(P,N))).next((D=>{E=D;const G=[];for(const K of l){const W=rm(K,E.get(K.key).overlayedDocument);W!=null&&G.push(new Fe(K.key,W,gl(W.value.mapValue),Ft.exists(!0)))}return h.mutationQueue.addMutationBatch(P,d,G,l)})).next((D=>{A=D;const G=D.applyToLocalDocumentSet(E,M);return h.documentOverlayCache.saveOverlays(P,D.batchId,G)}))})).then((()=>({batchId:A.batchId,changes:Sl(E)})))})(r.localStore,t);r.sharedClientState.addPendingMutation(s.batchId),(function(a,l,h){let d=a.Vu[a.currentUser.toKey()];d||(d=new et(q)),d=d.insert(l,h),a.Vu[a.currentUser.toKey()]=d})(r,s.batchId,e),await hr(r,s.changes),await Is(r.remoteStore)}catch(s){const o=ao(s,"Failed to persist write");e.reject(o)}}async function cu(n,t){const e=U(n);try{const r=await eg(e.localStore,t);t.targetChanges.forEach(((s,o)=>{const a=e.Au.get(o);a&&(Q(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?a.hu=!0:s.modifiedDocuments.size>0?Q(a.hu,14607):s.removedDocuments.size>0&&(Q(a.hu,42227),a.hu=!1))})),await hr(e,r,t)}catch(r){await fn(r)}}function Ac(n,t,e){const r=U(n);if(r.isPrimaryClient&&e===0||!r.isPrimaryClient&&e===1){const s=[];r.Tu.forEach(((o,a)=>{const l=a.view.va(t);l.snapshot&&s.push(l.snapshot)})),(function(a,l){const h=U(a);h.onlineState=l;let d=!1;h.queries.forEach(((p,E)=>{for(const A of E.Sa)A.va(l)&&(d=!0)})),d&&co(h)})(r.eventManager,t),s.length&&r.Pu.H_(s),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}async function $g(n,t,e){const r=U(n);r.sharedClientState.updateQueryState(t,"rejected",e);const s=r.Au.get(t),o=s&&s.key;if(o){let a=new et(L.comparator);a=a.insert(o,vt.newNoDocument(o,B.min()));const l=$().add(o),h=new Es(B.min(),new Map,new et(q),a,l);await cu(r,h),r.du=r.du.remove(o),r.Au.delete(t),uo(r)}else await Ti(r.localStore,t,!1).then((()=>wi(r,t,e))).catch(fn)}async function zg(n,t){const e=U(n),r=t.batch.batchId;try{const s=await tg(e.localStore,t);uu(e,r,null),lu(e,r),e.sharedClientState.updateMutationState(r,"acknowledged"),await hr(e,s)}catch(s){await fn(s)}}async function Hg(n,t,e){const r=U(n);try{const s=await(function(a,l){const h=U(a);return h.persistence.runTransaction("Reject batch","readwrite-primary",(d=>{let p;return h.mutationQueue.lookupMutationBatch(d,l).next((E=>(Q(E!==null,37113),p=E.keys(),h.mutationQueue.removeMutationBatch(d,E)))).next((()=>h.mutationQueue.performConsistencyCheck(d))).next((()=>h.documentOverlayCache.removeOverlaysForBatchId(d,p,l))).next((()=>h.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(d,p))).next((()=>h.localDocuments.getDocuments(d,p)))}))})(r.localStore,t);uu(r,t,e),lu(r,t),r.sharedClientState.updateMutationState(t,"rejected",e),await hr(r,s)}catch(s){await fn(s)}}function lu(n,t){(n.mu.get(t)||[]).forEach((e=>{e.resolve()})),n.mu.delete(t)}function uu(n,t,e){const r=U(n);let s=r.Vu[r.currentUser.toKey()];if(s){const o=s.get(t);o&&(e?o.reject(e):o.resolve(),s=s.remove(t)),r.Vu[r.currentUser.toKey()]=s}}function wi(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(const r of n.Iu.get(t))n.Tu.delete(r),e&&n.Pu.yu(r,e);n.Iu.delete(t),n.isPrimaryClient&&n.Ru.jr(t).forEach((r=>{n.Ru.containsKey(r)||hu(n,r)}))}function hu(n,t){n.Eu.delete(t.path.canonicalString());const e=n.du.get(t);e!==null&&(no(n.remoteStore,e),n.du=n.du.remove(t),n.Au.delete(e),uo(n))}function Sc(n,t,e){for(const r of e)r instanceof iu?(n.Ru.addReference(r.key,t),Gg(n,r)):r instanceof ou?(k(lo,"Document no longer in limbo: "+r.key),n.Ru.removeReference(r.key,t),n.Ru.containsKey(r.key)||hu(n,r.key)):F(19791,{wu:r})}function Gg(n,t){const e=t.key,r=e.path.canonicalString();n.du.get(e)||n.Eu.has(r)||(k(lo,"New document in limbo: "+e),n.Eu.add(r),uo(n))}function uo(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const t=n.Eu.values().next().value;n.Eu.delete(t);const e=new L(Y.fromString(t)),r=n.fu.next();n.Au.set(r,new Lg(e)),n.du=n.du.insert(e,r),Xl(n.remoteStore,new oe($t(Gi(e.path)),r,"TargetPurposeLimboResolution",hs.ce))}}async function hr(n,t,e){const r=U(n),s=[],o=[],a=[];r.Tu.isEmpty()||(r.Tu.forEach(((l,h)=>{a.push(r.pu(h,t,e).then((d=>{if((d||e)&&r.isPrimaryClient){const p=d?!d.fromCache:e?.targetChanges.get(h.targetId)?.current;r.sharedClientState.updateQueryState(h.targetId,p?"current":"not-current")}if(d){s.push(d);const p=to.As(h.targetId,d);o.push(p)}})))})),await Promise.all(a),r.Pu.H_(s),await(async function(h,d){const p=U(h);try{await p.persistence.runTransaction("notifyLocalViewChanges","readwrite",(E=>R.forEach(d,(A=>R.forEach(A.Es,(P=>p.persistence.referenceDelegate.addReference(E,A.targetId,P))).next((()=>R.forEach(A.ds,(P=>p.persistence.referenceDelegate.removeReference(E,A.targetId,P)))))))))}catch(E){if(!mn(E))throw E;k(eo,"Failed to update sequence numbers: "+E)}for(const E of d){const A=E.targetId;if(!E.fromCache){const P=p.Ms.get(A),N=P.snapshotVersion,M=P.withLastLimboFreeSnapshotVersion(N);p.Ms=p.Ms.insert(A,M)}}})(r.localStore,o))}async function Kg(n,t){const e=U(n);if(!e.currentUser.isEqual(t)){k(lo,"User change. New user:",t.toKey());const r=await Gl(e.localStore,t);e.currentUser=t,(function(o,a){o.mu.forEach((l=>{l.forEach((h=>{h.reject(new O(C.CANCELLED,a))}))})),o.mu.clear()})(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,r.removedBatchIds,r.addedBatchIds),await hr(e,r.Ls)}}function Wg(n,t){const e=U(n),r=e.Au.get(t);if(r&&r.hu)return $().add(r.key);{let s=$();const o=e.Iu.get(t);if(!o)return s;for(const a of o){const l=e.Tu.get(a);s=s.unionWith(l.view.nu)}return s}}function du(n){const t=U(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=cu.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Wg.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=$g.bind(null,t),t.Pu.H_=Dg.bind(null,t.eventManager),t.Pu.yu=kg.bind(null,t.eventManager),t}function Qg(n){const t=U(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=zg.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Hg.bind(null,t),t}class ss{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=Ts(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,e){return null}Mu(t,e){return null}vu(t){return Zm(this.persistence,new Xm,t.initialUser,this.serializer)}Cu(t){return new Hl(Zi.mi,this.serializer)}Du(t){return new og}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}ss.provider={build:()=>new ss};class Xg extends ss{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){Q(this.persistence.referenceDelegate instanceof ns,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new Lm(r,t.asyncQueue,e)}Cu(t){const e=this.cacheSizeBytes!==void 0?bt.withCacheSize(this.cacheSizeBytes):bt.DEFAULT;return new Hl((r=>ns.mi(r,e)),this.serializer)}}class Ai{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>Ac(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=Kg.bind(null,this.syncEngine),await bg(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return(function(){return new Vg})()}createDatastore(t){const e=Ts(t.databaseInfo.databaseId),r=(function(o){return new hg(o)})(t.databaseInfo);return(function(o,a,l,h){return new gg(o,a,l,h)})(t.authCredentials,t.appCheckCredentials,r,e)}createRemoteStore(t){return(function(r,s,o,a,l){return new _g(r,s,o,a,l)})(this.localStore,this.datastore,t.asyncQueue,(e=>Ac(this.syncEngine,e,0)),(function(){return yc.v()?new yc:new ag})())}createSyncEngine(t,e){return(function(s,o,a,l,h,d,p){const E=new Mg(s,o,a,l,h,d);return p&&(E.gu=!0),E})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){await(async function(e){const r=U(e);k(Oe,"RemoteStore shutting down."),r.Ea.add(5),await ur(r),r.Aa.shutdown(),r.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Ai.provider={build:()=>new Ai};class fu{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):Yt("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout((()=>{this.muted||t(e)}),0)}}const Ee="FirestoreClient";class Jg{constructor(t,e,r,s,o){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=r,this.databaseInfo=s,this.user=Tt.UNAUTHENTICATED,this.clientId=Bi.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=o,this.authCredentials.start(r,(async a=>{k(Ee,"Received user=",a.uid),await this.authCredentialListener(a),this.user=a})),this.appCheckCredentials.start(r,(a=>(k(Ee,"Received new app check token=",a),this.appCheckCredentialListener(a,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new ue;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const r=ao(e,"Failed to shutdown persistence");t.reject(r)}})),t.promise}}async function ni(n,t){n.asyncQueue.verifyOperationInProgress(),k(Ee,"Initializing OfflineComponentProvider");const e=n.configuration;await t.initialize(e);let r=e.initialUser;n.setCredentialChangeListener((async s=>{r.isEqual(s)||(await Gl(t.localStore,s),r=s)})),t.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=t}async function Rc(n,t){n.asyncQueue.verifyOperationInProgress();const e=await Yg(n);k(Ee,"Initializing OnlineComponentProvider"),await t.initialize(e,n.configuration),n.setCredentialChangeListener((r=>Tc(t.remoteStore,r))),n.setAppCheckTokenChangeListener(((r,s)=>Tc(t.remoteStore,s))),n._onlineComponents=t}async function Yg(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){k(Ee,"Using user provided OfflineComponentProvider");try{await ni(n,n._uninitializedComponentsProvider._offline)}catch(t){const e=t;if(!(function(s){return s.name==="FirebaseError"?s.code===C.FAILED_PRECONDITION||s.code===C.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(e))throw e;rn("Error using user provided cache. Falling back to memory cache: "+e),await ni(n,new ss)}}else k(Ee,"Using default OfflineComponentProvider"),await ni(n,new Xg(void 0));return n._offlineComponents}async function mu(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(k(Ee,"Using user provided OnlineComponentProvider"),await Rc(n,n._uninitializedComponentsProvider._online)):(k(Ee,"Using default OnlineComponentProvider"),await Rc(n,new Ai))),n._onlineComponents}function Zg(n){return mu(n).then((t=>t.syncEngine))}async function Si(n){const t=await mu(n),e=t.eventManager;return e.onListen=xg.bind(null,t.syncEngine),e.onUnlisten=Ug.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=Fg.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=jg.bind(null,t.syncEngine),e}function tp(n,t,e={}){const r=new ue;return n.asyncQueue.enqueueAndForget((async()=>(function(o,a,l,h,d){const p=new fu({next:A=>{p.Nu(),a.enqueueAndForget((()=>ru(o,E))),A.fromCache&&h.source==="server"?d.reject(new O(C.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):d.resolve(A)},error:A=>d.reject(A)}),E=new su(l,p,{includeMetadataChanges:!0,qa:!0});return nu(o,E)})(await Si(n),n.asyncQueue,t,e,r))),r.promise}function gu(n){const t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}const Cc=new Map;const pu="firestore.googleapis.com",bc=!0;class Pc{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new O(C.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=pu,this.ssl=bc}else this.host=t.host,this.ssl=t.ssl??bc;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=zl;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<Nm)throw new O(C.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}gf("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=gu(t.experimentalLongPollingOptions??{}),(function(r){if(r.timeoutSeconds!==void 0){if(isNaN(r.timeoutSeconds))throw new O(C.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (must not be NaN)`);if(r.timeoutSeconds<5)throw new O(C.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (minimum allowed value is 5)`);if(r.timeoutSeconds>30)throw new O(C.INVALID_ARGUMENT,`invalid long polling timeout: ${r.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(function(r,s){return r.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class ws{constructor(t,e,r,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=r,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Pc({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new O(C.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new O(C.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Pc(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=(function(r){if(!r)return new sf;switch(r.type){case"firstParty":return new lf(r.sessionIndex||"0",r.iamToken||null,r.authTokenFactory||null);case"provider":return r.client;default:throw new O(C.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(e){const r=Cc.get(e);r&&(k("ComponentProvider","Removing Datastore"),Cc.delete(e),r.terminate())})(this),Promise.resolve()}}function ep(n,t,e,r={}){n=qt(n,ws);const s=Mi(t),o=n._getSettings(),a={...o,emulatorOptions:n._getEmulatorOptions()},l=`${t}:${e}`;s&&(Dh(`https://${l}`),Lh("Firestore",!0)),o.host!==pu&&o.host!==l&&rn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const h={...o,host:l,ssl:s,emulatorOptions:r};if(!Gr(h,a)&&(n._setSettings(h),r.mockUserToken)){let d,p;if(typeof r.mockUserToken=="string")d=r.mockUserToken,p=Tt.MOCK_USER;else{d=kh(r.mockUserToken,n._app?.options.projectId);const E=r.mockUserToken.sub||r.mockUserToken.user_id;if(!E)throw new O(C.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");p=new Tt(E)}n._authCredentials=new of(new rl(d,p))}}class dr{constructor(t,e,r){this.converter=e,this._query=r,this.type="query",this.firestore=t}withConverter(t){return new dr(this.firestore,t,this._query)}}class ct{constructor(t,e,r){this.converter=e,this._key=r,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new he(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new ct(this.firestore,t,this._key)}toJSON(){return{type:ct._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,r){if(ar(e,ct._jsonSchema))return new ct(t,r||null,new L(Y.fromString(e.referencePath)))}}ct._jsonSchemaVersion="firestore/documentReference/1.0",ct._jsonSchema={type:it("string",ct._jsonSchemaVersion),referencePath:it("string")};class he extends dr{constructor(t,e,r){super(t,e,Gi(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new ct(this.firestore,null,new L(t))}withConverter(t){return new he(this.firestore,t,this._path)}}function jn(n,t,...e){if(n=nn(n),sl("collection","path",t),n instanceof ws){const r=Y.fromString(t,...e);return $a(r),new he(n,null,r)}{if(!(n instanceof ct||n instanceof he))throw new O(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Y.fromString(t,...e));return $a(r),new he(n.firestore,null,r)}}function un(n,t,...e){if(n=nn(n),arguments.length===1&&(t=Bi.newId()),sl("doc","path",t),n instanceof ws){const r=Y.fromString(t,...e);return qa(r),new ct(n,null,new L(r))}{if(!(n instanceof ct||n instanceof he))throw new O(C.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=n._path.child(Y.fromString(t,...e));return qa(r),new ct(n.firestore,n instanceof he?n.converter:null,new L(r))}}const Vc="AsyncQueue";class Dc{constructor(t=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Wl(this,"async_queue_retry"),this._c=()=>{const r=ei();r&&k(Vc,"Visibility state changed to "+r.visibilityState),this.M_.w_()},this.ac=t;const e=ei();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const e=ei();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise((()=>{}));const e=new ue;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Xu.push(t),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!mn(t))throw t;k(Vc,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(t){const e=this.ac.then((()=>(this.rc=!0,t().catch((r=>{throw this.nc=r,this.rc=!1,Yt("INTERNAL UNHANDLED ERROR: ",kc(r)),r})).then((r=>(this.rc=!1,r))))));return this.ac=e,e}enqueueAfterDelay(t,e,r){this.uc(),this.oc.indexOf(t)>-1&&(e=0);const s=oo.createAndSchedule(this,t,e,r,(o=>this.hc(o)));return this.tc.push(s),s}uc(){this.nc&&F(47125,{Pc:kc(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do t=this.ac,await t;while(t!==this.ac)}Ic(t){for(const e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then((()=>{this.tc.sort(((e,r)=>e.targetTimeMs-r.targetTimeMs));for(const e of this.tc)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Tc()}))}dc(t){this.oc.push(t)}hc(t){const e=this.tc.indexOf(t);this.tc.splice(e,1)}}function kc(n){let t=n.message||"";return n.stack&&(t=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),t}function Nc(n){return(function(e,r){if(typeof e!="object"||e===null)return!1;const s=e;for(const o of r)if(o in s&&typeof s[o]=="function")return!0;return!1})(n,["next","error","complete"])}class Le extends ws{constructor(t,e,r,s){super(t,e,r,s),this.type="firestore",this._queue=new Dc,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new Dc(t),this._firestoreClient=void 0,await t}}}function np(n,t){const e=typeof n=="object"?n:Hd(),r=typeof n=="string"?n:Xr,s=Ud(e,"firestore").getImmediate({identifier:r});if(!s._initialized){const o=Ph("firestore");o&&ep(s,...o)}return s}function ho(n){if(n._terminated)throw new O(C.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||rp(n),n._firestoreClient}function rp(n){const t=n._freezeSettings(),e=(function(s,o,a,l){return new Rf(s,o,a,l.host,l.ssl,l.experimentalForceLongPolling,l.experimentalAutoDetectLongPolling,gu(l.experimentalLongPollingOptions),l.useFetchStreams,l.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,t);n._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),n._firestoreClient=new Jg(n._authCredentials,n._appCheckCredentials,n._queue,e,n._componentsProvider&&(function(s){const o=s?._online.build();return{_offline:s?._offline.build(o),_online:o}})(n._componentsProvider))}class Nt{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Nt(_t.fromBase64String(t))}catch(e){throw new O(C.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new Nt(_t.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:Nt._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(ar(t,Nt._jsonSchema))return Nt.fromBase64String(t.bytes)}}Nt._jsonSchemaVersion="firestore/bytes/1.0",Nt._jsonSchema={type:it("string",Nt._jsonSchemaVersion),bytes:it("string")};class fo{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new O(C.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new pt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class mo{constructor(t){this._methodName=t}}class Ht{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new O(C.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new O(C.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return q(this._lat,t._lat)||q(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:Ht._jsonSchemaVersion}}static fromJSON(t){if(ar(t,Ht._jsonSchema))return new Ht(t.latitude,t.longitude)}}Ht._jsonSchemaVersion="firestore/geoPoint/1.0",Ht._jsonSchema={type:it("string",Ht._jsonSchemaVersion),latitude:it("number"),longitude:it("number")};class Gt{constructor(t){this._values=(t||[]).map((e=>e))}toArray(){return this._values.map((t=>t))}isEqual(t){return(function(r,s){if(r.length!==s.length)return!1;for(let o=0;o<r.length;++o)if(r[o]!==s[o])return!1;return!0})(this._values,t._values)}toJSON(){return{type:Gt._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(ar(t,Gt._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every((e=>typeof e=="number")))return new Gt(t.vectorValues);throw new O(C.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Gt._jsonSchemaVersion="firestore/vectorValue/1.0",Gt._jsonSchema={type:it("string",Gt._jsonSchemaVersion),vectorValues:it("object")};const sp=/^__.*__$/;class ip{constructor(t,e,r){this.data=t,this.fieldMask=e,this.fieldTransforms=r}toMutation(t,e){return this.fieldMask!==null?new Fe(t,this.data,this.fieldMask,e,this.fieldTransforms):new cr(t,this.data,e,this.fieldTransforms)}}function _u(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw F(40011,{Ac:n})}}class go{constructor(t,e,r,s,o,a){this.settings=t,this.databaseId=e,this.serializer=r,this.ignoreUndefinedProperties=s,o===void 0&&this.Rc(),this.fieldTransforms=o||[],this.fieldMask=a||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new go({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(t){const e=this.path?.child(t),r=this.Vc({path:e,fc:!1});return r.gc(t),r}yc(t){const e=this.path?.child(t),r=this.Vc({path:e,fc:!1});return r.Rc(),r}wc(t){return this.Vc({path:void 0,fc:!0})}Sc(t){return is(t,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return this.fieldMask.find((e=>t.isPrefixOf(e)))!==void 0||this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))!==void 0}Rc(){if(this.path)for(let t=0;t<this.path.length;t++)this.gc(this.path.get(t))}gc(t){if(t.length===0)throw this.Sc("Document fields must not be empty");if(_u(this.Ac)&&sp.test(t))throw this.Sc('Document fields cannot begin and end with "__"')}}class op{constructor(t,e,r){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=r||Ts(t)}Cc(t,e,r,s=!1){return new go({Ac:t,methodName:e,Dc:r,path:pt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function yu(n){const t=n._freezeSettings(),e=Ts(n._databaseId);return new op(n._databaseId,!!t.ignoreUndefinedProperties,e)}function Eu(n,t,e,r,s,o={}){const a=n.Cc(o.merge||o.mergeFields?2:0,t,e,s);wu("Data must be an object, but it was:",a,r);const l=vu(r,a);let h,d;if(o.merge)h=new xt(a.fieldMask),d=a.fieldTransforms;else if(o.mergeFields){const p=[];for(const E of o.mergeFields){const A=ap(t,E,e);if(!a.contains(A))throw new O(C.INVALID_ARGUMENT,`Field '${A}' is specified in your field mask but missing from your input data.`);lp(p,A)||p.push(A)}h=new xt(p),d=a.fieldTransforms.filter((E=>h.covers(E.field)))}else h=null,d=a.fieldTransforms;return new ip(new kt(l),h,d)}class po extends mo{_toFieldTransform(t){return new Zf(t.path,new Xn)}isEqual(t){return t instanceof po}}function Tu(n,t){if(Iu(n=nn(n)))return wu("Unsupported field value:",t,n),vu(n,t);if(n instanceof mo)return(function(r,s){if(!_u(s.Ac))throw s.Sc(`${r._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${r._methodName}() is not currently supported inside arrays`);const o=r._toFieldTransform(s);o&&s.fieldTransforms.push(o)})(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.fc&&t.Ac!==4)throw t.Sc("Nested arrays are not supported");return(function(r,s){const o=[];let a=0;for(const l of r){let h=Tu(l,s.wc(a));h==null&&(h={nullValue:"NULL_VALUE"}),o.push(h),a++}return{arrayValue:{values:o}}})(n,t)}return(function(r,s){if((r=nn(r))===null)return{nullValue:"NULL_VALUE"};if(typeof r=="number")return Xf(s.serializer,r);if(typeof r=="boolean")return{booleanValue:r};if(typeof r=="string")return{stringValue:r};if(r instanceof Date){const o=Z.fromDate(r);return{timestampValue:es(s.serializer,o)}}if(r instanceof Z){const o=new Z(r.seconds,1e3*Math.floor(r.nanoseconds/1e3));return{timestampValue:es(s.serializer,o)}}if(r instanceof Ht)return{geoPointValue:{latitude:r.latitude,longitude:r.longitude}};if(r instanceof Nt)return{bytesValue:xl(s.serializer,r._byteString)};if(r instanceof ct){const o=s.databaseId,a=r.firestore._databaseId;if(!a.isEqual(o))throw s.Sc(`Document reference is for database ${a.projectId}/${a.database} but should be for database ${o.projectId}/${o.database}`);return{referenceValue:Ji(r.firestore._databaseId||s.databaseId,r._key.path)}}if(r instanceof Gt)return(function(a,l){return{mapValue:{fields:{[fl]:{stringValue:ml},[Jr]:{arrayValue:{values:a.toArray().map((d=>{if(typeof d!="number")throw l.Sc("VectorValues must only contain numeric values.");return Ki(l.serializer,d)}))}}}}}})(r,s);throw s.Sc(`Unsupported field value: ${Ui(r)}`)})(n,t)}function vu(n,t){const e={};return al(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Me(n,((r,s)=>{const o=Tu(s,t.mc(r));o!=null&&(e[r]=o)})),{mapValue:{fields:e}}}function Iu(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof Z||n instanceof Ht||n instanceof Nt||n instanceof ct||n instanceof mo||n instanceof Gt)}function wu(n,t,e){if(!Iu(e)||!il(e)){const r=Ui(e);throw r==="an object"?t.Sc(n+" a custom object"):t.Sc(n+" "+r)}}function ap(n,t,e){if((t=nn(t))instanceof fo)return t._internalPath;if(typeof t=="string")return Au(n,t);throw is("Field path arguments must be of type string or ",n,!1,void 0,e)}const cp=new RegExp("[~\\*/\\[\\]]");function Au(n,t,e){if(t.search(cp)>=0)throw is(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new fo(...t.split("."))._internalPath}catch{throw is(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function is(n,t,e,r,s){const o=r&&!r.isEmpty(),a=s!==void 0;let l=`Function ${t}() called with invalid data`;e&&(l+=" (via `toFirestore()`)"),l+=". ";let h="";return(o||a)&&(h+=" (found",o&&(h+=` in field ${r}`),a&&(h+=` in document ${s}`),h+=")"),new O(C.INVALID_ARGUMENT,l+n+h)}function lp(n,t){return n.some((e=>e.isEqual(t)))}class Su{constructor(t,e,r,s,o){this._firestore=t,this._userDataWriter=e,this._key=r,this._document=s,this._converter=o}get id(){return this._key.path.lastSegment()}get ref(){return new ct(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new up(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Ru("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}}class up extends Su{data(){return super.data()}}function Ru(n,t){return typeof t=="string"?Au(n,t):t instanceof fo?t._internalPath:t._delegate._internalPath}function Cu(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new O(C.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class hp{convertValue(t,e="none"){switch(_e(t)){case 0:return null;case 1:return t.booleanValue;case 2:return rt(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(pe(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw F(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const r={};return Me(t,((s,o)=>{r[s]=this.convertValue(o,e)})),r}convertVectorValue(t){const e=t.fields?.[Jr].arrayValue?.values?.map((r=>rt(r.doubleValue)));return new Gt(e)}convertGeoPoint(t){return new Ht(rt(t.latitude),rt(t.longitude))}convertArray(t,e){return(t.values||[]).map((r=>this.convertValue(r,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const r=fs(t);return r==null?null:this.convertValue(r,e);case"estimate":return this.convertTimestamp(Kn(t));default:return null}}convertTimestamp(t){const e=ge(t);return new Z(e.seconds,e.nanos)}convertDocumentKey(t,e){const r=Y.fromString(t);Q($l(r),9688,{name:t});const s=new Wn(r.get(1),r.get(3)),o=new L(r.popFirst(5));return s.isEqual(e)||Yt(`Document ${o} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),o}}function bu(n,t,e){let r;return r=n?e&&(e.merge||e.mergeFields)?n.toFirestore(t,e):n.toFirestore(t):t,r}class Ln{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class Ve extends Su{constructor(t,e,r,s,o,a){super(t,e,r,s,a),this._firestore=t,this._firestoreImpl=t,this.metadata=o}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new qr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const r=this._document.data.field(Ru("DocumentSnapshot.get",t));if(r!==null)return this._userDataWriter.convertValue(r,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new O(C.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,e={};return e.type=Ve._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}}Ve._jsonSchemaVersion="firestore/documentSnapshot/1.0",Ve._jsonSchema={type:it("string",Ve._jsonSchemaVersion),bundleSource:it("string","DocumentSnapshot"),bundleName:it("string"),bundle:it("string")};class qr extends Ve{data(t={}){return super.data(t)}}class De{constructor(t,e,r,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new Ln(s.hasPendingWrites,s.fromCache),this.query=r}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach((r=>{t.call(e,new qr(this._firestore,this._userDataWriter,r.key,r,new Ln(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new O(C.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=(function(s,o){if(s._snapshot.oldDocs.isEmpty()){let a=0;return s._snapshot.docChanges.map((l=>{const h=new qr(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Ln(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);return l.doc,{type:"added",doc:h,oldIndex:-1,newIndex:a++}}))}{let a=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((l=>o||l.type!==3)).map((l=>{const h=new qr(s._firestore,s._userDataWriter,l.doc.key,l.doc,new Ln(s._snapshot.mutatedKeys.has(l.doc.key),s._snapshot.fromCache),s.query.converter);let d=-1,p=-1;return l.type!==0&&(d=a.indexOf(l.doc.key),a=a.delete(l.doc.key)),l.type!==1&&(a=a.add(l.doc),p=a.indexOf(l.doc.key)),{type:dp(l.type),doc:h,oldIndex:d,newIndex:p}}))}})(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new O(C.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=De._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=Bi.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const e=[],r=[],s=[];return this.docs.forEach((o=>{o._document!==null&&(e.push(o._document),r.push(this._userDataWriter.convertObjectMap(o._document.data.value.mapValue.fields,"previous")),s.push(o.ref.path))})),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function dp(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return F(61501,{type:n})}}De._jsonSchemaVersion="firestore/querySnapshot/1.0",De._jsonSchema={type:it("string",De._jsonSchemaVersion),bundleSource:it("string","QuerySnapshot"),bundleName:it("string"),bundle:it("string")};class _o extends hp{constructor(t){super(),this.firestore=t}convertBytes(t){return new Nt(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new ct(this.firestore,null,e)}}function fp(n){n=qt(n,dr);const t=qt(n.firestore,Le),e=ho(t),r=new _o(t);return Cu(n._query),tp(e,n._query).then((s=>new De(t,r,n,s)))}function os(n,t,e){n=qt(n,ct);const r=qt(n.firestore,Le),s=bu(n.converter,t,e);return yo(r,[Eu(yu(r),"setDoc",n._key,s,n.converter!==null,e).toMutation(n._key,Ft.none())])}function mp(n){return yo(qt(n.firestore,Le),[new Wi(n._key,Ft.none())])}function Pu(n,t){const e=qt(n.firestore,Le),r=un(n),s=bu(n.converter,t);return yo(e,[Eu(yu(n.firestore),"addDoc",r._key,s,n.converter!==null,{}).toMutation(r._key,Ft.exists(!1))]).then((()=>r))}function Oc(n,...t){n=nn(n);let e={includeMetadataChanges:!1,source:"default"},r=0;typeof t[r]!="object"||Nc(t[r])||(e=t[r++]);const s={includeMetadataChanges:e.includeMetadataChanges,source:e.source};if(Nc(t[r])){const h=t[r];t[r]=h.next?.bind(h),t[r+1]=h.error?.bind(h),t[r+2]=h.complete?.bind(h)}let o,a,l;if(n instanceof ct)a=qt(n.firestore,Le),l=Gi(n._key.path),o={next:h=>{t[r]&&t[r](gp(a,n,h))},error:t[r+1],complete:t[r+2]};else{const h=qt(n,dr);a=qt(h.firestore,Le),l=h._query;const d=new _o(a);o={next:p=>{t[r]&&t[r](new De(a,d,h,p))},error:t[r+1],complete:t[r+2]},Cu(n._query)}return(function(d,p,E,A){const P=new fu(A),N=new su(p,P,E);return d.asyncQueue.enqueueAndForget((async()=>nu(await Si(d),N))),()=>{P.Nu(),d.asyncQueue.enqueueAndForget((async()=>ru(await Si(d),N)))}})(ho(a),l,s,o)}function yo(n,t){return(function(r,s){const o=new ue;return r.asyncQueue.enqueueAndForget((async()=>qg(await Zg(r),s,o))),o.promise})(ho(n),t)}function gp(n,t,e){const r=e.docs.get(t._key),s=new _o(n);return new Ve(n,s,t._key,r,new Ln(e.hasPendingWrites,e.fromCache),t.converter)}function Zn(){return new po("serverTimestamp")}(function(t,e=!0){(function(s){dn=s})(zd),Wr(new zn("firestore",((r,{instanceIdentifier:s,options:o})=>{const a=r.getProvider("app").getImmediate(),l=new Le(new af(r.getProvider("auth-internal")),new uf(a,r.getProvider("app-check-internal")),(function(d,p){if(!Object.prototype.hasOwnProperty.apply(d.options,["projectId"]))throw new O(C.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Wn(d.options.projectId,p)})(a,s),a);return o={useFetchStreams:e,...o},l._setSettings(o),l}),"PUBLIC").setMultipleInstances(!0)),Qe(Fa,Ba,t),Qe(Fa,Ba,"esm2020")})();const pp={apiKey:"AIzaSyC5fjkXd_lirXDEY5wyH-upF9yU_nzLAJw",authDomain:"web-rtc-server-50d56.firebaseapp.com",projectId:"web-rtc-server-50d56",storageBucket:"web-rtc-server-50d56.firebasestorage.app",messagingSenderId:"1017642181996",appId:"1:1017642181996:web:e325acd4ee82baa9087f49",measurementId:"G-KVDMZRQKBP"},_p=Kc(pp),Vu=np(_p),yp={iceServers:[{urls:["stun:stun1.l.google.com:19302","stun:stun2.l.google.com:19302"]}],iceCandidatePoolSize:10};let x=null;const Lc=document.getElementById("webcamButton"),dt=document.getElementById("webcamVideo"),Eo=document.getElementById("callButton"),Du=document.getElementById("answerButton"),mt=document.getElementById("remoteVideo"),tr=document.getElementById("hangupButton"),ku=document.getElementById("settingsButton"),qn=document.getElementById("settingsModal"),Ep=document.getElementById("closeSettings"),Je=document.getElementById("videoSelect"),er=document.getElementById("audioSelect"),as=document.getElementById("audioOutputSelect"),Ye=document.getElementById("createCallModal"),Tp=document.getElementById("closeCreateCall"),fr=document.getElementById("callIdDisplay"),Lr=document.getElementById("copyCallId"),vp=document.getElementById("shareGmail"),Ip=document.getElementById("shareOutlook"),ke=document.getElementById("joinCallModal"),Ri=document.getElementById("joinCallInput"),wp=document.getElementById("confirmJoinCall"),Ap=document.getElementById("closeJoinCall"),de=document.getElementById("toggleMute"),fe=document.getElementById("toggleCamera"),Nu=document.getElementById("toggleFullscreen"),Ou=document.getElementById("callTimer"),Sp=document.getElementById("videoContainer"),Pt=document.getElementById("slot-0-camera-off"),cs=document.getElementById("remoteCameraOff"),Mt=document.getElementById("slot-0-muted"),To=document.getElementById("remoteMuted"),Xt=document.getElementById("connectionIndicator"),ls=document.getElementById("networkStats"),Rp=document.getElementById("videoStat"),Cp=document.getElementById("audioStat"),bp=document.getElementById("latencyStat"),Pp=document.getElementById("packetLossStat"),vo=document.getElementById("chatPanel"),Mr=document.getElementById("chatMessages"),Mc=document.getElementById("chatInput"),Vp=document.getElementById("sendMessage"),nr=document.getElementById("openChat"),Dp=document.getElementById("toggleChat"),xc=document.getElementById("showStatsToggle"),Ci=document.getElementById("usernameInput"),Io=document.getElementById("localNameTag"),Ze=document.getElementById("remoteNameTag");let Ot=!1,Kt=!1,bi=null,$r=null,$n=null,Pi=!1,Lt="Guest",rr=null,sr=null;const Dt=localStorage.getItem("clientId")||Math.random().toString(36).substring(2,10);localStorage.setItem("clientId",Dt);const b={},Vi=10;let tt=null;function mr(n){Object.values(b).forEach(t=>{const e=t.dataChannel;if(e&&e.readyState==="open")try{e.send(JSON.stringify(n))}catch{}})}let Pe=null,Ke=null,We=0,tn=null,en=null,Di=0,Fc=0;const kp=1e3,us=.03,Np=.06;function Lu(){if(x&&x.getAudioTracks().length)try{Pe||(Pe=new(window.AudioContext||window.webkitAudioContext));const n=Pe.createMediaStreamSource(x);Ke=Pe.createAnalyser(),Ke.fftSize=2048,n.connect(Ke);const t=new Uint8Array(Ke.fftSize);tn&&clearInterval(tn),tn=setInterval(()=>{Ke.getByteTimeDomainData(t);let e=0;for(let s=0;s<t.length;s++){const o=(t[s]-128)/128;e+=o*o}const r=Math.sqrt(e/t.length);We=Math.min(1,r),mr({type:"audio-level",level:We});try{const s=document.getElementById("slot-0");if(s){const o=s.querySelector(".audio-meter"),a=o&&o.querySelector(".level");o&&a&&(o.style.display="block",a.style.width=Math.min(100,Math.round(We*100))+"%"),s.classList.toggle("speaking",We>us+.03)}}catch{}},200)}catch(n){console.warn("Failed to start local audio meter",n)}}function Op(){if(tn&&(clearInterval(tn),tn=null),Pe){try{Pe.close()}catch{}Pe=null,Ke=null,We=0}}function Lp(){en&&clearInterval(en),en=setInterval(()=>{if(Date.now()<Di)return;let n=null,t=-1;const e=Date.now();for(const[s,o]of Object.entries(b)){if(!o)continue;const a=typeof o.lastAudioLevel=="number"?o.lastAudioLevel:0,l=o&&o.levelTs?o.levelTs:0;e-l>2e3||a>t&&(t=a,n=s)}if(!n||t<us||tt===n||Date.now()<Di||e-Fc<kp)return;let r=0;if(tt&&b[tt]){const s=b[tt];r=typeof s.lastAudioLevel=="number"?s.lastAudioLevel:0}if(t>Math.max(r+Np,us)){tt=n;const s=b[n];s&&s.remoteStream&&(mt.srcObject=s.remoteStream),Ze.textContent=s&&s.username||"Guest",wo(),Fc=Date.now()}},250)}function Mp(){en&&(clearInterval(en),en=null)}function wo(){if(document.querySelectorAll(".thumb-slot").forEach(n=>n.classList.remove("active")),tt){const n=b[tt];if(n&&n.slotIndex){const t=document.getElementById(`slot-${n.slotIndex}`);t&&t.classList.add("active")}}else{const n=document.getElementById("slot-0");n&&n.classList.add("active")}}function xp(n){for(const[t,e]of Object.entries(b))if(t===n&&e.slotIndex)return e.slotIndex;for(let t=1;t<Vi;t++){if(!document.getElementById(`slot-${t}`))continue;if(!Object.values(b).some(s=>s.slotIndex===t))return t}return null}function ir(n){const t=b[n];return!t||!t.slotIndex?null:document.getElementById(`slot-${t.slotIndex}`)}function Mu(n){const t=b[n].slotIndex||xp(n);if(!t)return null;b[n].slotIndex=t;const e=document.getElementById(`slot-${t}`);e.classList.remove("empty");let r=e.querySelector("video");r||(r=document.createElement("video"),r.className="thumb-video",r.autoplay=!0,r.playsInline=!0,r.id=`slot-${t}-video`,["loadeddata","playing","pause","emptied","seeked"].forEach(l=>{r.addEventListener(l,()=>or(n))}),e.appendChild(r));let s=e.querySelector(".slot-name");if(s||(s=document.createElement("div"),s.className="video-name-tag slot-name",s.id=`slot-${t}-name`,s.textContent=b[n].username||"Guest",e.appendChild(s)),!e.querySelector(".camera-off-overlay")){const l=document.createElement("div");l.className="camera-off-overlay small",l.id=`slot-${t}-camera-off`,l.innerHTML='<div class="camera-off-icon"></div>',e.appendChild(l)}if(!e.querySelector(".muted-indicator")){const l=document.createElement("div");l.className="muted-indicator small",l.id=`slot-${t}-muted`,l.textContent="",e.appendChild(l)}if(!e.querySelector(".audio-meter")){const l=document.createElement("div");l.className="audio-meter",l.innerHTML='<div class="level"></div>',e.appendChild(l)}if(!e.querySelector(".peer-debug")){const l=document.createElement("div");l.className="peer-debug",l.id=`slot-${t}-debug`,l.textContent="...",e.appendChild(l)}e.classList.add("debug-mode");const o=e.querySelector(".camera-off-overlay"),a=e.querySelector(".muted-indicator");return o&&o.classList.remove("active"),a&&a.classList.remove("active"),r}let St=null,ki=null,Ni=null;async function zr(n){if(!St)return;const t=jn(St,"signals"),e=document.getElementById("signalWarning"),r=async(s=1)=>{try{return await Pu(t,{...n,createdAt:Zn()}),e&&(e.style.display="none"),!0}catch(o){return console.error("sendSignal failed (attempt",s,"):",o),e&&(e.style.display="block",e.innerHTML=`Signaling error: ${o.message||o}. Check adblocker/firewall and allowlist this site.<small>Retrying...</small>`),s<3?(await new Promise(a=>setTimeout(a,1e3*s)),await r(s+1)):!1}};return await r(1)}async function xu(){if(!St)return;const n=un(St,"participants",Dt);try{await os(n,{username:Lt},{merge:!0})}catch(t){console.error("Failed to update participant record:",t)}}async function Ao(n,t=!1){if(St=un(Vu,"calls",n),t)try{await os(St,{createdAt:Zn()})}catch(s){console.error("Error creating call doc:",s)}try{const s=jn(St,"participants"),o=await fp(s);if(!t&&o.size>=Vi){alert("Call is full (maximum "+Vi+" participants)");return}await os(un(St,"participants",Dt),{username:Lt,joinedAt:Zn()},{merge:!0})}catch(s){console.error("Failed to join call participants collection:",s)}const e=jn(St,"participants");ki=Oc(e,s=>{s.docChanges().forEach(async o=>{const a=o.doc.id,l=o.doc.data();if(o.type==="added"){if(a===Dt)return;b[a]=b[a]||{},b[a].username=l.username||"Guest",b[a].cameraEnabled=void 0,b[a].muted=void 0,b[a].lastAudioLevel=0,b[a].levelTs=0,b[a].makingOffer=!1,b[a].ignoreOffer=!1,b[a].polite=Dt>a,Mu(a),or(a),Dt<a?await ri(a,!0):await ri(a,!1),tt||(tt=a,mt.srcObject=b[a].remoteStream,Ze.textContent=b[a].username||"Guest",wo())}else if(o.type==="removed")Oi(a);else if(o.type==="modified"&&b[a]){b[a].username=l.username||"Guest";const h=ir(a);if(h){const d=h.querySelector(".slot-name");d&&(d.textContent=b[a].username)}}})});const r=jn(St,"signals");Ni=Oc(r,s=>{s.docChanges().forEach(async o=>{if(o.type!=="added")return;const a=o.doc.data();if(!a||a.to!==Dt)return;const l=a.from;if(a.type==="offer"){b[l]=b[l]||{},b[l].username=b[l].username||"Guest",b[l]=b[l]||{},b[l].username=b[l].username||"Guest";const h=await ri(l,!1),d=!!b[l].polite,p={type:"offer",sdp:a.sdp},E=b[l].makingOffer||h&&h.signalingState!=="stable";if(b[l].ignoreOffer=!d&&E,b[l].ignoreOffer){console.log("Ignoring incoming offer from",l,"due to collision and not polite");return}try{if(E&&d)try{await h.setLocalDescription({type:"rollback"})}catch{}if(await h.setRemoteDescription(new RTCSessionDescription(p)),b[l]&&b[l].pendingCandidates&&b[l].pendingCandidates.length){for(const P of b[l].pendingCandidates)try{await h.addIceCandidate(new RTCIceCandidate(P))}catch(N){console.warn("Failed applying queued candidate",N)}b[l].pendingCandidates=[]}const A=await h.createAnswer();await h.setLocalDescription(A),await zr({type:"answer",from:Dt,to:l,sdp:A.sdp})}catch(A){console.error("Failed to handle incoming offer from",l,A)}}else if(a.type==="answer"){const h=b[l]&&b[l].pc;if(b[l]&&b[l].ignoreOffer){console.log("Ignoring answer from",l,"because earlier offer was ignored");return}if(h)try{const d={type:"answer",sdp:a.sdp};if(await h.setRemoteDescription(new RTCSessionDescription(d)),b[l]&&b[l].pendingCandidates&&b[l].pendingCandidates.length){for(const p of b[l].pendingCandidates)try{await h.addIceCandidate(new RTCIceCandidate(p))}catch(E){console.warn("Failed applying queued candidate",E)}b[l].pendingCandidates=[]}}catch(d){console.error("Failed to set remote answer for",l,d)}}else if(a.type==="ice"){const h=b[l]&&b[l].pc;if(h&&a.candidate)try{!h.remoteDescription||!h.remoteDescription.type?(b[l]=b[l]||{},b[l].pendingCandidates=b[l].pendingCandidates||[],b[l].pendingCandidates.push(a.candidate)):await h.addIceCandidate(new RTCIceCandidate(a.candidate))}catch(d){console.warn("Failed to add remote ICE candidate",d)}else a.type==="left"&&(console.log("Peer left:",l),Oi(l))}})}),await xu(),qp(),zp(),nr.classList.add("active"),Lp(),document.querySelectorAll(".thumb-slot").forEach(s=>s.classList.add("debug-mode"));try{To.classList.remove("active"),cs.classList.remove("active"),document.querySelectorAll(".thumb-slot .camera-off-overlay, .thumb-slot .muted-indicator").forEach(s=>s.classList.remove("active"))}catch{}}async function Fp(){if(St){try{await Pu(jn(St,"signals"),{type:"left",from:Dt,createdAt:Zn()}),await mp(un(St,"participants",Dt))}catch{}ki&&ki(),Ni&&Ni()}Object.keys(b).forEach(n=>Oi(n)),Mp(),Op();try{Te()}catch{}St=null,$p(),Hp(),nr.classList.remove("active")}async function ri(n,t=!1){if(!St)throw new Error("Not in a call");if(b[n]&&b[n].pc)return b[n].pc;const e=new RTCPeerConnection(yp),r=new MediaStream;b[n]=b[n]||{},b[n].pc=e,b[n].remoteStream=r;const s=Mu(n);s&&(s.srcObject=r,wo());try{const o=e.addTransceiver("audio",{direction:"sendrecv"}),a=e.addTransceiver("video",{direction:"sendrecv"});if(b[n].transceivers={audio:o,video:a},x){const l=x.getAudioTracks()[0],h=x.getVideoTracks()[0];try{l&&o.sender.replaceTrack(l)}catch{}try{h&&a.sender.replaceTrack(h)}catch{}}}catch{if(x){const a=x.getAudioTracks()[0],l=x.getVideoTracks()[0];if(a)try{e.addTrack(a,x)}catch{}if(l)try{e.addTrack(l,x)}catch{}}}if(t){const o=e.createDataChannel("data");b[n].dataChannel=o,Bc(o,n)}else e.ondatachannel=o=>{b[n].dataChannel=o.channel,Bc(o.channel,n)};if(e.ontrack=o=>{try{console.log("pc.ontrack fired for",n,"track kind:",o.track?.kind,"streams:",o.streams);const a=b[n]?.remoteStream;if(!a){console.warn("ontrack: peers[peerId].remoteStream is missing for",n);return}o.track?a.getTracks().find(d=>d.id===o.track.id)?console.log("ontrack: track already present, skipping duplicate add"):(a.addTrack(o.track),console.log("ontrack: added",o.track.kind,"track to remoteStream for",n,"- now has",a.getTracks().length,"tracks")):console.warn("ontrack: event.track is missing for",n,o);const l=ir(n);if(l){const h=l.querySelector(".camera-off-overlay");h&&h.classList.remove("active"),b[n]&&(b[n].cameraEnabled=!0);const d=l.querySelector(".audio-meter");d&&(d.style.display="block")}or(n)}catch(a){console.error("ontrack handler error for",n,a)}},e.onicecandidate=({candidate:o})=>{if(o){const a=o&&typeof o.toJSON=="function"?o.toJSON():o;console.log("pc.onicecandidate -> sending ICE to",n,a),zr({type:"ice",from:Dt,to:n,candidate:a})}},e.onnegotiationneeded=async()=>{try{if(e.signalingState!=="stable"||b[n].makingOffer)return;b[n].makingOffer=!0;const o=await e.createOffer();await e.setLocalDescription(o),await zr({type:"offer",from:Dt,to:n,sdp:o.sdp})}catch(o){console.warn("Negotiation failure for",n,o),setTimeout(()=>{b[n]&&(b[n].makingOffer=!1)},500)}finally{b[n]&&(b[n].makingOffer=!1)}},e.onconnectionstatechange=()=>{console.log("pc.onconnectionstatechange",n,e.connectionState)},e.oniceconnectionstatechange=()=>{console.log("pc.oniceconnectionstatechange",n,e.iceConnectionState)},t)try{b[n].makingOffer=!0;const o=await e.createOffer();await e.setLocalDescription(o),await zr({type:"offer",from:Dt,to:n,sdp:o.sdp})}finally{b[n].makingOffer=!1}return e}function Oi(n){const t=b[n];if(t){if(t.pc)try{t.pc.close()}catch{}if(t.dataChannel)try{t.dataChannel.close()}catch{}if(t.slotIndex){const e=document.getElementById(`slot-${t.slotIndex}`);e&&(e.innerHTML="",e.classList.add("empty"))}delete b[n]}}function or(n){const t=b[n],e=ir(n),r=tt===n;if(e){const s=e.querySelector(".camera-off-overlay"),o=e.querySelector(".muted-indicator"),a=e.querySelector(".audio-meter");let l=!1;const h=e.querySelector("video");if(h&&h.srcObject){try{const E=h.srcObject.getVideoTracks?h.srcObject.getVideoTracks():[];E.length>0&&(l=E.some(A=>A&&A.enabled!==!1))}catch{}if(!l)try{(typeof h.videoWidth=="number"&&h.videoWidth>0||typeof h.readyState=="number"&&h.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA||h.currentTime>0)&&(l=!0)}catch{}}const d=!!(l||t&&t.remoteStream&&t.remoteStream.getVideoTracks().length>0);d?s&&s.classList.remove("active"):s&&s.classList.toggle("active",t&&t.cameraEnabled===!1),o&&o.classList.toggle("active",t&&t.muted===!0),a&&(a.style.display=d||t&&t.levelTs&&Date.now()-t.levelTs<3e3?"block":"none");const p=e.querySelector(".peer-debug");if(p){const E=t&&t.pc,A=t&&t.pendingCandidates?t.pendingCandidates.length:0,P=t&&t.remoteStream?t.remoteStream.getTracks().length:0,N=[];N.push(`cam:${String(t?.cameraEnabled)}`),N.push(`muted:${String(t?.muted)}`),N.push(`rTracks:${P}`),N.push(`pending:${A}`),E&&(N.push(E.signalingState||"no-signal"),N.push(E.iceConnectionState||"no-ice")),p.textContent=N.join(" | ")}}if(r){if(typeof t?.cameraEnabled=="boolean"){let s=!1;try{if(mt&&mt.srcObject){const o=mt.srcObject.getVideoTracks?mt.srcObject.getVideoTracks():[];o.length&&(s=o.some(a=>a&&a.enabled!==!1)),s||(typeof mt.videoWidth=="number"&&mt.videoWidth>0?s=!0:typeof mt.readyState=="number"?s=mt.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA:mt.currentTime>0&&(s=!0))}}catch{}s?cs.classList.remove("active"):cs.classList.toggle("active",t.cameraEnabled===!1)}typeof t?.muted=="boolean"&&To.classList.toggle("active",t.muted===!0)}}function Te(){try{let n=!1;if(dt&&dt.srcObject)try{const t=dt.srcObject.getVideoTracks?dt.srcObject.getVideoTracks():[];t.length&&(n=t.some(e=>e&&e.enabled!==!1)),n||(typeof dt.videoWidth=="number"&&dt.videoWidth>0||typeof dt.readyState=="number"&&dt.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA||dt.currentTime>0)&&(n=!0)}catch{}if(Pt){const t=x&&x.getVideoTracks&&x.getVideoTracks()[0],e=!!t,r=e?t.enabled!==!1:!1;n?(Pt.classList.contains("active")&&console.log("updateLocalUI: clearing camera overlay because localHasVideo=true"),Pt.classList.remove("active")):Kt?(Pt.classList.contains("active")||console.log("updateLocalUI: showing camera overlay because isCameraOff=true"),Pt.classList.add("active")):e&&!r?Pt.classList.add("active"):Pt.classList.remove("active"),Pt.classList.contains("active")&&n&&console.warn("updateLocalUI: camera overlay active despite localHasVideo;",{localHasVideo:n,hasTrack:e,trackEnabled:r,videoWidth:dt&&typeof dt.videoWidth=="number"?dt.videoWidth:"n/a",readyState:dt&&typeof dt.readyState=="number"?dt.readyState:"n/a"})}Mt&&(Ot?(Mt.classList.contains("active")||console.log("updateLocalUI: showing muted overlay because isMuted=true"),Mt.classList.add("active")):(Mt.classList.contains("active")&&console.log("updateLocalUI: clearing muted overlay because isMuted=false"),Mt.classList.remove("active")))}catch(n){console.warn("updateLocalUI failed",n)}}function Fu(){[120,350,800].forEach(n=>setTimeout(()=>{try{Te()}catch{}},n))}async function Bp(){const n=await navigator.mediaDevices.enumerateDevices();Je.innerHTML="",er.innerHTML="",as.innerHTML="",n.forEach(t=>{const e=document.createElement("option");e.value=t.deviceId,e.text=t.label||`${t.kind} ${Je.length+1}`,t.kind==="videoinput"?Je.appendChild(e):t.kind==="audioinput"?er.appendChild(e):t.kind==="audiooutput"&&as.appendChild(e)})}Je.onchange=async()=>{rr=Je.value,x&&await Bu()};er.onchange=async()=>{sr=er.value,x&&await Bu()};as.onchange=async()=>{if(typeof mt.setSinkId<"u")try{await mt.setSinkId(as.value)}catch(n){console.error("Error setting audio output:",n)}};async function Bu(){const n={video:rr?{deviceId:{exact:rr}}:!0,audio:sr?{deviceId:{exact:sr}}:!0},t=x;x=await navigator.mediaDevices.getUserMedia(n),dt.srcObject=x;try{Te()}catch{}Fu();try{const e=x.getVideoTracks()[0],r=x.getAudioTracks()[0];typeof e<"u"&&(Kt=e.enabled===!1,fe.classList.toggle("camera-off",Kt),fe.textContent=Kt?"":"",Pt&&Pt.classList.remove("active")),typeof r<"u"&&(Ot=r.enabled===!1,de.classList.toggle("muted",Ot),de.textContent=Ot?"":"",Mt&&Mt.classList.remove("active"))}catch{}Lu(),Object.values(b).forEach(e=>{if(!e.pc)return;const r=e.pc.getSenders?e.pc.getSenders():[],s=x.getVideoTracks()[0],o=x.getAudioTracks()[0];if(e.transceivers){try{e.transceivers.audio&&o&&e.transceivers.audio.sender.replaceTrack(o)}catch{}try{e.transceivers.video&&s&&e.transceivers.video.sender.replaceTrack(s)}catch{}}if(r.forEach(a=>{a.track&&(a.track.kind==="video"&&s?a.replaceTrack(s):a.track.kind==="audio"&&o&&a.replaceTrack(o))}),r.length===0&&!e.transceivers&&x.getTracks().length>0)try{const a=x.getAudioTracks()[0],l=x.getVideoTracks()[0];a&&e.pc.addTrack(a,x),l&&e.pc.addTrack(l,x)}catch(a){console.warn("Error adding initial tracks after updateStream",a)}}),t&&t.getTracks().forEach(e=>e.stop())}ku.onclick=()=>{qn.classList.add("active")};Ep.onclick=()=>{qn.classList.remove("active")};qn.onclick=n=>{n.target===qn&&qn.classList.remove("active")};xc.onchange=()=>{Pi=xc.checked,Pi&&$n?(Xt.classList.add("active"),ls.classList.add("active")):(Xt.classList.remove("active"),ls.classList.remove("active"))};localStorage.getItem("username")&&(Lt=localStorage.getItem("username"),Ci.value=Lt,Io.textContent=Lt);Ci.oninput=()=>{Lt=Ci.value.trim()||"Guest",localStorage.setItem("username",Lt),Io.textContent=Lt,xu(),mr({type:"username",username:Lt})};Tp.onclick=()=>{Ye.classList.remove("active")};Ye.onclick=n=>{n.target===Ye&&Ye.classList.remove("active")};Lr.onclick=async()=>{try{const n=`${window.location.origin}${window.location.pathname}${window.location.pathname.endsWith("/"),""}?join=${fr.value}`;await navigator.clipboard.writeText(n);const t=Lr.textContent;Lr.textContent="Copied!",setTimeout(()=>{Lr.textContent=t},2e3)}catch(n){console.error("Failed to copy:",n)}};vp.onclick=()=>{const n=fr.value,t=`${window.location.origin}${window.location.pathname}${window.location.pathname.endsWith("/"),""}?join=${n}`,e=encodeURIComponent("Join my video call"),r=encodeURIComponent(`Hi,

Join my video call using this link: ${t}

Click the link and the join dialog will be pre-filled for you  no copy/paste needed.

See you soon!`);window.open(`https://mail.google.com/mail/?view=cm&fs=1&su=${e}&body=${r}`,"_blank")};Ip.onclick=()=>{const n=fr.value,t=`${window.location.origin}${window.location.pathname}${window.location.pathname.endsWith("/"),""}?join=${n}`,e=encodeURIComponent("Join my video call"),r=encodeURIComponent(`Hi,

Join my video call using this link: ${t}

Click the link and the join dialog will be pre-filled for you  no copy/paste needed.

See you soon!`);window.open(`https://outlook.office.com/mail/deeplink/compose?subject=${e}&body=${r}`,"_blank")};Du.onclick=()=>{ke.classList.add("active")};Ap.onclick=()=>{ke.classList.remove("active")};ke.onclick=n=>{n.target===ke&&ke.classList.remove("active")};function Up(){try{const n=new URL(window.location.href).searchParams;let t=n.get("join")||n.get("call");if(!t&&window.location.hash){const e=window.location.hash.substring(1),r=new URLSearchParams(e);t=r.get("join")||r.get("call")}if(t){Ri.value=t,ke.classList.add("active"),Ri.focus();try{window.history.replaceState({},document.title,window.location.pathname)}catch{}}}catch(n){console.warn("Failed to parse incoming join param",n)}}Up();try{Te()}catch{}nr.onclick=()=>{vo.classList.add("open"),nr.classList.remove("has-new")};Dp.onclick=()=>{vo.classList.remove("open")};Vp.onclick=()=>{jp()};function jp(){const n=Mc.value.trim();n&&(Uu(n,"sent",Lt),mr({type:"chat",message:n,username:Lt,timestamp:Date.now()}),Mc.value="")}function Uu(n,t="received",e="Guest"){if(!Mr)return;const r=document.createElement("div");r.className=`chat-message ${t}`;const s=document.createElement("div");s.className="chat-meta",s.textContent=`${e}  ${new Date().toLocaleTimeString()}`;const o=document.createElement("div");o.className="chat-body",o.textContent=n,r.appendChild(s),r.appendChild(o),Mr.appendChild(r),Mr.scrollTop=Mr.scrollHeight}Eo.onclick=async()=>{const n=Math.random().toString(36).substring(2,12);fr.value=n,Ye.classList.add("active");const t=un(Vu,"calls",n);await os(t,{createdAt:Zn()}),await Ao(n,!0),tr.disabled=!1};de.onclick=()=>{if(x){const n=x.getAudioTracks()[0];if(n){n.enabled=!n.enabled,Ot=!n.enabled,de.classList.toggle("muted",Ot),de.textContent=Ot?"":"",Mt&&Mt.classList.remove("active"),mr({type:"mute",muted:Ot});try{Te()}catch{}}}};fe.onclick=()=>{if(x){const n=x.getVideoTracks()[0];if(n){n.enabled=!n.enabled,Kt=!n.enabled,fe.classList.toggle("camera-off",Kt),fe.textContent=Kt?"":"",Pt&&Pt.classList.remove("active"),mr({type:"camera",enabled:n.enabled});try{Te()}catch{}}}};Nu.onclick=()=>{document.fullscreenElement?document.exitFullscreen():Sp.requestFullscreen().catch(n=>{console.error("Error attempting to enable fullscreen:",n)})};function qp(){bi=Date.now(),$r=setInterval(()=>{const n=Math.floor((Date.now()-bi)/1e3),t=Math.floor(n/60),e=n%60;Ou.textContent=`${String(t).padStart(2,"0")}:${String(e).padStart(2,"0")}`},1e3)}function $p(){$r&&(clearInterval($r),$r=null),Ou.textContent="00:00",bi=null}async function zp(){Pi&&(Xt.classList.add("active"),ls.classList.add("active")),$n=setInterval(async()=>{if(!tt)return;const n=b[tt];if(!n||!n.pc)return;const t=await n.pc.getStats();let e=0,r=0,s=0,o=0,a=0,l=0;t.forEach(d=>{d.type==="inbound-rtp"&&(d.kind==="video"&&d.bytesReceived?e=Math.round(d.bytesReceived*8/1e3):d.kind==="audio"&&d.bytesReceived&&(r=Math.round(d.bytesReceived*8/1e3)),d.packetsLost!==void 0&&(a+=d.packetsLost),d.packetsReceived!==void 0&&(l+=d.packetsReceived)),d.type==="candidate-pair"&&d.state==="succeeded"&&d.currentRoundTripTime!==void 0&&(s=Math.round(d.currentRoundTripTime*1e3))}),l>0&&(o=Math.round(a/(a+l)*100)),Rp.textContent=`${e} kbps`,Cp.textContent=`${r} kbps`,bp.textContent=`${s} ms`,Pp.textContent=`${o}%`;const h=Xt.querySelector(".connection-text");Xt.classList.remove("good","fair","poor"),s<150&&o<2?(Xt.classList.add("good"),h.textContent="Good"):s<300&&o<5?(Xt.classList.add("fair"),h.textContent="Fair"):(Xt.classList.add("poor"),h.textContent="Poor")},1e3)}function Hp(){$n&&(clearInterval($n),$n=null),Xt.classList.remove("active"),ls.classList.remove("active")}function Bc(n,t){n.onopen=()=>{console.log("Data channel opened for",t);try{n.send(JSON.stringify({type:"username",username:Lt})),(x&&x.getVideoTracks().length?x.getVideoTracks()[0].enabled:!1)&&n.send(JSON.stringify({type:"camera",enabled:!0})),Ot&&n.send(JSON.stringify({type:"mute",muted:!0})),n.send(JSON.stringify({type:"audio-level",level:We||0}))}catch{}},n.onmessage=e=>{const r=JSON.parse(e.data),s=b[t];if(r.type==="audio-level"){const a=typeof r.level=="number"?r.level:0;s&&(s.lastAudioLevel=a,s.levelTs=Date.now());const l=ir(t);if(l){const h=l.querySelector(".audio-meter"),d=h&&h.querySelector(".level");h&&d&&(h.style.display="block",d.style.width=Math.min(100,Math.round(a*100))+"%");const p=a>us+.02;l.classList.toggle("speaking",p)}return}const o=ir(t);if(r.type==="camera"){if(typeof r.enabled=="boolean"){if(o){const a=o.querySelector(".camera-off-overlay");a&&a.classList.toggle("active",!r.enabled)}s&&(s.cameraEnabled=!!r.enabled),or(t),t===tt&&cs.classList.toggle("active",!r.enabled)}}else if(r.type==="mute"){if(typeof r.muted=="boolean"){if(o){const a=o.querySelector(".muted-indicator");a&&a.classList.toggle("active",r.muted)}s&&(s.muted=!!r.muted),or(t),t===tt&&To.classList.toggle("active",r.muted)}}else if(r.type==="chat")Uu(r.message,"received",r.username||s&&s.username||"Guest"),vo.classList.contains("open")||nr.classList.add("has-new");else if(r.type==="username"){if(s&&(s.username=r.username||"Guest"),o){const a=o.querySelector(".slot-name");a&&(a.textContent=r.username||"Guest")}t===tt&&(Ze.textContent=r.username||"Guest")}},n.onerror=e=>{console.error("Data channel error:",e)}}const Gp=document.getElementById("topThumbnails");["loadeddata","playing","pause","emptied","seeked"].forEach(n=>{try{dt.addEventListener(n,()=>Te())}catch{}});Gp?.addEventListener("click",n=>{const t=n.target.closest(".thumb-slot");if(!t)return;const e=t.querySelector("video");if(e&&e.srcObject){const r=parseInt(t.dataset.index);if(r===0)Object.keys(b).length>0?(tt=Object.keys(b)[0]||null,tt&&b[tt]&&b[tt].remoteStream&&(mt.srcObject=b[tt].remoteStream,Ze.textContent=b[tt].username||"Guest")):(tt=null,mt.srcObject=x,Ze.textContent=Io.textContent||"Guest");else{const s=Object.entries(b).find(([o,a])=>a.slotIndex===r);tt=s?s[0]:null}if(!(r===0&&Object.keys(b).length>0)){mt.srcObject=e.srcObject;const s=t.querySelector(".slot-name");Ze.textContent=s?s.textContent:"Guest"}}Di=Date.now()+3e3});Lc.onclick=async()=>{console.log("Webcam button clicked");try{console.log("Requesting media devices..."),x=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),console.log("Media devices granted:",x)}catch(e){console.error("Error accessing media devices:",e),alert("Error accessing webcam: "+e.message);return}Object.keys(b).forEach(e=>{const r=b[e];if(!r.pc)return;const s=r.pc.getSenders?r.pc.getSenders():[],o=s.some(d=>d.track&&d.track.kind==="audio"),a=s.some(d=>d.track&&d.track.kind==="video"),l=x.getAudioTracks()[0],h=x.getVideoTracks()[0];if(r.transceivers){try{r.transceivers.audio&&l&&r.transceivers.audio.sender.replaceTrack(l)}catch{}try{r.transceivers.video&&h&&r.transceivers.video.sender.replaceTrack(h)}catch{}if(!r.transceivers.audio&&!o&&l)try{r.pc.addTrack(l,x)}catch{}if(!r.transceivers.video&&!a&&h)try{r.pc.addTrack(h,x)}catch{}}else{if(!o&&l)try{r.pc.addTrack(l,x)}catch{}if(!a&&h)try{r.pc.addTrack(h,x)}catch{}}}),dt.srcObject=x;try{const e=x.getVideoTracks()[0],r=x.getAudioTracks()[0];typeof e<"u"&&(Kt=e.enabled===!1,fe.classList.toggle("camera-off",Kt),fe.textContent=Kt?"":"",Pt&&Pt.classList.remove("active")),typeof r<"u"&&(Ot=r.enabled===!1,de.classList.toggle("muted",Ot),de.textContent=Ot?"":"",Mt&&Mt.classList.remove("active"))}catch{}try{Te()}catch{}Fu(),Object.keys(b).length===0&&(mt.srcObject=x),Lu(),await Bp();const n=x.getVideoTracks()[0],t=x.getAudioTracks()[0];n&&(rr=n.getSettings().deviceId,Je.value=rr),t&&(sr=t.getSettings().deviceId,er.value=sr),Eo.disabled=!1,Du.disabled=!1,Lc.disabled=!0,tr.disabled=!1,ku.disabled=!1,de.disabled=!1,fe.disabled=!1,Nu.disabled=!1};Eo.onclick=async()=>{const n=Math.random().toString(36).substring(2,12);fr.value=n,Ye.classList.add("active"),await Ao(n,!0),tr.disabled=!1};wp.onclick=async()=>{const n=Ri.value.trim();if(!n){alert("Please enter a call ID");return}ke.classList.remove("active"),await Ao(n,!1)};tr.onclick=async()=>{await Fp(),tr.disabled=!0};
